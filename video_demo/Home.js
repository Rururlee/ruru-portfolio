import{o as onMounted,a as openBlock,c as createElementBlock,p as pushScopeId,b as popScopeId,d as createBaseVNode}from"./index.js";var muiPlayer_min$1="",commonjsGlobal=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function getDefaultExportFromCjs(N){return N&&N.__esModule&&Object.prototype.hasOwnProperty.call(N,"default")?N.default:N}var muiPlayer_min={exports:{}};/*!
* Mui Player Javascript Library v1.6.0 @Professional edition
* Dateï¼š2021-12-01
* Released under GPL-3.0 license
* https://muiplayer.js.org/
*/(function(module,exports){function _toConsumableArray(N){return _arrayWithoutHoles(N)||_iterableToArray(N)||_unsupportedIterableToArray(N)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _iterableToArray(N){if(typeof Symbol!="undefined"&&N[Symbol.iterator]!=null||N["@@iterator"]!=null)return Array.from(N)}function _arrayWithoutHoles(N){if(Array.isArray(N))return _arrayLikeToArray(N)}function _createForOfIteratorHelper(N,j){var K=typeof Symbol!="undefined"&&N[Symbol.iterator]||N["@@iterator"];if(!K){if(Array.isArray(N)||(K=_unsupportedIterableToArray(N))||j&&N&&typeof N.length=="number"){K&&(N=K);var M=0,j=function(){};return{s:j,n:function(){return M>=N.length?{done:!0}:{done:!1,value:N[M++]}},e:function(w){throw w},f:j}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var S,B=!0,P=!1;return{s:function(){K=K.call(N)},n:function(){var O=K.next();return B=O.done,O},e:function(O){P=!0,S=O},f:function(){try{B||K.return==null||K.return()}finally{if(P)throw S}}}}function _unsupportedIterableToArray(N,j){if(N){if(typeof N=="string")return _arrayLikeToArray(N,j);var K=Object.prototype.toString.call(N).slice(8,-1);return(K=K==="Object"&&N.constructor?N.constructor.name:K)==="Map"||K==="Set"?Array.from(N):K==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(K)?_arrayLikeToArray(N,j):void 0}}function _arrayLikeToArray(N,j){(j==null||j>N.length)&&(j=N.length);for(var K=0,M=new Array(j);K<j;K++)M[K]=N[K];return M}function _typeof(N){return(_typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(j){return typeof j}:function(j){return j&&typeof Symbol=="function"&&j.constructor===Symbol&&j!==Symbol.prototype?"symbol":typeof j})(N)}(function(N,j){_typeof(exports)=="object"&&_typeof(module)=="object"?module.exports=j():N.MuiPlayer=j()})(window,function(){var MuiPlayer=function MuiPlayer(config){var _this=this;_this._global_={};var webpagePlugin="",mobilePlugin="",hls=null,flv=null,option=config||{},plugins=option.plugins||[];this._event_={};var con=typeof option.container=="string"?document.querySelector(option.container):option.container,$CONSTANT,$habit,$node,$global,element,$el,variable,$data,$method;con&&($CONSTANT={unitLengthReg:/^(auto|inherit|initial|\d+(\.\d+)?(\%|px|cm|mm|em|rem|vw|vh|)?)$/i,encodeKey:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"},$habit={themeColor:"#1e98d4"},$node={video:'<!-- HTML5 Video --><div class="video-wrapper"><video width="100%" height="100%"></video></div>',mplayerPoster:'<div class="mplayer-poster" id="mplayer-poster"></div>',mplayerCover:'<!-- \u5A92\u4F53\u64AD\u653E\u906E\u7F69\u5C42 --><div class="mplayer-cover" id="mplayer-cover"></div>',mplayerLoading:'<!-- Mplayer\u52A0\u8F7DLoading --><div class="mplayer-loading"id="mplayer-loading"control><svg viewBox="25 25 50 50"class="mplayer-loading__circular"><circle cx="50"cy="50"r="20"fill="none"></circle></svg></div>',mplayerError:'<!-- \u89C6\u9891\u52A0\u8F7D\u9519\u8BEF\u663E\u793A --><div class="mplayer-error"id="mplayer-error"control><div class="errop-tip">\u89C6\u9891\u52A0\u8F7D\u5931\u8D25\uFF0C\u70B9\u51FB\u5237\u65B0</div><svg t="1575125481608"class="icon"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"p-id="5893"width="28"height="28"><path d="M513.34 831.74C337.03 831.74 193.6 688.31 193.6 512c0-71.09 23.31-138.85 65.53-194.03v51.61c0 17.67 14.33 32 32 32s32-14.33 32-32V239.45c0-5.87-1.59-11.36-4.34-16.09-0.06-0.1-0.11-0.2-0.17-0.3-0.16-0.28-0.34-0.55-0.51-0.82-0.13-0.2-0.26-0.41-0.39-0.61-0.08-0.13-0.17-0.25-0.26-0.37a35.5 35.5 0 0 0-1.58-2.13c-6.81-8.35-16.96-12.35-26.95-11.69h-130c-17.67 0-32 14.33-32 32s14.33 32 32 32h55.35C159.8 339 129.6 423.35 129.6 512c0 51.79 10.15 102.05 30.17 149.38 19.33 45.7 46.99 86.74 82.23 121.97 35.23 35.23 76.27 62.9 121.97 82.23 47.33 20.02 97.59 30.17 149.38 30.17 17.67 0 32-14.33 32-32s-14.34-32.01-32.01-32.01zM855.38 762.3h-51.23c19.81-23 36.93-48.3 50.75-75.22 27.6-53.74 42.18-114.28 42.18-175.08 0-51.79-10.15-102.05-30.17-149.38-19.33-45.7-46.99-86.73-82.23-121.97-35.23-35.23-76.27-62.9-121.97-82.23-47.33-20.02-97.59-30.17-149.38-30.17-17.67 0-32 14.33-32 32s14.33 32 32 32c176.31 0 319.74 143.44 319.74 319.74 0 78.31-27.68 151.61-77.6 209.05l0.24-56.04c0.08-17.67-14.19-32.06-31.86-32.14h-0.14c-17.61 0-31.92 14.24-32 31.86l-0.55 129.43a31.988 31.988 0 0 0 9.32 22.71 31.68 31.68 0 0 0 5.33 4.3c0.02 0.01 0.04 0.02 0.06 0.04 0.48 0.31 0.97 0.61 1.47 0.89l0.15 0.09c0.5 0.28 1 0.54 1.51 0.8 0.03 0.01 0.05 0.03 0.08 0.04 1.64 0.8 3.34 1.46 5.1 1.98 0.01 0 0.02 0.01 0.03 0.01 0.55 0.16 1.1 0.3 1.66 0.43 0.07 0.02 0.15 0.03 0.22 0.05 0.5 0.11 1 0.21 1.5 0.3 0.1 0.02 0.2 0.04 0.3 0.05 0.48 0.08 0.96 0.15 1.44 0.21 0.11 0.01 0.23 0.03 0.34 0.04 0.48 0.05 0.95 0.09 1.43 0.12l0.34 0.03c0.53 0.03 1.07 0.04 1.61 0.05h132.31c17.67 0 32-14.33 32-32s-14.31-31.99-31.98-31.99z"p-id="5894"fill="#ffffff"></path></svg></div>',mplayerHeader:'<!-- Mplayer \u9876\u90E8\u5BFC\u822A --><div class="mplayer-header"id="mplayer-header"><div class="title-groupt"id="title-groupt"><button class="player-btn header-control back-button keyboard-input"id="back-button"control><svg id="back-icon-svg"t="1573891955387"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"p-id="4550"width="18"height="18"><path d="M305.519192 557.640404c-11.636364 0-23.40202-4.39596-32.323232-13.317172-17.842424-17.842424-17.842424-46.674747 0-64.517171L683.830303 69.30101c17.842424-17.842424 46.674747-17.842424 64.517172 0 17.842424 17.842424 17.842424 46.674747 0 64.517172L337.713131 544.323232c-8.921212 8.921212-20.557576 13.317172-32.193939 13.317172z m0 0"fill="#ffffff"p-id="4551"></path><path d="M715.894949 968.145455c-11.636364 0-23.40202-4.39596-32.323232-13.317172L273.19596 544.323232c-17.842424-17.842424-17.842424-46.674747 0-64.517171 17.842424-17.842424 46.674747-17.842424 64.517171 0l410.505051 410.50505c17.842424 17.842424 17.842424 46.674747 0 64.517172-8.921212 8.921212-20.557576 13.317172-32.323233 13.317172z m0 0"fill="#ffffff"p-id="4552"></path></svg><div class="title-name"id="title-name"></div></button></div><div class="buttom-group"id="buttom-group"></div></div>',mplayerFooter:'<!-- Mplayer \u5E95\u90E8\u64CD\u4F5C\u63A7\u4EF6 --><div class="mplayer-footer"id="mplayer-footer"><div class="progress"id="progress"><div class="left-part"id="left-part"><button class="player-btn keyboard-input play-switch footer-control"id="play-switch"control><!--play button--><div class="_play"><svg t="1574051894346"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"p-id="1212"><path d="M324.085 95.787l500.422 300.664c82.373 50.453 79.284 136.946-1.030 186.37v0l-506.6 304.784c-41.187 23.683-87.522 37.068-131.798 9.267-36.037-22.653-46.335-58.691-46.335-97.819v-616.774c0-39.127 13.386-75.166 48.395-97.819 45.305-27.801 94.731-14.416 136.946 11.327v0z"p-id="1213"fill="#ffffff"></path></svg></div><!--pause button--><div class="_pause"style="display: none;"><svg t="1574051952939"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"p-id="1434"><path d="M248.26311111 515.072c0-110.592-0.22755555-221.184 0.11377778-331.776 0.11377778-35.84 18.20444445-60.87111111 49.26577778-70.99733333 27.53422222-8.87466667 56.88888889 0.34133333 75.32088888 23.77955555 10.58133333 13.42577778 15.13244445 28.89955555 15.01866667 45.96622223-0.11377778 223.11822222 0.11377778 446.23644445-0.22755555 669.35466666-0.11377778 42.55288889-31.06133333 73.27288889-70.54222222 72.81777778-39.25333333-0.45511111-68.72177778-31.51644445-68.94933334-74.52444444-0.34133333-111.50222222 0-223.11822222 0-334.62044445zM638.52088889 516.66488889V193.64977778c0-52.45155555 27.42044445-85.21955555 70.54222222-84.65066667 42.43911111 0.56888889 69.17688889 32.42666667 69.17688889 83.05777778 0.11377778 218.22577778 0.11377778 436.56533333 0 654.79111111 0 38.34311111-17.29422222 63.60177778-49.152 73.95555555-27.648 8.98844445-56.54755555 0-75.43466667-23.552-12.17422222-15.13244445-15.36-32.768-15.24622222-51.76888888 0.22755555-109.568 0.11377778-219.136 0.11377778-328.81777778z"p-id="1435"fill="#ffffff"></path></svg></div></button><!--\u76F4\u64AD\u6A21\u5F0F--><button class="player-btn live-mode footer-control"id="live-mode"control><div class="spot"></div><div class="mode-text">\u76F4\u64AD</div></button></div><!--\u5E95\u90E8\u8FDB\u5EA6\u5BB9\u5668--><div class="progress-container"id="progress-container"><!--\u5B89\u5168\u8FDB\u5EA6\u65F6\u957F--><div class="progress-begin"id="progress-begin">\u5F00\u59CB</div><!--\u62D6\u52A8\u6709\u6548\u7684\u4F5C\u7528\u57DF--><div class="touch-effective"id="touch-effective"><!--\u52A0\u8F7D\u8FDB\u5EA6\u6761\u603B\u957F--><div class="progress-total"id="progress-total"></div><!--\u8D44\u6E90\u7F13\u5B58\u8FDB\u5EA6--><div class="progress-buffered"id="progress-buffered"></div><!--\u64AD\u653E\u8FDB\u5EA6--><div class="progress-play"id="progress-play"></div><!--\u62D6\u52A8\u8FDB\u5EA6\u7403--><div class="ball-container"><div class="progress-drag"id="progress-ball"><div class="progress-ball"></div></div></div></div><!--\u603B\u65F6\u957F--><div class="progress-long"id="progress-long">\u7ED3\u675F</div></div><div class="right-part"id="right-part"><!--\u5168\u5C4F\u5F00\u5173--><button class="player-btn keyboard-input full-switch footer-control"id="full-switch"tooltip="\u5168\u5C4F"control><div class="_full"><svg t="1607611836872"class="icon"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"p-id="2384"><path d="M842 797.08l-226.07999999-226.08a30 30 0 0 0-42.42000001 42.42000001L799.58 839.5 692 839.5a30 30 0 0 0 0 60L872 899.5a29.91 29.91 0 0 0 30-29.99999999l0-180a30 30 0 0 0-60 0l0 107.57999999zM130.79 128.29A29.91 29.91 0 0 1 152 119.5l180 0a30 30 0 0 1 0 60l-107.58 0 226.08 226.08a30 30 0 0 1-42.42000001 42.42L182 221.92 182 329.50000001a30 30 0 0 1-60 0L122 149.50000001a29.91 29.91 0 0 1 8.79-21.21000001z"fill="#ffffff"p-id="2385"></path></svg></div><div class="_unfull"style="display: none;"><svg t="1607611848290"class="icon"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"p-id="2546"><path d="M416.00000001 370.752L174.848 129.59999999a32 32 0 0 0-45.24800001 45.24800001L370.752 416.00000001 256 416a32 32 0 0 0 0 64l192 0a31.904 31.904 0 0 0 32-32L480 256a32 32 0 0 0-64 0l1e-8 114.752z m137.37599999 182.624A31.904 31.904 0 0 1 576 544L768 544a32 32 0 0 1 0 64l-114.752-1e-8 241.15200001 241.15200001a32 32 0 1 1-45.24800001 45.24800001L607.99999999 653.248 608 768a32 32 0 0 1-64 0l0-192a31.904 31.904 0 0 1 9.376-22.624z"fill="#ffffff"p-id="2547"></path></svg></div></button></div></div></div>',miniProgress:'<!-- Mplayer \u5E95\u90E8\u64AD\u653E\u8FF7\u4F60\u8FDB\u5EA6\u6761 --><div class="mini-progress"id="mini-progress"><!--\u52A0\u8F7D\u8FDB\u5EA6\u6761\u603B\u957F--><div class="mini-total"id="mini-total"></div><!--\u8D44\u6E90\u7F13\u5B58\u8FDB\u5EA6--><div class="mini-buffered"id="mini-buffered"></div><!--\u64AD\u653E\u8FDB\u5EA6--><div class="mini-play"id="mini-play"></div></div>'},$global=function(){return{first_authplay:!1,isReady:!1,webpagePlugin:{},mobilePlugin:{},cssAutoprefixer:["webkit","ms","moz","o"]}},element=function(){return{mPlayer:con,videoObject:con.querySelector("video"),mplayerCover:con.querySelector("#mplayer-cover"),mplayerPoster:con.querySelector("#mplayer-poster"),mplayerHeader:con.querySelector("#mplayer-header"),headerMenu:con.querySelector("#buttom-group"),backButton:con.querySelector("#back-button"),mplayerFooter:con.querySelector("#mplayer-footer"),progressContainer:con.querySelector("#progress-container"),playSwitch:con.querySelector("#play-switch"),fullSwitch:con.querySelector("#full-switch"),progressBall:con.querySelector("#progress-ball"),progressBegin:con.querySelector("#progress-begin"),progressLong:con.querySelector("#progress-long"),touchEffective:con.querySelector("#touch-effective"),progressBuffered:con.querySelector("#progress-buffered"),progressPlay:con.querySelector("#progress-play"),miniProgress:con.querySelector("#mini-progress"),miniBuffered:con.querySelector("#mini-buffered"),miniPlay:con.querySelector("#mini-play"),mplayerLoading:con.querySelector("#mplayer-loading"),mplayerError:con.querySelector("#mplayer-error")}},$el=new element,variable=function(){return{mediaPlayDirectives:0,isFullScreen:!1,showScreenControls:!1,ball_move_status:!1,isPlay:!1,mediaStatus:!1,duration:0,percentage:0,currentTime:0,playError:0,isDestory:!1,startX:null,startY:null,moveX:null,moveY:null,_defaultPlayProgressPro:null,isTouchMove:!1}},$data=new variable,$method={getLanguageText:function(){return{"zh-cn":{srcNull:"\u89C6\u9891\u5730\u5740\u4E3A\u7A7A",begin:"\u5F00\u59CB",end:"\u7ED3\u675F",live:"\u76F4\u64AD",settings:"\u8BBE\u7F6E",coveredPlay:"\u94FA\u6EE1\u64AD\u653E",loopPlay:"\u5FAA\u73AF\u64AD\u653E",playbackSpeed:"\u64AD\u653E\u901F\u5EA6",share:"\u5206\u4EAB",pictureInPicture:"\u753B\u4E2D\u753B",exitPictureInPicture:"\u9000\u51FA\u753B\u4E2D\u753B",pageScreen:"\u7F51\u9875\u5168\u5C4F",exitPageScreen:"\u9000\u51FA\u7F51\u9875\u5168\u5C4F",fullScreen:"\u5168\u5C4F",exitFullScreen:"\u9000\u51FA\u5168\u5C4F",normal:"\u6B63\u5E38",open:"\u6253\u5F00",subtitles:"\u5B57\u5E55",selectLangage:"\u9009\u62E9\u8BED\u8A00",dsps:"\u5207\u6362\u5230\u9ED8\u8BA4\u500D\u901F\u5EA6\u64AD\u653E",tsps:"\u5207\u6362\u5230?\u500D\u901F\u5EA6\u64AD\u653E",errorTip:"\u89C6\u9891\u52A0\u8F7D\u5931\u8D25\uFF0C\u70B9\u51FB\u5237\u65B0",shortcuts:"\u5FEB\u6377\u952E",shortcutsPanel:{title:"\u5FEB\u6377\u529F\u80FD",space:"\u7A7A\u683C",spaceAction:"\u64AD\u653E/\u6682\u505C",esc:"\u9000\u51FA\u5168\u5C4F",up:"\u97F3\u91CF\u589E\u52A05%",down:"\u97F3\u91CF\u51CF\u5C115%",right:"\u5FEB\u8FDB5\u79D2",left:"\u5FEB\u90005\u79D2"}},en:{srcNull:"Video address is empty",begin:"Begin",end:"End",live:"Live",settings:"Settings",coveredPlay:"Covered play",loopPlay:"Loop play",playbackSpeed:"Playback speed",share:"Share",pictureInPicture:"Picture in picture",exitPictureInPicture:"Exit picture in picture",pageScreen:"Page screen",exitPageScreen:"Exit page screen",fullScreen:"Full screen",exitFullScreen:"Exit full screen",normal:"Normal",open:"Open",subtitles:"Subtitles",selectLangage:"Select langage",dsps:"to default speed playback",tsps:"to ?x speed playback",errorTip:"Video failed to load, click refresh",shortcuts:"Shortcuts",shortcutsPanel:{title:"Shortcuts function",space:"Space",spaceAction:"play/pause",esc:"exit full screen",up:"voice increase 5%",down:"voice reduce 5%",right:"fast forward 5 seconds",left:"fast backward 5 seconds"}},"zh-tw":{srcNull:"\u8996\u983B\u5730\u5740\u70BA\u7A7A",begin:"\u958B\u59CB",end:"\u7D50\u675F",live:"\u76F4\u64AD",settings:"\u8A2D\u7F6E",coveredPlay:"\u92EA\u6EFF\u64AD\u653E",loopPlay:"\u5FAA\u74B0\u64AD\u653E",playbackSpeed:"\u64AD\u653E\u901F\u5EA6",share:"\u5206\u4EAB",pictureInPicture:"\u756B\u4E2D\u756B",exitPictureInPicture:"\u9000\u51FA\u756B\u4E2D\u756B",pageScreen:"\u7DB2\u9801\u5168\u5C4F",exitPageScreen:"\u9000\u51FA\u7DB2\u9801\u5168\u5C4F",fullScreen:"\u5168\u5C4F",exitFullScreen:"\u9000\u51FA\u5168\u5C4F",normal:"\u6B63\u5E38",open:"\u6253\u958B",subtitles:"\u5B57\u5E55",selectLangage:"\u9078\u64C7\u8A9E\u8A00",dsps:"\u5207\u63DB\u5230\u9ED8\u8A8D\u500D\u901F\u5EA6\u64AD\u653E",tsps:"\u5207\u63DB\u5230?\u500D\u901F\u5EA6\u64AD\u653E",errorTip:"\u8996\u983B\u52A0\u8F09\u5931\u6557\uFF0C\u9EDE\u64CA\u5237\u65B0",shortcuts:"\u5FEB\u6377\u9375",shortcutsPanel:{title:"\u5FEB\u6377\u529F\u80FD",space:"\u7A7A\u683C",spaceAction:"\u64AD\u653E/\u66AB\u505C",esc:"\u9000\u51FA\u5168\u5C4F",up:"\u97F3\u91CF\u589E\u52A05%",down:"\u97F3\u91CF\u51CF\u5C115%",right:"\u5FEB\u90325\u79D2",left:"\u5FEB\u90005\u79D2"}}}},getLangObject:function(){var N=option.lang||navigator.language||navigator.browserLanguage||"zh-cn";return["zh-cn","en","zh-tw"].indexOf(N.toLowerCase())!=-1?$method.getLanguageText()[N.toLowerCase()]:$method.getLanguageText()["zh-cn"]},initCreateMplayer:function(N){for(var j=$node.video+$node.mplayerPoster+$node.mplayerCover+$node.mplayerLoading+$node.mplayerError+$node.mplayerHeader+$node.mplayerFooter+$node.miniProgress,j=$node.logWrite?j+$node.logWrite:j,K=0;K<plugins.length;K++)$method.returnSys()!="androd"&&$method.returnSys()!="ios"||plugins[K]instanceof Object&&plugins[K].name=="MuiPlayerMobilePlugin"&&(mobilePlugin=plugins[K]),$method.returnSys()=="window"&&plugins[K]instanceof Object&&plugins[K].name=="MuiPlayerDesktopPlugin"&&(webpagePlugin=plugins[K]);j=j.toString().replace(/<!--.*?-->/g,""),j=$method.createRangeIsDocFragment(j),j=$method.initConifgAttribute(j,N),j=$method.initConfigControl(j),j=$method.initConfigCustom(j),j=$method.initConfigTheme(j),N={option,_this,$el:element,$data,$method,$habit,$CONSTANT},mobilePlugin&&(j=mobilePlugin.appendTemplate(j,N)),webpagePlugin&&(j=webpagePlugin.appendTemplate(j,N)),N=con.querySelector("#mplayer-media-wrapper"),N&&$method.removeNode(con,"#mplayer-media-wrapper"),(N=document.createElement("div")).setAttribute("id","mplayer-media-wrapper"),N.setAttribute("class","player-wrapper"),N.appendChild(j),$el.mPlayer.appendChild(N),option.src?($method.playerReady(),setTimeout(function(){_this._global_.isReady=!0,_this.emit("ready"),setTimeout(function(){$method.onScreenResize({type:"showControls"})},10)},100)):$method.showToast($method.getLangObject().srcNull)},onAction:function(){},playerReady:function(){$method.resetVariable(),option.autoplay===!0&&($data.mediaPlayDirectives=1,$method.onPlay()),$method.toggleEventListenerGlobal("add","playerReady"),$method.toggleEventListenerCustom("add"),$method.nodesObserver()},overloadingEl:function(){$el=new element;for(var N=0,j=Object.keys($el);N<j.length;N++){var K=j[N];K!="mPlayer"&&($el[K]||($el[K]={style:{},classList:{add:function(){},contains:function(){},remove:function(){}},addEventListener:function(){},removeEventListener:function(){}}),$el[K].querySelector=function(M){return M=this.querySelectorAll?this.querySelectorAll(M):[],M[0]||{exist:!1,style:{},height:"",width:""}})}},resetVariable:function(){for(var N=new variable,j=0;j<Object.keys(N).length;j++){var K=Object.keys(N)[j];$data[K]=N[K]}$method.overloadingEl(),_this._global_=new $global},plusRuntimeHandle:function(N){(N=N||{}).type=="resume"&&(_this._global_._beferPlayState&&$el.videoObject.play(),$data.isFullScreen&&plus.navigator.hideSystemNavigation()),N.type=="pause"&&(_this._global_._beferPlayState=$data.isPlay,$el.videoObject.pause())},runtimeCompatibleHandle:function(N){(N=N||{}).type=="webkitbeginfullscreen"&&$method.createTimerCloseControl({type:"cancel"}),N.type=="webkitendfullscreen"&&$method.createTimerCloseControl()},assginConfig:function(){option.themeColor&&($habit.themeColor=option.themeColor)},parseCamel:function(N){return N.replace(/\B([A-Z])/g,"-$1").toLowerCase()},createRangeIsDocFragment:function(N){var j=document.createRange();return j.selectNode($el.mPlayer),j.createContextualFragment(N)},consoleLog:function(N,j){},removeNode:function(N,j){N instanceof Element||N instanceof DocumentFragment?(N=N.querySelector(j))instanceof Element?N.parentNode.removeChild(N):console.warn("the body element not query the selector node......"):(j=document.querySelector(j))?j.parentNode.removeChild(j):console.warn("from document not query the selector node......")},getKeyCode:function(N){return N.keyCode||N.which||""},focusToggle:function(N){$el.mPlayer.classList[N=="ON"?"add":"remove"]("mp-keyboard-focus")},setElementStyle:function(N,j){var K=Object.keys(j);if(0<K.length){var M,S=_createForOfIteratorHelper(K);try{for(S.s();!(M=S.n()).done;){var B=M.value;N.style[$method.parseCamel(B)]=j[B]}}catch(P){S.e(P)}finally{S.f()}N.setAttribute("stylesheet",JSON.stringify(j))}},initConfigTheme:function(N){return $method.assginConfig(),N.querySelector("#progress-play")&&(N.querySelector("#progress-play").style.background=$habit.themeColor),N.querySelector("#mplayer-loading")&&(N.querySelector("#mplayer-loading").style.color=$habit.themeColor),N.querySelector("#mini-play")&&(N.querySelector("#mini-play").style.background=$habit.themeColor),N.querySelector("#live-mode")&&(N.querySelector("#live-mode .spot").style.background=$habit.themeColor),N},initConfigCustom:function(N){for(var j=option.custom||{},K=j.headControls||[],M=0;M<K.length&&!(5<=M);M++)K[M]instanceof Object&&K[M].slot&&(B=K[M].slot,(P=$el.mPlayer.querySelector("[slot="+B+"]"))&&(O=P.tagName=="TEMPLATE"?P.content.cloneNode(!0):$method.createRangeIsDocFragment(P.innerHTML),(w=document.createElement("button")).setAttribute("class","player-btn header-control"),w.setAttribute("slot",B),w.setAttribute("control",""),K[M].click instanceof Function&&w.classList.add("keyboard-input"),K[M].style&&K[M].style instanceof Object&&$method.setElementStyle(w,K[M].style),w.appendChild(O),N.querySelector("#buttom-group").insertBefore(w,N.querySelector("#buttom-group .header-control")),P.style.display="none"));for(var S=j.footerControls||[],M=0;M<S.length&&!(5<=M);M++)S[M]instanceof Object&&S[M].slot&&(B=S[M].slot,(P=$el.mPlayer.querySelector("[slot="+B+"]"))&&(O=P.tagName=="TEMPLATE"?P.content.cloneNode(!0):$method.createRangeIsDocFragment(P.innerHTML),(w=document.createElement("button")).setAttribute("class","player-btn footer-control"),w.setAttribute("slot",B),w.setAttribute("control",""),S[M].tooltip&&w.setAttribute("tooltip",S[M].tooltip),S[M].click instanceof Function&&w.classList.add("keyboard-input"),S[M].style&&S[M].style instanceof Object&&$method.setElementStyle(w,S[M].style),w.appendChild(O),S[M].position=="left"?N.querySelector("#mplayer-footer #left-part").appendChild(w):N.querySelector("#mplayer-footer #right-part").insertBefore(w,N.querySelector("#mplayer-footer #right-part").childNodes[0]),P.style.display="none"));for(var B,P,O,w,_,R=j.rightSidebar||[],M=0;M<R.length&&!(5<=M);M++)R[M]instanceof Object&&R[M].slot&&(B=R[M].slot,(P=$el.mPlayer.querySelector("[slot="+B+"]"))&&(O=P.tagName=="TEMPLATE"?P.content.cloneNode(!0):$method.createRangeIsDocFragment(P.innerHTML),(w=document.createElement("div")).appendChild(O),w.setAttribute("slot",B),w.setAttribute("class","mplayer-sidebar"),_=R[M].width||"",$CONSTANT.unitLengthReg.test(_)&&(w.style.width=isNaN(Number(_))?_:_+"px"),N.appendChild(w),P.style.display="none"));return N},initConfigControl:function(N){option.showMiniProgress!==!1&&option.live!==!0||$method.removeNode(N,"#mini-progress"),option.live===!0?(N.querySelector("#live-mode .mode-text").innerText=$method.getLangObject().live,$method.removeNode(N,"#progress-container")):$method.removeNode(N,"#live-mode"),option.pageHead===!1&&(N.querySelector("#mplayer-header").style.opacity=0);var j=option.subtitle||{},K=j.tracks,M=j.styles;if(Object.prototype.toString.call(K)==="[object Array]"&&0<K.length){for(var S=document.createDocumentFragment(),B=0;B<K.length;B++){var P,O=K[B];_typeof(O)=="object"&&/.\.vtt$/.test(O.src)&&((P=document.createElement("track")).setAttribute("src",O.src),P.setAttribute("kind",O.kind||"subtitles"),P.setAttribute("label",O.label||"\u5B57\u5E55"+(B+1)),O.srclang&&P.setAttribute("srclang",O.srclang),O.default===!0&&P.setAttribute("default",!0),S.appendChild(P))}N.querySelector("video").appendChild(S)}if(Object.prototype.toString.call(M)=="[object Object]"&&0<Object.keys(M).length){var w=document.createElement("style");w.setAttribute("id","pseudo-classes-cue"),w.setAttribute("type","text/css");for(var _="",R=0,C=Object.keys(M);R<C.length;R++){var T=C[R];_+=$method.parseCamel(T)+":"+M[T]+"!important;"}j=document.createTextNode(".m-player video::cue {"+_+"}"),w.appendChild(j),document.getElementsByTagName("head").item(0).appendChild(w)}return N},initConifgAttribute:function(N,j){var S=$el.mPlayer.getBoundingClientRect(),P=S.width,K=S.height;$el.mPlayer.classList.add("m-player"),$el.mPlayer.setAttribute("tabindex","0");var M,S=option.width||"auto";!$CONSTANT.unitLengthReg.test(S)&&j!==!0||$data.isFullScreen||(M=isNaN(Number(S))?S:S+"px",$el.mPlayer.style.width=j===!0?P+"px":M,j===!0&&setTimeout(function(){$el.mPlayer.style.width=M},800));var B,P=option.height||"225px";!$CONSTANT.unitLengthReg.test(P)&&j!==!0||$data.isFullScreen||(B=isNaN(Number(P))?P:P+"px",$el.mPlayer.style.height=j===!0?K+"px":B,j===!0&&option.autoFit===!1&&setTimeout(function(){$el.mPlayer.style.height=B},800)),0<=option.volume&&option.volume<=1&&(N.querySelector("video").volume=option.volume),option.muted===!0&&(N.querySelector("video").muted=!0);function O(R,C){var T=N.querySelector("video");if(R=="src"){var D=option.parse||{},c=D.type,A=D.loader,L=D.config||{};if(D.customKernel&&D.customKernel instanceof Function)return console.info("custom kernel..."),D.customKernel(T,C),0;if(T.setAttribute(R,C),c=="hls"){if(typeof A!="function")return;A.isSupported()==1?$method.hlsDecodeAction(T,C,{loader:A,config:L}):console.error("browser does not support hls js. to check whether your browser is supporting MediaSource Extensions.")}c=="flv"&&_typeof(A)=="object"&&(A.isSupported()==1?$method.flvDecodeAction(T,C,{loader:A,config:L}):console.error("browser does not support flv js. to check whether your browser is supporting MediaSource Extensions."))}else T.setAttribute(R,C)}option.src&&O("src",option.src),option.autoplay===!0&&O("autoplay","autoplay"),option.autoplay==1||option.preload&&O("preload",option.preload),option.loop&&O("loop","loop");var w=option.videoAttribute||[];if(0<w.length)for(var _=0;_<w.length;_++)O(w[_].attrKey,w[_].attrValue);return option.poster?((j=document.createElement("img")).setAttribute("src",option.poster),j.setAttribute("style","width: 100%;height: 100%;object-fit: cover;"),N.querySelector("#mplayer-poster").appendChild(j)):$method.removeNode(N,"#mplayer-poster"),option.title&&(N.querySelector("#title-name").innerHTML=option.title),option.initFullFixed===!0&&$el.mPlayer.classList.add("page-fullscreen"),option.dragSpotShape=="square"&&(N.querySelector("#progress-ball .progress-ball").style.borderRadius="3px",N.querySelector("#progress-ball .progress-ball").style.width="9px",N.querySelector("#progress-ball .progress-ball").style.height="14px"),option.objectFit=="cover"&&N.querySelector("video").classList.add("covered"),N.querySelector("#mplayer-footer #full-switch").setAttribute("tooltip",$method.getLangObject().fullScreen),N.querySelector("#mplayer-error .errop-tip").innerText=$method.getLangObject().errorTip,N.querySelector("#progress-begin").innerText=$method.getLangObject().begin,N.querySelector("#progress-long").innerText=$method.getLangObject().end,N},hlsDecodeAction:function(N,j,K){console.info("hls create...");var M=Object.assign({autoStartLoad:option.autoplay===!0||option.preload!="none"},K.config);(hls=new K.loader(M)).attachMedia(N),hls.on(K.loader.Events.MEDIA_ATTACHED,function(){hls.loadSource(j)}),hls.on(K.loader.Events.ERROR,$method.onError)},flvDecodeAction:function(N,j,K){console.info("flv create..."),j=Object.assign({type:"flv",url:j},K.config),(flv=K.loader.createPlayer(j)).attachMediaElement(N),option.autoplay!==!0&&option.preload=="none"||flv.load(),flv.on(K.loader.Events.ERROR,$method.onError)},hasNotchInScreen:function(){return!!window.plus&&plus.navigator.hasNotchInScreen()},applicationFullHandle:function(N){window.plus&&(this._landscape_lock=function(){plus.navigator.setFullscreen(!0),plus.screen.lockOrientation("landscape"),setTimeout(function(){plus.navigator.hideSystemNavigation()},200),setTimeout(function(){var j=plus.navigator.getStatusbarHeight(),j=$method.hasNotchInScreen()?j+10:10;$el.mplayerHeader.style.paddingLeft=j+"px",$el.mplayerHeader.style.paddingRight=j+"px",$el.mplayerFooter.style.paddingLeft=j+"px",$el.mplayerFooter.style.paddingRight=j+"px",$el.progressContainer.style.left=j+"px",$el.progressContainer.style.right=j+"px"},100)},this._portrait_lock=function(){plus.navigator.setFullscreen(!1),plus.screen.lockOrientation("portrait"),setTimeout(function(){$el.mplayerHeader.style.paddingLeft="10px",$el.mplayerHeader.style.paddingRight="10px",$el.mplayerFooter.style.paddingLeft="10px",$el.mplayerFooter.style.paddingRight="10px"},100)})},setTooltipText:function(N,j){N.setAttribute&&N.setAttribute("tooltip",j),$el.mplayerFooter.querySelector(".mp-tooltip").innerText=j},fullToggle:function(N){(N=N||{type:""}).stopPropagation&&N.stopPropagation(),_this._global_.generate_fullscreen_listener||(_this._global_.generate_fullscreen_listener=!0,$el.mPlayer.requestFullscreen?document.addEventListener("fullscreenchange",function(){document.fullscreenElement?$method.fullScreenChangeAction("Y"):$method.fullScreenChangeAction("N")}):$el.mPlayer.webkitRequestFullscreen?document.addEventListener("webkitfullscreenchange",function(){document.webkitFullscreenElement?$method.fullScreenChangeAction("Y"):$method.fullScreenChangeAction("N")}):$el.mPlayer.mozRequestFullScreen?document.addEventListener("mozfullscreenchange",function(){document.mozFullScreenElement?$method.fullScreenChangeAction("Y"):$method.fullScreenChangeAction("N")}):$el.mPlayer.msRequestFullscreen&&document.addEventListener("msfullscreenchange",function(){document.msFullscreenElement?$method.fullScreenChangeAction("Y"):$method.fullScreenChangeAction("N")})),$data.isFullScreen?$method.closeFullScreen():$method.openFullScreen()},fullScreenChangeAction:function(N){N=="Y"?($data.isFullScreen=!0,$el.fullSwitch.querySelector("._full").style.display="none",$el.fullSwitch.querySelector("._unfull").style.display="block",$method.setTooltipText($el.fullSwitch,$method.getLangObject().exitFullScreen)):N=="N"&&($data.isFullScreen=!1,$el.fullSwitch.querySelector("._full").style.display="block",$el.fullSwitch.querySelector("._unfull").style.display="none",$method.setTooltipText($el.fullSwitch,$method.getLangObject().fullScreen),$el.mPlayer.classList.contains("browser-fullscreen")&&$method.closeFullScreen("completed")),window.plus&&($data.isPlay?plus.device.setWakelock(!0):plus.device.setWakelock(!1))},closeFullScreen:function(N){function j(){$data.isFullScreen=!1,$method.createTimerCloseControl(),$el.mPlayer.classList.remove("browser-fullscreen"),N!="completed"&&(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen())}option.autoOrientaion!=0&&window.plus&&$method.returnSys()!="ios"?(new $method.applicationFullHandle()._portrait_lock(),setTimeout(function(){j(),option.pageHead===!1&&($el.mplayerHeader.style.opacity=0)},100)):(j(),option.pageHead===!1&&($el.mplayerHeader.style.opacity=0))},openFullScreen:function(){var N;$method.returnSys()!="ios"?(N=function(){$el.mPlayer.requestFullscreen?$el.mPlayer.requestFullscreen():$el.mPlayer.webkitRequestFullscreen?$el.mPlayer.webkitRequestFullscreen():$el.mPlayer.mozRequestFullScreen?$el.mPlayer.mozRequestFullScreen():$el.mPlayer.msRequestFullscreen&&$el.mPlayer.msRequestFullscreen(),$data.isFullScreen=!0,$method.createTimerCloseControl(),$el.mPlayer.classList.add("browser-fullscreen")},option.autoOrientaion!=0&&window.plus?(new $method.applicationFullHandle()._landscape_lock(),setTimeout(function(){N(),option.pageHead===!1&&($el.mplayerHeader.style.opacity=1)},100)):(N(),option.pageHead===!1&&($el.mplayerHeader.style.opacity=1))):$el.videoObject.webkitEnterFullscreen()},onPlayTap:function(N){(N=N||{type:""}).stopPropagation&&N.stopPropagation();var j=$el.playSwitch.querySelector("._play").style.display;if($el.playSwitch.querySelector("._pause").style.display,$data.isPlay||j=="none")$el.videoObject.pause();else if(!$data.isPlay){if(!option.src)return void $method.showToast($method.getLangObject().srcNull);!hls&&!flv||$data.mediaStatus?($data.mediaPlayDirectives=0,$el.videoObject.play()):($data.mediaPlayDirectives=1,hls&&hls.startLoad(),flv&&flv.load()),_this._global_.mp_timeout_4||(_this._global_.mp_timeout_4=setTimeout(function(){_this._global_.mp_timeout_4=null,$data.isPlay||$method.showLoading()},500))}$method.createTimerCloseControl(N)},onContrainerTap:function(N){var j;(N=N||{}).stopPropagation&&N.stopPropagation(),$data.isTouchMove||(j=function(K){_this._global_.triggerDblclickEvent||(mobilePlugin?new mobilePlugin.interface(N)._onAgentMpTap("dbclick"):webpagePlugin?new webpagePlugin.interface(N)._onAgentMpTap("dbclick"):$method.onPlayTap({type:"dblscreen"}),_this._global_.triggerDblclickEvent=!0,setTimeout(function(){_this._global_.triggerDblclickEvent=!1},310))},_this._global_.clickCount=_this._global_.clickCount||0,_this._global_.clickCount++,_this._global_.clickCount==2?(j(),_this._global_.clickCount=0):(_this._global_.mp_timeout_2&&clearTimeout(_this._global_.mp_timeout_2),_this._global_.mp_timeout_2=setTimeout(function(){_this._global_.clickCount==1&&(_this._global_.triggerDblclickEvent||(mobilePlugin?new mobilePlugin.interface(N)._onAgentMpTap("click"):webpagePlugin?new webpagePlugin.interface(N)._onAgentMpTap("click"):$method.toggleControlsDisplay(N))),_this._global_.clickCount=0},300)),N.type=="dblclick"&&(j(),_this._global_.clickCount=0))},changeVideoSize:function(P){P=P||{};var j,K,M,S,B=$el.videoObject,P=(option.subtitle||{}).tracks;Object.prototype.toString.call(P)==="[object Array]"&&0<P.length&&B.videoHeight&&B.videoWidth&&$method.returnSys()=="window"&&(P=$el.mPlayer.getBoundingClientRect(),j=P.width,K=P.height,M=B.videoHeight/B.videoWidth,S=K/j,!(P=$el.mPlayer.classList).contains("browser-fullscreen")&&!P.contains("page-fullscreen")&&option.autoFit!=0||S.toFixed(2)>M.toFixed(2)?(B.style.width=j.toFixed()+"px",B.style.height=(j*M).toFixed()+"px"):S.toFixed(2)<M.toFixed(2)?(B.style.height=K.toFixed()+"px",B.style.width=(K/M).toFixed()+"px"):(B.style.width=j.toFixed()+"px",B.style.height=K.toFixed()+"px"))},onPause:function(N){$data.isPlay=!1,setTimeout(function(){$method.hideLoading()},500),$el.playSwitch.querySelector("._play").style.display="block",$el.playSwitch.querySelector("._pause").style.display="none",window.plus&&plus.device.setWakelock(!1)},onPlay:function(N){setTimeout(function(){$method.computeLoadingStatus(function(j){j||$data.playError||$method.showLoading()})},500)},onPlaying:function(){$method.computeLoadingStatus(function(N){N&&($method.hideLoading(),$method.hideCover(),option.live||$method.onTimeupdate())}),window.plus&&plus.device.setWakelock(!0),$data.isPlay=!0,1<$data.duration&&$el.videoObject.style.opacity!=1&&setTimeout(function(){$el.videoObject.style.opacity=1},500),$el.playSwitch.querySelector("._play").style.display="none",$el.playSwitch.querySelector("._pause").style.display="block",$el.mplayerError.style.display!="none"&&($el.mplayerError.style.display="none"),option.poster&&$el.mplayerPoster.style.display!="none"&&($el.mplayerPoster.style.display="none"),option.autoFit!=0&&1<$data.duration&&$el.mPlayer.style.height!="auto"&&!$data.isFullScreen&&($el.mPlayer.style.height="auto")},computeLoadingStatus:function(N){var j=0;(function K(){var M=$el.videoObject.duration||0,S=$el.videoObject.currentTime||0;1<M||0<S?N(!0):1e3<=j?N(!1):setTimeout(function(){j+=200,K()},200)})()},onBack:function(N){N.stopPropagation(),$data.isFullScreen?$method.fullToggle():_this.emit("back"),$method.createTimerCloseControl()},onCanplaythrough:function(N){$method.hideCover(),$method.hideLoading()},onDurationChange:function(N){$el.videoObject.duration;var j;1<(j=$el.videoObject.duration)&&($data.mediaStatus=!0,$data.duration=j,_this.emit("duration-change",{duration:j}),$data.mediaPlayDirectives!=1||_this._global_.first_authplay||(_this._global_.first_authplay=!0,$el.videoObject.play(),$method.hideLoading()),j!=1/0&&(j=$method.formatCurrentTime($data.duration),$el.progressLong.innerHTML=j,$el.progressBegin.innerHTML="00:00"),$el.videoObject.style.opacity!=1&&setTimeout(function(){$el.videoObject.style.opacity=1},500),option.autoFit!=0&&$el.mPlayer.style.height!="auto"&&($el.mPlayer.style.height="auto"),$method.changeVideoSize(N))},dc:function dc(str){for(var b,b1,b2,b3,d=0,s,s=new Array(Math.floor(str.length/3)),b=s.length,i=0;i<b;i++)b1=$CONSTANT.encodeKey.indexOf(str.charAt(d)),d++,b2=$CONSTANT.encodeKey.indexOf(str.charAt(d)),d++,b3=$CONSTANT.encodeKey.indexOf(str.charAt(d)),d++,s[i]=36*b1*36+36*b2+b3;return b=eval("String.fromCharCode("+s.join(",")+")"),b},formatCurrentTime:function(N){var j=0<(j=parseInt(N/3600))?j+":":"",K=parseInt(N%3600/60);return K=(K=0<K&&K.toString().length==1?"0"+K+":":K+":")==0?"00:":K,N=parseInt(N%60),N=(N=0<N&&N.toString().length==1?"0"+N:N)==0?"00":N,j.toString()+K.toString()+N.toString()},updateProgressBar:function(N){$data.percentage=N,$el.progressBall.style.left=$data.percentage+"%",$el.progressPlay.style.width=$data.percentage+"%",$method.computePlayTime($data.percentage,$data.duration,function(j){$el.progressBegin.innerHTML=j}),_this.emit("seek-progress",{percentage:N})},progressControlHandle:function(N,j,K,M){$method.computeProgress(N,j,function(S){S=Number.parseFloat($data._defaultPlayProgressPro||0)+S*(K||1),100<=S?S=100:S<=0&&(S=0),$method.updateProgressBar(S),M&&M()})},computeProgress:function(N,j,K){K(N/j.getBoundingClientRect().width*100)},computePlayTime:function(N,j,K){100<=N?N=100:N<=0&&(N=0),$data.currentTime=N/100*j,K($method.formatCurrentTime($data.currentTime))},onTimeupdate:function(N){var j,K;$data.duration<=1||$data.duration==1/0||(j=$el.videoObject.currentTime||0)<.1||(K=j/$data.duration*100,$el.miniPlay.style.width=(K=100<=K?100:K)+"%",$data.ball_move_status||function(){$el.progressBall.style.left=K+"%",$el.progressPlay.style.width=K+"%";var M=$method.formatCurrentTime(j);$el.progressBegin.innerHTML!=M&&($el.progressBegin.innerHTML=M)}(),option.live||(_this._global_.playingState=!1,_this._global_.mp_timeout_5&&clearTimeout(_this._global_.mp_timeout_5),_this._global_.mp_timeout_5=setTimeout(function(){!_this._global_.playingState&&$data.isPlay&&$method.showLoading()},700),$data.isPlay&&(_this._global_.beginTimeDot?(_this._global_.endTimeDot=new Date,_this._global_.endTimeDot.getTime()-_this._global_.beginTimeDot.getTime()<=700&&(_this._global_.playingState=!0,$method.hideLoading(),clearTimeout(_this._global_.mp_timeout_5)),_this._global_.nextTimeUpdateState=!1,_this._global_.mp_timeout_6&&clearTimeout(_this._global_.mp_timeout_6),_this._global_.mp_timeout_6=setTimeout(function(){!_this._global_.nextTimeUpdateState&&$data.isPlay&&$method.showLoading()},700),_this._global_.beginTimeDot=null):(_this._global_.beginTimeDot=new Date,_this._global_.nextTimeUpdateState=!0))),$data.mediaStatus||$method.onDurationChange(N))},progressBarSeeking:function(N){if((N=N||{}).stopPropagation&&N.stopPropagation(),N.preventDefault&&N.preventDefault(),$data.mediaStatus&&$data.duration!=1/0&&$data.duration!="NaN"){var j=function(){$data.ball_move_status=!0,$method.createTimerCloseControl({type:"cancel"}),$data.startX=(N.type=="touchstart"?N.touches[0]:N).clientX,$data._defaultPlayProgressPro=0;var S=$el.touchEffective.getClientRects()[0],S=$data.startX-S.left;$method.progressControlHandle(S,$el.touchEffective),$data._defaultPlayProgressPro=$el.progressPlay.style.width.substr(0,$el.progressPlay.style.width.length-1)||0,N.type=="touchstart"?($el.touchEffective.addEventListener("touchmove",$method.progressBarSeeking),$el.touchEffective.addEventListener("touchend",$method.progressBarSeeking),$el.touchEffective.addEventListener("touchcancel",$method.progressBarSeeking)):(document.addEventListener("mousemove",$method.progressBarSeeking),document.addEventListener("mouseup",$method.progressBarSeeking))},K=function(){$data.moveX=(N.type=="touchmove"?N.touches[0]:N).clientX,$data.isTouchMove||($data.isTouchMove=!0,$el.progressBall.querySelector(".progress-ball").style.boxShadow="0 0 20px 3px "+$habit.themeColor,mobilePlugin&&new mobilePlugin.interface()._onAgentEventAction("touchmove-footerbar")),$data.startX||($data.startX=$data.moveX);var S=$data.moveX-$data.startX;$method.progressControlHandle(S,$el.touchEffective)},M=function(){N.type=="touchend"?($el.touchEffective.removeEventListener("touchmove",$method.progressBarSeeking),$el.touchEffective.removeEventListener("touchend",$method.progressBarSeeking),$el.touchEffective.removeEventListener("touchcancel",$method.progressBarSeeking)):(document.removeEventListener("mousemove",$method.progressBarSeeking),document.removeEventListener("mouseup",$method.progressBarSeeking)),$data.isTouchMove&&($el.progressBall.querySelector(".progress-ball").style.boxShadow="0 1px 10px #cccccc",mobilePlugin&&new mobilePlugin.interface()._onAgentEventAction("touchend-footerbar")),$el.videoObject.currentTime=$data.currentTime,$data.ball_move_status=!1,$method.resetTouchVariable(),$method.createTimerCloseControl()};switch(N.type){case"mousedown":j();break;case"mousemove":K();break;case"mouseup":M();break;case"touchstart":j();break;case"touchmove":K();break;case"touchend":M();break;case"touchcancel":$el.touchEffective.removeEventListener("touchmove",$method.progressBarSeeking),$el.touchEffective.removeEventListener("touchend",$method.progressBarSeeking),$el.touchEffective.removeEventListener("touchcancel",$method.progressBarSeeking),$data.ball_move_status=!1,$method.resetTouchVariable(),$method.createTimerCloseControl(),mobilePlugin&&new mobilePlugin.interface()._onAgentEventAction("touchend-footerbar");break;default:N.type}}},resetTouchVariable:function(){$data.startX=null,$data.startY=null,$data.moveX=null,$data.moveY=null,setTimeout(function(){$data.isTouchMove=!1},50)},createTimerCloseControl:function(N){var j;(N=N||{}).type!="cancel"?(j=function(){_this._global_.mp_timeout_3=setTimeout(function(){$method.toggleControlsDisplay({type:N.type||"timer"})},3500)},_this._global_.mp_timeout_3&&clearTimeout(_this._global_.mp_timeout_3),j()):_this._global_.mp_timeout_3&&clearTimeout(_this._global_.mp_timeout_3)},closeMpSidebar:function(){for(var N=!1,j=$el.mPlayer.querySelectorAll(".mplayer-sidebar"),K=0;K<j.length;K++)j[K].classList.contains("open")&&(j[K].classList.remove("open"),N=!0,_typeof(_this._global_.webpagePlugin)=="object"&&_this._global_.webpagePlugin.eventStatus=="removeEventListener"&&new webpagePlugin.interface()._addEvent());return N},toggleControlsDisplay:function(N){(N=N||{type:""}).stopPropagation&&N.stopPropagation();var j=$method.closeMpSidebar();if(!j&&N.type!="DOMContentLoaded"&&N.type!="resize"&&N.type!="orientationchange"){var K=["webkitTransform","transform","msTransform"],M=function(){$el.mplayerHeader.classList.toggle("show",!0)},S=function(){$el.mplayerHeader.classList.toggle("show",!1);for(var O=$el.mplayerHeader.getBoundingClientRect().height,w=0;w<K.length;w++)$el.mplayerHeader.style[K[w]]="translateY("+-O+"px)"},B=function(){$el.mplayerFooter.classList.toggle("show",!0),$el.miniProgress.style.opacity=0},j=function(){$el.mplayerFooter.classList.toggle("show",!1);for(var O=$el.mplayerFooter.getBoundingClientRect().height,w=$el.progressContainer.classList.contains("upper-position")?Number.parseInt($el.progressContainer.getBoundingClientRect().height/2)+1:0,_=0;_<K.length;_++)$el.mplayerFooter.style[K[_]]="translateY("+(O+w)+"px)";$el.miniProgress.style.opacity=1};return N.type=="showControls"?(B(),M(),$data.showScreenControls=!0,$method.createTimerCloseControl(),void _this.emit("controls-toggle",{show:!0})):N.type=="hideControls"?(j(),S(),$data.showScreenControls=!1,$method.createTimerCloseControl({type:"cancel"}),void _this.emit("controls-toggle",{show:!1})):void((N.type!="timer"&&N.type!="dblscreen"||$data.showScreenControls!=0)&&($data.showScreenControls?(j(),S(),$data.showScreenControls=!1,_this.emit("controls-toggle",{show:!1})):(B(),M(),$data.showScreenControls=!0,$method.createTimerCloseControl(),_this.emit("controls-toggle",{show:!0}),window.plus&&$data.isFullScreen&&plus.navigator.hideSystemNavigation())))}},onWaiting:function(){$data.isPlay=!1,_this._global_.mp_timeout_1||(_this._global_.mp_timeout_1=setTimeout(function(){$data.isPlay||$method.showLoading(),_this._global_.mp_timeout_1=null},500))},onError:function(N){console.error(N);var j=arguments;$data.isDestory&&1<=$data.playError||setTimeout(function(){(($el.videoObject.readyState||0)===0||$el.videoObject.duration<=1)&&($data.playError++,$el.mplayerError.style.display="block",$el.videoObject.style.opacity=0,$method.showCover(),$method.hideLoading(),$method.toggleControlsDisplay({type:"hideControls"}),$method.toggleEventListenerGlobal("remove"),$method.toggleEventListenerCustom("remove"),$el.mplayerError.addEventListener("click",function(K){K.stopPropagation(),$method.reloadUrl()},{once:!0}),_this.emit("error",_toConsumableArray(j)))},3e3)},reloadUrl:function(N){$method.destory(),$method.createTimerCloseControl({type:"cancel"}),N&&(option.src=N),$data.isFullScreen&&setTimeout(function(){$method.openFullScreen(),$method.fullScreenChangeAction("Y")},50),$method.initCreateMplayer(!0)},destory:function(){var N,j,K,M;$el.mPlayer.querySelector("#mplayer-media-wrapper video")&&($data.isDestory=!0,$method.toggleEventListenerGlobal("remove"),$method.toggleEventListenerCustom("remove"),$el.mPlayer.classList.remove("fullscreen-scaling"),hls&&hls.media&&(hls.destroy(),hls=""),flv&&(flv.destroy(),flv=""),j=(N=$el.mPlayer.querySelector("#mplayer-media-wrapper")).querySelector("video"),K=(M=N.getBoundingClientRect()).height,M=M.width,document.pictureInPictureElement==j&&document.exitPictureInPicture(),N.style.height=K+"px",N.style.width=M+"px",j.pause(),j.removeAttribute("src"),N.innerHTML="",_this.emit("destory"))},onProgress:function(){var N=$el.videoObject.buffered;if(0<N.length&&0<$data.duration){if(N.end(0)==$data.duration)return $el.miniBuffered.style.width="100%",$el.progressBuffered.style.width="100%",void($el.progressBuffered.style.borderRadius="5px");for(var j=0;j<N.length;j++){N.start(j);var K=N.end(j);if(K>$data.currentTime){K=K/$data.duration*100,$el.progressBuffered.style.width=K+"%",$el.miniBuffered.style.width=K+"%";break}}}},showLoading:function(){$el.mplayerLoading.style.display!="inline-block"&&($el.mplayerLoading.style.display="inline-block")},hideLoading:function(){$el.mplayerLoading.style.display!="none"&&($el.mplayerLoading.style.display="none")},showCover:function(){$el.mplayerCover.style.opacity<=0&&($el.mplayerCover.style.zIndex=8,$el.mplayerCover.style.opacity=.2)},hideCover:function(){$el.mplayerCover.style.opacity!="0"&&($el.mplayerCover.style.opacity=0,$el.mplayerCover.style.zIndex=-1)},showToast:function(){var N=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},j={message:"",duration:1500,style:{}};typeof N=="string"&&(j.message=N),_typeof(N)=="object"&&Object.keys(j).forEach(function(B){N[B]&&(j[B]=N[B])});var K,M=0<(typeof j.duration=="number"&&j.duration)?j.duration:1500,S=$el.mPlayer.querySelector("#mplayer-media-wrapper");S.querySelector("#mplayer-toast")&&$method.removeNode(S,"#mplayer-toast"),(K=document.createElement("div")).setAttribute("class","mplayer-toast toast-scaling"),K.setAttribute("id","mplayer-toast"),K.innerHTML=j.message,Object.prototype.toString.call(j.style)=="[object Object]"&&Object.keys(j.style).forEach(function(B){K.style[B]=j.style[B]}),S.appendChild(K),K.addEventListener("click",function(B){B.stopPropagation()}),K.addEventListener("touchstart",function(B){B.stopPropagation()}),_this._global_.handleIconTimer_2&&window.clearTimeout(_this._global_.handleIconTimer_2),_this._global_.handleIconTimer_2=setTimeout(function(){$method.removeNode(S,"#mplayer-toast")},M)},toggleControlsStyle:function(N){for(var j,K=(option.custom||{}).footerControls||[],M=0;M<K.length;M++)K[M].oftenShow!==!0&&(j=K[M].slot,(j=$el.mplayerFooter.querySelector("[slot="+j+"]"))&&(N=="portrait"&&(j.style.display="none"),N=="landscape"&&(j.style.display="block")))},onDocVisibilitychange:function(N){$data.showScreenControls!==!1&&$method.createTimerCloseControl({type:document.visibilityState=="visible"?"":"cancel"})},onScreenResize:function(N){(N=N||{type:""}).stopPropagation&&N.stopPropagation();function j(){$method.toggleControlsDisplay(N),$el.progressContainer.classList.remove("upper-position"),$method.toggleControlsStyle("portrait"),setTimeout(function(){var M={direction:"portrait"};$method.returnSys()=="window"&&(M.fullscreen=$data.isFullScreen),_this.emit("fullscreen-change",M)},10),window.plus&&setTimeout(function(){plus.navigator.showSystemNavigation()},200)}function K(){$method.toggleControlsDisplay(N),$el.progressContainer.classList.add("upper-position"),$method.toggleControlsStyle("landscape"),setTimeout(function(){var M={direction:"landscape"};$method.returnSys()=="window"&&(M.fullscreen=$data.isFullScreen),_this.emit("fullscreen-change",M)},10),window.plus&&$data.isFullScreen&&setTimeout(function(){plus.navigator.hideSystemNavigation()},200)}$method.createTimerCloseControl(),$method.changeVideoSize(N),window.orientation||window.orientation==0?(window.orientation==0||window.orientation==180?j:K)():setTimeout(function(){(500<=$el.mPlayer.getBoundingClientRect().width?K:j)()},0),$data.showScreenControls==0&&$method.toggleControlsDisplay({type:"hideControls"})},returnSys:function(){var N=new function(){var j=navigator.userAgent;return{ios:!!j.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:-1<j.indexOf("Android")||-1<j.indexOf("Linux"),iPhone:-1<j.indexOf("iPhone"),iPad:-1<j.indexOf("iPad")}};return N.iPhone||N.iPad||N.ios?"ios":N.android?"androd":"window"},nodesObserver:function(){var N=new MutationObserver(function(K,M){var S,B=_createForOfIteratorHelper(K);try{for(B.s();!(S=B.n()).done;){var P=S.value;if(P.type==="childList"){var O,w=_createForOfIteratorHelper(P.removedNodes);try{for(w.s();!(O=w.n()).done;){var _=O.value;if(_ instanceof HTMLVideoElement){hls&&hls.media&&(hls.destroy(),hls=""),flv&&(flv.destroy(),flv=""),document.pictureInPictureElement==_&&document.exitPictureInPicture(),_.pause(),_.removeAttribute("src"),M.disconnect();break}}}catch(R){w.e(R)}finally{w.f()}}}}catch(R){B.e(R)}finally{B.f()}}),j=$el.mPlayer.querySelector(".video-wrapper");N.observe(j,{childList:!0})},toggleEventListenerCustom:function(N){var j=option.custom||{},K=N=="add"?"addEventListener":"removeEventListener",M=j.headControls||[];if(0<M.length)for(var S=0;S<M.length;S++)!M[S].click instanceof Function||(P=M[S].slot,(O=$el.headerMenu.querySelector("[slot="+P+"]"))instanceof Element&&O[K]("click",M[S].click));var B=j.footerControls||[];if(0<B.length)for(var P,O,S=0;S<B.length;S++)!B[S].click instanceof Function||(P=B[S].slot,(O=$el.mplayerFooter.querySelector("[slot="+P+"]"))instanceof Element&&O[K]("click",B[S].click))},toggleEventListenerGlobal:function(N,j){var K,M=N=="add"?"addEventListener":"removeEventListener";K="onorientationchange"in window?"orientationchange":"resize",window[M](K,$method.onScreenResize),$el.backButton[M]("click",$method.onBack),$el.fullSwitch[M]("click",$method.fullToggle),$el.playSwitch[M]("click",$method.onPlayTap),$el.mPlayer[M]("click",$method.onContrainerTap),$el.mPlayer[M]("dblclick",$method.onContrainerTap),$el.touchEffective instanceof Element&&$el.touchEffective[M]("touchstart",$method.progressBarSeeking),$el.touchEffective instanceof Element&&$el.touchEffective[M]("mousedown",$method.progressBarSeeking),$el.videoObject[M]("webkitbeginfullscreen",$method.runtimeCompatibleHandle),$el.videoObject[M]("webkitendfullscreen",$method.runtimeCompatibleHandle),document[M]("resume",$method.plusRuntimeHandle),document[M]("pause",$method.plusRuntimeHandle),document[M]("visibilitychange",$method.onDocVisibilitychange),j=="playerReady"&&function(){$el.mplayerCover.addEventListener("touchstart",function(P){P.stopPropagation()}),$el.mplayerCover.addEventListener("touchmove",function(P){P.stopPropagation()}),$el.mplayerHeader.addEventListener("touchmove",function(P){P.stopPropagation()}),$el.mplayerHeader.addEventListener("click",function(P){P.stopPropagation()}),$el.mplayerHeader.addEventListener("dblclick",function(P){P.stopPropagation()}),$el.mplayerFooter.addEventListener("touchmove",function(P){P.stopPropagation()}),$el.mplayerFooter.addEventListener("click",function(P){P.stopPropagation()}),$el.mplayerFooter.addEventListener("dblclick",function(P){P.stopPropagation()}),$el.mplayerError.addEventListener("touchstart",function(P){P.stopPropagation()}),$el.mplayerError.addEventListener("touchmove",function(P){P.stopPropagation()}),$el.videoObject.addEventListener("canplaythrough",$method.onCanplaythrough),$el.videoObject.addEventListener("durationchange",$method.onDurationChange),option.live||$el.videoObject.addEventListener("timeupdate",$method.onTimeupdate),$el.videoObject.addEventListener("play",$method.onPlay),$el.videoObject.addEventListener("playing",$method.onPlaying),$el.videoObject.addEventListener("pause",$method.onPause),$el.videoObject.addEventListener("waiting",$method.onWaiting),$el.videoObject.addEventListener("error",$method.onError),option.live||$el.videoObject.addEventListener("progress",$method.onProgress);for(var S=$el.mPlayer.querySelectorAll(".mplayer-sidebar"),B=0;B<S.length;B++)S[B].addEventListener("touchstart",function(P){P.stopPropagation()}),S[B].addEventListener("touchmove",function(P){P.stopPropagation()}),S[B].addEventListener("touchend",function(P){P.stopPropagation()}),S[B].addEventListener("click",function(P){P.stopPropagation()}),S[B].addEventListener("dblclick",function(P){P.stopPropagation()})}()}},this.showRightSidebar=function(N){N=$el.mPlayer.querySelector("#mplayer-media-wrapper [slot="+N+"]"),N&&N.classList.contains("mplayer-sidebar")&&($method.toggleControlsDisplay({type:"sidebarRight"}),$method.createTimerCloseControl({type:"cancel"}),N.classList.add("open"),webpagePlugin&&new webpagePlugin.interface()._removeEvent())},this.toggleControls=function(N){N===!0?$data.showScreenControls==0?$method.toggleControlsDisplay({type:"showControls"}):$method.createTimerCloseControl():N===!1?$data.showScreenControls==1&&$method.toggleControlsDisplay({type:"hideControls"}):$method.toggleControlsDisplay()},this.showToast=function(N){$method.showToast(N)},this.showLoading=function(){$method.showLoading()},this.hideLoading=function(){$method.hideLoading()},this.video=function(){return $el.videoObject},this.reloadUrl=function(N){$method.reloadUrl(N)},this.destory=function(){$method.destory()},this.openFullScreen=function(){$method.openFullScreen()},this.closeFullScreen=function(){$method.closeFullScreen()},this.sendError=function(N){$method.onError(N)},this.getControls=function(){return setTimeout(function(){$method.overloadingEl()},10),$el.mPlayer.querySelectorAll("[control]")},document.readyState=="interactive"||document.readyState=="complete"?$method.initCreateMplayer():document.addEventListener("readystatechange",function(){document.readyState=="interactive"&&$method.initCreateMplayer()}))};return MuiPlayer.prototype.on=function(N,j){this._event_[N]||(this._event_[N]=[]),this._event_[N].push(j)},MuiPlayer.prototype.off=function(N,j){this._event_[N]&&(j?0<=(j=this._event_[N].indexOf(j))&&this._event_[N].splice(j,1):this._event_[N]=void 0)},MuiPlayer.prototype.emit=function(N,j){if(this._event_[N])for(var K=0;K<this._event_[N].length;K++){var M=this._event_[N][K];j instanceof Array?M.apply(this,j):M(j)}},MuiPlayer.prototype.once=function(N,j){var K=this;this.on(N,function M(){j.apply(this,Array.prototype.slice.call(arguments)),setTimeout(function(){K.off(N,M)},200)})},MuiPlayer})})(muiPlayer_min,muiPlayer_min.exports);var MuiPlayer=muiPlayer_min.exports,hls={exports:{}};(function(N,j){typeof window!="undefined"&&function(M,S){N.exports=S()}(commonjsGlobal,function(){return function(K){var M={};function S(B){if(M[B])return M[B].exports;var P=M[B]={i:B,l:!1,exports:{}};return K[B].call(P.exports,P,P.exports,S),P.l=!0,P.exports}return S.m=K,S.c=M,S.d=function(B,P,O){S.o(B,P)||Object.defineProperty(B,P,{enumerable:!0,get:O})},S.r=function(B){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(B,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(B,"__esModule",{value:!0})},S.t=function(B,P){if(P&1&&(B=S(B)),P&8||P&4&&typeof B=="object"&&B&&B.__esModule)return B;var O=Object.create(null);if(S.r(O),Object.defineProperty(O,"default",{enumerable:!0,value:B}),P&2&&typeof B!="string")for(var w in B)S.d(O,w,function(_){return B[_]}.bind(null,w));return O},S.n=function(B){var P=B&&B.__esModule?function(){return B.default}:function(){return B};return S.d(P,"a",P),P},S.o=function(B,P){return Object.prototype.hasOwnProperty.call(B,P)},S.p="/dist/",S(S.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(K,M,S){var B=Object.prototype.hasOwnProperty,P="~";function O(){}Object.create&&(O.prototype=Object.create(null),new O().__proto__||(P=!1));function w(T,D,c){this.fn=T,this.context=D,this.once=c||!1}function _(T,D,c,A,L){if(typeof c!="function")throw new TypeError("The listener must be a function");var E=new w(c,A||T,L),g=P?P+D:D;return T._events[g]?T._events[g].fn?T._events[g]=[T._events[g],E]:T._events[g].push(E):(T._events[g]=E,T._eventsCount++),T}function R(T,D){--T._eventsCount===0?T._events=new O:delete T._events[D]}function C(){this._events=new O,this._eventsCount=0}C.prototype.eventNames=function(){var D=[],c,A;if(this._eventsCount===0)return D;for(A in c=this._events)B.call(c,A)&&D.push(P?A.slice(1):A);return Object.getOwnPropertySymbols?D.concat(Object.getOwnPropertySymbols(c)):D},C.prototype.listeners=function(D){var c=P?P+D:D,A=this._events[c];if(!A)return[];if(A.fn)return[A.fn];for(var L=0,E=A.length,g=new Array(E);L<E;L++)g[L]=A[L].fn;return g},C.prototype.listenerCount=function(D){var c=P?P+D:D,A=this._events[c];return A?A.fn?1:A.length:0},C.prototype.emit=function(D,c,A,L,E,g){var o=P?P+D:D;if(!this._events[o])return!1;var f=this._events[o],r=arguments.length,p,m;if(f.fn){switch(f.once&&this.removeListener(D,f.fn,void 0,!0),r){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,c),!0;case 3:return f.fn.call(f.context,c,A),!0;case 4:return f.fn.call(f.context,c,A,L),!0;case 5:return f.fn.call(f.context,c,A,L,E),!0;case 6:return f.fn.call(f.context,c,A,L,E,g),!0}for(m=1,p=new Array(r-1);m<r;m++)p[m-1]=arguments[m];f.fn.apply(f.context,p)}else{var l=f.length,e;for(m=0;m<l;m++)switch(f[m].once&&this.removeListener(D,f[m].fn,void 0,!0),r){case 1:f[m].fn.call(f[m].context);break;case 2:f[m].fn.call(f[m].context,c);break;case 3:f[m].fn.call(f[m].context,c,A);break;case 4:f[m].fn.call(f[m].context,c,A,L);break;default:if(!p)for(e=1,p=new Array(r-1);e<r;e++)p[e-1]=arguments[e];f[m].fn.apply(f[m].context,p)}}return!0},C.prototype.on=function(D,c,A){return _(this,D,c,A,!1)},C.prototype.once=function(D,c,A){return _(this,D,c,A,!0)},C.prototype.removeListener=function(D,c,A,L){var E=P?P+D:D;if(!this._events[E])return this;if(!c)return R(this,E),this;var g=this._events[E];if(g.fn)g.fn===c&&(!L||g.once)&&(!A||g.context===A)&&R(this,E);else{for(var o=0,f=[],r=g.length;o<r;o++)(g[o].fn!==c||L&&!g[o].once||A&&g[o].context!==A)&&f.push(g[o]);f.length?this._events[E]=f.length===1?f[0]:f:R(this,E)}return this},C.prototype.removeAllListeners=function(D){var c;return D?(c=P?P+D:D,this._events[c]&&R(this,c)):(this._events=new O,this._eventsCount=0),this},C.prototype.off=C.prototype.removeListener,C.prototype.addListener=C.prototype.on,C.prefixed=P,C.EventEmitter=C,K.exports=C},"./node_modules/url-toolkit/src/url-toolkit.js":function(K,M,S){(function(B){var P=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,O=/^([^\/?#]*)([^]*)$/,w=/(?:\/|^)\.(?=\/)/g,_=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,R={buildAbsoluteURL:function(C,T,D){if(D=D||{},C=C.trim(),T=T.trim(),!T){if(!D.alwaysNormalize)return C;var c=R.parseURL(C);if(!c)throw new Error("Error trying to parse base URL.");return c.path=R.normalizePath(c.path),R.buildURLFromParts(c)}var A=R.parseURL(T);if(!A)throw new Error("Error trying to parse relative URL.");if(A.scheme)return D.alwaysNormalize?(A.path=R.normalizePath(A.path),R.buildURLFromParts(A)):T;var L=R.parseURL(C);if(!L)throw new Error("Error trying to parse base URL.");if(!L.netLoc&&L.path&&L.path[0]!=="/"){var E=O.exec(L.path);L.netLoc=E[1],L.path=E[2]}L.netLoc&&!L.path&&(L.path="/");var g={scheme:L.scheme,netLoc:A.netLoc,path:null,params:A.params,query:A.query,fragment:A.fragment};if(!A.netLoc&&(g.netLoc=L.netLoc,A.path[0]!=="/"))if(!A.path)g.path=L.path,A.params||(g.params=L.params,A.query||(g.query=L.query));else{var o=L.path,f=o.substring(0,o.lastIndexOf("/")+1)+A.path;g.path=R.normalizePath(f)}return g.path===null&&(g.path=D.alwaysNormalize?R.normalizePath(A.path):A.path),R.buildURLFromParts(g)},parseURL:function(C){var T=P.exec(C);return T?{scheme:T[1]||"",netLoc:T[2]||"",path:T[3]||"",params:T[4]||"",query:T[5]||"",fragment:T[6]||""}:null},normalizePath:function(C){for(C=C.split("").reverse().join("").replace(w,"");C.length!==(C=C.replace(_,"")).length;);return C.split("").reverse().join("")},buildURLFromParts:function(C){return C.scheme+C.netLoc+C.path+C.params+C.query+C.fragment}};K.exports=R})()},"./node_modules/webworkify-webpack/index.js":function(K,M,S){function B(D){var c={};function A(E){if(c[E])return c[E].exports;var g=c[E]={i:E,l:!1,exports:{}};return D[E].call(g.exports,g,g.exports,A),g.l=!0,g.exports}A.m=D,A.c=c,A.i=function(E){return E},A.d=function(E,g,o){A.o(E,g)||Object.defineProperty(E,g,{configurable:!1,enumerable:!0,get:o})},A.r=function(E){Object.defineProperty(E,"__esModule",{value:!0})},A.n=function(E){var g=E&&E.__esModule?function(){return E.default}:function(){return E};return A.d(g,"a",g),g},A.o=function(E,g){return Object.prototype.hasOwnProperty.call(E,g)},A.p="/",A.oe=function(E){throw console.error(E),E};var L=A(A.s=ENTRY_MODULE);return L.default||L}var P="[\\.|\\-|\\+|\\w|/|@]+",O="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+P+").*?\\)";function w(D){return(D+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function _(D){return!isNaN(1*D)}function R(D,c,A){var L={};L[A]=[];var E=c.toString(),g=E.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!g)return L;for(var o=g[1],f=new RegExp("(\\\\n|\\W)"+w(o)+O,"g"),r;r=f.exec(E);)r[3]!=="dll-reference"&&L[A].push(r[3]);for(f=new RegExp("\\("+w(o)+'\\("(dll-reference\\s('+P+'))"\\)\\)'+O,"g");r=f.exec(E);)D[r[2]]||(L[A].push(r[1]),D[r[2]]=S(r[1]).m),L[r[2]]=L[r[2]]||[],L[r[2]].push(r[4]);for(var p=Object.keys(L),m=0;m<p.length;m++)for(var l=0;l<L[p[m]].length;l++)_(L[p[m]][l])&&(L[p[m]][l]=1*L[p[m]][l]);return L}function C(D){var c=Object.keys(D);return c.reduce(function(A,L){return A||D[L].length>0},!1)}function T(D,c){for(var A={main:[c]},L={main:[]},E={main:{}};C(A);)for(var g=Object.keys(A),o=0;o<g.length;o++){var f=g[o],r=A[f],p=r.pop();if(E[f]=E[f]||{},!(E[f][p]||!D[f][p])){E[f][p]=!0,L[f]=L[f]||[],L[f].push(p);for(var m=R(D,D[f][p],f),l=Object.keys(m),e=0;e<l.length;e++)A[l[e]]=A[l[e]]||[],A[l[e]]=A[l[e]].concat(m[l[e]])}}return L}K.exports=function(D,c){c=c||{};var A={main:S.m},L=c.all?{main:Object.keys(A.main)}:T(A,D),E="";Object.keys(L).filter(function(p){return p!=="main"}).forEach(function(p){for(var m=0;L[p][m];)m++;L[p].push(m),A[p][m]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",E=E+"var "+p+" = ("+B.toString().replace("ENTRY_MODULE",JSON.stringify(m))+")({"+L[p].map(function(l){return""+JSON.stringify(l)+": "+A[p][l].toString()}).join(",")+`});
`}),E=E+"new (("+B.toString().replace("ENTRY_MODULE",JSON.stringify(D))+")({"+L.main.map(function(p){return""+JSON.stringify(p)+": "+A.main[p].toString()}).join(",")+"}))(self);";var g=new window.Blob([E],{type:"text/javascript"});if(c.bare)return g;var o=window.URL||window.webkitURL||window.mozURL||window.msURL,f=o.createObjectURL(g),r=new window.Worker(f);return r.objectURL=f,r}},"./src/config.ts":function(K,M,S){S.r(M),S.d(M,"hlsDefaultConfig",function(){return e}),S.d(M,"mergeConfig",function(){return h}),S.d(M,"enableStreamingMode",function(){return u});var B=S("./src/controller/abr-controller.ts"),P=S("./src/controller/audio-stream-controller.ts"),O=S("./src/controller/audio-track-controller.ts"),w=S("./src/controller/subtitle-stream-controller.ts"),_=S("./src/controller/subtitle-track-controller.ts"),R=S("./src/controller/buffer-controller.ts"),C=S("./src/controller/timeline-controller.ts"),T=S("./src/controller/cap-level-controller.ts"),D=S("./src/controller/fps-controller.ts"),c=S("./src/controller/eme-controller.ts"),A=S("./src/controller/cmcd-controller.ts"),L=S("./src/utils/xhr-loader.ts"),E=S("./src/utils/fetch-loader.ts"),g=S("./src/utils/cues.ts"),o=S("./src/utils/mediakeys-helper.ts"),f=S("./src/utils/logger.ts");function r(){return r=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var v=arguments[n];for(var y in v)Object.prototype.hasOwnProperty.call(v,y)&&(t[y]=v[y])}return t},r.apply(this,arguments)}function p(t,n){var v=Object.keys(t);if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(t);n&&(y=y.filter(function(x){return Object.getOwnPropertyDescriptor(t,x).enumerable})),v.push.apply(v,y)}return v}function m(t){for(var n=1;n<arguments.length;n++){var v=arguments[n]!=null?arguments[n]:{};n%2?p(Object(v),!0).forEach(function(y){l(t,y,v[y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(v)):p(Object(v)).forEach(function(y){Object.defineProperty(t,y,Object.getOwnPropertyDescriptor(v,y))})}return t}function l(t,n,v){return n in t?Object.defineProperty(t,n,{value:v,enumerable:!0,configurable:!0,writable:!0}):t[n]=v,t}var e=m(m({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:L.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:B.default,bufferController:R.default,capLevelController:T.default,fpsController:D.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:o.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0},a()),{},{subtitleStreamController:w.SubtitleStreamController,subtitleTrackController:_.default,timelineController:C.TimelineController,audioStreamController:P.default,audioTrackController:O.default,emeController:c.default,cmcdController:A.default});function a(){return{cueHandler:g.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function h(t,n){if((n.liveSyncDurationCount||n.liveMaxLatencyDurationCount)&&(n.liveSyncDuration||n.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(n.liveMaxLatencyDurationCount!==void 0&&(n.liveSyncDurationCount===void 0||n.liveMaxLatencyDurationCount<=n.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(n.liveMaxLatencyDuration!==void 0&&(n.liveSyncDuration===void 0||n.liveMaxLatencyDuration<=n.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return r({},t,n)}function u(t){var n=t.loader;if(n!==E.default&&n!==L.default)f.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),t.progressive=!1;else{var v=Object(E.fetchSupported)();v&&(t.loader=E.default,t.progressive=!0,t.enableSoftwareAES=!0,f.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":function(K,M,S){S.r(M);var B=S("./src/polyfills/number.ts"),P=S("./src/utils/ewma-bandwidth-estimator.ts"),O=S("./src/events.ts"),w=S("./src/utils/buffer-helper.ts"),_=S("./src/errors.ts"),R=S("./src/types/loader.ts"),C=S("./src/utils/logger.ts");function T(A,L){for(var E=0;E<L.length;E++){var g=L[E];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(A,g.key,g)}}function D(A,L,E){return L&&T(A.prototype,L),E&&T(A,E),A}var c=function(){function A(E){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=E;var g=E.config;this.bwEstimator=new P.default(g.abrEwmaSlowVoD,g.abrEwmaFastVoD,g.abrEwmaDefaultEstimate),this.registerListeners()}var L=A.prototype;return L.registerListeners=function(){var g=this.hls;g.on(O.Events.FRAG_LOADING,this.onFragLoading,this),g.on(O.Events.FRAG_LOADED,this.onFragLoaded,this),g.on(O.Events.FRAG_BUFFERED,this.onFragBuffered,this),g.on(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),g.on(O.Events.ERROR,this.onError,this)},L.unregisterListeners=function(){var g=this.hls;g.off(O.Events.FRAG_LOADING,this.onFragLoading,this),g.off(O.Events.FRAG_LOADED,this.onFragLoaded,this),g.off(O.Events.FRAG_BUFFERED,this.onFragBuffered,this),g.off(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),g.off(O.Events.ERROR,this.onError,this)},L.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},L.onFragLoading=function(g,o){var f=o.frag;if(f.type===R.PlaylistLevelType.MAIN&&!this.timer){var r;this.fragCurrent=f,this.partCurrent=(r=o.part)!=null?r:null,this.timer=self.setInterval(this.onCheck,100)}},L.onLevelLoaded=function(g,o){var f=this.hls.config;o.details.live?this.bwEstimator.update(f.abrEwmaSlowLive,f.abrEwmaFastLive):this.bwEstimator.update(f.abrEwmaSlowVoD,f.abrEwmaFastVoD)},L._abandonRulesCheck=function(){var g=this.fragCurrent,o=this.partCurrent,f=this.hls,r=f.autoLevelEnabled,p=f.config,m=f.media;if(!(!g||!m)){var l=o?o.stats:g.stats,e=o?o.duration:g.duration;if(l.aborted){C.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!r||m.paused||!m.playbackRate||!m.readyState)){var a=performance.now()-l.loading.start,h=Math.abs(m.playbackRate);if(!(a<=500*e/h)){var u=f.levels,t=f.minAutoLevel,n=u[g.level],v=l.total||Math.max(l.loaded,Math.round(e*n.maxBitrate/8)),y=Math.max(1,l.bwEstimate?l.bwEstimate/8:l.loaded*1e3/a),x=(v-l.loaded)/y,I=m.currentTime,F=(w.BufferHelper.bufferInfo(m,I,p.maxBufferHole).end-I)/h;if(!(F>=2*e/h||x<=F)){var U=Number.POSITIVE_INFINITY,k;for(k=g.level-1;k>t;k--){var $=u[k].maxBitrate;if(U=e*$/(8*.8*y),U<F)break}if(!(U>=x)){var W=this.bwEstimator.getEstimate();C.logger.warn("Fragment "+g.sn+(o?" part "+o.index:"")+" of level "+g.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+k+`
      Current BW estimate: `+(Object(B.isFiniteNumber)(W)?(W/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+x.toFixed(3)+` s
      Estimated load time for the next fragment: `+U.toFixed(3)+` s
      Time to underbuffer: `+F.toFixed(3)+" s"),f.nextLoadLevel=k,this.bwEstimator.sample(a,l.loaded),this.clearTimer(),g.loader&&(this.fragCurrent=this.partCurrent=null,g.loader.abort()),f.trigger(O.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:g,part:o,stats:l})}}}}}},L.onFragLoaded=function(g,o){var f=o.frag,r=o.part;if(f.type===R.PlaylistLevelType.MAIN&&Object(B.isFiniteNumber)(f.sn)){var p=r?r.stats:f.stats,m=r?r.duration:f.duration;if(this.clearTimer(),this.lastLoadedFragLevel=f.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var l=this.hls.levels[f.level],e=(l.loaded?l.loaded.bytes:0)+p.loaded,a=(l.loaded?l.loaded.duration:0)+m;l.loaded={bytes:e,duration:a},l.realBitrate=Math.round(8*e/a)}if(f.bitrateTest){var h={stats:p,frag:f,part:r,id:f.type};this.onFragBuffered(O.Events.FRAG_BUFFERED,h),f.bitrateTest=!1}}},L.onFragBuffered=function(g,o){var f=o.frag,r=o.part,p=r?r.stats:f.stats;if(!p.aborted&&!(f.type!==R.PlaylistLevelType.MAIN||f.sn==="initSegment")){var m=p.parsing.end-p.loading.start;this.bwEstimator.sample(m,p.loaded),p.bwEstimate=this.bwEstimator.getEstimate(),f.bitrateTest?this.bitrateTestDelay=m/1e3:this.bitrateTestDelay=0}},L.onError=function(g,o){switch(o.details){case _.ErrorDetails.FRAG_LOAD_ERROR:case _.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break}},L.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},L.getNextABRAutoLevel=function(){var g=this.fragCurrent,o=this.partCurrent,f=this.hls,r=f.maxAutoLevel,p=f.config,m=f.minAutoLevel,l=f.media,e=o?o.duration:g?g.duration:0,a=l?l.currentTime:0,h=l&&l.playbackRate!==0?Math.abs(l.playbackRate):1,u=this.bwEstimator?this.bwEstimator.getEstimate():p.abrEwmaDefaultEstimate,t=(w.BufferHelper.bufferInfo(l,a,p.maxBufferHole).end-a)/h,n=this.findBestLevel(u,m,r,t,p.abrBandWidthFactor,p.abrBandWidthUpFactor);if(n>=0)return n;C.logger.trace((t?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var v=e?Math.min(e,p.maxStarvationDelay):p.maxStarvationDelay,y=p.abrBandWidthFactor,x=p.abrBandWidthUpFactor;if(!t){var I=this.bitrateTestDelay;if(I){var F=e?Math.min(e,p.maxLoadingDelay):p.maxLoadingDelay;v=F-I,C.logger.trace("bitrate test took "+Math.round(1e3*I)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*v)+" ms"),y=x=1}}return n=this.findBestLevel(u,m,r,t+v,y,x),Math.max(n,0)},L.findBestLevel=function(g,o,f,r,p,m){for(var l,e=this.fragCurrent,a=this.partCurrent,h=this.lastLoadedFragLevel,u=this.hls.levels,t=u[h],n=!!(t!=null&&(l=t.details)!==null&&l!==void 0&&l.live),v=t==null?void 0:t.codecSet,y=a?a.duration:e?e.duration:0,x=f;x>=o;x--){var I=u[x];if(!(!I||v&&I.codecSet!==v)){var F=I.details,U=(a?F==null?void 0:F.partTarget:F==null?void 0:F.averagetargetduration)||y,k=void 0;x<=h?k=p*g:k=m*g;var $=u[x].maxBitrate,W=$*U/k;if(C.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+x+"/"+Math.round(k)+"/"+$+"/"+U+"/"+r+"/"+W),k>$&&(!W||n&&!this.bitrateTestDelay||W<r))return x}}return-1},D(A,[{key:"nextAutoLevel",get:function(){var g=this._nextAutoLevel,o=this.bwEstimator;if(g!==-1&&(!o||!o.canEstimate()))return g;var f=this.getNextABRAutoLevel();return g!==-1&&(f=Math.min(g,f)),f},set:function(g){this._nextAutoLevel=g}}]),A}();M.default=c},"./src/controller/audio-stream-controller.ts":function(K,M,S){S.r(M);var B=S("./src/polyfills/number.ts"),P=S("./src/controller/base-stream-controller.ts"),O=S("./src/events.ts"),w=S("./src/utils/buffer-helper.ts"),_=S("./src/controller/fragment-tracker.ts"),R=S("./src/types/level.ts"),C=S("./src/types/loader.ts"),T=S("./src/loader/fragment.ts"),D=S("./src/demux/chunk-cache.ts"),c=S("./src/demux/transmuxer-interface.ts"),A=S("./src/types/transmuxer.ts"),L=S("./src/controller/fragment-finders.ts"),E=S("./src/utils/discontinuities.ts"),g=S("./src/errors.ts"),o=S("./src/utils/logger.ts");function f(){return f=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var h=arguments[a];for(var u in h)Object.prototype.hasOwnProperty.call(h,u)&&(e[u]=h[u])}return e},f.apply(this,arguments)}function r(e,a){e.prototype=Object.create(a.prototype),e.prototype.constructor=e,p(e,a)}function p(e,a){return p=Object.setPrototypeOf||function(u,t){return u.__proto__=t,u},p(e,a)}var m=100,l=function(e){r(a,e);function a(u,t){var n;return n=e.call(this,u,t,"[audio-stream-controller]")||this,n.videoBuffer=null,n.videoTrackCC=-1,n.waitingVideoCC=-1,n.audioSwitch=!1,n.trackId=-1,n.waitingData=null,n.mainDetails=null,n.bufferFlushed=!1,n._registerListeners(),n}var h=a.prototype;return h.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},h._registerListeners=function(){var t=this.hls;t.on(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(O.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(O.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(O.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(O.Events.ERROR,this.onError,this),t.on(O.Events.BUFFER_RESET,this.onBufferReset,this),t.on(O.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(O.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(O.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(O.Events.FRAG_BUFFERED,this.onFragBuffered,this)},h._unregisterListeners=function(){var t=this.hls;t.off(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(O.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(O.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(O.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(O.Events.ERROR,this.onError,this),t.off(O.Events.BUFFER_RESET,this.onBufferReset,this),t.off(O.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(O.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(O.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(O.Events.FRAG_BUFFERED,this.onFragBuffered,this)},h.onInitPtsFound=function(t,n){var v=n.frag,y=n.id,x=n.initPTS;if(y==="main"){var I=v.cc;this.initPTS[v.cc]=x,this.log("InitPTS for cc: "+I+" found from main: "+x),this.videoTrackCC=I,this.state===P.State.WAITING_INIT_PTS&&this.tick()}},h.startLoad=function(t){if(!this.levels){this.startPosition=t,this.state=P.State.STOPPED;return}var n=this.lastCurrentTime;this.stopLoad(),this.setInterval(m),this.fragLoadError=0,n>0&&t===-1?(this.log("Override startPosition with lastCurrentTime @"+n.toFixed(3)),this.state=P.State.IDLE):(this.loadedmetadata=!1,this.state=P.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()},h.doTick=function(){switch(this.state){case P.State.IDLE:this.doTickIdle();break;case P.State.WAITING_TRACK:{var t,n=this.levels,v=this.trackId,y=n==null||(t=n[v])===null||t===void 0?void 0:t.details;if(y){if(this.waitForCdnTuneIn(y))break;this.state=P.State.WAITING_INIT_PTS}break}case P.State.FRAG_LOADING_WAITING_RETRY:{var x,I=performance.now(),F=this.retryDate;(!F||I>=F||(x=this.media)!==null&&x!==void 0&&x.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=P.State.IDLE);break}case P.State.WAITING_INIT_PTS:{var U=this.waitingData;if(U){var k=U.frag,$=U.part,W=U.cache,G=U.complete;if(this.initPTS[k.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=P.State.FRAG_LOADING;var H=W.flush(),z={frag:k,part:$,payload:H,networkDetails:null};this._handleFragmentLoadProgress(z),G&&e.prototype._handleFragmentLoadComplete.call(this,z)}else if(this.videoTrackCC!==this.waitingVideoCC)o.logger.log("Waiting fragment cc ("+k.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var V=this.getLoadPosition(),Y=w.BufferHelper.bufferInfo(this.mediaBuffer,V,this.config.maxBufferHole),Q=Object(L.fragmentWithinToleranceTest)(Y.end,this.config.maxFragLookUpTolerance,k);Q<0&&(o.logger.log("Waiting fragment cc ("+k.cc+") @ "+k.start+" cancelled because another fragment at "+Y.end+" is needed"),this.clearWaitingFragment())}}else this.state=P.State.IDLE}}this.onTickEnd()},h.clearWaitingFragment=function(){var t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=P.State.IDLE)},h.onTickEnd=function(){var t=this.media;if(!(!t||!t.readyState)){var n=this.mediaBuffer?this.mediaBuffer:t,v=n.buffered;!this.loadedmetadata&&v.length&&(this.loadedmetadata=!0),this.lastCurrentTime=t.currentTime}},h.doTickIdle=function(){var t,n,v=this.hls,y=this.levels,x=this.media,I=this.trackId,F=v.config;if(!(!y||!y[I])&&!(!x&&(this.startFragRequested||!F.startFragPrefetch))){var U=y[I],k=U.details;if(!k||k.live&&this.levelLastLoaded!==I||this.waitForCdnTuneIn(k)){this.state=P.State.WAITING_TRACK;return}this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,T.ElementaryStreamTypes.AUDIO,C.PlaylistLevelType.AUDIO));var $=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,C.PlaylistLevelType.AUDIO);if($!==null){var W=$.len,G=this.getMaxBufferLength(),H=this.audioSwitch;if(!(W>=G&&!H)){if(!H&&this._streamEnded($,k)){v.trigger(O.Events.BUFFER_EOS,{type:"audio"}),this.state=P.State.ENDED;return}var z=k.fragments,V=z[0].start,Y=$.end;if(H){var Q=this.getLoadPosition();Y=Q,k.PTSKnown&&Q<V&&($.end>V||$.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),x.currentTime=V+.05)}var X=this.getNextFragment(Y,k);if(!X){this.bufferFlushed=!0;return}((t=X.decryptdata)===null||t===void 0?void 0:t.keyFormat)==="identity"&&!((n=X.decryptdata)!==null&&n!==void 0&&n.key)?this.loadKey(X,k):this.loadFragment(X,k,Y)}}}},h.getMaxBufferLength=function(){var t=e.prototype.getMaxBufferLength.call(this),n=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,C.PlaylistLevelType.MAIN);return n===null?t:Math.max(t,n.len)},h.onMediaDetaching=function(){this.videoBuffer=null,e.prototype.onMediaDetaching.call(this)},h.onAudioTracksUpdated=function(t,n){var v=n.audioTracks;this.resetTransmuxer(),this.levels=v.map(function(y){return new R.Level(y)})},h.onAudioTrackSwitching=function(t,n){var v=!!n.url;this.trackId=n.id;var y=this.fragCurrent;y!=null&&y.loader&&y.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),v?this.setInterval(m):this.resetTransmuxer(),v?(this.audioSwitch=!0,this.state=P.State.IDLE):this.state=P.State.STOPPED,this.tick()},h.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},h.onLevelLoaded=function(t,n){this.mainDetails=n.details},h.onAudioTrackLoaded=function(t,n){var v,y=this.levels,x=n.details,I=n.id;if(!y){this.warn("Audio tracks were reset while loading level "+I);return}this.log("Track "+I+" loaded ["+x.startSN+","+x.endSN+"],duration:"+x.totalduration);var F=y[I],U=0;if(x.live||(v=F.details)!==null&&v!==void 0&&v.live){var k=this.mainDetails;if(x.fragments[0]||(x.deltaUpdateFailed=!0),x.deltaUpdateFailed||!k)return;!F.details&&x.hasProgramDateTime&&k.hasProgramDateTime?(Object(E.alignMediaPlaylistByPDT)(x,k),U=x.fragments[0].start):U=this.alignPlaylists(x,F.details)}F.details=x,this.levelLastLoaded=I,!this.startFragRequested&&(this.mainDetails||!x.live)&&this.setStartPosition(F.details,U),this.state===P.State.WAITING_TRACK&&!this.waitForCdnTuneIn(x)&&(this.state=P.State.IDLE),this.tick()},h._handleFragmentLoadProgress=function(t){var n,v=t.frag,y=t.part,x=t.payload,I=this.config,F=this.trackId,U=this.levels;if(!U){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+v.sn+" of level "+v.level+" will not be buffered");return}var k=U[F];console.assert(k,"Audio track is defined on fragment load progress");var $=k.details;console.assert($,"Audio track details are defined on fragment load progress");var W=I.defaultAudioCodec||k.audioCodec||"mp4a.40.2",G=this.transmuxer;G||(G=this.transmuxer=new c.default(this.hls,C.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var H=this.initPTS[v.cc],z=(n=v.initSegment)===null||n===void 0?void 0:n.data;if(H!==void 0){var V=!1,Y=y?y.index:-1,Q=Y!==-1,X=new A.ChunkMetadata(v.level,v.sn,v.stats.chunkCount,x.byteLength,Y,Q);G.push(x,z,W,"",v,y,$.totalduration,V,X,H)}else{o.logger.log("Unknown video PTS for cc "+v.cc+", waiting for video PTS before demuxing audio frag "+v.sn+" of ["+$.startSN+" ,"+$.endSN+"],track "+F);var q=this.waitingData=this.waitingData||{frag:v,part:y,cache:new D.default,complete:!1},J=q.cache;J.push(new Uint8Array(x)),this.waitingVideoCC=this.videoTrackCC,this.state=P.State.WAITING_INIT_PTS}},h._handleFragmentLoadComplete=function(t){if(this.waitingData){this.waitingData.complete=!0;return}e.prototype._handleFragmentLoadComplete.call(this,t)},h.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},h.onBufferCreated=function(t,n){var v=n.tracks.audio;v&&(this.mediaBuffer=v.buffer),n.tracks.video&&(this.videoBuffer=n.tracks.video.buffer)},h.onFragBuffered=function(t,n){var v=n.frag,y=n.part;if(v.type===C.PlaylistLevelType.AUDIO){if(this.fragContextChanged(v)){this.warn("Fragment "+v.sn+(y?" p: "+y.index:"")+" of level "+v.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}v.sn!=="initSegment"&&(this.fragPrevious=v,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(O.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(v,y)}},h.onError=function(t,n){switch(n.details){case g.ErrorDetails.FRAG_LOAD_ERROR:case g.ErrorDetails.FRAG_LOAD_TIMEOUT:case g.ErrorDetails.KEY_LOAD_ERROR:case g.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(C.PlaylistLevelType.AUDIO,n);break;case g.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case g.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==P.State.ERROR&&this.state!==P.State.STOPPED&&(this.state=n.fatal?P.State.ERROR:P.State.IDLE,this.warn(n.details+" while loading frag, switching to "+this.state+" state"));break;case g.ErrorDetails.BUFFER_FULL_ERROR:if(n.parent==="audio"&&(this.state===P.State.PARSING||this.state===P.State.PARSED)){var v=!0,y=this.getFwdBufferInfo(this.mediaBuffer,C.PlaylistLevelType.AUDIO);y&&y.len>.5&&(v=!this.reduceMaxBufferLength(y.len)),v&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,e.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},h.onBufferFlushed=function(t,n){var v=n.type;v===T.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},h._handleTransmuxComplete=function(t){var n,v="audio",y=this.hls,x=t.remuxResult,I=t.chunkMeta,F=this.getCurrentContext(I);if(!F){this.warn("The loading context changed while buffering fragment "+I.sn+" of level "+I.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(I.level);return}var U=F.frag,k=F.part,$=x.audio,W=x.text,G=x.id3,H=x.initSegment;if(!this.fragContextChanged(U)){if(this.state=P.State.PARSING,this.audioSwitch&&$&&this.completeAudioSwitch(),H!=null&&H.tracks&&(this._bufferInitSegment(H.tracks,U,I),y.trigger(O.Events.FRAG_PARSING_INIT_SEGMENT,{frag:U,id:v,tracks:H.tracks})),$){var z=$.startPTS,V=$.endPTS,Y=$.startDTS,Q=$.endDTS;k&&(k.elementaryStreams[T.ElementaryStreamTypes.AUDIO]={startPTS:z,endPTS:V,startDTS:Y,endDTS:Q}),U.setElementaryStreamInfo(T.ElementaryStreamTypes.AUDIO,z,V,Y,Q),this.bufferFragmentData($,U,k,I)}if(G!=null&&(n=G.samples)!==null&&n!==void 0&&n.length){var X=f({frag:U,id:v},G);y.trigger(O.Events.FRAG_PARSING_METADATA,X)}if(W){var q=f({frag:U,id:v},W);y.trigger(O.Events.FRAG_PARSING_USERDATA,q)}}},h._bufferInitSegment=function(t,n,v){if(this.state===P.State.PARSING){t.video&&delete t.video;var y=t.audio;if(!!y){y.levelCodec=y.codec,y.id="audio",this.log("Init audio buffer, container:"+y.container+", codecs[parsed]=["+y.codec+"]"),this.hls.trigger(O.Events.BUFFER_CODECS,t);var x=y.initSegment;if(x!=null&&x.byteLength){var I={type:"audio",frag:n,part:null,chunkMeta:v,parent:n.type,data:x};this.hls.trigger(O.Events.BUFFER_APPENDING,I)}this.tick()}}},h.loadFragment=function(t,n,v){var y=this.fragmentTracker.getState(t);this.fragCurrent=t,(this.audioSwitch||y===_.FragmentState.NOT_LOADED||y===_.FragmentState.PARTIAL)&&(t.sn==="initSegment"?this._loadInitSegment(t):n.live&&!Object(B.isFiniteNumber)(this.initPTS[t.cc])?(this.log("Waiting for video PTS in continuity counter "+t.cc+" of live stream before loading audio fragment "+t.sn+" of level "+this.trackId),this.state=P.State.WAITING_INIT_PTS):(this.startFragRequested=!0,e.prototype.loadFragment.call(this,t,n,v)))},h.completeAudioSwitch=function(){var t=this.hls,n=this.media,v=this.trackId;n&&(this.log("Switching audio track : flushing all audio"),e.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,t.trigger(O.Events.AUDIO_TRACK_SWITCHED,{id:v})},a}(P.default);M.default=l},"./src/controller/audio-track-controller.ts":function(K,M,S){S.r(M);var B=S("./src/events.ts"),P=S("./src/errors.ts"),O=S("./src/controller/base-playlist-controller.ts"),w=S("./src/types/loader.ts");function _(c,A){for(var L=0;L<A.length;L++){var E=A[L];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(c,E.key,E)}}function R(c,A,L){return A&&_(c.prototype,A),L&&_(c,L),c}function C(c,A){c.prototype=Object.create(A.prototype),c.prototype.constructor=c,T(c,A)}function T(c,A){return T=Object.setPrototypeOf||function(E,g){return E.__proto__=g,E},T(c,A)}var D=function(c){C(A,c);function A(E){var g;return g=c.call(this,E,"[audio-track-controller]")||this,g.tracks=[],g.groupId=null,g.tracksInGroup=[],g.trackId=-1,g.trackName="",g.selectDefaultTrack=!0,g.registerListeners(),g}var L=A.prototype;return L.registerListeners=function(){var g=this.hls;g.on(B.Events.MANIFEST_LOADING,this.onManifestLoading,this),g.on(B.Events.MANIFEST_PARSED,this.onManifestParsed,this),g.on(B.Events.LEVEL_LOADING,this.onLevelLoading,this),g.on(B.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),g.on(B.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),g.on(B.Events.ERROR,this.onError,this)},L.unregisterListeners=function(){var g=this.hls;g.off(B.Events.MANIFEST_LOADING,this.onManifestLoading,this),g.off(B.Events.MANIFEST_PARSED,this.onManifestParsed,this),g.off(B.Events.LEVEL_LOADING,this.onLevelLoading,this),g.off(B.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),g.off(B.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),g.off(B.Events.ERROR,this.onError,this)},L.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,c.prototype.destroy.call(this)},L.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},L.onManifestParsed=function(g,o){this.tracks=o.audioTracks||[]},L.onAudioTrackLoaded=function(g,o){var f=o.id,r=o.details,p=this.tracksInGroup[f];if(!p){this.warn("Invalid audio track id "+f);return}var m=p.details;p.details=o.details,this.log("audioTrack "+f+" loaded ["+r.startSN+"-"+r.endSN+"]"),f===this.trackId&&(this.retryCount=0,this.playlistLoaded(f,o,m))},L.onLevelLoading=function(g,o){this.switchLevel(o.level)},L.onLevelSwitching=function(g,o){this.switchLevel(o.level)},L.switchLevel=function(g){var o=this.hls.levels[g];if(!!(o!=null&&o.audioGroupIds)){var f=o.audioGroupIds[o.urlId];if(this.groupId!==f){this.groupId=f;var r=this.tracks.filter(function(m){return!f||m.groupId===f});this.selectDefaultTrack&&!r.some(function(m){return m.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=r;var p={audioTracks:r};this.log("Updating audio tracks, "+r.length+' track(s) found in "'+f+'" group-id'),this.hls.trigger(B.Events.AUDIO_TRACKS_UPDATED,p),this.selectInitialTrack()}}},L.onError=function(g,o){c.prototype.onError.call(this,g,o),!(o.fatal||!o.context)&&o.context.type===w.PlaylistContextType.AUDIO_TRACK&&o.context.id===this.trackId&&o.context.groupId===this.groupId&&this.retryLoadingOrFail(o)},L.setAudioTrack=function(g){var o=this.tracksInGroup;if(g<0||g>=o.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var f=o[this.trackId];this.log("Now switching to audio-track index "+g);var r=o[g],p=r.id,m=r.groupId,l=m===void 0?"":m,e=r.name,a=r.type,h=r.url;if(this.trackId=g,this.trackName=e,this.selectDefaultTrack=!1,this.hls.trigger(B.Events.AUDIO_TRACK_SWITCHING,{id:p,groupId:l,name:e,type:a,url:h}),!(r.details&&!r.details.live)){var u=this.switchParams(r.url,f==null?void 0:f.details);this.loadPlaylist(u)}},L.selectInitialTrack=function(){var g=this.tracksInGroup;console.assert(g.length,"Initial audio track should be selected when tracks are known");var o=this.trackName,f=this.findTrackId(o)||this.findTrackId();f!==-1?this.setAudioTrack(f):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(B.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},L.findTrackId=function(g){for(var o=this.tracksInGroup,f=0;f<o.length;f++){var r=o[f];if((!this.selectDefaultTrack||r.default)&&(!g||g===r.name))return r.id}return-1},L.loadPlaylist=function(g){var o=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(o)){var f=o.id,r=o.groupId,p=o.url;if(g)try{p=g.addDirectives(p)}catch(m){this.warn("Could not construct new URL with HLS Delivery Directives: "+m)}this.log("loading audio-track playlist for id: "+f),this.clearTimer(),this.hls.trigger(B.Events.AUDIO_TRACK_LOADING,{url:p,id:f,groupId:r,deliveryDirectives:g||null})}},R(A,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(g){this.selectDefaultTrack=!1,this.setAudioTrack(g)}}]),A}(O.default);M.default=D},"./src/controller/base-playlist-controller.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return R});var B=S("./src/polyfills/number.ts"),P=S("./src/types/level.ts"),O=S("./src/controller/level-helper.ts"),w=S("./src/utils/logger.ts"),_=S("./src/errors.ts"),R=function(){function C(D,c){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=w.logger.log.bind(w.logger,c+":"),this.warn=w.logger.warn.bind(w.logger,c+":"),this.hls=D}var T=C.prototype;return T.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},T.onError=function(c,A){A.fatal&&A.type===_.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},T.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},T.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},T.stopLoad=function(){this.canLoad=!1,this.clearTimer()},T.switchParams=function(c,A){var L=A==null?void 0:A.renditionReports;if(L)for(var E=0;E<L.length;E++){var g=L[E],o=""+g.URI;if(o===c.substr(-o.length)){var f=parseInt(g["LAST-MSN"]),r=parseInt(g["LAST-PART"]);if(A&&this.hls.config.lowLatencyMode){var p=Math.min(A.age-A.partTarget,A.targetduration);r!==void 0&&p>A.partTarget&&(r+=1)}if(Object(B.isFiniteNumber)(f))return new P.HlsUrlParameters(f,Object(B.isFiniteNumber)(r)?r:void 0,P.HlsSkip.No)}}},T.loadPlaylist=function(c){},T.shouldLoadTrack=function(c){return this.canLoad&&c&&!!c.url&&(!c.details||c.details.live)},T.playlistLoaded=function(c,A,L){var E=this,g=A.details,o=A.stats,f=o.loading.end?Math.max(0,self.performance.now()-o.loading.end):0;if(g.advancedDateTime=Date.now()-f,g.live||L!=null&&L.live){if(g.reloaded(L),L&&this.log("live playlist "+c+" "+(g.advanced?"REFRESHED "+g.lastPartSn+"-"+g.lastPartIndex:"MISSED")),L&&g.fragments.length>0&&Object(O.mergeDetails)(L,g),!this.canLoad||!g.live)return;var r,p=void 0,m=void 0;if(g.canBlockReload&&g.endSN&&g.advanced){var l=this.hls.config.lowLatencyMode,e=g.lastPartSn,a=g.endSN,h=g.lastPartIndex,u=h!==-1,t=e===a,n=l?0:h;u?(p=t?a+1:e,m=t?n:h+1):p=a+1;var v=g.age,y=v+g.ageHeader,x=Math.min(y-g.partTarget,g.targetduration*1.5);if(x>0){if(L&&x>L.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+L.tuneInGoal+" to: "+x+" with playlist age: "+g.age),x=0;else{var I=Math.floor(x/g.targetduration);if(p+=I,m!==void 0){var F=Math.round(x%g.targetduration/g.partTarget);m+=F}this.log("CDN Tune-in age: "+g.ageHeader+"s last advanced "+v.toFixed(2)+"s goal: "+x+" skip sn "+I+" to part "+m)}g.tuneInGoal=x}if(r=this.getDeliveryDirectives(g,A.deliveryDirectives,p,m),l||!t){this.loadPlaylist(r);return}}else r=this.getDeliveryDirectives(g,A.deliveryDirectives,p,m);var U=Object(O.computeReloadInterval)(g,o);p!==void 0&&g.canBlockReload&&(U-=g.partTarget||1),this.log("reload live playlist "+c+" in "+Math.round(U)+" ms"),this.timer=self.setTimeout(function(){return E.loadPlaylist(r)},U)}else this.clearTimer()},T.getDeliveryDirectives=function(c,A,L,E){var g=Object(P.getSkipValue)(c,L);return A!=null&&A.skip&&c.deltaUpdateFailed&&(L=A.msn,E=A.part,g=P.HlsSkip.No),new P.HlsUrlParameters(L,E,g)},T.retryLoadingOrFail=function(c){var A=this,L=this.hls.config,E=this.retryCount<L.levelLoadingMaxRetry;if(E){var g;if(this.retryCount++,c.details.indexOf("LoadTimeOut")>-1&&(g=c.context)!==null&&g!==void 0&&g.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+c.details+'"'),this.loadPlaylist();else{var o=Math.min(Math.pow(2,this.retryCount)*L.levelLoadingRetryDelay,L.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return A.loadPlaylist()},o),this.warn("retry playlist loading #"+this.retryCount+" in "+o+' ms after "'+c.details+'"')}}else this.warn('cannot recover from error "'+c.details+'"'),this.clearTimer(),c.fatal=!0;return E},C}()},"./src/controller/base-stream-controller.ts":function(K,M,S){S.r(M),S.d(M,"State",function(){return a}),S.d(M,"default",function(){return h});var B=S("./src/polyfills/number.ts"),P=S("./src/task-loop.ts"),O=S("./src/controller/fragment-tracker.ts"),w=S("./src/utils/buffer-helper.ts"),_=S("./src/utils/logger.ts"),R=S("./src/events.ts"),C=S("./src/errors.ts"),T=S("./src/types/transmuxer.ts"),D=S("./src/utils/mp4-tools.ts"),c=S("./src/utils/discontinuities.ts"),A=S("./src/controller/fragment-finders.ts"),L=S("./src/controller/level-helper.ts"),E=S("./src/loader/fragment-loader.ts"),g=S("./src/crypt/decrypter.ts"),o=S("./src/utils/time-ranges.ts"),f=S("./src/types/loader.ts");function r(u,t){for(var n=0;n<t.length;n++){var v=t[n];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(u,v.key,v)}}function p(u,t,n){return t&&r(u.prototype,t),n&&r(u,n),u}function m(u){if(u===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u}function l(u,t){u.prototype=Object.create(t.prototype),u.prototype.constructor=u,e(u,t)}function e(u,t){return e=Object.setPrototypeOf||function(v,y){return v.__proto__=y,v},e(u,t)}var a={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},h=function(u){l(t,u);function t(v,y,x){var I;return I=u.call(this)||this,I.hls=void 0,I.fragPrevious=null,I.fragCurrent=null,I.fragmentTracker=void 0,I.transmuxer=null,I._state=a.STOPPED,I.media=void 0,I.mediaBuffer=void 0,I.config=void 0,I.bitrateTest=!1,I.lastCurrentTime=0,I.nextLoadPosition=0,I.startPosition=0,I.loadedmetadata=!1,I.fragLoadError=0,I.retryDate=0,I.levels=null,I.fragmentLoader=void 0,I.levelLastLoaded=null,I.startFragRequested=!1,I.decrypter=void 0,I.initPTS=[],I.onvseeking=null,I.onvended=null,I.logPrefix="",I.log=void 0,I.warn=void 0,I.logPrefix=x,I.log=_.logger.log.bind(_.logger,x+":"),I.warn=_.logger.warn.bind(_.logger,x+":"),I.hls=v,I.fragmentLoader=new E.default(v.config),I.fragmentTracker=y,I.config=v.config,I.decrypter=new g.default(v,v.config),v.on(R.Events.KEY_LOADED,I.onKeyLoaded,m(I)),I}var n=t.prototype;return n.doTick=function(){this.onTickEnd()},n.onTickEnd=function(){},n.startLoad=function(y){},n.stopLoad=function(){this.fragmentLoader.abort();var y=this.fragCurrent;y&&this.fragmentTracker.removeFragment(y),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=a.STOPPED},n._streamEnded=function(y,x){var I=this.fragCurrent,F=this.fragmentTracker;if(!x.live&&I&&I.sn>=x.endSN&&!y.nextStart){var U=x.partList;if(U!=null&&U.length){var k=U[U.length-1],$=w.BufferHelper.isBuffered(this.media,k.start+k.duration/2);return $}var W=F.getState(I);return W===O.FragmentState.PARTIAL||W===O.FragmentState.OK}return!1},n.onMediaAttached=function(y,x){var I=this.media=this.mediaBuffer=x.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),I.addEventListener("seeking",this.onvseeking),I.addEventListener("ended",this.onvended);var F=this.config;this.levels&&F.autoStartLoad&&this.state===a.STOPPED&&this.startLoad(F.startPosition)},n.onMediaDetaching=function(){var y=this.media;y!=null&&y.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),y&&(y.removeEventListener("seeking",this.onvseeking),y.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},n.onMediaSeeking=function(){var y=this.config,x=this.fragCurrent,I=this.media,F=this.mediaBuffer,U=this.state,k=I?I.currentTime:0,$=w.BufferHelper.bufferInfo(F||I,k,y.maxBufferHole);if(this.log("media seeking to "+(Object(B.isFiniteNumber)(k)?k.toFixed(3):k)+", state: "+U),U===a.ENDED)this.resetLoadingState();else if(x&&!$.len){var W=y.maxFragLookUpTolerance,G=x.start-W,H=x.start+x.duration+W,z=k>H;(k<G||z)&&(z&&x.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),x.loader.abort()),this.resetLoadingState())}I&&(this.lastCurrentTime=k),!this.loadedmetadata&&!$.len&&(this.nextLoadPosition=this.startPosition=k),this.tickImmediate()},n.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},n.onKeyLoaded=function(y,x){if(!(this.state!==a.KEY_LOADING||x.frag!==this.fragCurrent||!this.levels)){this.state=a.IDLE;var I=this.levels[x.frag.level].details;I&&this.loadFragment(x.frag,I,x.frag.start)}},n.onHandlerDestroying=function(){this.stopLoad(),u.prototype.onHandlerDestroying.call(this)},n.onHandlerDestroyed=function(){this.state=a.STOPPED,this.hls.off(R.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,u.prototype.onHandlerDestroyed.call(this)},n.loadKey=function(y,x){this.log("Loading key for "+y.sn+" of ["+x.startSN+"-"+x.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+y.level),this.state=a.KEY_LOADING,this.fragCurrent=y,this.hls.trigger(R.Events.KEY_LOADING,{frag:y})},n.loadFragment=function(y,x,I){this._loadFragForPlayback(y,x,I)},n._loadFragForPlayback=function(y,x,I){var F=this,U=function($){if(F.fragContextChanged(y)){F.warn("Fragment "+y.sn+($.part?" p: "+$.part.index:"")+" of level "+y.level+" was dropped during download."),F.fragmentTracker.removeFragment(y);return}y.stats.chunkCount++,F._handleFragmentLoadProgress($)};this._doFragLoad(y,x,I,U).then(function(k){if(!!k){F.fragLoadError=0;var $=F.state;if(F.fragContextChanged(y)){($===a.FRAG_LOADING||$===a.BACKTRACKING||!F.fragCurrent&&$===a.PARSING)&&(F.fragmentTracker.removeFragment(y),F.state=a.IDLE);return}if("payload"in k&&(F.log("Loaded fragment "+y.sn+" of level "+y.level),F.hls.trigger(R.Events.FRAG_LOADED,k),F.state===a.BACKTRACKING)){F.fragmentTracker.backtrack(y,k),F.resetFragmentLoading(y);return}F._handleFragmentLoadComplete(k)}}).catch(function(k){F.warn(k),F.resetFragmentLoading(y)})},n.flushMainBuffer=function(y,x,I){if(I===void 0&&(I=null),!!(y-x)){var F={startOffset:y,endOffset:x,type:I};this.fragLoadError=0,this.hls.trigger(R.Events.BUFFER_FLUSHING,F)}},n._loadInitSegment=function(y){var x=this;this._doFragLoad(y).then(function(I){if(!I||x.fragContextChanged(y)||!x.levels)throw new Error("init load aborted");return I}).then(function(I){var F=x.hls,U=I.payload,k=y.decryptdata;if(U&&U.byteLength>0&&k&&k.key&&k.iv&&k.method==="AES-128"){var $=self.performance.now();return x.decrypter.webCryptoDecrypt(new Uint8Array(U),k.key.buffer,k.iv.buffer).then(function(W){var G=self.performance.now();return F.trigger(R.Events.FRAG_DECRYPTED,{frag:y,payload:W,stats:{tstart:$,tdecrypt:G}}),I.payload=W,I})}return I}).then(function(I){var F=x.fragCurrent,U=x.hls,k=x.levels;if(!k)throw new Error("init load aborted, missing levels");var $=k[y.level].details;console.assert($,"Level details are defined when init segment is loaded");var W=y.stats;x.state=a.IDLE,x.fragLoadError=0,y.data=new Uint8Array(I.payload),W.parsing.start=W.buffering.start=self.performance.now(),W.parsing.end=W.buffering.end=self.performance.now(),I.frag===F&&U.trigger(R.Events.FRAG_BUFFERED,{stats:W,frag:F,part:null,id:y.type}),x.tick()}).catch(function(I){x.warn(I),x.resetFragmentLoading(y)})},n.fragContextChanged=function(y){var x=this.fragCurrent;return!y||!x||y.level!==x.level||y.sn!==x.sn||y.urlId!==x.urlId},n.fragBufferedComplete=function(y,x){var I=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+y.type+" sn: "+y.sn+(x?" part: "+x.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+y.level+" "+o.default.toString(w.BufferHelper.getBuffered(I))),this.state=a.IDLE,this.tick()},n._handleFragmentLoadComplete=function(y){var x=this.transmuxer;if(!!x){var I=y.frag,F=y.part,U=y.partsLoaded,k=!U||U.length===0||U.some(function(W){return!W}),$=new T.ChunkMetadata(I.level,I.sn,I.stats.chunkCount+1,0,F?F.index:-1,!k);x.flush($)}},n._handleFragmentLoadProgress=function(y){},n._doFragLoad=function(y,x,I,F){var U=this;if(I===void 0&&(I=null),!this.levels)throw new Error("frag load aborted, missing levels");if(I=Math.max(y.start,I||0),this.config.lowLatencyMode&&x){var k=x.partList;if(k&&F){I>y.end&&x.fragmentHint&&(y=x.fragmentHint);var $=this.getNextPart(k,y,I);if($>-1){var W=k[$];return this.log("Loading part sn: "+y.sn+" p: "+W.index+" cc: "+y.cc+" of playlist ["+x.startSN+"-"+x.endSN+"] parts [0-"+$+"-"+(k.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+y.level+", target: "+parseFloat(I.toFixed(3))),this.nextLoadPosition=W.start+W.duration,this.state=a.FRAG_LOADING,this.hls.trigger(R.Events.FRAG_LOADING,{frag:y,part:k[$],targetBufferTime:I}),this.doFragPartsLoad(y,k,$,F).catch(function(G){return U.handleFragLoadError(G)})}else if(!y.url||this.loadedEndOfParts(k,I))return Promise.resolve(null)}}return this.log("Loading fragment "+y.sn+" cc: "+y.cc+" "+(x?"of ["+x.startSN+"-"+x.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+y.level+", target: "+parseFloat(I.toFixed(3))),Object(B.isFiniteNumber)(y.sn)&&!this.bitrateTest&&(this.nextLoadPosition=y.start+y.duration),this.state=a.FRAG_LOADING,this.hls.trigger(R.Events.FRAG_LOADING,{frag:y,targetBufferTime:I}),this.fragmentLoader.load(y,F).catch(function(G){return U.handleFragLoadError(G)})},n.doFragPartsLoad=function(y,x,I,F){var U=this;return new Promise(function(k,$){var W=[],G=function H(z){var V=x[z];U.fragmentLoader.loadPart(y,V,F).then(function(Y){W[V.index]=Y;var Q=Y.part;U.hls.trigger(R.Events.FRAG_LOADED,Y);var X=x[z+1];if(X&&X.fragment===y)H(z+1);else return k({frag:y,part:Q,partsLoaded:W})}).catch($)};G(I)})},n.handleFragLoadError=function(y){var x=y.data;return x&&x.details===C.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(x.frag,x.part):this.hls.trigger(R.Events.ERROR,x),null},n._handleTransmuxerFlush=function(y){var x=this.getCurrentContext(y);if(!x||this.state!==a.PARSING){this.fragCurrent||(this.state=a.IDLE);return}var I=x.frag,F=x.part,U=x.level,k=self.performance.now();I.stats.parsing.end=k,F&&(F.stats.parsing.end=k),this.updateLevelTiming(I,F,U,y.partial)},n.getCurrentContext=function(y){var x=this.levels,I=y.level,F=y.sn,U=y.part;if(!x||!x[I])return this.warn("Levels object was unset while buffering fragment "+F+" of level "+I+". The current chunk will not be buffered."),null;var k=x[I],$=U>-1?Object(L.getPartWith)(k,F,U):null,W=$?$.fragment:Object(L.getFragmentWithSN)(k,F,this.fragCurrent);return W?{frag:W,part:$,level:k}:null},n.bufferFragmentData=function(y,x,I,F){if(!(!y||this.state!==a.PARSING)){var U=y.data1,k=y.data2,$=U;if(U&&k&&($=Object(D.appendUint8Array)(U,k)),!(!$||!$.length)){var W={type:y.type,frag:x,part:I,chunkMeta:F,parent:x.type,data:$};this.hls.trigger(R.Events.BUFFER_APPENDING,W),y.dropped&&y.independent&&!I&&this.flushBufferGap(x)}}},n.flushBufferGap=function(y){var x=this.media;if(!!x){if(!w.BufferHelper.isBuffered(x,x.currentTime)){this.flushMainBuffer(0,y.start);return}var I=x.currentTime,F=w.BufferHelper.bufferInfo(x,I,0),U=y.duration,k=Math.min(this.config.maxFragLookUpTolerance*2,U*.25),$=Math.max(Math.min(y.start-k,F.end-k),I+k);y.start-$>k&&this.flushMainBuffer($,y.start)}},n.getFwdBufferInfo=function(y,x){var I=this.config,F=this.getLoadPosition();if(!Object(B.isFiniteNumber)(F))return null;var U=w.BufferHelper.bufferInfo(y,F,I.maxBufferHole);if(U.len===0&&U.nextStart!==void 0){var k=this.fragmentTracker.getBufferedFrag(F,x);if(k&&U.nextStart<k.end)return w.BufferHelper.bufferInfo(y,F,Math.max(U.nextStart,I.maxBufferHole))}return U},n.getMaxBufferLength=function(y){var x=this.config,I;return y?I=Math.max(8*x.maxBufferSize/y,x.maxBufferLength):I=x.maxBufferLength,Math.min(I,x.maxMaxBufferLength)},n.reduceMaxBufferLength=function(y){var x=this.config,I=y||x.maxBufferLength;return x.maxMaxBufferLength>=I?(x.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+x.maxMaxBufferLength+"s"),!0):!1},n.getNextFragment=function(y,x){var I,F,U=x.fragments,k=U.length;if(!k)return null;var $=this.config,W=U[0].start,G;if(x.live){var H=$.initialLiveManifestSize;if(k<H)return this.warn("Not enough fragments to start playback (have: "+k+", need: "+H+")"),null;!x.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(G=this.getInitialLiveFragment(x,U),this.startPosition=G?this.hls.liveSyncPosition||G.start:y)}else y<=W&&(G=U[0]);if(!G){var z=$.lowLatencyMode?x.partEnd:x.fragmentEnd;G=this.getFragmentAtPosition(y,z,x)}return(I=G)!==null&&I!==void 0&&I.initSegment&&!((F=G)!==null&&F!==void 0&&F.initSegment.data)&&!this.bitrateTest&&(G=G.initSegment),G},n.getNextPart=function(y,x,I){for(var F=-1,U=!1,k=!0,$=0,W=y.length;$<W;$++){var G=y[$];if(k=k&&!G.independent,F>-1&&I<G.start)break;var H=G.loaded;!H&&(U||G.independent||k)&&G.fragment===x&&(F=$),U=H}return F},n.loadedEndOfParts=function(y,x){var I=y[y.length-1];return I&&x>I.start&&I.loaded},n.getInitialLiveFragment=function(y,x){var I=this.fragPrevious,F=null;if(I){if(y.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+I.programDateTime),F=Object(A.findFragmentByPDT)(x,I.endProgramDateTime,this.config.maxFragLookUpTolerance)),!F){var U=I.sn+1;if(U>=y.startSN&&U<=y.endSN){var k=x[U-y.startSN];I.cc===k.cc&&(F=k,this.log("Live playlist, switching playlist, load frag with next SN: "+F.sn))}F||(F=Object(A.findFragWithCC)(x,I.cc),F&&this.log("Live playlist, switching playlist, load frag with same CC: "+F.sn))}}else{var $=this.hls.liveSyncPosition;$!==null&&(F=this.getFragmentAtPosition($,this.bitrateTest?y.fragmentEnd:y.edge,y))}return F},n.getFragmentAtPosition=function(y,x,I){var F=this.config,U=this.fragPrevious,k=I.fragments,$=I.endSN,W=I.fragmentHint,G=F.maxFragLookUpTolerance,H=!!(F.lowLatencyMode&&I.partList&&W);H&&W&&!this.bitrateTest&&(k=k.concat(W),$=W.sn);var z;if(y<x){var V=y>x-G?0:G;z=Object(A.findFragmentByPTS)(U,k,y,V)}else z=k[k.length-1];if(z){var Y=z.sn-I.startSN,Q=U&&z.level===U.level,X=k[Y+1],q=this.fragmentTracker.getState(z);if(q===O.FragmentState.BACKTRACKED){z=null;for(var J=Y;k[J]&&this.fragmentTracker.getState(k[J])===O.FragmentState.BACKTRACKED;)U?z=k[J--]:z=k[--J];z||(z=X)}else U&&z.sn===U.sn&&!H&&Q&&(z.sn<$&&this.fragmentTracker.getState(X)!==O.FragmentState.OK?(this.log("SN "+z.sn+" just loaded, load next one: "+X.sn),z=X):z=null)}return z},n.synchronizeToLiveEdge=function(y){var x=this.config,I=this.media;if(!!I){var F=this.hls.liveSyncPosition,U=I.currentTime,k=y.fragments[0].start,$=y.edge,W=U>=k-x.maxFragLookUpTolerance&&U<=$;if(F!==null&&I.duration>F&&(U<F||!W)){var G=x.liveMaxLatencyDuration!==void 0?x.liveMaxLatencyDuration:x.liveMaxLatencyDurationCount*y.targetduration;(!W&&I.readyState<4||U<$-G)&&(this.loadedmetadata||(this.nextLoadPosition=F),I.readyState&&(this.warn("Playback: "+U.toFixed(3)+" is located too far from the end of live sliding playlist: "+$+", reset currentTime to : "+F.toFixed(3)),I.currentTime=F))}}},n.alignPlaylists=function(y,x){var I=this.levels,F=this.levelLastLoaded,U=this.fragPrevious,k=F!==null?I[F]:null,$=y.fragments.length;if(!$)return this.warn("No fragments in live playlist"),0;var W=y.fragments[0].start,G=!x,H=y.alignedSliding&&Object(B.isFiniteNumber)(W);if(G||!H&&!W){Object(c.alignStream)(U,k,y);var z=y.fragments[0].start;return this.log("Live playlist sliding: "+z.toFixed(2)+" start-sn: "+(x?x.startSN:"na")+"->"+y.startSN+" prev-sn: "+(U?U.sn:"na")+" fragments: "+$),z}return W},n.waitForCdnTuneIn=function(y){var x=3;return y.live&&y.canBlockReload&&y.tuneInGoal>Math.max(y.partHoldBack,y.partTarget*x)},n.setStartPosition=function(y,x){var I=this.startPosition;if(I<x&&(I=-1),I===-1||this.lastCurrentTime===-1){var F=y.startTimeOffset;Object(B.isFiniteNumber)(F)?(I=x+F,F<0&&(I+=y.totalduration),I=Math.min(Math.max(x,I),x+y.totalduration),this.log("Start time offset "+F+" found in playlist, adjust startPosition to "+I),this.startPosition=I):y.live?I=this.hls.liveSyncPosition||x:this.startPosition=I=0,this.lastCurrentTime=I}this.nextLoadPosition=I},n.getLoadPosition=function(){var y=this.media,x=0;return this.loadedmetadata&&y?x=y.currentTime:this.nextLoadPosition&&(x=this.nextLoadPosition),x},n.handleFragLoadAborted=function(y,x){this.transmuxer&&y.sn!=="initSegment"&&y.stats.aborted&&(this.warn("Fragment "+y.sn+(x?" part"+x.index:"")+" of level "+y.level+" was aborted"),this.resetFragmentLoading(y))},n.resetFragmentLoading=function(y){(!this.fragCurrent||!this.fragContextChanged(y))&&(this.state=a.IDLE)},n.onFragmentOrKeyLoadError=function(y,x){if(!x.fatal){var I=x.frag;if(!(!I||I.type!==y)){var F=this.fragCurrent;console.assert(F&&I.sn===F.sn&&I.level===F.level&&I.urlId===F.urlId,"Frag load error must match current frag to retry");var U=this.config;if(this.fragLoadError+1<=U.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(I.level))return;var k=Math.min(Math.pow(2,this.fragLoadError)*U.fragLoadingRetryDelay,U.fragLoadingMaxRetryTimeout);this.warn("Fragment "+I.sn+" of "+y+" "+I.level+" failed to load, retrying in "+k+"ms"),this.retryDate=self.performance.now()+k,this.fragLoadError++,this.state=a.FRAG_LOADING_WAITING_RETRY}else x.levelRetry?(y===f.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=a.IDLE):(_.logger.error(x.details+" reaches max retry, redispatch as fatal ..."),x.fatal=!0,this.hls.stopLoad(),this.state=a.ERROR)}}},n.afterBufferFlushed=function(y,x,I){if(!!y){var F=w.BufferHelper.getBuffered(y);this.fragmentTracker.detectEvictedFragments(x,F,I),this.state===a.ENDED&&this.resetLoadingState()}},n.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=a.IDLE},n.resetLiveStartWhenNotLoaded=function(y){if(!this.loadedmetadata){this.startFragRequested=!1;var x=this.levels?this.levels[y].details:null;if(x!=null&&x.live)return this.startPosition=-1,this.setStartPosition(x,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},n.updateLevelTiming=function(y,x,I,F){var U=this,k=I.details;console.assert(!!k,"level.details must be defined");var $=Object.keys(y.elementaryStreams).reduce(function(W,G){var H=y.elementaryStreams[G];if(H){var z=H.endPTS-H.startPTS;if(z<=0)return U.warn("Could not parse fragment "+y.sn+" "+G+" duration reliably ("+z+") resetting transmuxer to fallback to playlist timing"),U.resetTransmuxer(),W||!1;var V=F?0:Object(L.updateFragPTSDTS)(k,y,H.startPTS,H.endPTS,H.startDTS,H.endDTS);return U.hls.trigger(R.Events.LEVEL_PTS_UPDATED,{details:k,level:I,drift:V,type:G,frag:y,start:H.startPTS,end:H.endPTS}),!0}return W},!1);$?(this.state=a.PARSED,this.hls.trigger(R.Events.FRAG_PARSED,{frag:y,part:x})):this.resetLoadingState()},n.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},p(t,[{key:"state",get:function(){return this._state},set:function(y){var x=this._state;x!==y&&(this._state=y,this.log(x+"->"+y))}}]),t}(P.default)},"./src/controller/buffer-controller.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return A});var B=S("./src/polyfills/number.ts"),P=S("./src/events.ts"),O=S("./src/utils/logger.ts"),w=S("./src/errors.ts"),_=S("./src/utils/buffer-helper.ts"),R=S("./src/utils/mediasource-helper.ts"),C=S("./src/loader/fragment.ts"),T=S("./src/controller/buffer-operation-queue.ts"),D=Object(R.getMediaSource)(),c=/([ha]vc.)(?:\.[^.,]+)+/,A=function(){function L(g){var o=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var f=o.hls,r=o.media,p=o.mediaSource;O.logger.log("[buffer-controller]: Media source opened"),r&&(o.updateMediaElementDuration(),f.trigger(P.Events.MEDIA_ATTACHED,{media:r})),p&&p.removeEventListener("sourceopen",o._onMediaSourceOpen),o.checkPendingTracks()},this._onMediaSourceClose=function(){O.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){O.logger.log("[buffer-controller]: Media source ended")},this.hls=g,this._initSourceBuffer(),this.registerListeners()}var E=L.prototype;return E.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},E.destroy=function(){this.unregisterListeners(),this.details=null},E.registerListeners=function(){var o=this.hls;o.on(P.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),o.on(P.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.on(P.Events.MANIFEST_PARSED,this.onManifestParsed,this),o.on(P.Events.BUFFER_RESET,this.onBufferReset,this),o.on(P.Events.BUFFER_APPENDING,this.onBufferAppending,this),o.on(P.Events.BUFFER_CODECS,this.onBufferCodecs,this),o.on(P.Events.BUFFER_EOS,this.onBufferEos,this),o.on(P.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),o.on(P.Events.LEVEL_UPDATED,this.onLevelUpdated,this),o.on(P.Events.FRAG_PARSED,this.onFragParsed,this),o.on(P.Events.FRAG_CHANGED,this.onFragChanged,this)},E.unregisterListeners=function(){var o=this.hls;o.off(P.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),o.off(P.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.off(P.Events.MANIFEST_PARSED,this.onManifestParsed,this),o.off(P.Events.BUFFER_RESET,this.onBufferReset,this),o.off(P.Events.BUFFER_APPENDING,this.onBufferAppending,this),o.off(P.Events.BUFFER_CODECS,this.onBufferCodecs,this),o.off(P.Events.BUFFER_EOS,this.onBufferEos,this),o.off(P.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),o.off(P.Events.LEVEL_UPDATED,this.onLevelUpdated,this),o.off(P.Events.FRAG_PARSED,this.onFragParsed,this),o.off(P.Events.FRAG_CHANGED,this.onFragChanged,this)},E._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new T.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},E.onManifestParsed=function(o,f){var r=2;(f.audio&&!f.video||!f.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,this.details=null,O.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},E.onMediaAttaching=function(o,f){var r=this.media=f.media;if(r&&D){var p=this.mediaSource=new D;p.addEventListener("sourceopen",this._onMediaSourceOpen),p.addEventListener("sourceended",this._onMediaSourceEnded),p.addEventListener("sourceclose",this._onMediaSourceClose),r.src=self.URL.createObjectURL(p),this._objectUrl=r.src}},E.onMediaDetaching=function(){var o=this.media,f=this.mediaSource,r=this._objectUrl;if(f){if(O.logger.log("[buffer-controller]: media source detaching"),f.readyState==="open")try{f.endOfStream()}catch(p){O.logger.warn("[buffer-controller]: onMediaDetaching: "+p.message+" while calling endOfStream")}this.onBufferReset(),f.removeEventListener("sourceopen",this._onMediaSourceOpen),f.removeEventListener("sourceended",this._onMediaSourceEnded),f.removeEventListener("sourceclose",this._onMediaSourceClose),o&&(r&&self.URL.revokeObjectURL(r),o.src===r?(o.removeAttribute("src"),o.load()):O.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(P.Events.MEDIA_DETACHED,void 0)},E.onBufferReset=function(){var o=this;this.getSourceBufferTypes().forEach(function(f){var r=o.sourceBuffer[f];try{r&&(o.removeBufferListeners(f),o.mediaSource&&o.mediaSource.removeSourceBuffer(r),o.sourceBuffer[f]=void 0)}catch(p){O.logger.warn("[buffer-controller]: Failed to reset the "+f+" buffer",p)}}),this._initSourceBuffer()},E.onBufferCodecs=function(o,f){var r=this,p=this.getSourceBufferTypes().length;Object.keys(f).forEach(function(m){if(p){var l=r.tracks[m];if(l&&typeof l.buffer.changeType=="function"){var e=f[m],a=e.codec,h=e.levelCodec,u=e.container,t=(l.levelCodec||l.codec).replace(c,"$1"),n=(h||a).replace(c,"$1");if(t!==n){var v=u+";codecs="+(h||a);r.appendChangeType(m,v)}}}else r.pendingTracks[m]=f[m]}),!p&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},E.appendChangeType=function(o,f){var r=this,p=this.operationQueue,m={execute:function(){var e=r.sourceBuffer[o];e&&(O.logger.log("[buffer-controller]: changing "+o+" sourceBuffer type to "+f),e.changeType(f)),p.shiftAndExecuteNext(o)},onStart:function(){},onComplete:function(){},onError:function(e){O.logger.warn("[buffer-controller]: Failed to change "+o+" SourceBuffer type",e)}};p.append(m,o)},E.onBufferAppending=function(o,f){var r=this,p=this.hls,m=this.operationQueue,l=this.tracks,e=f.data,a=f.type,h=f.frag,u=f.part,t=f.chunkMeta,n=t.buffering[a],v=self.performance.now();n.start=v;var y=h.stats.buffering,x=u?u.stats.buffering:null;y.start===0&&(y.start=v),x&&x.start===0&&(x.start=v);var I=l.audio,F=a==="audio"&&t.id===1&&(I==null?void 0:I.container)==="audio/mpeg",U={execute:function(){if(n.executeStart=self.performance.now(),F){var $=r.sourceBuffer[a];if($){var W=h.start-$.timestampOffset;Math.abs(W)>=.1&&(O.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+h.start+" (delta: "+W+") sn: "+h.sn+")"),$.timestampOffset=h.start)}}r.appendExecutor(e,a)},onStart:function(){},onComplete:function(){var $=self.performance.now();n.executeEnd=n.end=$,y.first===0&&(y.first=$),x&&x.first===0&&(x.first=$);var W=r.sourceBuffer,G={};for(var H in W)G[H]=_.BufferHelper.getBuffered(W[H]);r.appendError=0,r.hls.trigger(P.Events.BUFFER_APPENDED,{type:a,frag:h,part:u,chunkMeta:t,parent:h.type,timeRanges:G})},onError:function($){O.logger.error("[buffer-controller]: Error encountered while trying to append to the "+a+" SourceBuffer",$);var W={type:w.ErrorTypes.MEDIA_ERROR,parent:h.type,details:w.ErrorDetails.BUFFER_APPEND_ERROR,err:$,fatal:!1};$.code===DOMException.QUOTA_EXCEEDED_ERR?W.details=w.ErrorDetails.BUFFER_FULL_ERROR:(r.appendError++,W.details=w.ErrorDetails.BUFFER_APPEND_ERROR,r.appendError>p.config.appendErrorMaxRetry&&(O.logger.error("[buffer-controller]: Failed "+p.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),W.fatal=!0)),p.trigger(P.Events.ERROR,W)}};m.append(U,a)},E.onBufferFlushing=function(o,f){var r=this,p=this.operationQueue,m=function(e){return{execute:r.removeExecutor.bind(r,e,f.startOffset,f.endOffset),onStart:function(){},onComplete:function(){r.hls.trigger(P.Events.BUFFER_FLUSHED,{type:e})},onError:function(h){O.logger.warn("[buffer-controller]: Failed to remove from "+e+" SourceBuffer",h)}}};f.type?p.append(m(f.type),f.type):this.getSourceBufferTypes().forEach(function(l){p.append(m(l),l)})},E.onFragParsed=function(o,f){var r=this,p=f.frag,m=f.part,l=[],e=m?m.elementaryStreams:p.elementaryStreams;e[C.ElementaryStreamTypes.AUDIOVIDEO]?l.push("audiovideo"):(e[C.ElementaryStreamTypes.AUDIO]&&l.push("audio"),e[C.ElementaryStreamTypes.VIDEO]&&l.push("video"));var a=function(){var u=self.performance.now();p.stats.buffering.end=u,m&&(m.stats.buffering.end=u);var t=m?m.stats:p.stats;r.hls.trigger(P.Events.FRAG_BUFFERED,{frag:p,part:m,stats:t,id:p.type})};l.length===0&&O.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+p.type+" level: "+p.level+" sn: "+p.sn),this.blockBuffers(a,l)},E.onFragChanged=function(o,f){this.flushBackBuffer()},E.onBufferEos=function(o,f){var r=this,p=this.getSourceBufferTypes().reduce(function(m,l){var e=r.sourceBuffer[l];return(!f.type||f.type===l)&&e&&!e.ended&&(e.ended=!0,O.logger.log("[buffer-controller]: "+l+" sourceBuffer now EOS")),m&&!!(!e||e.ended)},!0);p&&this.blockBuffers(function(){var m=r.mediaSource;!m||m.readyState!=="open"||m.endOfStream()})},E.onLevelUpdated=function(o,f){var r=f.details;!r.fragments.length||(this.details=r,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},E.flushBackBuffer=function(){var o=this.hls,f=this.details,r=this.media,p=this.sourceBuffer;if(!(!r||f===null)){var m=this.getSourceBufferTypes();if(!!m.length){var l=f.live&&o.config.liveBackBufferLength!==null?o.config.liveBackBufferLength:o.config.backBufferLength;if(!(!Object(B.isFiniteNumber)(l)||l<0)){var e=r.currentTime,a=f.levelTargetDuration,h=Math.max(l,a),u=Math.floor(e/a)*a-h;m.forEach(function(t){var n=p[t];if(n){var v=_.BufferHelper.getBuffered(n);v.length>0&&u>v.start(0)&&(o.trigger(P.Events.BACK_BUFFER_REACHED,{bufferEnd:u}),f.live&&o.trigger(P.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:u}),o.trigger(P.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:u,type:t}))}})}}}},E.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var o=this.details,f=this.hls,r=this.media,p=this.mediaSource,m=o.fragments[0].start+o.totalduration,l=r.duration,e=Object(B.isFiniteNumber)(p.duration)?p.duration:0;o.live&&f.config.liveDurationInfinity?(O.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),p.duration=1/0,this.updateSeekableRange(o)):(m>e&&m>l||!Object(B.isFiniteNumber)(l))&&(O.logger.log("[buffer-controller]: Updating Media Source duration to "+m.toFixed(3)),p.duration=m)}},E.updateSeekableRange=function(o){var f=this.mediaSource,r=o.fragments,p=r.length;if(p&&o.live&&f!==null&&f!==void 0&&f.setLiveSeekableRange){var m=Math.max(0,r[0].start),l=Math.max(m,m+o.totalduration);f.setLiveSeekableRange(m,l)}},E.checkPendingTracks=function(){var o=this.bufferCodecEventsExpected,f=this.operationQueue,r=this.pendingTracks,p=Object.keys(r).length;if(p&&!o||p===2){this.createSourceBuffers(r),this.pendingTracks={};var m=this.getSourceBufferTypes();if(m.length===0){this.hls.trigger(P.Events.ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}m.forEach(function(l){f.executeNext(l)})}},E.createSourceBuffers=function(o){var f=this.sourceBuffer,r=this.mediaSource;if(!r)throw Error("createSourceBuffers called when mediaSource was null");var p=0;for(var m in o)if(!f[m]){var l=o[m];if(!l)throw Error("source buffer exists for track "+m+", however track does not");var e=l.levelCodec||l.codec,a=l.container+";codecs="+e;O.logger.log("[buffer-controller]: creating sourceBuffer("+a+")");try{var h=f[m]=r.addSourceBuffer(a),u=m;this.addBufferListener(u,"updatestart",this._onSBUpdateStart),this.addBufferListener(u,"updateend",this._onSBUpdateEnd),this.addBufferListener(u,"error",this._onSBUpdateError),this.tracks[m]={buffer:h,codec:e,container:l.container,levelCodec:l.levelCodec,id:l.id},p++}catch(t){O.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+t.message),this.hls.trigger(P.Events.ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:t,mimeType:a})}}p&&this.hls.trigger(P.Events.BUFFER_CREATED,{tracks:this.tracks})},E._onSBUpdateStart=function(o){var f=this.operationQueue,r=f.current(o);r.onStart()},E._onSBUpdateEnd=function(o){var f=this.operationQueue,r=f.current(o);r.onComplete(),f.shiftAndExecuteNext(o)},E._onSBUpdateError=function(o,f){O.logger.error("[buffer-controller]: "+o+" SourceBuffer error",f),this.hls.trigger(P.Events.ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var r=this.operationQueue.current(o);r&&r.onError(f)},E.removeExecutor=function(o,f,r){var p=this.media,m=this.mediaSource,l=this.operationQueue,e=this.sourceBuffer,a=e[o];if(!p||!m||!a){O.logger.warn("[buffer-controller]: Attempting to remove from the "+o+" SourceBuffer, but it does not exist"),l.shiftAndExecuteNext(o);return}var h=Object(B.isFiniteNumber)(p.duration)?p.duration:1/0,u=Object(B.isFiniteNumber)(m.duration)?m.duration:1/0,t=Math.max(0,f),n=Math.min(r,h,u);n>t?(O.logger.log("[buffer-controller]: Removing ["+t+","+n+"] from the "+o+" SourceBuffer"),console.assert(!a.updating,o+" sourceBuffer must not be updating"),a.remove(t,n)):l.shiftAndExecuteNext(o)},E.appendExecutor=function(o,f){var r=this.operationQueue,p=this.sourceBuffer,m=p[f];if(!m){O.logger.warn("[buffer-controller]: Attempting to append to the "+f+" SourceBuffer, but it does not exist"),r.shiftAndExecuteNext(f);return}m.ended=!1,console.assert(!m.updating,f+" sourceBuffer must not be updating"),m.appendBuffer(o)},E.blockBuffers=function(o,f){var r=this;if(f===void 0&&(f=this.getSourceBufferTypes()),!f.length){O.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve(o);return}var p=this.operationQueue,m=f.map(function(l){return p.appendBlocker(l)});Promise.all(m).then(function(){o(),f.forEach(function(l){var e=r.sourceBuffer[l];(!e||!e.updating)&&p.shiftAndExecuteNext(l)})})},E.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},E.addBufferListener=function(o,f,r){var p=this.sourceBuffer[o];if(!!p){var m=r.bind(this,o);this.listeners[o].push({event:f,listener:m}),p.addEventListener(f,m)}},E.removeBufferListeners=function(o){var f=this.sourceBuffer[o];!f||this.listeners[o].forEach(function(r){f.removeEventListener(r.event,r.listener)})},L}()},"./src/controller/buffer-operation-queue.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return P});var B=S("./src/utils/logger.ts"),P=function(){function O(_){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=_}var w=O.prototype;return w.append=function(R,C){var T=this.queues[C];T.push(R),T.length===1&&this.buffers[C]&&this.executeNext(C)},w.insertAbort=function(R,C){var T=this.queues[C];T.unshift(R),this.executeNext(C)},w.appendBlocker=function(R){var C,T=new Promise(function(c){C=c}),D={execute:C,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(D,R),T},w.executeNext=function(R){var C=this.buffers,T=this.queues,D=C[R],c=T[R];if(c.length){var A=c[0];try{A.execute()}catch(L){B.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),A.onError(L),(!D||!D.updating)&&(c.shift(),this.executeNext(R))}}},w.shiftAndExecuteNext=function(R){this.queues[R].shift(),this.executeNext(R)},w.current=function(R){return this.queues[R][0]},O}()},"./src/controller/cap-level-controller.ts":function(K,M,S){S.r(M);var B=S("./src/events.ts");function P(_,R){for(var C=0;C<R.length;C++){var T=R[C];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(_,T.key,T)}}function O(_,R,C){return R&&P(_.prototype,R),C&&P(_,C),_}var w=function(){function _(C){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=C,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var R=_.prototype;return R.setStreamController=function(T){this.streamController=T},R.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},R.registerListeners=function(){var T=this.hls;T.on(B.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),T.on(B.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),T.on(B.Events.MANIFEST_PARSED,this.onManifestParsed,this),T.on(B.Events.BUFFER_CODECS,this.onBufferCodecs,this),T.on(B.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},R.unregisterListener=function(){var T=this.hls;T.off(B.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),T.off(B.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),T.off(B.Events.MANIFEST_PARSED,this.onManifestParsed,this),T.off(B.Events.BUFFER_CODECS,this.onBufferCodecs,this),T.off(B.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},R.onFpsDropLevelCapping=function(T,D){_.isLevelAllowed(D.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(D.droppedLevel)},R.onMediaAttaching=function(T,D){this.media=D.media instanceof HTMLVideoElement?D.media:null},R.onManifestParsed=function(T,D){var c=this.hls;this.restrictedLevels=[],this.firstLevel=D.firstLevel,c.config.capLevelToPlayerSize&&D.video&&this.startCapping()},R.onBufferCodecs=function(T,D){var c=this.hls;c.config.capLevelToPlayerSize&&D.video&&this.startCapping()},R.onMediaDetaching=function(){this.stopCapping()},R.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var T=this.hls.levels;if(T.length){var D=this.hls;D.autoLevelCapping=this.getMaxLevel(T.length-1),D.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=D.autoLevelCapping}}},R.getMaxLevel=function(T){var D=this,c=this.hls.levels;if(!c.length)return-1;var A=c.filter(function(L,E){return _.isLevelAllowed(E,D.restrictedLevels)&&E<=T});return this.clientRect=null,_.getMaxLevelByMediaSize(A,this.mediaWidth,this.mediaHeight)},R.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},R.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},R.getDimensions=function(){if(this.clientRect)return this.clientRect;var T=this.media,D={width:0,height:0};if(T){var c=T.getBoundingClientRect();D.width=c.width,D.height=c.height,!D.width&&!D.height&&(D.width=c.right-c.left||T.width||0,D.height=c.bottom-c.top||T.height||0)}return this.clientRect=D,D},_.isLevelAllowed=function(T,D){return D===void 0&&(D=[]),D.indexOf(T)===-1},_.getMaxLevelByMediaSize=function(T,D,c){if(!T||!T.length)return-1;for(var A=function(f,r){return r?f.width!==r.width||f.height!==r.height:!0},L=T.length-1,E=0;E<T.length;E+=1){var g=T[E];if((g.width>=D||g.height>=c)&&A(g,T[E+1])){L=E;break}}return L},O(_,[{key:"mediaWidth",get:function(){return this.getDimensions().width*_.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*_.contentScaleFactor}}],[{key:"contentScaleFactor",get:function(){var T=1;try{T=self.devicePixelRatio}catch{}return T}}]),_}();M.default=w},"./src/controller/cmcd-controller.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return A});var B=S("./src/events.ts"),P=S("./src/types/cmcd.ts"),O=S("./src/utils/buffer-helper.ts"),w=S("./src/utils/logger.ts");function _(L,E){for(var g=0;g<E.length;g++){var o=E[g];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(L,o.key,o)}}function R(L,E,g){return E&&_(L.prototype,E),g&&_(L,g),L}function C(L,E){var g=typeof Symbol!="undefined"&&L[Symbol.iterator]||L["@@iterator"];if(g)return(g=g.call(L)).next.bind(g);if(Array.isArray(L)||(g=T(L))||E&&L&&typeof L.length=="number"){g&&(L=g);var o=0;return function(){return o>=L.length?{done:!0}:{done:!1,value:L[o++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function T(L,E){if(!!L){if(typeof L=="string")return D(L,E);var g=Object.prototype.toString.call(L).slice(8,-1);if(g==="Object"&&L.constructor&&(g=L.constructor.name),g==="Map"||g==="Set")return Array.from(L);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return D(L,E)}}function D(L,E){(E==null||E>L.length)&&(E=L.length);for(var g=0,o=new Array(E);g<E;g++)o[g]=L[g];return o}function c(){return c=Object.assign||function(L){for(var E=1;E<arguments.length;E++){var g=arguments[E];for(var o in g)Object.prototype.hasOwnProperty.call(g,o)&&(L[o]=g[o])}return L},c.apply(this,arguments)}var A=function(){function L(g){var o=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){o.initialized&&(o.starved=!0),o.buffering=!0},this.onPlaying=function(){o.initialized||(o.initialized=!0),o.buffering=!1},this.applyPlaylistData=function(p){try{o.apply(p,{ot:P.CMCDObjectType.MANIFEST,su:!o.initialized})}catch(m){w.logger.warn("Could not generate manifest CMCD data.",m)}},this.applyFragmentData=function(p){try{var m=p.frag,l=o.hls.levels[m.level],e=o.getObjectType(m),a={d:m.duration*1e3,ot:e};(e===P.CMCDObjectType.VIDEO||e===P.CMCDObjectType.AUDIO||e==P.CMCDObjectType.MUXED)&&(a.br=l.bitrate/1e3,a.tb=o.getTopBandwidth(e)/1e3,a.bl=o.getBufferLength(e)),o.apply(p,a)}catch(h){w.logger.warn("Could not generate segment CMCD data.",h)}},this.hls=g;var f=this.config=g.config,r=f.cmcd;r!=null&&(f.pLoader=this.createPlaylistLoader(),f.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||L.uuid(),this.cid=r.contentId,this.useHeaders=r.useHeaders===!0,this.registerListeners())}var E=L.prototype;return E.registerListeners=function(){var o=this.hls;o.on(B.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.on(B.Events.MEDIA_DETACHED,this.onMediaDetached,this),o.on(B.Events.BUFFER_CREATED,this.onBufferCreated,this)},E.unregisterListeners=function(){var o=this.hls;o.off(B.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.off(B.Events.MEDIA_DETACHED,this.onMediaDetached,this),o.off(B.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},E.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},E.onMediaAttached=function(o,f){this.media=f.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},E.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},E.onBufferCreated=function(o,f){var r,p;this.audioBuffer=(r=f.tracks.audio)===null||r===void 0?void 0:r.buffer,this.videoBuffer=(p=f.tracks.video)===null||p===void 0?void 0:p.buffer},E.createData=function(){var o;return{v:P.CMCDVersion,sf:P.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(o=this.media)===null||o===void 0?void 0:o.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},E.apply=function(o,f){f===void 0&&(f={}),c(f,this.createData());var r=f.ot===P.CMCDObjectType.INIT||f.ot===P.CMCDObjectType.VIDEO||f.ot===P.CMCDObjectType.MUXED;if(this.starved&&r&&(f.bs=!0,f.su=!0,this.starved=!1),f.su==null&&(f.su=this.buffering),this.useHeaders){var p=L.toHeaders(f);if(!Object.keys(p).length)return;o.headers||(o.headers={}),c(o.headers,p)}else{var m=L.toQuery(f);if(!m)return;o.url=L.appendQueryToUri(o.url,m)}},E.getObjectType=function(o){var f=o.type;if(f==="subtitle")return P.CMCDObjectType.TIMED_TEXT;if(o.sn==="initSegment")return P.CMCDObjectType.INIT;if(f==="audio")return P.CMCDObjectType.AUDIO;if(f==="main")return this.hls.audioTracks.length?P.CMCDObjectType.VIDEO:P.CMCDObjectType.MUXED},E.getTopBandwidth=function(o){var f=0,r,p=this.hls;if(o===P.CMCDObjectType.AUDIO)r=p.audioTracks;else{var m=p.maxAutoLevel,l=m>-1?m+1:p.levels.length;r=p.levels.slice(0,l)}for(var e=C(r),a;!(a=e()).done;){var h=a.value;h.bitrate>f&&(f=h.bitrate)}return f>0?f:NaN},E.getBufferLength=function(o){var f=this.hls.media,r=o===P.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!r||!f)return NaN;var p=O.BufferHelper.bufferInfo(r,f.currentTime,this.config.maxBufferHole);return p.len*1e3},E.createPlaylistLoader=function(){var o=this.config.pLoader,f=this.applyPlaylistData,r=o||this.config.loader;return function(){function p(l){this.loader=void 0,this.loader=new r(l)}var m=p.prototype;return m.destroy=function(){this.loader.destroy()},m.abort=function(){this.loader.abort()},m.load=function(e,a,h){f(e),this.loader.load(e,a,h)},R(p,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),p}()},E.createFragmentLoader=function(){var o=this.config.fLoader,f=this.applyFragmentData,r=o||this.config.loader;return function(){function p(l){this.loader=void 0,this.loader=new r(l)}var m=p.prototype;return m.destroy=function(){this.loader.destroy()},m.abort=function(){this.loader.abort()},m.load=function(e,a,h){f(e),this.loader.load(e,a,h)},R(p,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),p}()},L.uuid=function(){var o=URL.createObjectURL(new Blob),f=o.toString();return URL.revokeObjectURL(o),f.substr(f.lastIndexOf("/")+1)},L.serialize=function(o){for(var f=[],r=function(F){return!Number.isNaN(F)&&F!=null&&F!==""&&F!==!1},p=function(F){return Math.round(F)},m=function(F){return p(F/100)*100},l=function(F){return encodeURIComponent(F)},e={br:p,d:p,bl:m,dl:m,mtp:m,nor:l,rtp:m,tb:p},a=Object.keys(o||{}).sort(),h=C(a),u;!(u=h()).done;){var t=u.value,n=o[t];if(!!r(n)&&!(t==="v"&&n===1)&&!(t=="pr"&&n===1)){var v=e[t];v&&(n=v(n));var y=typeof n,x=void 0;t==="ot"||t==="sf"||t==="st"?x=t+"="+n:y==="boolean"?x=t:y==="number"?x=t+"="+n:x=t+"="+JSON.stringify(n),f.push(x)}}return f.join(",")},L.toHeaders=function(o){for(var f=Object.keys(o),r={},p=["Object","Request","Session","Status"],m=[{},{},{},{}],l={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},e=0,a=f;e<a.length;e++){var h=a[e],u=l[h]!=null?l[h]:1;m[u][h]=o[h]}for(var t=0;t<m.length;t++){var n=L.serialize(m[t]);n&&(r["CMCD-"+p[t]]=n)}return r},L.toQuery=function(o){return"CMCD="+encodeURIComponent(L.serialize(o))},L.appendQueryToUri=function(o,f){if(!f)return o;var r=o.includes("?")?"&":"?";return""+o+r+f},L}()},"./src/controller/eme-controller.ts":function(K,M,S){S.r(M);var B=S("./src/events.ts"),P=S("./src/errors.ts"),O=S("./src/utils/logger.ts"),w=S("./src/utils/mediakeys-helper.ts");function _(A,L){for(var E=0;E<L.length;E++){var g=L[E];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(A,g.key,g)}}function R(A,L,E){return L&&_(A.prototype,L),E&&_(A,E),A}var C=3,T=function(L,E,g){var o={audioCapabilities:[],videoCapabilities:[]};return L.forEach(function(f){o.audioCapabilities.push({contentType:'audio/mp4; codecs="'+f+'"',robustness:g.audioRobustness||""})}),E.forEach(function(f){o.videoCapabilities.push({contentType:'video/mp4; codecs="'+f+'"',robustness:g.videoRobustness||""})}),[o]},D=function(L,E,g,o){switch(L){case w.KeySystems.WIDEVINE:return T(E,g,o);default:throw new Error("Unknown key-system: "+L)}},c=function(){function A(E){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=E,this._config=E.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var L=A.prototype;return L.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},L._registerListeners=function(){this.hls.on(B.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(B.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(B.Events.MANIFEST_PARSED,this.onManifestParsed,this)},L._unregisterListeners=function(){this.hls.off(B.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(B.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(B.Events.MANIFEST_PARSED,this.onManifestParsed,this)},L.getLicenseServerUrl=function(g){switch(g){case w.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+g+'"')},L._attemptKeySystemAccess=function(g,o,f){var r=this,p=D(g,o,f,this._drmSystemOptions);O.logger.log("Requesting encrypted media key-system access");var m=this.requestMediaKeySystemAccess(g,p);this.mediaKeysPromise=m.then(function(l){return r._onMediaKeySystemAccessObtained(g,l)}),m.catch(function(l){O.logger.error('Failed to obtain key-system "'+g+'" access:',l)})},L._onMediaKeySystemAccessObtained=function(g,o){var f=this;O.logger.log('Access for key-system "'+g+'" obtained');var r={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:o,mediaKeySystemDomain:g};this._mediaKeysList.push(r);var p=Promise.resolve().then(function(){return o.createMediaKeys()}).then(function(m){return r.mediaKeys=m,O.logger.log('Media-keys created for key-system "'+g+'"'),f._onMediaKeysCreated(),m});return p.catch(function(m){O.logger.error("Failed to create media-keys:",m)}),p},L._onMediaKeysCreated=function(){var g=this;this._mediaKeysList.forEach(function(o){o.mediaKeysSession||(o.mediaKeysSession=o.mediaKeys.createSession(),g._onNewMediaKeySession(o.mediaKeysSession))})},L._onNewMediaKeySession=function(g){var o=this;O.logger.log("New key-system session "+g.sessionId),g.addEventListener("message",function(f){o._onKeySessionMessage(g,f.message)},!1)},L._onKeySessionMessage=function(g,o){O.logger.log("Got EME message event, creating license request"),this._requestLicense(o,function(f){O.logger.log("Received license data (length: "+(f&&f.byteLength)+"), updating key-session"),g.update(f)})},L.onMediaEncrypted=function(g){var o=this;if(O.logger.log('Media is encrypted using "'+g.initDataType+'" init data type'),!this.mediaKeysPromise){O.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(B.Events.ERROR,{type:P.ErrorTypes.KEY_SYSTEM_ERROR,details:P.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var f=function(p){!o._media||(o._attemptSetMediaKeys(p),o._generateRequestWithPreferredKeySession(g.initDataType,g.initData))};this.mediaKeysPromise.then(f).catch(f)},L._attemptSetMediaKeys=function(g){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var o=this._mediaKeysList[0];if(!o||!o.mediaKeys){O.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(B.Events.ERROR,{type:P.ErrorTypes.KEY_SYSTEM_ERROR,details:P.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}O.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(o.mediaKeys),this._hasSetMediaKeys=!0}},L._generateRequestWithPreferredKeySession=function(g,o){var f=this,r=this._mediaKeysList[0];if(!r){O.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(B.Events.ERROR,{type:P.ErrorTypes.KEY_SYSTEM_ERROR,details:P.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(r.mediaKeysSessionInitialized){O.logger.warn("Key-Session already initialized but requested again");return}var p=r.mediaKeysSession;if(!p){O.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(B.Events.ERROR,{type:P.ErrorTypes.KEY_SYSTEM_ERROR,details:P.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!o){O.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(B.Events.ERROR,{type:P.ErrorTypes.KEY_SYSTEM_ERROR,details:P.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}O.logger.log('Generating key-session request for "'+g+'" init data type'),r.mediaKeysSessionInitialized=!0,p.generateRequest(g,o).then(function(){O.logger.debug("Key-session generation succeeded")}).catch(function(m){O.logger.error("Error generating key-session request:",m),f.hls.trigger(B.Events.ERROR,{type:P.ErrorTypes.KEY_SYSTEM_ERROR,details:P.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},L._createLicenseXhr=function(g,o,f){var r=new XMLHttpRequest;r.responseType="arraybuffer",r.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,r,g,o,f);var p=this._licenseXhrSetup;if(p)try{p.call(this.hls,r,g),p=void 0}catch(m){O.logger.error(m)}try{r.readyState||r.open("POST",g,!0),p&&p.call(this.hls,r,g)}catch(m){throw new Error("issue setting up KeySystem license XHR "+m)}return r},L._onLicenseRequestReadyStageChange=function(g,o,f,r){switch(g.readyState){case 4:if(g.status===200){this._requestLicenseFailureCount=0,O.logger.log("License request succeeded");var p=g.response,m=this._licenseResponseCallback;if(m)try{p=m.call(this.hls,g,o)}catch(e){O.logger.error(e)}r(p)}else{if(O.logger.error("License Request XHR failed ("+o+"). Status: "+g.status+" ("+g.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>C){this.hls.trigger(B.Events.ERROR,{type:P.ErrorTypes.KEY_SYSTEM_ERROR,details:P.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var l=C-this._requestLicenseFailureCount+1;O.logger.warn("Retrying license request, "+l+" attempts left"),this._requestLicense(f,r)}break}},L._generateLicenseRequestChallenge=function(g,o){switch(g.mediaKeySystemDomain){case w.KeySystems.WIDEVINE:return o}throw new Error("unsupported key-system: "+g.mediaKeySystemDomain)},L._requestLicense=function(g,o){O.logger.log("Requesting content license for key-system");var f=this._mediaKeysList[0];if(!f){O.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(B.Events.ERROR,{type:P.ErrorTypes.KEY_SYSTEM_ERROR,details:P.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var r=this.getLicenseServerUrl(f.mediaKeySystemDomain),p=this._createLicenseXhr(r,g,o);O.logger.log("Sending license request to URL: "+r);var m=this._generateLicenseRequestChallenge(f,g);p.send(m)}catch(l){O.logger.error("Failure requesting DRM license: "+l),this.hls.trigger(B.Events.ERROR,{type:P.ErrorTypes.KEY_SYSTEM_ERROR,details:P.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},L.onMediaAttached=function(g,o){if(!!this._emeEnabled){var f=o.media;this._media=f,f.addEventListener("encrypted",this._onMediaEncrypted)}},L.onMediaDetached=function(){var g=this._media,o=this._mediaKeysList;!g||(g.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(o.map(function(f){if(f.mediaKeysSession)return f.mediaKeysSession.close().catch(function(){})})).then(function(){return g.setMediaKeys(null)}).catch(function(){}))},L.onManifestParsed=function(g,o){if(!!this._emeEnabled){var f=o.levels.map(function(p){return p.audioCodec}).filter(function(p){return!!p}),r=o.levels.map(function(p){return p.videoCodec}).filter(function(p){return!!p});this._attemptKeySystemAccess(w.KeySystems.WIDEVINE,f,r)}},R(A,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),A}();M.default=c},"./src/controller/fps-controller.ts":function(K,M,S){S.r(M);var B=S("./src/events.ts"),P=S("./src/utils/logger.ts"),O=function(){function w(R){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=R,this.registerListeners()}var _=w.prototype;return _.setStreamController=function(C){this.streamController=C},_.registerListeners=function(){this.hls.on(B.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},_.unregisterListeners=function(){this.hls.off(B.Events.MEDIA_ATTACHING,this.onMediaAttaching)},_.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},_.onMediaAttaching=function(C,T){var D=this.hls.config;if(D.capLevelOnFPSDrop){var c=T.media instanceof self.HTMLVideoElement?T.media:null;this.media=c,c&&typeof c.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),D.fpsDroppedMonitoringPeriod)}},_.checkFPS=function(C,T,D){var c=performance.now();if(T){if(this.lastTime){var A=c-this.lastTime,L=D-this.lastDroppedFrames,E=T-this.lastDecodedFrames,g=1e3*L/A,o=this.hls;if(o.trigger(B.Events.FPS_DROP,{currentDropped:L,currentDecoded:E,totalDroppedFrames:D}),g>0&&L>o.config.fpsDroppedMonitoringThreshold*E){var f=o.currentLevel;P.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+f),f>0&&(o.autoLevelCapping===-1||o.autoLevelCapping>=f)&&(f=f-1,o.trigger(B.Events.FPS_DROP_LEVEL_CAPPING,{level:f,droppedLevel:o.currentLevel}),o.autoLevelCapping=f,this.streamController.nextLevelSwitch())}}this.lastTime=c,this.lastDroppedFrames=D,this.lastDecodedFrames=T}},_.checkFPSInterval=function(){var C=this.media;if(C)if(this.isVideoPlaybackQualityAvailable){var T=C.getVideoPlaybackQuality();this.checkFPS(C,T.totalVideoFrames,T.droppedVideoFrames)}else this.checkFPS(C,C.webkitDecodedFrameCount,C.webkitDroppedFrameCount)},w}();M.default=O},"./src/controller/fragment-finders.ts":function(K,M,S){S.r(M),S.d(M,"findFragmentByPDT",function(){return O}),S.d(M,"findFragmentByPTS",function(){return w}),S.d(M,"fragmentWithinToleranceTest",function(){return _}),S.d(M,"pdtWithinToleranceTest",function(){return R}),S.d(M,"findFragWithCC",function(){return C});var B=S("./src/polyfills/number.ts"),P=S("./src/utils/binary-search.ts");function O(T,D,c){if(D===null||!Array.isArray(T)||!T.length||!Object(B.isFiniteNumber)(D))return null;var A=T[0].programDateTime;if(D<(A||0))return null;var L=T[T.length-1].endProgramDateTime;if(D>=(L||0))return null;c=c||0;for(var E=0;E<T.length;++E){var g=T[E];if(R(D,c,g))return g}return null}function w(T,D,c,A){c===void 0&&(c=0),A===void 0&&(A=0);var L=null;if(T?L=D[T.sn-D[0].sn+1]||null:c===0&&D[0].start===0&&(L=D[0]),L&&_(c,A,L)===0)return L;var E=P.default.search(D,_.bind(null,c,A));return E||L}function _(T,D,c){T===void 0&&(T=0),D===void 0&&(D=0);var A=Math.min(D,c.duration+(c.deltaPTS?c.deltaPTS:0));return c.start+c.duration-A<=T?1:c.start-A>T&&c.start?-1:0}function R(T,D,c){var A=Math.min(D,c.duration+(c.deltaPTS?c.deltaPTS:0))*1e3,L=c.endProgramDateTime||0;return L-A>T}function C(T,D){return P.default.search(T,function(c){return c.cc<D?1:c.cc>D?-1:0})}},"./src/controller/fragment-tracker.ts":function(K,M,S){S.r(M),S.d(M,"FragmentState",function(){return O}),S.d(M,"FragmentTracker",function(){return w});var B=S("./src/events.ts"),P=S("./src/types/loader.ts"),O;(function(C){C.NOT_LOADED="NOT_LOADED",C.BACKTRACKED="BACKTRACKED",C.APPENDING="APPENDING",C.PARTIAL="PARTIAL",C.OK="OK"})(O||(O={}));var w=function(){function C(D){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=D,this._registerListeners()}var T=C.prototype;return T._registerListeners=function(){var c=this.hls;c.on(B.Events.BUFFER_APPENDED,this.onBufferAppended,this),c.on(B.Events.FRAG_BUFFERED,this.onFragBuffered,this),c.on(B.Events.FRAG_LOADED,this.onFragLoaded,this)},T._unregisterListeners=function(){var c=this.hls;c.off(B.Events.BUFFER_APPENDED,this.onBufferAppended,this),c.off(B.Events.FRAG_BUFFERED,this.onFragBuffered,this),c.off(B.Events.FRAG_LOADED,this.onFragLoaded,this)},T.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},T.getAppendedFrag=function(c,A){if(A===P.PlaylistLevelType.MAIN){var L=this.activeFragment,E=this.activeParts;if(!L)return null;if(E)for(var g=E.length;g--;){var o=E[g],f=o?o.end:L.appendedPTS;if(o.start<=c&&f!==void 0&&c<=f)return g>9&&(this.activeParts=E.slice(g-9)),o}else if(L.start<=c&&L.appendedPTS!==void 0&&c<=L.appendedPTS)return L}return this.getBufferedFrag(c,A)},T.getBufferedFrag=function(c,A){for(var L=this.fragments,E=Object.keys(L),g=E.length;g--;){var o=L[E[g]];if((o==null?void 0:o.body.type)===A&&o.buffered){var f=o.body;if(f.start<=c&&c<=f.end)return f}}return null},T.detectEvictedFragments=function(c,A,L){var E=this;Object.keys(this.fragments).forEach(function(g){var o=E.fragments[g];if(!!o){if(!o.buffered){o.body.type===L&&E.removeFragment(o.body);return}var f=o.range[c];!f||f.time.some(function(r){var p=!E.isTimeBuffered(r.startPTS,r.endPTS,A);return p&&E.removeFragment(o.body),p})}})},T.detectPartialFragments=function(c){var A=this,L=this.timeRanges,E=c.frag,g=c.part;if(!(!L||E.sn==="initSegment")){var o=R(E),f=this.fragments[o];!f||(Object.keys(L).forEach(function(r){var p=E.elementaryStreams[r];if(!!p){var m=L[r],l=g!==null||p.partial===!0;f.range[r]=A.getBufferedTimes(E,g,l,m)}}),f.backtrack=f.loaded=null,Object.keys(f.range).length?f.buffered=!0:this.removeFragment(f.body))}},T.fragBuffered=function(c){var A=R(c),L=this.fragments[A];L&&(L.backtrack=L.loaded=null,L.buffered=!0)},T.getBufferedTimes=function(c,A,L,E){for(var g={time:[],partial:L},o=A?A.start:c.start,f=A?A.end:c.end,r=c.minEndPTS||f,p=c.maxStartPTS||o,m=0;m<E.length;m++){var l=E.start(m)-this.bufferPadding,e=E.end(m)+this.bufferPadding;if(p>=l&&r<=e){g.time.push({startPTS:Math.max(o,E.start(m)),endPTS:Math.min(f,E.end(m))});break}else if(o<e&&f>l)g.partial=!0,g.time.push({startPTS:Math.max(o,E.start(m)),endPTS:Math.min(f,E.end(m))});else if(f<=l)break}return g},T.getPartialFragment=function(c){var A=null,L,E,g,o=0,f=this.bufferPadding,r=this.fragments;return Object.keys(r).forEach(function(p){var m=r[p];!m||_(m)&&(E=m.body.start-f,g=m.body.end+f,c>=E&&c<=g&&(L=Math.min(c-E,g-c),o<=L&&(A=m.body,o=L)))}),A},T.getState=function(c){var A=R(c),L=this.fragments[A];return L?L.buffered?_(L)?O.PARTIAL:O.OK:L.backtrack?O.BACKTRACKED:O.APPENDING:O.NOT_LOADED},T.backtrack=function(c,A){var L=R(c),E=this.fragments[L];if(!E||E.backtrack)return null;var g=E.backtrack=A||E.loaded;return E.loaded=null,g},T.getBacktrackData=function(c){var A=R(c),L=this.fragments[A];if(L){var E,g=L.backtrack;if(g!=null&&(E=g.payload)!==null&&E!==void 0&&E.byteLength)return g;this.removeFragment(c)}return null},T.isTimeBuffered=function(c,A,L){for(var E,g,o=0;o<L.length;o++){if(E=L.start(o)-this.bufferPadding,g=L.end(o)+this.bufferPadding,c>=E&&A<=g)return!0;if(A<=E)return!1}return!1},T.onFragLoaded=function(c,A){var L=A.frag,E=A.part;if(!(L.sn==="initSegment"||L.bitrateTest||E)){var g=R(L);this.fragments[g]={body:L,loaded:A,backtrack:null,buffered:!1,range:Object.create(null)}}},T.onBufferAppended=function(c,A){var L=this,E=A.frag,g=A.part,o=A.timeRanges;if(E.type===P.PlaylistLevelType.MAIN)if(this.activeFragment=E,g){var f=this.activeParts;f||(this.activeParts=f=[]),f.push(g)}else this.activeParts=null;this.timeRanges=o,Object.keys(o).forEach(function(r){var p=o[r];if(L.detectEvictedFragments(r,p),!g)for(var m=0;m<p.length;m++)E.appendedPTS=Math.max(p.end(m),E.appendedPTS||0)})},T.onFragBuffered=function(c,A){this.detectPartialFragments(A)},T.hasFragment=function(c){var A=R(c);return!!this.fragments[A]},T.removeFragmentsInRange=function(c,A,L){var E=this;Object.keys(this.fragments).forEach(function(g){var o=E.fragments[g];if(!!o&&o.buffered){var f=o.body;f.type===L&&f.start<A&&f.end>c&&E.removeFragment(f)}})},T.removeFragment=function(c){var A=R(c);c.stats.loaded=0,c.clearElementaryStreamInfo(),delete this.fragments[A]},T.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},C}();function _(C){var T,D;return C.buffered&&(((T=C.range.video)===null||T===void 0?void 0:T.partial)||((D=C.range.audio)===null||D===void 0?void 0:D.partial))}function R(C){return C.type+"_"+C.level+"_"+C.urlId+"_"+C.sn}},"./src/controller/gap-controller.ts":function(K,M,S){S.r(M),S.d(M,"STALL_MINIMUM_DURATION_MS",function(){return _}),S.d(M,"MAX_START_GAP_JUMP",function(){return R}),S.d(M,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return C}),S.d(M,"SKIP_BUFFER_RANGE_START",function(){return T}),S.d(M,"default",function(){return D});var B=S("./src/utils/buffer-helper.ts"),P=S("./src/errors.ts"),O=S("./src/events.ts"),w=S("./src/utils/logger.ts"),_=250,R=2,C=.1,T=.05,D=function(){function c(L,E,g,o){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=L,this.media=E,this.fragmentTracker=g,this.hls=o}var A=c.prototype;return A.destroy=function(){this.hls=this.fragmentTracker=this.media=null},A.poll=function(E){var g=this.config,o=this.media,f=this.stalled,r=o.currentTime,p=o.seeking,m=this.seeking&&!p,l=!this.seeking&&p;if(this.seeking=p,r!==E){if(this.moved=!0,f!==null){if(this.stallReported){var e=self.performance.now()-f;w.logger.warn("playback not stuck anymore @"+r+", after "+Math.round(e)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((l||m)&&(this.stalled=null),!(o.paused||o.ended||o.playbackRate===0||!B.BufferHelper.getBuffered(o).length)){var a=B.BufferHelper.bufferInfo(o,r,0),h=a.len>0,u=a.nextStart||0;if(!(!h&&!u)){if(p){var t=a.len>R,n=!u||u-r>R&&!this.fragmentTracker.getPartialFragment(r);if(t||n)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var v,y=Math.max(u,a.start||0)-r,x=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,I=x==null||(v=x.details)===null||v===void 0?void 0:v.live,F=I?x.details.targetduration*2:R;if(y>0&&y<=F){this._trySkipBufferHole(null);return}}var U=self.performance.now();if(f===null){this.stalled=U;return}var k=U-f;!p&&k>=_&&this._reportStall(a.len);var $=B.BufferHelper.bufferInfo(o,r,g.maxBufferHole);this._tryFixBufferStall($,k)}}},A._tryFixBufferStall=function(E,g){var o=this.config,f=this.fragmentTracker,r=this.media,p=r.currentTime,m=f.getPartialFragment(p);if(m){var l=this._trySkipBufferHole(m);if(l)return}E.len>o.maxBufferHole&&g>o.highBufferWatchdogPeriod*1e3&&(w.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},A._reportStall=function(E){var g=this.hls,o=this.media,f=this.stallReported;f||(this.stallReported=!0,w.logger.warn("Playback stalling at @"+o.currentTime+" due to low buffer (buffer="+E+")"),g.trigger(O.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:E}))},A._trySkipBufferHole=function(E){for(var g=this.config,o=this.hls,f=this.media,r=f.currentTime,p=0,m=B.BufferHelper.getBuffered(f),l=0;l<m.length;l++){var e=m.start(l);if(r+g.maxBufferHole>=p&&r<e){var a=Math.max(e+T,f.currentTime+C);return w.logger.warn("skipping hole, adjusting currentTime from "+r+" to "+a),this.moved=!0,this.stalled=null,f.currentTime=a,E&&o.trigger(O.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+r+" to "+a,frag:E}),a}p=m.end(l)}return 0},A._tryNudgeBuffer=function(){var E=this.config,g=this.hls,o=this.media,f=o.currentTime,r=(this.nudgeRetry||0)+1;if(this.nudgeRetry=r,r<E.nudgeMaxRetry){var p=f+r*E.nudgeOffset;w.logger.warn("Nudging 'currentTime' from "+f+" to "+p),o.currentTime=p,g.trigger(O.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else w.logger.error("Playhead still not moving while enough data buffered @"+f+" after "+E.nudgeMaxRetry+" nudges"),g.trigger(O.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},c}()},"./src/controller/id3-track-controller.ts":function(K,M,S){S.r(M);var B=S("./src/events.ts"),P=S("./src/utils/texttrack-utils.ts"),O=S("./src/demux/id3.ts"),w=.25,_=function(){function R(T){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=T,this._registerListeners()}var C=R.prototype;return C.destroy=function(){this._unregisterListeners()},C._registerListeners=function(){var D=this.hls;D.on(B.Events.MEDIA_ATTACHED,this.onMediaAttached,this),D.on(B.Events.MEDIA_DETACHING,this.onMediaDetaching,this),D.on(B.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),D.on(B.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},C._unregisterListeners=function(){var D=this.hls;D.off(B.Events.MEDIA_ATTACHED,this.onMediaAttached,this),D.off(B.Events.MEDIA_DETACHING,this.onMediaDetaching,this),D.off(B.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),D.off(B.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},C.onMediaAttached=function(D,c){this.media=c.media},C.onMediaDetaching=function(){!this.id3Track||(Object(P.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},C.getID3Track=function(D){if(!!this.media){for(var c=0;c<D.length;c++){var A=D[c];if(A.kind==="metadata"&&A.label==="id3")return Object(P.sendAddTrackEvent)(A,this.media),A}return this.media.addTextTrack("metadata","id3")}},C.onFragParsingMetadata=function(D,c){if(!!this.media){var A=c.frag,L=c.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var E=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,g=0;g<L.length;g++){var o=O.getID3Frames(L[g].data);if(o){var f=L[g].pts,r=g<L.length-1?L[g+1].pts:A.end,p=r-f;p<=0&&(r=f+w);for(var m=0;m<o.length;m++){var l=o[m];if(!O.isTimeStampFrame(l)){var e=new E(f,r,"");e.value=l,this.id3Track.addCue(e)}}}}}},C.onBufferFlushing=function(D,c){var A=c.startOffset,L=c.endOffset,E=c.type;if(!E||E==="audio"){var g=this.id3Track;g&&Object(P.removeCuesInRange)(g,A,L)}},R}();M.default=_},"./src/controller/latency-controller.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return R});var B=S("./src/errors.ts"),P=S("./src/events.ts"),O=S("./src/utils/logger.ts");function w(C,T){for(var D=0;D<T.length;D++){var c=T[D];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(C,c.key,c)}}function _(C,T,D){return T&&w(C.prototype,T),D&&w(C,D),C}var R=function(){function C(D){var c=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return c.timeupdate()},this.hls=D,this.config=D.config,this.registerListeners()}var T=C.prototype;return T.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},T.registerListeners=function(){this.hls.on(P.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(P.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(P.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(P.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(P.Events.ERROR,this.onError,this)},T.unregisterListeners=function(){this.hls.off(P.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(P.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(P.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(P.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(P.Events.ERROR,this.onError)},T.onMediaAttached=function(c,A){this.media=A.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},T.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},T.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},T.onLevelUpdated=function(c,A){var L=A.details;this.levelDetails=L,L.advanced&&this.timeupdate(),!L.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},T.onError=function(c,A){A.details===B.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,O.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},T.timeupdate=function(){var c=this.media,A=this.levelDetails;if(!(!c||!A)){this.currentTime=c.currentTime;var L=this.computeLatency();if(L!==null){this._latency=L;var E=this.config,g=E.lowLatencyMode,o=E.maxLiveSyncPlaybackRate;if(!(!g||o===1)){var f=this.targetLatency;if(f!==null){var r=L-f,p=Math.min(this.maxLatency,f+A.targetduration),m=r<p;if(A.live&&m&&r>.05&&this.forwardBufferLength>1){var l=Math.min(2,Math.max(1,o)),e=Math.round(2/(1+Math.exp(-.75*r-this.edgeStalled))*20)/20;c.playbackRate=Math.min(l,Math.max(1,e))}else c.playbackRate!==1&&c.playbackRate!==0&&(c.playbackRate=1)}}}}},T.estimateLiveEdge=function(){var c=this.levelDetails;return c===null?null:c.edge+c.age},T.computeLatency=function(){var c=this.estimateLiveEdge();return c===null?null:c-this.currentTime},_(C,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var c=this.config,A=this.levelDetails;return c.liveMaxLatencyDuration!==void 0?c.liveMaxLatencyDuration:A?c.liveMaxLatencyDurationCount*A.targetduration:0}},{key:"targetLatency",get:function(){var c=this.levelDetails;if(c===null)return null;var A=c.holdBack,L=c.partHoldBack,E=c.targetduration,g=this.config,o=g.liveSyncDuration,f=g.liveSyncDurationCount,r=g.lowLatencyMode,p=this.hls.userConfig,m=r&&L||A;(p.liveSyncDuration||p.liveSyncDurationCount||m===0)&&(m=o!==void 0?o:f*E);var l=E,e=1;return m+Math.min(this.stallCount*e,l)}},{key:"liveSyncPosition",get:function(){var c=this.estimateLiveEdge(),A=this.targetLatency,L=this.levelDetails;if(c===null||A===null||L===null)return null;var E=L.edge,g=c-A-this.edgeStalled,o=E-L.totalduration,f=E-(this.config.lowLatencyMode&&L.partTarget||L.targetduration);return Math.min(Math.max(o,g),f)}},{key:"drift",get:function(){var c=this.levelDetails;return c===null?1:c.drift}},{key:"edgeStalled",get:function(){var c=this.levelDetails;if(c===null)return 0;var A=(this.config.lowLatencyMode&&c.partTarget||c.targetduration)*3;return Math.max(c.age-A,0)}},{key:"forwardBufferLength",get:function(){var c=this.media,A=this.levelDetails;if(!c||!A)return 0;var L=c.buffered.length;return L?c.buffered.end(L-1):A.edge-this.currentTime}}]),C}()},"./src/controller/level-controller.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return g});var B=S("./src/types/level.ts"),P=S("./src/events.ts"),O=S("./src/errors.ts"),w=S("./src/utils/codecs.ts"),_=S("./src/controller/level-helper.ts"),R=S("./src/controller/base-playlist-controller.ts"),C=S("./src/types/loader.ts");function T(){return T=Object.assign||function(o){for(var f=1;f<arguments.length;f++){var r=arguments[f];for(var p in r)Object.prototype.hasOwnProperty.call(r,p)&&(o[p]=r[p])}return o},T.apply(this,arguments)}function D(o,f){for(var r=0;r<f.length;r++){var p=f[r];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(o,p.key,p)}}function c(o,f,r){return f&&D(o.prototype,f),r&&D(o,r),o}function A(o,f){o.prototype=Object.create(f.prototype),o.prototype.constructor=o,L(o,f)}function L(o,f){return L=Object.setPrototypeOf||function(p,m){return p.__proto__=m,p},L(o,f)}var E=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),g=function(o){A(f,o);function f(p){var m;return m=o.call(this,p,"[level-controller]")||this,m._levels=[],m._firstLevel=-1,m._startLevel=void 0,m.currentLevelIndex=-1,m.manualLevelIndex=-1,m.onParsedComplete=void 0,m._registerListeners(),m}var r=f.prototype;return r._registerListeners=function(){var m=this.hls;m.on(P.Events.MANIFEST_LOADED,this.onManifestLoaded,this),m.on(P.Events.LEVEL_LOADED,this.onLevelLoaded,this),m.on(P.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),m.on(P.Events.FRAG_LOADED,this.onFragLoaded,this),m.on(P.Events.ERROR,this.onError,this)},r._unregisterListeners=function(){var m=this.hls;m.off(P.Events.MANIFEST_LOADED,this.onManifestLoaded,this),m.off(P.Events.LEVEL_LOADED,this.onLevelLoaded,this),m.off(P.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),m.off(P.Events.FRAG_LOADED,this.onFragLoaded,this),m.off(P.Events.ERROR,this.onError,this)},r.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,o.prototype.destroy.call(this)},r.startLoad=function(){var m=this._levels;m.forEach(function(l){l.loadError=0}),o.prototype.startLoad.call(this)},r.onManifestLoaded=function(m,l){var e=[],a=[],h=[],u,t={},n,v=!1,y=!1,x=!1;if(l.levels.forEach(function(k){var $=k.attrs;v=v||!!(k.width&&k.height),y=y||!!k.videoCodec,x=x||!!k.audioCodec,E&&k.audioCodec&&k.audioCodec.indexOf("mp4a.40.34")!==-1&&(k.audioCodec=void 0);var W=k.bitrate+"-"+k.attrs.RESOLUTION+"-"+k.attrs.CODECS;n=t[W],n?n.url.push(k.url):(n=new B.Level(k),t[W]=n,e.push(n)),$&&($.AUDIO&&Object(_.addGroupId)(n,"audio",$.AUDIO),$.SUBTITLES&&Object(_.addGroupId)(n,"text",$.SUBTITLES))}),(v||y)&&x&&(e=e.filter(function(k){var $=k.videoCodec,W=k.width,G=k.height;return!!$||!!(W&&G)})),e=e.filter(function(k){var $=k.audioCodec,W=k.videoCodec;return(!$||Object(w.isCodecSupportedInMp4)($,"audio"))&&(!W||Object(w.isCodecSupportedInMp4)(W,"video"))}),l.audioTracks&&(a=l.audioTracks.filter(function(k){return!k.audioCodec||Object(w.isCodecSupportedInMp4)(k.audioCodec,"audio")}),Object(_.assignTrackIdsByGroup)(a)),l.subtitles&&(h=l.subtitles,Object(_.assignTrackIdsByGroup)(h)),e.length>0){u=e[0].bitrate,e.sort(function(k,$){return k.bitrate-$.bitrate}),this._levels=e;for(var I=0;I<e.length;I++)if(e[I].bitrate===u){this._firstLevel=I,this.log("manifest loaded, "+e.length+" level(s) found, first bitrate: "+u);break}var F=x&&!y,U={levels:e,audioTracks:a,subtitleTracks:h,firstLevel:this._firstLevel,stats:l.stats,audio:x,video:y,altAudio:!F&&a.some(function(k){return!!k.url})};this.hls.trigger(P.Events.MANIFEST_PARSED,U),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(P.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:l.url,reason:"no level with compatible codecs found in manifest"})},r.onError=function(m,l){if(o.prototype.onError.call(this,m,l),!l.fatal){var e=l.context,a=this._levels[this.currentLevelIndex];if(e&&(e.type===C.PlaylistContextType.AUDIO_TRACK&&a.audioGroupIds&&e.groupId===a.audioGroupIds[a.urlId]||e.type===C.PlaylistContextType.SUBTITLE_TRACK&&a.textGroupIds&&e.groupId===a.textGroupIds[a.urlId])){this.redundantFailover(this.currentLevelIndex);return}var h=!1,u=!0,t;switch(l.details){case O.ErrorDetails.FRAG_LOAD_ERROR:case O.ErrorDetails.FRAG_LOAD_TIMEOUT:case O.ErrorDetails.KEY_LOAD_ERROR:case O.ErrorDetails.KEY_LOAD_TIMEOUT:if(l.frag){var n=this._levels[l.frag.level];n?(n.fragmentError++,n.fragmentError>this.hls.config.fragLoadingMaxRetry&&(t=l.frag.level)):t=l.frag.level}break;case O.ErrorDetails.LEVEL_LOAD_ERROR:case O.ErrorDetails.LEVEL_LOAD_TIMEOUT:e&&(e.deliveryDirectives&&(u=!1),t=e.level),h=!0;break;case O.ErrorDetails.REMUX_ALLOC_ERROR:t=l.level,h=!0;break}t!==void 0&&this.recoverLevel(l,t,h,u)}},r.recoverLevel=function(m,l,e,a){var h=m.details,u=this._levels[l];if(u.loadError++,e){var t=this.retryLoadingOrFail(m);if(t)m.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(a){var n=u.url.length;if(n>1&&u.loadError<n)m.levelRetry=!0,this.redundantFailover(l);else if(this.manualLevelIndex===-1){var v=l===0?this._levels.length-1:l-1;this.currentLevelIndex!==v&&this._levels[v].loadError===0&&(this.warn(h+": switch to "+v),m.levelRetry=!0,this.hls.nextAutoLevel=v)}}},r.redundantFailover=function(m){var l=this._levels[m],e=l.url.length;if(e>1){var a=(l.urlId+1)%e;this.warn("Switching to redundant URL-id "+a),this._levels.forEach(function(h){h.urlId=a}),this.level=m}},r.onFragLoaded=function(m,l){var e=l.frag;if(e!==void 0&&e.type===C.PlaylistLevelType.MAIN){var a=this._levels[e.level];a!==void 0&&(a.fragmentError=0,a.loadError=0)}},r.onLevelLoaded=function(m,l){var e,a=l.level,h=l.details,u=this._levels[a];if(!u){var t;this.warn("Invalid level index "+a),(t=l.deliveryDirectives)!==null&&t!==void 0&&t.skip&&(h.deltaUpdateFailed=!0);return}a===this.currentLevelIndex?(u.fragmentError===0&&(u.loadError=0,this.retryCount=0),this.playlistLoaded(a,l,u.details)):(e=l.deliveryDirectives)!==null&&e!==void 0&&e.skip&&(h.deltaUpdateFailed=!0)},r.onAudioTrackSwitched=function(m,l){var e=this.hls.levels[this.currentLevelIndex];if(!!e&&e.audioGroupIds){for(var a=-1,h=this.hls.audioTracks[l.id].groupId,u=0;u<e.audioGroupIds.length;u++)if(e.audioGroupIds[u]===h){a=u;break}a!==e.urlId&&(e.urlId=a,this.startLoad())}},r.loadPlaylist=function(m){var l=this.currentLevelIndex,e=this._levels[l];if(this.canLoad&&e&&e.url.length>0){var a=e.urlId,h=e.url[a];if(m)try{h=m.addDirectives(h)}catch(u){this.warn("Could not construct new URL with HLS Delivery Directives: "+u)}this.log("Attempt loading level index "+l+(m?" at sn "+m.msn+" part "+m.part:"")+" with URL-id "+a+" "+h),this.clearTimer(),this.hls.trigger(P.Events.LEVEL_LOADING,{url:h,level:l,id:a,deliveryDirectives:m||null})}},r.removeLevel=function(m,l){var e=function(u,t){return t!==l},a=this._levels.filter(function(h,u){return u!==m?!0:h.url.length>1&&l!==void 0?(h.url=h.url.filter(e),h.audioGroupIds&&(h.audioGroupIds=h.audioGroupIds.filter(e)),h.textGroupIds&&(h.textGroupIds=h.textGroupIds.filter(e)),h.urlId=0,!0):!1}).map(function(h,u){var t=h.details;return t!=null&&t.fragments&&t.fragments.forEach(function(n){n.level=u}),h});this._levels=a,this.hls.trigger(P.Events.LEVELS_UPDATED,{levels:a})},c(f,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(m){var l,e=this._levels;if(e.length!==0&&!(this.currentLevelIndex===m&&(l=e[m])!==null&&l!==void 0&&l.details)){if(m<0||m>=e.length){var a=m<0;if(this.hls.trigger(P.Events.ERROR,{type:O.ErrorTypes.OTHER_ERROR,details:O.ErrorDetails.LEVEL_SWITCH_ERROR,level:m,fatal:a,reason:"invalid level idx"}),a)return;m=Math.min(m,e.length-1)}this.clearTimer();var h=this.currentLevelIndex,u=e[h],t=e[m];this.log("switching to level "+m+" from "+h),this.currentLevelIndex=m;var n=T({},t,{level:m,maxBitrate:t.maxBitrate,uri:t.uri,urlId:t.urlId});delete n._urlId,this.hls.trigger(P.Events.LEVEL_SWITCHING,n);var v=t.details;if(!v||v.live){var y=this.switchParams(t.uri,u==null?void 0:u.details);this.loadPlaylist(y)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(m){this.manualLevelIndex=m,this._startLevel===void 0&&(this._startLevel=m),m!==-1&&(this.level=m)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(m){this._firstLevel=m}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var m=this.hls.config.startLevel;return m!==void 0?m:this._firstLevel}else return this._startLevel},set:function(m){this._startLevel=m}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(m){this.level=m,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=m)}}]),f}(R.default)},"./src/controller/level-helper.ts":function(K,M,S){S.r(M),S.d(M,"addGroupId",function(){return O}),S.d(M,"assignTrackIdsByGroup",function(){return w}),S.d(M,"updatePTS",function(){return _}),S.d(M,"updateFragPTSDTS",function(){return C}),S.d(M,"mergeDetails",function(){return T}),S.d(M,"mapPartIntersection",function(){return D}),S.d(M,"mapFragmentIntersection",function(){return c}),S.d(M,"adjustSliding",function(){return A}),S.d(M,"addSliding",function(){return L}),S.d(M,"computeReloadInterval",function(){return E}),S.d(M,"getFragmentWithSN",function(){return g}),S.d(M,"getPartWith",function(){return o});var B=S("./src/polyfills/number.ts"),P=S("./src/utils/logger.ts");function O(f,r,p){switch(r){case"audio":f.audioGroupIds||(f.audioGroupIds=[]),f.audioGroupIds.push(p);break;case"text":f.textGroupIds||(f.textGroupIds=[]),f.textGroupIds.push(p);break}}function w(f){var r={};f.forEach(function(p){var m=p.groupId||"";p.id=r[m]=r[m]||0,r[m]++})}function _(f,r,p){var m=f[r],l=f[p];R(m,l)}function R(f,r){var p=r.startPTS;if(Object(B.isFiniteNumber)(p)){var m=0,l;r.sn>f.sn?(m=p-f.start,l=f):(m=f.start-p,l=r),l.duration!==m&&(l.duration=m)}else if(r.sn>f.sn){var e=f.cc===r.cc;e&&f.minEndPTS?r.start=f.start+(f.minEndPTS-f.start):r.start=f.start+f.duration}else r.start=Math.max(f.start-r.duration,0)}function C(f,r,p,m,l,e){var a=m-p;a<=0&&(P.logger.warn("Fragment should have a positive duration",r),m=p+r.duration,e=l+r.duration);var h=p,u=m,t=r.startPTS,n=r.endPTS;if(Object(B.isFiniteNumber)(t)){var v=Math.abs(t-p);Object(B.isFiniteNumber)(r.deltaPTS)?r.deltaPTS=Math.max(v,r.deltaPTS):r.deltaPTS=v,h=Math.max(p,t),p=Math.min(p,t),l=Math.min(l,r.startDTS),u=Math.min(m,n),m=Math.max(m,n),e=Math.max(e,r.endDTS)}r.duration=m-p;var y=p-r.start;r.appendedPTS=m,r.start=r.startPTS=p,r.maxStartPTS=h,r.startDTS=l,r.endPTS=m,r.minEndPTS=u,r.endDTS=e;var x=r.sn;if(!f||x<f.startSN||x>f.endSN)return 0;var I,F=x-f.startSN,U=f.fragments;for(U[F]=r,I=F;I>0;I--)R(U[I],U[I-1]);for(I=F;I<U.length-1;I++)R(U[I],U[I+1]);return f.fragmentHint&&R(U[U.length-1],f.fragmentHint),f.PTSKnown=f.alignedSliding=!0,y}function T(f,r){for(var p=null,m=f.fragments,l=m.length-1;l>=0;l--){var e=m[l].initSegment;if(e){p=e;break}}f.fragmentHint&&delete f.fragmentHint.endPTS;var a=0,h;if(c(f,r,function(I,F){I.relurl&&(a=I.cc-F.cc),Object(B.isFiniteNumber)(I.startPTS)&&Object(B.isFiniteNumber)(I.endPTS)&&(F.start=F.startPTS=I.startPTS,F.startDTS=I.startDTS,F.appendedPTS=I.appendedPTS,F.maxStartPTS=I.maxStartPTS,F.endPTS=I.endPTS,F.endDTS=I.endDTS,F.minEndPTS=I.minEndPTS,F.duration=I.endPTS-I.startPTS,F.duration&&(h=F),r.PTSKnown=r.alignedSliding=!0),F.elementaryStreams=I.elementaryStreams,F.loader=I.loader,F.stats=I.stats,F.urlId=I.urlId,I.initSegment&&(F.initSegment=I.initSegment,p=I.initSegment)}),p){var u=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments;u.forEach(function(I){var F;(!I.initSegment||I.initSegment.relurl===((F=p)===null||F===void 0?void 0:F.relurl))&&(I.initSegment=p)})}if(r.skippedSegments&&(r.deltaUpdateFailed=r.fragments.some(function(I){return!I}),r.deltaUpdateFailed)){P.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var t=r.skippedSegments;t--;)r.fragments.shift();r.startSN=r.fragments[0].sn,r.startCC=r.fragments[0].cc}var n=r.fragments;if(a){P.logger.warn("discontinuity sliding from playlist, take drift into account");for(var v=0;v<n.length;v++)n[v].cc+=a}r.skippedSegments&&(r.startCC=r.fragments[0].cc),D(f.partList,r.partList,function(I,F){F.elementaryStreams=I.elementaryStreams,F.stats=I.stats}),h?C(r,h,h.startPTS,h.endPTS,h.startDTS,h.endDTS):A(f,r),n.length&&(r.totalduration=r.edge-n[0].start),r.driftStartTime=f.driftStartTime,r.driftStart=f.driftStart;var y=r.advancedDateTime;if(r.advanced&&y){var x=r.edge;r.driftStart||(r.driftStartTime=y,r.driftStart=x),r.driftEndTime=y,r.driftEnd=x}else r.driftEndTime=f.driftEndTime,r.driftEnd=f.driftEnd,r.advancedDateTime=f.advancedDateTime}function D(f,r,p){if(f&&r)for(var m=0,l=0,e=f.length;l<=e;l++){var a=f[l],h=r[l+m];a&&h&&a.index===h.index&&a.fragment.sn===h.fragment.sn?p(a,h):m--}}function c(f,r,p){for(var m=r.skippedSegments,l=Math.max(f.startSN,r.startSN)-r.startSN,e=(f.fragmentHint?1:0)+(m?r.endSN:Math.min(f.endSN,r.endSN))-r.startSN,a=r.startSN-f.startSN,h=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments,u=f.fragmentHint?f.fragments.concat(f.fragmentHint):f.fragments,t=l;t<=e;t++){var n=u[a+t],v=h[t];m&&!v&&t<m&&(v=r.fragments[t]=n),n&&v&&p(n,v)}}function A(f,r){var p=r.startSN+r.skippedSegments-f.startSN,m=f.fragments;p<0||p>=m.length||L(r,m[p].start)}function L(f,r){if(r){for(var p=f.fragments,m=f.skippedSegments;m<p.length;m++)p[m].start+=r;f.fragmentHint&&(f.fragmentHint.start+=r)}}function E(f,r){var p=1e3*f.levelTargetDuration,m=p/2,l=f.age,e=l>0&&l<p*3,a=r.loading.end-r.loading.start,h,u=f.availabilityDelay;if(f.updated===!1)if(e){var t=333*f.misses;h=Math.max(Math.min(m,a*2),t),f.availabilityDelay=(f.availabilityDelay||0)+h}else h=m;else e?(u=Math.min(u||p/2,l),f.availabilityDelay=u,h=u+p-l):h=p-a;return Math.round(h)}function g(f,r,p){if(!f||!f.details)return null;var m=f.details,l=m.fragments[r-m.startSN];return l||(l=m.fragmentHint,l&&l.sn===r)?l:r<m.startSN&&p&&p.sn===r?p:null}function o(f,r,p){if(!f||!f.details)return null;var m=f.details.partList;if(m)for(var l=m.length;l--;){var e=m[l];if(e.index===p&&e.fragment.sn===r)return e}return null}},"./src/controller/stream-controller.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return m});var B=S("./src/polyfills/number.ts"),P=S("./src/controller/base-stream-controller.ts"),O=S("./src/is-supported.ts"),w=S("./src/events.ts"),_=S("./src/utils/buffer-helper.ts"),R=S("./src/controller/fragment-tracker.ts"),C=S("./src/types/loader.ts"),T=S("./src/loader/fragment.ts"),D=S("./src/demux/transmuxer-interface.ts"),c=S("./src/types/transmuxer.ts"),A=S("./src/controller/gap-controller.ts"),L=S("./src/errors.ts"),E=S("./src/utils/logger.ts");function g(l,e){for(var a=0;a<e.length;a++){var h=e[a];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(l,h.key,h)}}function o(l,e,a){return e&&g(l.prototype,e),a&&g(l,a),l}function f(l,e){l.prototype=Object.create(e.prototype),l.prototype.constructor=l,r(l,e)}function r(l,e){return r=Object.setPrototypeOf||function(h,u){return h.__proto__=u,h},r(l,e)}var p=100,m=function(l){f(e,l);function e(h,u){var t;return t=l.call(this,h,u,"[stream-controller]")||this,t.audioCodecSwap=!1,t.gapController=null,t.level=-1,t._forceStartLoad=!1,t.altAudio=!1,t.audioOnly=!1,t.fragPlaying=null,t.onvplaying=null,t.onvseeked=null,t.fragLastKbps=0,t.stalled=!1,t.couldBacktrack=!1,t.audioCodecSwitch=!1,t.videoBuffer=null,t._registerListeners(),t}var a=e.prototype;return a._registerListeners=function(){var u=this.hls;u.on(w.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.on(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.on(w.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(w.Events.MANIFEST_PARSED,this.onManifestParsed,this),u.on(w.Events.LEVEL_LOADING,this.onLevelLoading,this),u.on(w.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.on(w.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),u.on(w.Events.ERROR,this.onError,this),u.on(w.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),u.on(w.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),u.on(w.Events.BUFFER_CREATED,this.onBufferCreated,this),u.on(w.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),u.on(w.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),u.on(w.Events.FRAG_BUFFERED,this.onFragBuffered,this)},a._unregisterListeners=function(){var u=this.hls;u.off(w.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.off(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.off(w.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.off(w.Events.MANIFEST_PARSED,this.onManifestParsed,this),u.off(w.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.off(w.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),u.off(w.Events.ERROR,this.onError,this),u.off(w.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),u.off(w.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),u.off(w.Events.BUFFER_CREATED,this.onBufferCreated,this),u.off(w.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),u.off(w.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),u.off(w.Events.FRAG_BUFFERED,this.onFragBuffered,this)},a.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},a.startLoad=function(u){if(this.levels){var t=this.lastCurrentTime,n=this.hls;if(this.stopLoad(),this.setInterval(p),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var v=n.startLevel;v===-1&&(n.config.testBandwidth?(v=0,this.bitrateTest=!0):v=n.nextAutoLevel),this.level=n.nextLoadLevel=v,this.loadedmetadata=!1}t>0&&u===-1&&(this.log("Override startPosition with lastCurrentTime @"+t.toFixed(3)),u=t),this.state=P.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=u,this.tick()}else this._forceStartLoad=!0,this.state=P.State.STOPPED},a.stopLoad=function(){this._forceStartLoad=!1,l.prototype.stopLoad.call(this)},a.doTick=function(){switch(this.state){case P.State.IDLE:this.doTickIdle();break;case P.State.WAITING_LEVEL:{var u,t=this.levels,n=this.level,v=t==null||(u=t[n])===null||u===void 0?void 0:u.details;if(v&&(!v.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(v))break;this.state=P.State.IDLE;break}break}case P.State.FRAG_LOADING_WAITING_RETRY:{var y,x=self.performance.now(),I=this.retryDate;(!I||x>=I||(y=this.media)!==null&&y!==void 0&&y.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=P.State.IDLE)}break}this.onTickEnd()},a.onTickEnd=function(){l.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},a.doTickIdle=function(){var u,t,n=this.hls,v=this.levelLastLoaded,y=this.levels,x=this.media,I=n.config,F=n.nextLoadLevel;if(!(v===null||!x&&(this.startFragRequested||!I.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!y||!y[F])){var U=y[F];this.level=n.nextLoadLevel=F;var k=U.details;if(!k||this.state===P.State.WAITING_LEVEL||k.live&&this.levelLastLoaded!==F){this.state=P.State.WAITING_LEVEL;return}var $=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:x,C.PlaylistLevelType.MAIN);if($!==null){var W=$.len,G=this.getMaxBufferLength(U.maxBitrate);if(!(W>=G)){if(this._streamEnded($,k)){var H={};this.altAudio&&(H.type="video"),this.hls.trigger(w.Events.BUFFER_EOS,H),this.state=P.State.ENDED;return}var z=$.end,V=this.getNextFragment(z,k);if(this.couldBacktrack&&!this.fragPrevious&&V&&V.sn!=="initSegment"){var Y=V.sn-k.startSN;Y>1&&(V=k.fragments[Y-1],this.fragmentTracker.removeFragment(V))}if(V&&this.fragmentTracker.getState(V)===R.FragmentState.OK&&this.nextLoadPosition>z){var Q=this.audioOnly&&!this.altAudio?T.ElementaryStreamTypes.AUDIO:T.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(x,Q,C.PlaylistLevelType.MAIN),V=this.getNextFragment(this.nextLoadPosition,k)}!V||(V.initSegment&&!V.initSegment.data&&!this.bitrateTest&&(V=V.initSegment),((u=V.decryptdata)===null||u===void 0?void 0:u.keyFormat)==="identity"&&!((t=V.decryptdata)!==null&&t!==void 0&&t.key)?this.loadKey(V,k):this.loadFragment(V,k,z))}}}},a.loadFragment=function(u,t,n){var v,y=this.fragmentTracker.getState(u);if(this.fragCurrent=u,y===R.FragmentState.BACKTRACKED){var x=this.fragmentTracker.getBacktrackData(u);if(x){this._handleFragmentLoadProgress(x),this._handleFragmentLoadComplete(x);return}else y=R.FragmentState.NOT_LOADED}y===R.FragmentState.NOT_LOADED||y===R.FragmentState.PARTIAL?u.sn==="initSegment"?this._loadInitSegment(u):this.bitrateTest?(u.bitrateTest=!0,this.log("Fragment "+u.sn+" of level "+u.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(u)):(this.startFragRequested=!0,l.prototype.loadFragment.call(this,u,t,n)):y===R.FragmentState.APPENDING?this.reduceMaxBufferLength(u.duration)&&this.fragmentTracker.removeFragment(u):((v=this.media)===null||v===void 0?void 0:v.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},a.getAppendedFrag=function(u){var t=this.fragmentTracker.getAppendedFrag(u,C.PlaylistLevelType.MAIN);return t&&"fragment"in t?t.fragment:t},a.getBufferedFrag=function(u){return this.fragmentTracker.getBufferedFrag(u,C.PlaylistLevelType.MAIN)},a.followingBufferedFrag=function(u){return u?this.getBufferedFrag(u.end+.5):null},a.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},a.nextLevelSwitch=function(){var u=this.levels,t=this.media;if(t!=null&&t.readyState){var n,v=this.getAppendedFrag(t.currentTime);if(v&&v.start>1&&this.flushMainBuffer(0,v.start-1),!t.paused&&u){var y=this.hls.nextLoadLevel,x=u[y],I=this.fragLastKbps;I&&this.fragCurrent?n=this.fragCurrent.duration*x.maxBitrate/(1e3*I)+1:n=0}else n=0;var F=this.getBufferedFrag(t.currentTime+n);if(F){var U=this.followingBufferedFrag(F);if(U){this.abortCurrentFrag();var k=U.maxStartPTS?U.maxStartPTS:U.start,$=U.duration,W=Math.max(F.end,k+Math.min(Math.max($-this.config.maxFragLookUpTolerance,$*.5),$*.75));this.flushMainBuffer(W,Number.POSITIVE_INFINITY)}}}},a.abortCurrentFrag=function(){var u=this.fragCurrent;this.fragCurrent=null,u!=null&&u.loader&&u.loader.abort(),this.state===P.State.KEY_LOADING&&(this.state=P.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},a.flushMainBuffer=function(u,t){l.prototype.flushMainBuffer.call(this,u,t,this.altAudio?"video":null)},a.onMediaAttached=function(u,t){l.prototype.onMediaAttached.call(this,u,t);var n=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),n.addEventListener("playing",this.onvplaying),n.addEventListener("seeked",this.onvseeked),this.gapController=new A.default(this.config,n,this.fragmentTracker,this.hls)},a.onMediaDetaching=function(){var u=this.media;u&&(u.removeEventListener("playing",this.onvplaying),u.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),l.prototype.onMediaDetaching.call(this)},a.onMediaPlaying=function(){this.tick()},a.onMediaSeeked=function(){var u=this.media,t=u?u.currentTime:null;Object(B.isFiniteNumber)(t)&&this.log("Media seeked to "+t.toFixed(3)),this.tick()},a.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(w.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},a.onManifestParsed=function(u,t){var n=!1,v=!1,y;t.levels.forEach(function(x){y=x.audioCodec,y&&(y.indexOf("mp4a.40.2")!==-1&&(n=!0),y.indexOf("mp4a.40.5")!==-1&&(v=!0))}),this.audioCodecSwitch=n&&v&&!Object(O.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1},a.onLevelLoading=function(u,t){var n=this.levels;if(!(!n||this.state!==P.State.IDLE)){var v=n[t.level];(!v.details||v.details.live&&this.levelLastLoaded!==t.level||this.waitForCdnTuneIn(v.details))&&(this.state=P.State.WAITING_LEVEL)}},a.onLevelLoaded=function(u,t){var n,v=this.levels,y=t.level,x=t.details,I=x.totalduration;if(!v){this.warn("Levels were reset while loading level "+y);return}this.log("Level "+y+" loaded ["+x.startSN+","+x.endSN+"], cc ["+x.startCC+", "+x.endCC+"] duration:"+I);var F=this.fragCurrent;F&&(this.state===P.State.FRAG_LOADING||this.state===P.State.FRAG_LOADING_WAITING_RETRY)&&F.level!==t.level&&F.loader&&(this.state=P.State.IDLE,F.loader.abort());var U=v[y],k=0;if(x.live||(n=U.details)!==null&&n!==void 0&&n.live){if(x.fragments[0]||(x.deltaUpdateFailed=!0),x.deltaUpdateFailed)return;k=this.alignPlaylists(x,U.details)}if(U.details=x,this.levelLastLoaded=y,this.hls.trigger(w.Events.LEVEL_UPDATED,{details:x,level:y}),this.state===P.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(x))return;this.state=P.State.IDLE}this.startFragRequested?x.live&&this.synchronizeToLiveEdge(x):this.setStartPosition(x,k),this.tick()},a._handleFragmentLoadProgress=function(u){var t,n=u.frag,v=u.part,y=u.payload,x=this.levels;if(!x){this.warn("Levels were reset while fragment load was in progress. Fragment "+n.sn+" of level "+n.level+" will not be buffered");return}var I=x[n.level],F=I.details;if(!F){this.warn("Dropping fragment "+n.sn+" of level "+n.level+" after level details were reset");return}var U=I.videoCodec,k=F.PTSKnown||!F.live,$=(t=n.initSegment)===null||t===void 0?void 0:t.data,W=this._getAudioCodec(I),G=this.transmuxer=this.transmuxer||new D.default(this.hls,C.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),H=v?v.index:-1,z=H!==-1,V=new c.ChunkMetadata(n.level,n.sn,n.stats.chunkCount,y.byteLength,H,z),Y=this.initPTS[n.cc];G.push(y,$,W,U,n,v,F.totalduration,k,V,Y)},a.onAudioTrackSwitching=function(u,t){var n=this.altAudio,v=!!t.url,y=t.id;if(!v){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var x=this.fragCurrent;x!=null&&x.loader&&(this.log("Switching to main audio track, cancel main fragment load"),x.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var I=this.hls;n&&I.trigger(w.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),I.trigger(w.Events.AUDIO_TRACK_SWITCHED,{id:y})}},a.onAudioTrackSwitched=function(u,t){var n=t.id,v=!!this.hls.audioTracks[n].url;if(v){var y=this.videoBuffer;y&&this.mediaBuffer!==y&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=y)}this.altAudio=v,this.tick()},a.onBufferCreated=function(u,t){var n=t.tracks,v,y,x=!1;for(var I in n){var F=n[I];if(F.id==="main"){if(y=I,v=F,I==="video"){var U=n[I];U&&(this.videoBuffer=U.buffer)}}else x=!0}x&&v?(this.log("Alternate track found, use "+y+".buffered to schedule main fragment loading"),this.mediaBuffer=v.buffer):this.mediaBuffer=this.media},a.onFragBuffered=function(u,t){var n=t.frag,v=t.part;if(!(n&&n.type!==C.PlaylistLevelType.MAIN)){if(this.fragContextChanged(n)){this.warn("Fragment "+n.sn+(v?" p: "+v.index:"")+" of level "+n.level+" finished buffering, but was aborted. state: "+this.state),this.state===P.State.PARSED&&(this.state=P.State.IDLE);return}var y=v?v.stats:n.stats;this.fragLastKbps=Math.round(8*y.total/(y.buffering.end-y.loading.first)),n.sn!=="initSegment"&&(this.fragPrevious=n),this.fragBufferedComplete(n,v)}},a.onError=function(u,t){switch(t.details){case L.ErrorDetails.FRAG_LOAD_ERROR:case L.ErrorDetails.FRAG_LOAD_TIMEOUT:case L.ErrorDetails.KEY_LOAD_ERROR:case L.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(C.PlaylistLevelType.MAIN,t);break;case L.ErrorDetails.LEVEL_LOAD_ERROR:case L.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==P.State.ERROR&&(t.fatal?(this.warn(""+t.details),this.state=P.State.ERROR):!t.levelRetry&&this.state===P.State.WAITING_LEVEL&&(this.state=P.State.IDLE));break;case L.ErrorDetails.BUFFER_FULL_ERROR:if(t.parent==="main"&&(this.state===P.State.PARSING||this.state===P.State.PARSED)){var n=!0,v=this.getFwdBufferInfo(this.media,C.PlaylistLevelType.MAIN);v&&v.len>.5&&(n=!this.reduceMaxBufferLength(v.len)),n&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},a.checkBuffer=function(){var u=this.media,t=this.gapController;if(!(!u||!t||!u.readyState)){var n=_.BufferHelper.getBuffered(u);!this.loadedmetadata&&n.length?(this.loadedmetadata=!0,this.seekToStartPos()):t.poll(this.lastCurrentTime),this.lastCurrentTime=u.currentTime}},a.onFragLoadEmergencyAborted=function(){this.state=P.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},a.onBufferFlushed=function(u,t){var n=t.type;if(n!==T.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var v=(n===T.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(v,n,C.PlaylistLevelType.MAIN)}},a.onLevelsUpdated=function(u,t){this.levels=t.levels},a.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},a.seekToStartPos=function(){var u=this.media,t=u.currentTime,n=this.startPosition;if(n>=0&&t<n){if(u.seeking){E.logger.log("could not seek to "+n+", already seeking at "+t);return}var v=_.BufferHelper.getBuffered(u),y=v.length?v.start(0):0,x=y-n;x>0&&(x<this.config.maxBufferHole||x<this.config.maxFragLookUpTolerance)&&(E.logger.log("adjusting start position by "+x+" to match buffer start"),n+=x,this.startPosition=n),this.log("seek to target start position "+n+" from current time "+t),u.currentTime=n}},a._getAudioCodec=function(u){var t=this.config.defaultAudioCodec||u.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t},a._loadBitrateTestFrag=function(u){var t=this;this._doFragLoad(u).then(function(n){var v=t.hls;if(!(!n||v.nextLoadLevel||t.fragContextChanged(u))){t.fragLoadError=0,t.state=P.State.IDLE,t.startFragRequested=!1,t.bitrateTest=!1;var y=u.stats;y.parsing.start=y.parsing.end=y.buffering.start=y.buffering.end=self.performance.now(),v.trigger(w.Events.FRAG_LOADED,n)}})},a._handleTransmuxComplete=function(u){var t,n="main",v=this.hls,y=u.remuxResult,x=u.chunkMeta,I=this.getCurrentContext(x);if(!I){this.warn("The loading context changed while buffering fragment "+x.sn+" of level "+x.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(x.level);return}var F=I.frag,U=I.part,k=I.level,$=y.video,W=y.text,G=y.id3,H=y.initSegment,z=this.altAudio?void 0:y.audio;if(!this.fragContextChanged(F)){if(this.state=P.State.PARSING,H){H.tracks&&(this._bufferInitSegment(k,H.tracks,F,x),v.trigger(w.Events.FRAG_PARSING_INIT_SEGMENT,{frag:F,id:n,tracks:H.tracks}));var V=H.initPTS,Y=H.timescale;Object(B.isFiniteNumber)(V)&&(this.initPTS[F.cc]=V,v.trigger(w.Events.INIT_PTS_FOUND,{frag:F,id:n,initPTS:V,timescale:Y}))}if($&&y.independent!==!1){if(k.details){var Q=$.startPTS,X=$.endPTS,q=$.startDTS,J=$.endDTS;if(U)U.elementaryStreams[$.type]={startPTS:Q,endPTS:X,startDTS:q,endDTS:J};else if($.firstKeyFrame&&$.independent&&(this.couldBacktrack=!0),$.dropped&&$.independent){var Z=this.getLoadPosition()+this.config.maxBufferHole;if(Z<Q){this.backtrack(F);return}F.setElementaryStreamInfo($.type,F.start,X,F.start,J,!0)}F.setElementaryStreamInfo($.type,Q,X,q,J),this.bufferFragmentData($,F,U,x)}}else if(y.independent===!1){this.backtrack(F);return}if(z){var ee=z.startPTS,te=z.endPTS,re=z.startDTS,ne=z.endDTS;U&&(U.elementaryStreams[T.ElementaryStreamTypes.AUDIO]={startPTS:ee,endPTS:te,startDTS:re,endDTS:ne}),F.setElementaryStreamInfo(T.ElementaryStreamTypes.AUDIO,ee,te,re,ne),this.bufferFragmentData(z,F,U,x)}if(G!=null&&(t=G.samples)!==null&&t!==void 0&&t.length){var se={frag:F,id:n,samples:G.samples};v.trigger(w.Events.FRAG_PARSING_METADATA,se)}if(W){var ie={frag:F,id:n,samples:W.samples};v.trigger(w.Events.FRAG_PARSING_USERDATA,ie)}}},a._bufferInitSegment=function(u,t,n,v){var y=this;if(this.state===P.State.PARSING){this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;var x=t.audio,I=t.video,F=t.audiovideo;if(x){var U=u.audioCodec,k=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(U&&(U.indexOf("mp4a.40.5")!==-1?U="mp4a.40.2":U="mp4a.40.5"),x.metadata.channelCount!==1&&k.indexOf("firefox")===-1&&(U="mp4a.40.5")),k.indexOf("android")!==-1&&x.container!=="audio/mpeg"&&(U="mp4a.40.2",this.log("Android: force audio codec to "+U)),u.audioCodec&&u.audioCodec!==U&&this.log('Swapping manifest audio codec "'+u.audioCodec+'" for "'+U+'"'),x.levelCodec=U,x.id="main",this.log("Init audio buffer, container:"+x.container+", codecs[selected/level/parsed]=["+(U||"")+"/"+(u.audioCodec||"")+"/"+x.codec+"]")}I&&(I.levelCodec=u.videoCodec,I.id="main",this.log("Init video buffer, container:"+I.container+", codecs[level/parsed]=["+(u.videoCodec||"")+"/"+I.codec+"]")),F&&this.log("Init audiovideo buffer, container:"+F.container+", codecs[level/parsed]=["+(u.attrs.CODECS||"")+"/"+F.codec+"]"),this.hls.trigger(w.Events.BUFFER_CODECS,t),Object.keys(t).forEach(function($){var W=t[$],G=W.initSegment;G!=null&&G.byteLength&&y.hls.trigger(w.Events.BUFFER_APPENDING,{type:$,data:G,frag:n,part:null,chunkMeta:v,parent:n.type})}),this.tick()}},a.backtrack=function(u){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(u);var t=this.fragmentTracker.backtrack(u);this.fragPrevious=null,this.nextLoadPosition=u.start,t?this.resetFragmentLoading(u):this.state=P.State.BACKTRACKING},a.checkFragmentChanged=function(){var u=this.media,t=null;if(u&&u.readyState>1&&u.seeking===!1){var n=u.currentTime;if(_.BufferHelper.isBuffered(u,n)?t=this.getAppendedFrag(n):_.BufferHelper.isBuffered(u,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){var v=this.fragPlaying,y=t.level;(!v||t.sn!==v.sn||v.level!==y||t.urlId!==v.urlId)&&(this.hls.trigger(w.Events.FRAG_CHANGED,{frag:t}),(!v||v.level!==y)&&this.hls.trigger(w.Events.LEVEL_SWITCHED,{level:y}),this.fragPlaying=t)}}},o(e,[{key:"nextLevel",get:function(){var u=this.nextBufferedFrag;return u?u.level:-1}},{key:"currentLevel",get:function(){var u=this.media;if(u){var t=this.getAppendedFrag(u.currentTime);if(t)return t.level}return-1}},{key:"nextBufferedFrag",get:function(){var u=this.media;if(u){var t=this.getAppendedFrag(u.currentTime);return this.followingBufferedFrag(t)}else return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),e}(P.default)},"./src/controller/subtitle-stream-controller.ts":function(K,M,S){S.r(M),S.d(M,"SubtitleStreamController",function(){return o});var B=S("./src/events.ts"),P=S("./src/utils/buffer-helper.ts"),O=S("./src/controller/fragment-finders.ts"),w=S("./src/utils/discontinuities.ts"),_=S("./src/controller/level-helper.ts"),R=S("./src/controller/fragment-tracker.ts"),C=S("./src/controller/base-stream-controller.ts"),T=S("./src/types/loader.ts"),D=S("./src/types/level.ts");function c(f,r){for(var p=0;p<r.length;p++){var m=r[p];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(f,m.key,m)}}function A(f,r,p){return r&&c(f.prototype,r),p&&c(f,p),f}function L(f,r){f.prototype=Object.create(r.prototype),f.prototype.constructor=f,E(f,r)}function E(f,r){return E=Object.setPrototypeOf||function(m,l){return m.__proto__=l,m},E(f,r)}var g=500,o=function(f){L(r,f);function r(m,l){var e;return e=f.call(this,m,l,"[subtitle-stream-controller]")||this,e.levels=[],e.currentTrackId=-1,e.tracksBuffered=[],e.mainDetails=null,e._registerListeners(),e}var p=r.prototype;return p.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},p._registerListeners=function(){var l=this.hls;l.on(B.Events.MEDIA_ATTACHED,this.onMediaAttached,this),l.on(B.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.on(B.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.on(B.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.on(B.Events.ERROR,this.onError,this),l.on(B.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),l.on(B.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),l.on(B.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),l.on(B.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),l.on(B.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},p._unregisterListeners=function(){var l=this.hls;l.off(B.Events.MEDIA_ATTACHED,this.onMediaAttached,this),l.off(B.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.off(B.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.off(B.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.off(B.Events.ERROR,this.onError,this),l.off(B.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),l.off(B.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),l.off(B.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),l.off(B.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),l.off(B.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},p.startLoad=function(){this.stopLoad(),this.state=C.State.IDLE,this.setInterval(g),this.tick()},p.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},p.onLevelLoaded=function(l,e){this.mainDetails=e.details},p.onSubtitleFragProcessed=function(l,e){var a=e.frag,h=e.success;if(this.fragPrevious=a,this.state=C.State.IDLE,!!h){var u=this.tracksBuffered[this.currentTrackId];if(!!u){for(var t,n=a.start,v=0;v<u.length;v++)if(n>=u[v].start&&n<=u[v].end){t=u[v];break}var y=a.start+a.duration;t?t.end=y:(t={start:n,end:y},u.push(t)),this.fragmentTracker.fragBuffered(a)}}},p.onBufferFlushing=function(l,e){var a=e.startOffset,h=e.endOffset;if(a===0&&h!==Number.POSITIVE_INFINITY){var u=this.currentTrackId,t=this.levels;if(!t.length||!t[u]||!t[u].details)return;var n=t[u].details,v=n.targetduration,y=h-v;if(y<=0)return;e.endOffsetSubtitles=Math.max(0,y),this.tracksBuffered.forEach(function(x){for(var I=0;I<x.length;){if(x[I].end<=y){x.shift();continue}else if(x[I].start<y)x[I].start=y;else break;I++}}),this.fragmentTracker.removeFragmentsInRange(a,y,T.PlaylistLevelType.SUBTITLE)}},p.onError=function(l,e){var a,h=e.frag;!h||h.type!==T.PlaylistLevelType.SUBTITLE||((a=this.fragCurrent)!==null&&a!==void 0&&a.loader&&this.fragCurrent.loader.abort(),this.state=C.State.IDLE)},p.onSubtitleTracksUpdated=function(l,e){var a=this,h=e.subtitleTracks;this.tracksBuffered=[],this.levels=h.map(function(u){return new D.Level(u)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(u){a.tracksBuffered[u.id]=[]}),this.mediaBuffer=null},p.onSubtitleTrackSwitch=function(l,e){if(this.currentTrackId=e.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var a=this.levels[this.currentTrackId];a!=null&&a.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,a&&this.setInterval(g)},p.onSubtitleTrackLoaded=function(l,e){var a,h=e.details,u=e.id,t=this.currentTrackId,n=this.levels;if(!!n.length){var v=n[t];if(!(u>=n.length||u!==t||!v)){if(this.mediaBuffer=this.mediaBufferTimeRanges,h.live||(a=v.details)!==null&&a!==void 0&&a.live){var y=this.mainDetails;if(h.deltaUpdateFailed||!y)return;var x=y.fragments[0];if(!v.details)h.hasProgramDateTime&&y.hasProgramDateTime?Object(w.alignMediaPlaylistByPDT)(h,y):x&&Object(_.addSliding)(h,x.start);else{var I=this.alignPlaylists(h,v.details);I===0&&x&&Object(_.addSliding)(h,x.start)}}if(v.details=h,this.levelLastLoaded=u,this.tick(),h.live&&!this.fragCurrent&&this.media&&this.state===C.State.IDLE){var F=Object(O.findFragmentByPTS)(null,h.fragments,this.media.currentTime,0);F||(this.warn("Subtitle playlist not aligned with playback"),v.details=void 0)}}}},p._handleFragmentLoadComplete=function(l){var e=l.frag,a=l.payload,h=e.decryptdata,u=this.hls;if(!this.fragContextChanged(e)&&a&&a.byteLength>0&&h&&h.key&&h.iv&&h.method==="AES-128"){var t=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(a),h.key.buffer,h.iv.buffer).then(function(n){var v=performance.now();u.trigger(B.Events.FRAG_DECRYPTED,{frag:e,payload:n,stats:{tstart:t,tdecrypt:v}})})}},p.doTick=function(){if(!this.media){this.state=C.State.IDLE;return}if(this.state===C.State.IDLE){var l,e=this.currentTrackId,a=this.levels;if(!a.length||!a[e]||!a[e].details)return;var h=a[e].details,u=h.targetduration,t=this.config,n=this.media,v=P.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,n.currentTime-u,t.maxBufferHole),y=v.end,x=v.len,I=this.getMaxBufferLength()+u;if(x>I)return;console.assert(h,"Subtitle track details are defined on idle subtitle stream controller tick");var F=h.fragments,U=F.length,k=h.edge,$,W=this.fragPrevious;if(y<k){var G=t.maxFragLookUpTolerance;$=Object(O.findFragmentByPTS)(W,F,y,G),!$&&W&&W.start<F[0].start&&($=F[0])}else $=F[U-1];(l=$)!==null&&l!==void 0&&l.encrypted?this.loadKey($,h):$&&this.fragmentTracker.getState($)===R.FragmentState.NOT_LOADED&&this.loadFragment($,h,y)}},p.loadFragment=function(l,e,a){this.fragCurrent=l,f.prototype.loadFragment.call(this,l,e,a)},A(r,[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}]),r}(C.default)},"./src/controller/subtitle-track-controller.ts":function(K,M,S){S.r(M);var B=S("./src/events.ts"),P=S("./src/utils/texttrack-utils.ts"),O=S("./src/controller/base-playlist-controller.ts"),w=S("./src/types/loader.ts");function _(A,L){for(var E=0;E<L.length;E++){var g=L[E];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(A,g.key,g)}}function R(A,L,E){return L&&_(A.prototype,L),E&&_(A,E),A}function C(A,L){A.prototype=Object.create(L.prototype),A.prototype.constructor=A,T(A,L)}function T(A,L){return T=Object.setPrototypeOf||function(g,o){return g.__proto__=o,g},T(A,L)}var D=function(A){C(L,A);function L(g){var o;return o=A.call(this,g,"[subtitle-track-controller]")||this,o.media=null,o.tracks=[],o.groupId=null,o.tracksInGroup=[],o.trackId=-1,o.selectDefaultTrack=!0,o.queuedDefaultTrack=-1,o.trackChangeListener=function(){return o.onTextTracksChanged()},o.asyncPollTrackChange=function(){return o.pollTrackChange(0)},o.useTextTrackPolling=!1,o.subtitlePollingInterval=-1,o.subtitleDisplay=!0,o.registerListeners(),o}var E=L.prototype;return E.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,A.prototype.destroy.call(this)},E.registerListeners=function(){var o=this.hls;o.on(B.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.on(B.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.on(B.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.on(B.Events.MANIFEST_PARSED,this.onManifestParsed,this),o.on(B.Events.LEVEL_LOADING,this.onLevelLoading,this),o.on(B.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),o.on(B.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),o.on(B.Events.ERROR,this.onError,this)},E.unregisterListeners=function(){var o=this.hls;o.off(B.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.off(B.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.off(B.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.off(B.Events.MANIFEST_PARSED,this.onManifestParsed,this),o.off(B.Events.LEVEL_LOADING,this.onLevelLoading,this),o.off(B.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),o.off(B.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),o.off(B.Events.ERROR,this.onError,this)},E.onMediaAttached=function(o,f){this.media=f.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},E.pollTrackChange=function(o){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,o)},E.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var o=c(this.media.textTracks);o.forEach(function(f){Object(P.clearCurrentCues)(f)}),this.subtitleTrack=-1,this.media=null}},E.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},E.onManifestParsed=function(o,f){this.tracks=f.subtitleTracks},E.onSubtitleTrackLoaded=function(o,f){var r=f.id,p=f.details,m=this.trackId,l=this.tracksInGroup[m];if(!l){this.warn("Invalid subtitle track id "+r);return}var e=l.details;l.details=f.details,this.log("subtitle track "+r+" loaded ["+p.startSN+"-"+p.endSN+"]"),r===this.trackId&&(this.retryCount=0,this.playlistLoaded(r,f,e))},E.onLevelLoading=function(o,f){this.switchLevel(f.level)},E.onLevelSwitching=function(o,f){this.switchLevel(f.level)},E.switchLevel=function(o){var f=this.hls.levels[o];if(!!(f!=null&&f.textGroupIds)){var r=f.textGroupIds[f.urlId];if(this.groupId!==r){var p=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,m=this.tracks.filter(function(a){return!r||a.groupId===r});this.tracksInGroup=m;var l=this.findTrackId(p==null?void 0:p.name)||this.findTrackId();this.groupId=r;var e={subtitleTracks:m};this.log("Updating subtitle tracks, "+m.length+' track(s) found in "'+r+'" group-id'),this.hls.trigger(B.Events.SUBTITLE_TRACKS_UPDATED,e),l!==-1&&this.setSubtitleTrack(l,p)}}},E.findTrackId=function(o){for(var f=this.tracksInGroup,r=0;r<f.length;r++){var p=f[r];if((!this.selectDefaultTrack||p.default)&&(!o||o===p.name))return p.id}return-1},E.onError=function(o,f){A.prototype.onError.call(this,o,f),!(f.fatal||!f.context)&&f.context.type===w.PlaylistContextType.SUBTITLE_TRACK&&f.context.id===this.trackId&&f.context.groupId===this.groupId&&this.retryLoadingOrFail(f)},E.loadPlaylist=function(o){var f=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(f)){var r=f.id,p=f.groupId,m=f.url;if(o)try{m=o.addDirectives(m)}catch(l){this.warn("Could not construct new URL with HLS Delivery Directives: "+l)}this.log("Loading subtitle playlist for id "+r),this.hls.trigger(B.Events.SUBTITLE_TRACK_LOADING,{url:m,id:r,groupId:p,deliveryDirectives:o||null})}},E.toggleTrackModes=function(o){var f=this,r=this.media,p=this.subtitleDisplay,m=this.trackId;if(!!r){var l=c(r.textTracks),e=l.filter(function(u){return u.groupId===f.groupId});if(o===-1)[].slice.call(l).forEach(function(u){u.mode="disabled"});else{var a=e[m];a&&(a.mode="disabled")}var h=e[o];h&&(h.mode=p?"showing":"hidden")}},E.setSubtitleTrack=function(o,f){var r,p=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=o;return}if(this.trackId!==o&&this.toggleTrackModes(o),!(this.trackId===o&&(o===-1||(r=p[o])!==null&&r!==void 0&&r.details)||o<-1||o>=p.length)){this.clearTimer();var m=p[o];if(this.log("Switching to subtitle track "+o),this.trackId=o,m){var l=m.id,e=m.groupId,a=e===void 0?"":e,h=m.name,u=m.type,t=m.url;this.hls.trigger(B.Events.SUBTITLE_TRACK_SWITCH,{id:l,groupId:a,name:h,type:u,url:t});var n=this.switchParams(m.url,f==null?void 0:f.details);this.loadPlaylist(n)}else this.hls.trigger(B.Events.SUBTITLE_TRACK_SWITCH,{id:o})}},E.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var o=-1,f=c(this.media.textTracks),r=0;r<f.length;r++)if(f[r].mode==="hidden")o=r;else if(f[r].mode==="showing"){o=r;break}this.subtitleTrack!==o&&(this.subtitleTrack=o)}},R(L,[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(o){this.selectDefaultTrack=!1;var f=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(o,f)}}]),L}(O.default);function c(A){for(var L=[],E=0;E<A.length;E++){var g=A[E];g.kind==="subtitles"&&g.label&&L.push(A[E])}return L}M.default=D},"./src/controller/timeline-controller.ts":function(K,M,S){S.r(M),S.d(M,"TimelineController",function(){return c});var B=S("./src/polyfills/number.ts"),P=S("./src/events.ts"),O=S("./src/utils/cea-608-parser.ts"),w=S("./src/utils/output-filter.ts"),_=S("./src/utils/webvtt-parser.ts"),R=S("./src/utils/texttrack-utils.ts"),C=S("./src/utils/imsc1-ttml-parser.ts"),T=S("./src/types/loader.ts"),D=S("./src/utils/logger.ts"),c=function(){function g(f){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=E(),this.captionsProperties=void 0,this.hls=f,this.config=f.config,this.Cues=f.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var r=new w.default(this,"textTrack1"),p=new w.default(this,"textTrack2"),m=new w.default(this,"textTrack3"),l=new w.default(this,"textTrack4");this.cea608Parser1=new O.default(1,r,p),this.cea608Parser2=new O.default(3,m,l)}f.on(P.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),f.on(P.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.on(P.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.on(P.Events.MANIFEST_LOADED,this.onManifestLoaded,this),f.on(P.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),f.on(P.Events.FRAG_LOADING,this.onFragLoading,this),f.on(P.Events.FRAG_LOADED,this.onFragLoaded,this),f.on(P.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),f.on(P.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),f.on(P.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),f.on(P.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),f.on(P.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var o=g.prototype;return o.destroy=function(){var r=this.hls;r.off(P.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.off(P.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(P.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(P.Events.MANIFEST_LOADED,this.onManifestLoaded,this),r.off(P.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.off(P.Events.FRAG_LOADING,this.onFragLoading,this),r.off(P.Events.FRAG_LOADED,this.onFragLoaded,this),r.off(P.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),r.off(P.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),r.off(P.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.off(P.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),r.off(P.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},o.addCues=function(r,p,m,l,e){for(var a=!1,h=e.length;h--;){var u=e[h],t=L(u[0],u[1],p,m);if(t>=0&&(u[0]=Math.min(u[0],p),u[1]=Math.max(u[1],m),a=!0,t/(m-p)>.5))return}if(a||e.push([p,m]),this.config.renderTextTracksNatively){var n=this.captionsTracks[r];this.Cues.newCue(n,p,m,l)}else{var v=this.Cues.newCue(null,p,m,l);this.hls.trigger(P.Events.CUES_PARSED,{type:"captions",cues:v,track:r})}},o.onInitPtsFound=function(r,p){var m=this,l=p.frag,e=p.id,a=p.initPTS,h=p.timescale,u=this.unparsedVttFrags;e==="main"&&(this.initPTS[l.cc]=a,this.timescale[l.cc]=h),u.length&&(this.unparsedVttFrags=[],u.forEach(function(t){m.onFragLoaded(P.Events.FRAG_LOADED,t)}))},o.getExistingTrack=function(r){var p=this.media;if(p)for(var m=0;m<p.textTracks.length;m++){var l=p.textTracks[m];if(l[r])return l}return null},o.createCaptionsTrack=function(r){this.config.renderTextTracksNatively?this.createNativeTrack(r):this.createNonNativeTrack(r)},o.createNativeTrack=function(r){if(!this.captionsTracks[r]){var p=this.captionsProperties,m=this.captionsTracks,l=this.media,e=p[r],a=e.label,h=e.languageCode,u=this.getExistingTrack(r);if(u)m[r]=u,Object(R.clearCurrentCues)(m[r]),Object(R.sendAddTrackEvent)(m[r],l);else{var t=this.createTextTrack("captions",a,h);t&&(t[r]=!0,m[r]=t)}}},o.createNonNativeTrack=function(r){if(!this.nonNativeCaptionsTracks[r]){var p=this.captionsProperties[r];if(!!p){var m=p.label,l={_id:r,label:m,kind:"captions",default:p.media?!!p.media.default:!1,closedCaptions:p.media};this.nonNativeCaptionsTracks[r]=l,this.hls.trigger(P.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[l]})}}},o.createTextTrack=function(r,p,m){var l=this.media;if(!!l)return l.addTextTrack(r,p,m)},o.onMediaAttaching=function(r,p){this.media=p.media,this._cleanTracks()},o.onMediaDetaching=function(){var r=this.captionsTracks;Object.keys(r).forEach(function(p){Object(R.clearCurrentCues)(r[p]),delete r[p]}),this.nonNativeCaptionsTracks={}},o.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=E(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},o._cleanTracks=function(){var r=this.media;if(!!r){var p=r.textTracks;if(p)for(var m=0;m<p.length;m++)Object(R.clearCurrentCues)(p[m])}},o.onSubtitleTracksUpdated=function(r,p){var m=this;this.textTracks=[];var l=p.subtitleTracks||[],e=l.some(function(t){return t.textCodec===C.IMSC1_CODEC});if(this.config.enableWebVTT||e&&this.config.enableIMSC1){var a=this.tracks&&l&&this.tracks.length===l.length;if(this.tracks=l||[],this.config.renderTextTracksNatively){var h=this.media?this.media.textTracks:[];this.tracks.forEach(function(t,n){var v;if(n<h.length){for(var y=null,x=0;x<h.length;x++)if(A(h[x],t)){y=h[x];break}y&&(v=y)}v?Object(R.clearCurrentCues)(v):(v=m.createTextTrack("subtitles",t.name,t.lang),v&&(v.mode="disabled")),v&&(v.groupId=t.groupId,m.textTracks.push(v))})}else if(!a&&this.tracks&&this.tracks.length){var u=this.tracks.map(function(t){return{label:t.name,kind:t.type.toLowerCase(),default:t.default,subtitleTrack:t}});this.hls.trigger(P.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:u})}}},o.onManifestLoaded=function(r,p){var m=this;this.config.enableCEA708Captions&&p.captions&&p.captions.forEach(function(l){var e=/(?:CC|SERVICE)([1-4])/.exec(l.instreamId);if(!!e){var a="textTrack"+e[1],h=m.captionsProperties[a];!h||(h.label=l.name,l.lang&&(h.languageCode=l.lang),h.media=l)}})},o.onFragLoading=function(r,p){var m=this.cea608Parser1,l=this.cea608Parser2,e=this.lastSn,a=this.lastPartIndex;if(!(!this.enabled||!(m&&l))&&p.frag.type===T.PlaylistLevelType.MAIN){var h,u,t=p.frag.sn,n=(h=p==null||(u=p.part)===null||u===void 0?void 0:u.index)!=null?h:-1;t===e+1||t===e&&n===a+1||(m.reset(),l.reset()),this.lastSn=t,this.lastPartIndex=n}},o.onFragLoaded=function(r,p){var m=p.frag,l=p.payload,e=this.initPTS,a=this.unparsedVttFrags;if(m.type===T.PlaylistLevelType.SUBTITLE)if(l.byteLength){if(!Object(B.isFiniteNumber)(e[m.cc])){a.push(p),e.length&&this.hls.trigger(P.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:m,error:new Error("Missing initial subtitle PTS")});return}var h=m.decryptdata,u="stats"in p;if(h==null||h.key==null||h.method!=="AES-128"||u){var t=this.tracks[m.level],n=this.vttCCs;n[m.cc]||(n[m.cc]={start:m.start,prevCC:this.prevCC,new:!0},this.prevCC=m.cc),t&&t.textCodec===C.IMSC1_CODEC?this._parseIMSC1(m,l):this._parseVTTs(m,l,n)}}else this.hls.trigger(P.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:m,error:new Error("Empty subtitle payload")})},o._parseIMSC1=function(r,p){var m=this,l=this.hls;Object(C.parseIMSC1)(p,this.initPTS[r.cc],this.timescale[r.cc],function(e){m._appendCues(e,r.level),l.trigger(P.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},function(e){D.logger.log("Failed to parse IMSC1: "+e),l.trigger(P.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:e})})},o._parseVTTs=function(r,p,m){var l=this,e=this.hls;Object(_.parseWebVTT)(p,this.initPTS[r.cc],this.timescale[r.cc],m,r.cc,r.start,function(a){l._appendCues(a,r.level),e.trigger(P.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},function(a){l._fallbackToIMSC1(r,p),D.logger.log("Failed to parse VTT cue: "+a),e.trigger(P.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:a})})},o._fallbackToIMSC1=function(r,p){var m=this,l=this.tracks[r.level];l.textCodec||Object(C.parseIMSC1)(p,this.initPTS[r.cc],this.timescale[r.cc],function(){l.textCodec=C.IMSC1_CODEC,m._parseIMSC1(r,p)},function(){l.textCodec="wvtt"})},o._appendCues=function(r,p){var m=this.hls;if(this.config.renderTextTracksNatively){var l=this.textTracks[p];if(l.mode==="disabled")return;r.forEach(function(h){return Object(R.addCueToTrack)(l,h)})}else{var e=this.tracks[p],a=e.default?"default":"subtitles"+p;m.trigger(P.Events.CUES_PARSED,{type:"subtitles",cues:r,track:a})}},o.onFragDecrypted=function(r,p){var m=p.frag;if(m.type===T.PlaylistLevelType.SUBTITLE){if(!Object(B.isFiniteNumber)(this.initPTS[m.cc])){this.unparsedVttFrags.push(p);return}this.onFragLoaded(P.Events.FRAG_LOADED,p)}},o.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},o.onFragParsingUserdata=function(r,p){var m=this.cea608Parser1,l=this.cea608Parser2;if(!(!this.enabled||!(m&&l)))for(var e=0;e<p.samples.length;e++){var a=p.samples[e].bytes;if(a){var h=this.extractCea608Data(a);m.addData(p.samples[e].pts,h[0]),l.addData(p.samples[e].pts,h[1])}}},o.onBufferFlushing=function(r,p){var m=p.startOffset,l=p.endOffset,e=p.endOffsetSubtitles,a=p.type,h=this.media;if(!(!h||h.currentTime<l)){if(!a||a==="video"){var u=this.captionsTracks;Object.keys(u).forEach(function(n){return Object(R.removeCuesInRange)(u[n],m,l)})}if(this.config.renderTextTracksNatively&&m===0&&e!==void 0){var t=this.textTracks;Object.keys(t).forEach(function(n){return Object(R.removeCuesInRange)(t[n],m,e)})}}},o.extractCea608Data=function(r){for(var p=r[0]&31,m=2,l=[[],[]],e=0;e<p;e++){var a=r[m++],h=127&r[m++],u=127&r[m++],t=(4&a)!==0,n=3&a;h===0&&u===0||t&&(n===0||n===1)&&(l[n].push(h),l[n].push(u))}return l},g}();function A(g,o){return g&&g.label===o.name&&!(g.textTrack1||g.textTrack2)}function L(g,o,f,r){return Math.min(o,r)-Math.max(g,f)}function E(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}},"./src/crypt/aes-crypto.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return B});var B=function(){function P(w,_){this.subtle=void 0,this.aesIV=void 0,this.subtle=w,this.aesIV=_}var O=P.prototype;return O.decrypt=function(_,R){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},R,_)},P}()},"./src/crypt/aes-decryptor.ts":function(K,M,S){S.r(M),S.d(M,"removePadding",function(){return P}),S.d(M,"default",function(){return O});var B=S("./src/utils/typed-array.ts");function P(w){var _=w.byteLength,R=_&&new DataView(w.buffer).getUint8(_-1);return R?Object(B.sliceUint8)(w,0,_-R):w}var O=function(){function w(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var _=w.prototype;return _.uint8ArrayToUint32Array_=function(C){for(var T=new DataView(C),D=new Uint32Array(4),c=0;c<4;c++)D[c]=T.getUint32(c*4);return D},_.initTable=function(){var C=this.sBox,T=this.invSBox,D=this.subMix,c=D[0],A=D[1],L=D[2],E=D[3],g=this.invSubMix,o=g[0],f=g[1],r=g[2],p=g[3],m=new Uint32Array(256),l=0,e=0,a=0;for(a=0;a<256;a++)a<128?m[a]=a<<1:m[a]=a<<1^283;for(a=0;a<256;a++){var h=e^e<<1^e<<2^e<<3^e<<4;h=h>>>8^h&255^99,C[l]=h,T[h]=l;var u=m[l],t=m[u],n=m[t],v=m[h]*257^h*16843008;c[l]=v<<24|v>>>8,A[l]=v<<16|v>>>16,L[l]=v<<8|v>>>24,E[l]=v,v=n*16843009^t*65537^u*257^l*16843008,o[h]=v<<24|v>>>8,f[h]=v<<16|v>>>16,r[h]=v<<8|v>>>24,p[h]=v,l?(l=u^m[m[m[n^u]]],e^=m[m[e]]):l=e=1}},_.expandKey=function(C){for(var T=this.uint8ArrayToUint32Array_(C),D=!0,c=0;c<T.length&&D;)D=T[c]===this.key[c],c++;if(!D){this.key=T;var A=this.keySize=T.length;if(A!==4&&A!==6&&A!==8)throw new Error("Invalid aes key size="+A);var L=this.ksRows=(A+6+1)*4,E,g,o=this.keySchedule=new Uint32Array(L),f=this.invKeySchedule=new Uint32Array(L),r=this.sBox,p=this.rcon,m=this.invSubMix,l=m[0],e=m[1],a=m[2],h=m[3],u,t;for(E=0;E<L;E++){if(E<A){u=o[E]=T[E];continue}t=u,E%A===0?(t=t<<8|t>>>24,t=r[t>>>24]<<24|r[t>>>16&255]<<16|r[t>>>8&255]<<8|r[t&255],t^=p[E/A|0]<<24):A>6&&E%A===4&&(t=r[t>>>24]<<24|r[t>>>16&255]<<16|r[t>>>8&255]<<8|r[t&255]),o[E]=u=(o[E-A]^t)>>>0}for(g=0;g<L;g++)E=L-g,g&3?t=o[E]:t=o[E-4],g<4||E<=4?f[g]=t:f[g]=l[r[t>>>24]]^e[r[t>>>16&255]]^a[r[t>>>8&255]]^h[r[t&255]],f[g]=f[g]>>>0}},_.networkToHostOrderSwap=function(C){return C<<24|(C&65280)<<8|(C&16711680)>>8|C>>>24},_.decrypt=function(C,T,D){for(var c=this.keySize+6,A=this.invKeySchedule,L=this.invSBox,E=this.invSubMix,g=E[0],o=E[1],f=E[2],r=E[3],p=this.uint8ArrayToUint32Array_(D),m=p[0],l=p[1],e=p[2],a=p[3],h=new Int32Array(C),u=new Int32Array(h.length),t,n,v,y,x,I,F,U,k,$,W,G,H,z,V=this.networkToHostOrderSwap;T<h.length;){for(k=V(h[T]),$=V(h[T+1]),W=V(h[T+2]),G=V(h[T+3]),x=k^A[0],I=G^A[1],F=W^A[2],U=$^A[3],H=4,z=1;z<c;z++)t=g[x>>>24]^o[I>>16&255]^f[F>>8&255]^r[U&255]^A[H],n=g[I>>>24]^o[F>>16&255]^f[U>>8&255]^r[x&255]^A[H+1],v=g[F>>>24]^o[U>>16&255]^f[x>>8&255]^r[I&255]^A[H+2],y=g[U>>>24]^o[x>>16&255]^f[I>>8&255]^r[F&255]^A[H+3],x=t,I=n,F=v,U=y,H=H+4;t=L[x>>>24]<<24^L[I>>16&255]<<16^L[F>>8&255]<<8^L[U&255]^A[H],n=L[I>>>24]<<24^L[F>>16&255]<<16^L[U>>8&255]<<8^L[x&255]^A[H+1],v=L[F>>>24]<<24^L[U>>16&255]<<16^L[x>>8&255]<<8^L[I&255]^A[H+2],y=L[U>>>24]<<24^L[x>>16&255]<<16^L[I>>8&255]<<8^L[F&255]^A[H+3],u[T]=V(t^m),u[T+1]=V(y^l),u[T+2]=V(v^e),u[T+3]=V(n^a),m=k,l=$,e=W,a=G,T=T+4}return u.buffer},w}()},"./src/crypt/decrypter.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return T});var B=S("./src/crypt/aes-crypto.ts"),P=S("./src/crypt/fast-aes-key.ts"),O=S("./src/crypt/aes-decryptor.ts"),w=S("./src/utils/logger.ts"),_=S("./src/utils/mp4-tools.ts"),R=S("./src/utils/typed-array.ts"),C=16,T=function(){function D(A,L,E){var g=E===void 0?{}:E,o=g.removePKCS7Padding,f=o===void 0?!0:o;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=A,this.config=L,this.removePKCS7Padding=f,f)try{var r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var c=D.prototype;return c.destroy=function(){this.observer=null},c.isSync=function(){return this.config.enableSoftwareAES},c.flush=function(){var L=this.currentResult;if(!L){this.reset();return}var E=new Uint8Array(L);return this.reset(),this.removePKCS7Padding?Object(O.removePadding)(E):E},c.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},c.decrypt=function(L,E,g,o){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(L),E,g);var f=this.flush();f&&o(f.buffer)}else this.webCryptoDecrypt(new Uint8Array(L),E,g).then(o)},c.softwareDecrypt=function(L,E,g){var o=this.currentIV,f=this.currentResult,r=this.remainderData;this.logOnce("JS AES decrypt"),r&&(L=Object(_.appendUint8Array)(r,L),this.remainderData=null);var p=this.getValidChunk(L);if(!p.length)return null;o&&(g=o);var m=this.softwareDecrypter;m||(m=this.softwareDecrypter=new O.default),m.expandKey(E);var l=f;return this.currentResult=m.decrypt(p.buffer,0,g),this.currentIV=Object(R.sliceUint8)(p,-16).buffer,l||null},c.webCryptoDecrypt=function(L,E,g){var o=this,f=this.subtle;return(this.key!==E||!this.fastAesKey)&&(this.key=E,this.fastAesKey=new P.default(f,E)),this.fastAesKey.expandKey().then(function(r){if(!f)return Promise.reject(new Error("web crypto not initialized"));var p=new B.default(f,g);return p.decrypt(L.buffer,r)}).catch(function(r){return o.onWebCryptoError(r,L,E,g)})},c.onWebCryptoError=function(L,E,g,o){return w.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",L),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(E,g,o)},c.getValidChunk=function(L){var E=L,g=L.length-L.length%C;return g!==L.length&&(E=Object(R.sliceUint8)(L,0,g),this.remainderData=Object(R.sliceUint8)(L,g)),E},c.logOnce=function(L){!this.logEnabled||(w.logger.log("[decrypter.ts]: "+L),this.logEnabled=!1)},D}()},"./src/crypt/fast-aes-key.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return B});var B=function(){function P(w,_){this.subtle=void 0,this.key=void 0,this.subtle=w,this.key=_}var O=P.prototype;return O.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},P}()},"./src/demux/aacdemuxer.ts":function(K,M,S){S.r(M);var B=S("./src/demux/base-audio-demuxer.ts"),P=S("./src/demux/adts.ts"),O=S("./src/utils/logger.ts"),w=S("./src/demux/id3.ts");function _(T,D){T.prototype=Object.create(D.prototype),T.prototype.constructor=T,R(T,D)}function R(T,D){return R=Object.setPrototypeOf||function(A,L){return A.__proto__=L,A},R(T,D)}var C=function(T){_(D,T);function D(A,L){var E;return E=T.call(this)||this,E.observer=void 0,E.config=void 0,E.observer=A,E.config=L,E}var c=D.prototype;return c.resetInitSegment=function(L,E,g){T.prototype.resetInitSegment.call(this,L,E,g),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:L,duration:g,inputTimeScale:9e4,dropped:0}},D.probe=function(L){if(!L)return!1;for(var E=w.getID3Data(L,0)||[],g=E.length,o=L.length;g<o;g++)if(P.probe(L,g))return O.logger.log("ADTS sync word found !"),!0;return!1},c.canParse=function(L,E){return P.canParse(L,E)},c.appendFrame=function(L,E,g){P.initTrackConfig(L,this.observer,E,g,L.manifestCodec);var o=P.appendFrame(L,E,g,this.initPTS,this.frameIndex);if(o&&o.missing===0)return o},D}(B.default);C.minProbeByteLength=9,M.default=C},"./src/demux/adts.ts":function(K,M,S){S.r(M),S.d(M,"getAudioConfig",function(){return w}),S.d(M,"isHeaderPattern",function(){return _}),S.d(M,"getHeaderLength",function(){return R}),S.d(M,"getFullFrameLength",function(){return C}),S.d(M,"canGetFrameLength",function(){return T}),S.d(M,"isHeader",function(){return D}),S.d(M,"canParse",function(){return c}),S.d(M,"probe",function(){return A}),S.d(M,"initTrackConfig",function(){return L}),S.d(M,"getFrameDuration",function(){return E}),S.d(M,"parseFrameHeader",function(){return g}),S.d(M,"appendFrame",function(){return o});var B=S("./src/utils/logger.ts"),P=S("./src/errors.ts"),O=S("./src/events.ts");function w(f,r,p,m){var l,e,a,h,u=navigator.userAgent.toLowerCase(),t=m,n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];l=((r[p+2]&192)>>>6)+1;var v=(r[p+2]&60)>>>2;if(v>n.length-1){f.trigger(O.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+v});return}return a=(r[p+2]&1)<<2,a|=(r[p+3]&192)>>>6,B.logger.log("manifest codec:"+m+", ADTS type:"+l+", samplingIndex:"+v),/firefox/i.test(u)?v>=6?(l=5,h=new Array(4),e=v-3):(l=2,h=new Array(2),e=v):u.indexOf("android")!==-1?(l=2,h=new Array(2),e=v):(l=5,h=new Array(4),m&&(m.indexOf("mp4a.40.29")!==-1||m.indexOf("mp4a.40.5")!==-1)||!m&&v>=6?e=v-3:((m&&m.indexOf("mp4a.40.2")!==-1&&(v>=6&&a===1||/vivaldi/i.test(u))||!m&&a===1)&&(l=2,h=new Array(2)),e=v)),h[0]=l<<3,h[0]|=(v&14)>>1,h[1]|=(v&1)<<7,h[1]|=a<<3,l===5&&(h[1]|=(e&14)>>1,h[2]=(e&1)<<7,h[2]|=2<<2,h[3]=0),{config:h,samplerate:n[v],channelCount:a,codec:"mp4a.40."+l,manifestCodec:t}}function _(f,r){return f[r]===255&&(f[r+1]&246)===240}function R(f,r){return f[r+1]&1?7:9}function C(f,r){return(f[r+3]&3)<<11|f[r+4]<<3|(f[r+5]&224)>>>5}function T(f,r){return r+5<f.length}function D(f,r){return r+1<f.length&&_(f,r)}function c(f,r){return T(f,r)&&_(f,r)&&C(f,r)<=f.length-r}function A(f,r){if(D(f,r)){var p=R(f,r);if(r+p>=f.length)return!1;var m=C(f,r);if(m<=p)return!1;var l=r+m;return l===f.length||D(f,l)}return!1}function L(f,r,p,m,l){if(!f.samplerate){var e=w(r,p,m,l);if(!e)return;f.config=e.config,f.samplerate=e.samplerate,f.channelCount=e.channelCount,f.codec=e.codec,f.manifestCodec=e.manifestCodec,B.logger.log("parsed codec:"+f.codec+", rate:"+e.samplerate+", channels:"+e.channelCount)}}function E(f){return 1024*9e4/f}function g(f,r,p,m,l){var e=R(f,r),a=C(f,r);if(a-=e,a>0){var h=p+m*l;return{headerLength:e,frameLength:a,stamp:h}}}function o(f,r,p,m,l){var e=E(f.samplerate),a=g(r,p,m,l,e);if(a){var h=a.frameLength,u=a.headerLength,t=a.stamp,n=u+h,v=Math.max(0,p+n-r.length),y;v?(y=new Uint8Array(n-u),y.set(r.subarray(p+u,r.length),0)):y=r.subarray(p+u,p+n);var x={unit:y,pts:t};return v||f.samples.push(x),{sample:x,length:n,missing:v}}}},"./src/demux/base-audio-demuxer.ts":function(K,M,S){S.r(M),S.d(M,"initPTSFn",function(){return C});var B=S("./src/polyfills/number.ts"),P=S("./src/demux/id3.ts"),O=S("./src/demux/dummy-demuxed-track.ts"),w=S("./src/utils/mp4-tools.ts"),_=S("./src/utils/typed-array.ts"),R=function(){function T(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var D=T.prototype;return D.resetInitSegment=function(A,L,E){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},D.resetTimeStamp=function(){},D.resetContiguity=function(){},D.canParse=function(A,L){return!1},D.appendFrame=function(A,L,E){},D.demux=function(A,L){this.cachedData&&(A=Object(w.appendUint8Array)(this.cachedData,A),this.cachedData=null);var E=P.getID3Data(A,0),g=E?E.length:0,o,f,r=this._audioTrack,p=this._id3Track,m=E?P.getTimeStamp(E):void 0,l=A.length;for((this.frameIndex===0||this.initPTS===null)&&(this.initPTS=C(m,L)),E&&E.length>0&&p.samples.push({pts:this.initPTS,dts:this.initPTS,data:E}),f=this.initPTS;g<l;){if(this.canParse(A,g)){var e=this.appendFrame(r,A,g);e?(this.frameIndex++,f=e.sample.pts,g+=e.length,o=g):g=l}else P.canParse(A,g)?(E=P.getID3Data(A,g),p.samples.push({pts:f,dts:f,data:E}),g+=E.length,o=g):g++;if(g===l&&o!==l){var a=Object(_.sliceUint8)(A,o);this.cachedData?this.cachedData=Object(w.appendUint8Array)(this.cachedData,a):this.cachedData=a}}return{audioTrack:r,avcTrack:Object(O.dummyTrack)(),id3Track:p,textTrack:Object(O.dummyTrack)()}},D.demuxSampleAes=function(A,L,E){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},D.flush=function(A){var L=this.cachedData;return L&&(this.cachedData=null,this.demux(L,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(O.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(O.dummyTrack)()}},D.destroy=function(){},T}(),C=function(D,c){return Object(B.isFiniteNumber)(D)?D*90:c*9e4};M.default=R},"./src/demux/chunk-cache.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return B});var B=function(){function O(){this.chunks=[],this.dataLength=0}var w=O.prototype;return w.push=function(R){this.chunks.push(R),this.dataLength+=R.length},w.flush=function(){var R=this.chunks,C=this.dataLength,T;if(R.length)R.length===1?T=R[0]:T=P(R,C);else return new Uint8Array(0);return this.reset(),T},w.reset=function(){this.chunks.length=0,this.dataLength=0},O}();function P(O,w){for(var _=new Uint8Array(w),R=0,C=0;C<O.length;C++){var T=O[C];_.set(T,R),R+=T.length}return _}},"./src/demux/dummy-demuxed-track.ts":function(K,M,S){S.r(M),S.d(M,"dummyTrack",function(){return B});function B(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(K,M,S){S.r(M);var B=S("./src/utils/logger.ts"),P=function(){function O(_){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=_,this.bytesAvailable=_.byteLength,this.word=0,this.bitsAvailable=0}var w=O.prototype;return w.loadWord=function(){var R=this.data,C=this.bytesAvailable,T=R.byteLength-C,D=new Uint8Array(4),c=Math.min(4,C);if(c===0)throw new Error("no bytes available");D.set(R.subarray(T,T+c)),this.word=new DataView(D.buffer).getUint32(0),this.bitsAvailable=c*8,this.bytesAvailable-=c},w.skipBits=function(R){var C;this.bitsAvailable>R?(this.word<<=R,this.bitsAvailable-=R):(R-=this.bitsAvailable,C=R>>3,R-=C>>3,this.bytesAvailable-=C,this.loadWord(),this.word<<=R,this.bitsAvailable-=R)},w.readBits=function(R){var C=Math.min(this.bitsAvailable,R),T=this.word>>>32-C;return R>32&&B.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=C,this.bitsAvailable>0?this.word<<=C:this.bytesAvailable>0&&this.loadWord(),C=R-C,C>0&&this.bitsAvailable?T<<C|this.readBits(C):T},w.skipLZ=function(){var R;for(R=0;R<this.bitsAvailable;++R)if((this.word&2147483648>>>R)!==0)return this.word<<=R,this.bitsAvailable-=R,R;return this.loadWord(),R+this.skipLZ()},w.skipUEG=function(){this.skipBits(1+this.skipLZ())},w.skipEG=function(){this.skipBits(1+this.skipLZ())},w.readUEG=function(){var R=this.skipLZ();return this.readBits(R+1)-1},w.readEG=function(){var R=this.readUEG();return 1&R?1+R>>>1:-1*(R>>>1)},w.readBoolean=function(){return this.readBits(1)===1},w.readUByte=function(){return this.readBits(8)},w.readUShort=function(){return this.readBits(16)},w.readUInt=function(){return this.readBits(32)},w.skipScalingList=function(R){for(var C=8,T=8,D,c=0;c<R;c++)T!==0&&(D=this.readEG(),T=(C+D+256)%256),C=T===0?C:T},w.readSPS=function(){var R=0,C=0,T=0,D=0,c,A,L,E=this.readUByte.bind(this),g=this.readBits.bind(this),o=this.readUEG.bind(this),f=this.readBoolean.bind(this),r=this.skipBits.bind(this),p=this.skipEG.bind(this),m=this.skipUEG.bind(this),l=this.skipScalingList.bind(this);E();var e=E();if(g(5),r(3),E(),m(),e===100||e===110||e===122||e===244||e===44||e===83||e===86||e===118||e===128){var a=o();if(a===3&&r(1),m(),m(),r(1),f())for(A=a!==3?8:12,L=0;L<A;L++)f()&&(L<6?l(16):l(64))}m();var h=o();if(h===0)o();else if(h===1)for(r(1),p(),p(),c=o(),L=0;L<c;L++)p();m(),r(1);var u=o(),t=o(),n=g(1);n===0&&r(1),r(1),f()&&(R=o(),C=o(),T=o(),D=o());var v=[1,1];if(f()&&f()){var y=E();switch(y){case 1:v=[1,1];break;case 2:v=[12,11];break;case 3:v=[10,11];break;case 4:v=[16,11];break;case 5:v=[40,33];break;case 6:v=[24,11];break;case 7:v=[20,11];break;case 8:v=[32,11];break;case 9:v=[80,33];break;case 10:v=[18,11];break;case 11:v=[15,11];break;case 12:v=[64,33];break;case 13:v=[160,99];break;case 14:v=[4,3];break;case 15:v=[3,2];break;case 16:v=[2,1];break;case 255:{v=[E()<<8|E(),E()<<8|E()];break}}}return{width:Math.ceil((u+1)*16-R*2-C*2),height:(2-n)*(t+1)*16-(n?2:4)*(T+D),pixelRatio:v}},w.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},O}();M.default=P},"./src/demux/id3.ts":function(K,M,S){S.r(M),S.d(M,"isHeader",function(){return B}),S.d(M,"isFooter",function(){return P}),S.d(M,"getID3Data",function(){return O}),S.d(M,"canParse",function(){return _}),S.d(M,"getTimeStamp",function(){return R}),S.d(M,"isTimeStampFrame",function(){return C}),S.d(M,"getID3Frames",function(){return D}),S.d(M,"decodeFrame",function(){return c}),S.d(M,"utf8ArrayToStr",function(){return o}),S.d(M,"testables",function(){return f});var B=function(l,e){return e+10<=l.length&&l[e]===73&&l[e+1]===68&&l[e+2]===51&&l[e+3]<255&&l[e+4]<255&&l[e+6]<128&&l[e+7]<128&&l[e+8]<128&&l[e+9]<128},P=function(l,e){return e+10<=l.length&&l[e]===51&&l[e+1]===68&&l[e+2]===73&&l[e+3]<255&&l[e+4]<255&&l[e+6]<128&&l[e+7]<128&&l[e+8]<128&&l[e+9]<128},O=function(l,e){for(var a=e,h=0;B(l,e);){h+=10;var u=w(l,e+6);h+=u,P(l,e+10)&&(h+=10),e+=h}if(h>0)return l.subarray(a,a+h)},w=function(l,e){var a=0;return a=(l[e]&127)<<21,a|=(l[e+1]&127)<<14,a|=(l[e+2]&127)<<7,a|=l[e+3]&127,a},_=function(l,e){return B(l,e)&&w(l,e+6)+10<=l.length-e},R=function(l){for(var e=D(l),a=0;a<e.length;a++){var h=e[a];if(C(h))return g(h)}},C=function(l){return l&&l.key==="PRIV"&&l.info==="com.apple.streaming.transportStreamTimestamp"},T=function(l){var e=String.fromCharCode(l[0],l[1],l[2],l[3]),a=w(l,4),h=10;return{type:e,size:a,data:l.subarray(h,h+a)}},D=function(l){for(var e=0,a=[];B(l,e);){var h=w(l,e+6);e+=10;for(var u=e+h;e+8<u;){var t=T(l.subarray(e)),n=c(t);n&&a.push(n),e+=t.size+10}P(l,e)&&(e+=10)}return a},c=function(l){return l.type==="PRIV"?A(l):l.type[0]==="W"?E(l):L(l)},A=function(l){if(!(l.size<2)){var e=o(l.data,!0),a=new Uint8Array(l.data.subarray(e.length+1));return{key:l.type,info:e,data:a.buffer}}},L=function(l){if(!(l.size<2)){if(l.type==="TXXX"){var e=1,a=o(l.data.subarray(e),!0);e+=a.length+1;var h=o(l.data.subarray(e));return{key:l.type,info:a,data:h}}var u=o(l.data.subarray(1));return{key:l.type,data:u}}},E=function(l){if(l.type==="WXXX"){if(l.size<2)return;var e=1,a=o(l.data.subarray(e),!0);e+=a.length+1;var h=o(l.data.subarray(e));return{key:l.type,info:a,data:h}}var u=o(l.data);return{key:l.type,data:u}},g=function(l){if(l.data.byteLength===8){var e=new Uint8Array(l.data),a=e[3]&1,h=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return h/=45,a&&(h+=4772185884e-2),Math.round(h)}},o=function(l,e){e===void 0&&(e=!1);var a=p();if(a){var h=a.decode(l);if(e){var u=h.indexOf("\0");return u!==-1?h.substring(0,u):h}return h.replace(/\0/g,"")}for(var t=l.length,n,v,y,x="",I=0;I<t;){if(n=l[I++],n===0&&e)return x;if(n===0||n===3)continue;switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:x+=String.fromCharCode(n);break;case 12:case 13:v=l[I++],x+=String.fromCharCode((n&31)<<6|v&63);break;case 14:v=l[I++],y=l[I++],x+=String.fromCharCode((n&15)<<12|(v&63)<<6|(y&63)<<0);break}}return x},f={decodeTextFrame:L},r;function p(){return!r&&typeof self.TextDecoder!="undefined"&&(r=new self.TextDecoder("utf-8")),r}},"./src/demux/mp3demuxer.ts":function(K,M,S){S.r(M);var B=S("./src/demux/base-audio-demuxer.ts"),P=S("./src/demux/id3.ts"),O=S("./src/utils/logger.ts"),w=S("./src/demux/mpegaudio.ts");function _(T,D){T.prototype=Object.create(D.prototype),T.prototype.constructor=T,R(T,D)}function R(T,D){return R=Object.setPrototypeOf||function(A,L){return A.__proto__=L,A},R(T,D)}var C=function(T){_(D,T);function D(){return T.apply(this,arguments)||this}var c=D.prototype;return c.resetInitSegment=function(L,E,g){T.prototype.resetInitSegment.call(this,L,E,g),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:L,duration:g,inputTimeScale:9e4,dropped:0}},D.probe=function(L){if(!L)return!1;for(var E=P.getID3Data(L,0)||[],g=E.length,o=L.length;g<o;g++)if(w.probe(L,g))return O.logger.log("MPEG Audio sync word found !"),!0;return!1},c.canParse=function(L,E){return w.canParse(L,E)},c.appendFrame=function(L,E,g){if(this.initPTS!==null)return w.appendFrame(L,E,g,this.initPTS,this.frameIndex)},D}(B.default);C.minProbeByteLength=4,M.default=C},"./src/demux/mp4demuxer.ts":function(K,M,S){S.r(M);var B=S("./src/utils/mp4-tools.ts"),P=S("./src/demux/dummy-demuxed-track.ts"),O=function(){function w(R,C){this.remainderData=null,this.config=void 0,this.config=C}var _=w.prototype;return _.resetTimeStamp=function(){},_.resetInitSegment=function(){},_.resetContiguity=function(){},w.probe=function(C){return Object(B.findBox)({data:C,start:0,end:Math.min(C.length,16384)},["moof"]).length>0},_.demux=function(C){var T=C,D=Object(P.dummyTrack)();if(this.config.progressive){this.remainderData&&(T=Object(B.appendUint8Array)(this.remainderData,C));var c=Object(B.segmentValidRange)(T);this.remainderData=c.remainder,D.samples=c.valid||new Uint8Array}else D.samples=T;return{audioTrack:Object(P.dummyTrack)(),avcTrack:D,id3Track:Object(P.dummyTrack)(),textTrack:Object(P.dummyTrack)()}},_.flush=function(){var C=Object(P.dummyTrack)();return C.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(P.dummyTrack)(),avcTrack:C,id3Track:Object(P.dummyTrack)(),textTrack:Object(P.dummyTrack)()}},_.demuxSampleAes=function(C,T,D){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},_.destroy=function(){},w}();O.minProbeByteLength=1024,M.default=O},"./src/demux/mpegaudio.ts":function(K,M,S){S.r(M),S.d(M,"appendFrame",function(){return R}),S.d(M,"parseHeader",function(){return C}),S.d(M,"isHeaderPattern",function(){return T}),S.d(M,"isHeader",function(){return D}),S.d(M,"canParse",function(){return c}),S.d(M,"probe",function(){return A});var B=null,P=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],O=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],w=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],_=[0,1,1,4];function R(L,E,g,o,f){if(!(g+24>E.length)){var r=C(E,g);if(r&&g+r.frameLength<=E.length){var p=r.samplesPerFrame*9e4/r.sampleRate,m=o+f*p,l={unit:E.subarray(g,g+r.frameLength),pts:m,dts:m};return L.config=[],L.channelCount=r.channelCount,L.samplerate=r.sampleRate,L.samples.push(l),{sample:l,length:r.frameLength,missing:0}}}}function C(L,E){var g=L[E+1]>>3&3,o=L[E+1]>>1&3,f=L[E+2]>>4&15,r=L[E+2]>>2&3;if(g!==1&&f!==0&&f!==15&&r!==3){var p=L[E+2]>>1&1,m=L[E+3]>>6,l=g===3?3-o:o===3?3:4,e=P[l*14+f-1]*1e3,a=g===3?0:g===2?1:2,h=O[a*3+r],u=m===3?1:2,t=w[g][o],n=_[o],v=t*8*n,y=Math.floor(t*e/h+p)*n;if(B===null){var x=navigator.userAgent||"",I=x.match(/Chrome\/(\d+)/i);B=I?parseInt(I[1]):0}var F=!!B&&B<=87;return F&&o===2&&e>=224e3&&m===0&&(L[E+3]=L[E+3]|128),{sampleRate:h,channelCount:u,frameLength:y,samplesPerFrame:v}}}function T(L,E){return L[E]===255&&(L[E+1]&224)===224&&(L[E+1]&6)!==0}function D(L,E){return E+1<L.length&&T(L,E)}function c(L,E){var g=4;return T(L,E)&&g<=L.length-E}function A(L,E){if(E+1<L.length&&T(L,E)){var g=4,o=C(L,E),f=g;o!=null&&o.frameLength&&(f=o.frameLength);var r=E+f;return r===L.length||D(L,r)}return!1}},"./src/demux/sample-aes.ts":function(K,M,S){S.r(M);var B=S("./src/crypt/decrypter.ts"),P=S("./src/demux/tsdemuxer.ts"),O=function(){function w(R,C,T){this.keyData=void 0,this.decrypter=void 0,this.keyData=T,this.decrypter=new B.default(R,C,{removePKCS7Padding:!1})}var _=w.prototype;return _.decryptBuffer=function(C,T){this.decrypter.decrypt(C,this.keyData.key.buffer,this.keyData.iv.buffer,T)},_.decryptAacSample=function(C,T,D,c){var A=C[T].unit,L=A.subarray(16,A.length-A.length%16),E=L.buffer.slice(L.byteOffset,L.byteOffset+L.length),g=this;this.decryptBuffer(E,function(o){var f=new Uint8Array(o);A.set(f,16),c||g.decryptAacSamples(C,T+1,D)})},_.decryptAacSamples=function(C,T,D){for(;;T++){if(T>=C.length){D();return}if(!(C[T].unit.length<32)){var c=this.decrypter.isSync();if(this.decryptAacSample(C,T,D,c),!c)return}}},_.getAvcEncryptedData=function(C){for(var T=Math.floor((C.length-48)/160)*16+16,D=new Int8Array(T),c=0,A=32;A<C.length-16;A+=160,c+=16)D.set(C.subarray(A,A+16),c);return D},_.getAvcDecryptedUnit=function(C,T){for(var D=new Uint8Array(T),c=0,A=32;A<C.length-16;A+=160,c+=16)C.set(D.subarray(c,c+16),A);return C},_.decryptAvcSample=function(C,T,D,c,A,L){var E=Object(P.discardEPB)(A.data),g=this.getAvcEncryptedData(E),o=this;this.decryptBuffer(g.buffer,function(f){A.data=o.getAvcDecryptedUnit(E,f),L||o.decryptAvcSamples(C,T,D+1,c)})},_.decryptAvcSamples=function(C,T,D,c){if(C instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;T++,D=0){if(T>=C.length){c();return}for(var A=C[T].units;!(D>=A.length);D++){var L=A[D];if(!(L.data.length<=48||L.type!==1&&L.type!==5)){var E=this.decrypter.isSync();if(this.decryptAvcSample(C,T,D,c,L,E),!E)return}}}},w}();M.default=O},"./src/demux/transmuxer-interface.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return D});var B=S("./node_modules/webworkify-webpack/index.js"),P=S("./src/events.ts"),O=S("./src/demux/transmuxer.ts"),w=S("./src/utils/logger.ts"),_=S("./src/errors.ts"),R=S("./src/utils/mediasource-helper.ts"),C=S("./node_modules/eventemitter3/index.js"),T=Object(R.getMediaSource)()||{isTypeSupported:function(){return!1}},D=function(){function c(L,E,g,o){var f=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=L,this.id=E,this.onTransmuxComplete=g,this.onFlush=o;var r=L.config,p=function(h,u){u=u||{},u.frag=f.frag,u.id=f.id,L.trigger(h,u)};this.observer=new C.EventEmitter,this.observer.on(P.Events.FRAG_DECRYPTED,p),this.observer.on(P.Events.ERROR,p);var m={mp4:T.isTypeSupported("video/mp4"),mpeg:T.isTypeSupported("audio/mpeg"),mp3:T.isTypeSupported('audio/mp4; codecs="mp3"')},l=navigator.vendor;if(r.enableWorker&&typeof Worker!="undefined"){w.logger.log("demuxing in webworker");var e;try{e=this.worker=B("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),e.addEventListener("message",this.onwmsg),e.onerror=function(a){L.trigger(P.Events.ERROR,{type:_.ErrorTypes.OTHER_ERROR,details:_.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(a.message+"  ("+a.filename+":"+a.lineno+")")})},e.postMessage({cmd:"init",typeSupported:m,vendor:l,id:E,config:JSON.stringify(r)})}catch(a){w.logger.warn("Error in worker:",a),w.logger.error("Error while initializing DemuxerWorker, fallback to inline"),e&&self.URL.revokeObjectURL(e.objectURL),this.transmuxer=new O.default(this.observer,m,r,l,E),this.worker=null}}else this.transmuxer=new O.default(this.observer,m,r,l,E)}var A=c.prototype;return A.destroy=function(){var E=this.worker;if(E)E.removeEventListener("message",this.onwmsg),E.terminate(),this.worker=null;else{var g=this.transmuxer;g&&(g.destroy(),this.transmuxer=null)}var o=this.observer;o&&o.removeAllListeners(),this.observer=null},A.push=function(E,g,o,f,r,p,m,l,e,a){var h,u,t=this;e.transmuxing.start=self.performance.now();var n=this.transmuxer,v=this.worker,y=p?p.start:r.start,x=r.decryptdata,I=this.frag,F=!(I&&r.cc===I.cc),U=!(I&&e.level===I.level),k=I?e.sn-I.sn:-1,$=this.part?e.part-this.part.index:1,W=!U&&(k===1||k===0&&$===1),G=self.performance.now();(U||k||r.stats.parsing.start===0)&&(r.stats.parsing.start=G),p&&($||!W)&&(p.stats.parsing.start=G);var H=!(I&&((h=r.initSegment)===null||h===void 0?void 0:h.url)===((u=I.initSegment)===null||u===void 0?void 0:u.url)),z=new O.TransmuxState(F,W,l,U,y,H);if(!W||F||H){w.logger.log("[transmuxer-interface, "+r.type+"]: Starting new transmux session for sn: "+e.sn+" p: "+e.part+" level: "+e.level+" id: "+e.id+`
        discontinuity: `+F+`
        trackSwitch: `+U+`
        contiguous: `+W+`
        accurateTimeOffset: `+l+`
        timeOffset: `+y+`
        initSegmentChange: `+H);var V=new O.TransmuxConfig(o,f,g,m,a);this.configureTransmuxer(V)}if(this.frag=r,this.part=p,v)v.postMessage({cmd:"demux",data:E,decryptdata:x,chunkMeta:e,state:z},E instanceof ArrayBuffer?[E]:[]);else if(n){var Y=n.push(E,x,e,z);Object(O.isPromise)(Y)?Y.then(function(Q){t.handleTransmuxComplete(Q)}):this.handleTransmuxComplete(Y)}},A.flush=function(E){var g=this;E.transmuxing.start=self.performance.now();var o=this.transmuxer,f=this.worker;if(f)f.postMessage({cmd:"flush",chunkMeta:E});else if(o){var r=o.flush(E);Object(O.isPromise)(r)?r.then(function(p){g.handleFlushResult(p,E)}):this.handleFlushResult(r,E)}},A.handleFlushResult=function(E,g){var o=this;E.forEach(function(f){o.handleTransmuxComplete(f)}),this.onFlush(g)},A.onWorkerMessage=function(E){var g=E.data,o=this.hls;switch(g.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(g.data);break}case"flush":{this.onFlush(g.data);break}default:{g.data=g.data||{},g.data.frag=this.frag,g.data.id=this.id,o.trigger(g.event,g.data);break}}},A.configureTransmuxer=function(E){var g=this.worker,o=this.transmuxer;g?g.postMessage({cmd:"configure",config:E}):o&&o.configure(E)},A.handleTransmuxComplete=function(E){E.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(E)},c}()},"./src/demux/transmuxer-worker.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return _});var B=S("./src/demux/transmuxer.ts"),P=S("./src/events.ts"),O=S("./src/utils/logger.ts"),w=S("./node_modules/eventemitter3/index.js");function _(c){var A=new w.EventEmitter,L=function(g,o){c.postMessage({event:g,data:o})};A.on(P.Events.FRAG_DECRYPTED,L),A.on(P.Events.ERROR,L),c.addEventListener("message",function(E){var g=E.data;switch(g.cmd){case"init":{var o=JSON.parse(g.config);c.transmuxer=new B.default(A,g.typeSupported,o,g.vendor,g.id),Object(O.enableLogs)(o.debug),L("init",null);break}case"configure":{c.transmuxer.configure(g.config);break}case"demux":{var f=c.transmuxer.push(g.data,g.decryptdata,g.chunkMeta,g.state);Object(B.isPromise)(f)?f.then(function(m){R(c,m)}):R(c,f);break}case"flush":{var r=g.chunkMeta,p=c.transmuxer.flush(r);Object(B.isPromise)(p)?p.then(function(m){T(c,m,r)}):T(c,p,r);break}}})}function R(c,A){if(!D(A.remuxResult)){var L=[],E=A.remuxResult,g=E.audio,o=E.video;g&&C(L,g),o&&C(L,o),c.postMessage({event:"transmuxComplete",data:A},L)}}function C(c,A){A.data1&&c.push(A.data1.buffer),A.data2&&c.push(A.data2.buffer)}function T(c,A,L){A.forEach(function(E){R(c,E)}),c.postMessage({event:"flush",data:L})}function D(c){return!c.audio&&!c.video&&!c.text&&!c.id3&&!c.initSegment}},"./src/demux/transmuxer.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return f}),S.d(M,"isPromise",function(){return m}),S.d(M,"TransmuxConfig",function(){return l}),S.d(M,"TransmuxState",function(){return e});var B=S("./src/events.ts"),P=S("./src/errors.ts"),O=S("./src/crypt/decrypter.ts"),w=S("./src/demux/aacdemuxer.ts"),_=S("./src/demux/mp4demuxer.ts"),R=S("./src/demux/tsdemuxer.ts"),C=S("./src/demux/mp3demuxer.ts"),T=S("./src/remux/mp4-remuxer.ts"),D=S("./src/remux/passthrough-remuxer.ts"),c=S("./src/demux/chunk-cache.ts"),A=S("./src/utils/mp4-tools.ts"),L=S("./src/utils/logger.ts"),E;try{E=self.performance.now.bind(self.performance)}catch{L.logger.debug("Unable to use Performance API on this environment"),E=self.Date.now}var g=[{demux:R.default,remux:T.default},{demux:_.default,remux:D.default},{demux:w.default,remux:T.default},{demux:C.default,remux:T.default}],o=1024;g.forEach(function(a){var h=a.demux;o=Math.max(o,h.minProbeByteLength)});var f=function(){function a(u,t,n,v,y){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new c.default,this.observer=u,this.typeSupported=t,this.config=n,this.vendor=v,this.id=y}var h=a.prototype;return h.configure=function(t){this.transmuxConfig=t,this.decrypter&&this.decrypter.reset()},h.push=function(t,n,v,y){var x=this,I=v.transmuxing;I.executeStart=E();var F=new Uint8Array(t),U=this.cache,k=this.config,$=this.currentTransmuxState,W=this.transmuxConfig;y&&(this.currentTransmuxState=y);var G=r(F,n);if(G&&G.method==="AES-128"){var H=this.getDecrypter();if(k.enableSoftwareAES){var z=H.softwareDecrypt(F,G.key.buffer,G.iv.buffer);if(!z)return I.executeEnd=E(),p(v);F=new Uint8Array(z)}else return this.decryptionPromise=H.webCryptoDecrypt(F,G.key.buffer,G.iv.buffer).then(function(le){var fe=x.push(le,null,v);return x.decryptionPromise=null,fe}),this.decryptionPromise}var V=y||$,Y=V.contiguous,Q=V.discontinuity,X=V.trackSwitch,q=V.accurateTimeOffset,J=V.timeOffset,Z=V.initSegmentChange,ee=W.audioCodec,te=W.videoCodec,re=W.defaultInitPts,ne=W.duration,se=W.initSegmentData;if((Q||X||Z)&&this.resetInitSegment(se,ee,te,ne),(Q||Z)&&this.resetInitialTimestamp(re),Y||this.resetContiguity(),this.needsProbing(F,Q,X)){if(U.dataLength){var ie=U.flush();F=Object(A.appendUint8Array)(ie,F)}this.configureTransmuxer(F,W)}var oe=this.transmux(F,G,J,q,v),de=this.currentTransmuxState;return de.contiguous=!0,de.discontinuity=!1,de.trackSwitch=!1,I.executeEnd=E(),oe},h.flush=function(t){var n=this,v=t.transmuxing;v.executeStart=E();var y=this.decrypter,x=this.cache,I=this.currentTransmuxState,F=this.decryptionPromise;if(F)return F.then(function(){return n.flush(t)});var U=[],k=I.timeOffset;if(y){var $=y.flush();$&&U.push(this.push($,null,t))}var W=x.dataLength;x.reset();var G=this.demuxer,H=this.remuxer;if(!G||!H)return W>=o&&this.observer.emit(B.Events.ERROR,B.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),v.executeEnd=E(),[p(t)];var z=G.flush(k);return m(z)?z.then(function(V){return n.flushRemux(U,V,t),U}):(this.flushRemux(U,z,t),U)},h.flushRemux=function(t,n,v){var y=n.audioTrack,x=n.avcTrack,I=n.id3Track,F=n.textTrack,U=this.currentTransmuxState,k=U.accurateTimeOffset,$=U.timeOffset;L.logger.log("[transmuxer.ts]: Flushed fragment "+v.sn+(v.part>-1?" p: "+v.part:"")+" of level "+v.level);var W=this.remuxer.remux(y,x,I,F,$,k,!0,this.id);t.push({remuxResult:W,chunkMeta:v}),v.transmuxing.executeEnd=E()},h.resetInitialTimestamp=function(t){var n=this.demuxer,v=this.remuxer;!n||!v||(n.resetTimeStamp(t),v.resetTimeStamp(t))},h.resetContiguity=function(){var t=this.demuxer,n=this.remuxer;!t||!n||(t.resetContiguity(),n.resetNextTimestamp())},h.resetInitSegment=function(t,n,v,y){var x=this.demuxer,I=this.remuxer;!x||!I||(x.resetInitSegment(n,v,y),I.resetInitSegment(t,n,v))},h.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},h.transmux=function(t,n,v,y,x){var I;return n&&n.method==="SAMPLE-AES"?I=this.transmuxSampleAes(t,n,v,y,x):I=this.transmuxUnencrypted(t,v,y,x),I},h.transmuxUnencrypted=function(t,n,v,y){var x=this.demuxer.demux(t,n,!1,!this.config.progressive),I=x.audioTrack,F=x.avcTrack,U=x.id3Track,k=x.textTrack,$=this.remuxer.remux(I,F,U,k,n,v,!1,this.id);return{remuxResult:$,chunkMeta:y}},h.transmuxSampleAes=function(t,n,v,y,x){var I=this;return this.demuxer.demuxSampleAes(t,n,v).then(function(F){var U=I.remuxer.remux(F.audioTrack,F.avcTrack,F.id3Track,F.textTrack,v,y,!1,I.id);return{remuxResult:U,chunkMeta:x}})},h.configureTransmuxer=function(t,n){for(var v=this.config,y=this.observer,x=this.typeSupported,I=this.vendor,F=n.audioCodec,U=n.defaultInitPts,k=n.duration,$=n.initSegmentData,W=n.videoCodec,G,H=0,z=g.length;H<z;H++)if(g[H].demux.probe(t)){G=g[H];break}G||(L.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),G={demux:_.default,remux:D.default});var V=this.demuxer,Y=this.remuxer,Q=G.remux,X=G.demux;(!Y||!(Y instanceof Q))&&(this.remuxer=new Q(y,v,x,I)),(!V||!(V instanceof X))&&(this.demuxer=new X(y,v,x),this.probe=X.probe),this.resetInitSegment($,F,W,k),this.resetInitialTimestamp(U)},h.needsProbing=function(t,n,v){return!this.demuxer||!this.remuxer||n||v},h.getDecrypter=function(){var t=this.decrypter;return t||(t=this.decrypter=new O.default(this.observer,this.config)),t},a}();function r(a,h){var u=null;return a.byteLength>0&&h!=null&&h.key!=null&&h.iv!==null&&h.method!=null&&(u=h),u}var p=function(h){return{remuxResult:{},chunkMeta:h}};function m(a){return"then"in a&&a.then instanceof Function}var l=function(h,u,t,n,v){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=h,this.videoCodec=u,this.initSegmentData=t,this.duration=n,this.defaultInitPts=v},e=function(h,u,t,n,v,y){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=h,this.contiguous=u,this.accurateTimeOffset=t,this.trackSwitch=n,this.timeOffset=v,this.initSegmentChange=y}},"./src/demux/tsdemuxer.ts":function(K,M,S){S.r(M),S.d(M,"discardEPB",function(){return p});var B=S("./src/demux/adts.ts"),P=S("./src/demux/mpegaudio.ts"),O=S("./src/demux/exp-golomb.ts"),w=S("./src/demux/id3.ts"),_=S("./src/demux/sample-aes.ts"),R=S("./src/events.ts"),C=S("./src/utils/mp4-tools.ts"),T=S("./src/utils/logger.ts"),D=S("./src/errors.ts"),c={video:1,audio:2,id3:3,text:4},A=function(){function m(e,a,h){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=a,this.typeSupported=h}m.probe=function(a){var h=m.syncOffset(a);return h<0?!1:(h&&T.logger.warn("MPEG2-TS detected but first sync word found @ offset "+h+", junk ahead ?"),!0)},m.syncOffset=function(a){for(var h=Math.min(1e3,a.length-564),u=0;u<h;){if(a[u]===71&&a[u+188]===71&&a[u+2*188]===71)return u;u++}return-1},m.createTrack=function(a,h){return{container:a==="video"||a==="audio"?"video/mp2t":void 0,type:a,id:c[a],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:a==="audio"?h:void 0}};var l=m.prototype;return l.resetInitSegment=function(a,h,u){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=m.createTrack("video",u),this._audioTrack=m.createTrack("audio",u),this._id3Track=m.createTrack("id3",u),this._txtTrack=m.createTrack("text",u),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=a,this.videoCodec=h,this._duration=u},l.resetTimeStamp=function(){},l.resetContiguity=function(){var a=this._audioTrack,h=this._avcTrack,u=this._id3Track;a&&(a.pesData=null),h&&(h.pesData=null),u&&(u.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},l.demux=function(a,h,u,t){u===void 0&&(u=!1),t===void 0&&(t=!1),u||(this.sampleAes=null);var n,v=this._avcTrack,y=this._audioTrack,x=this._id3Track,I=v.pid,F=v.pesData,U=y.pid,k=x.pid,$=y.pesData,W=x.pesData,G=!1,H=this.pmtParsed,z=this._pmtId,V=a.length;if(this.remainderData&&(a=Object(C.appendUint8Array)(this.remainderData,a),V=a.length,this.remainderData=null),V<188&&!t)return this.remainderData=a,{audioTrack:y,avcTrack:v,id3Track:x,textTrack:this._txtTrack};var Y=Math.max(0,m.syncOffset(a));V-=(V+Y)%188,V<a.byteLength&&!t&&(this.remainderData=new Uint8Array(a.buffer,V,a.buffer.byteLength-V));for(var Q=0,X=Y;X<V;X+=188)if(a[X]===71){var q=!!(a[X+1]&64),J=((a[X+1]&31)<<8)+a[X+2],Z=(a[X+3]&48)>>4,ee=void 0;if(Z>1){if(ee=X+5+a[X+4],ee===X+188)continue}else ee=X+4;switch(J){case I:q&&(F&&(n=o(F))&&this.parseAVCPES(n,!1),F={data:[],size:0}),F&&(F.data.push(a.subarray(ee,X+188)),F.size+=X+188-ee);break;case U:q&&($&&(n=o($))&&(y.isAAC?this.parseAACPES(n):this.parseMPEGPES(n)),$={data:[],size:0}),$&&($.data.push(a.subarray(ee,X+188)),$.size+=X+188-ee);break;case k:q&&(W&&(n=o(W))&&this.parseID3PES(n),W={data:[],size:0}),W&&(W.data.push(a.subarray(ee,X+188)),W.size+=X+188-ee);break;case 0:q&&(ee+=a[ee]+1),z=this._pmtId=E(a,ee);break;case z:{q&&(ee+=a[ee]+1);var te=g(a,ee,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,u);I=te.avc,I>0&&(v.pid=I),U=te.audio,U>0&&(y.pid=U,y.isAAC=te.isAAC),k=te.id3,k>0&&(x.pid=k),G&&!H&&(T.logger.log("reparse from beginning"),G=!1,X=Y-188),H=this.pmtParsed=!0;break}case 17:case 8191:break;default:G=!0;break}}else Q++;Q>0&&this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+Q+" TS packet/s that do not start with 0x47"}),v.pesData=F,y.pesData=$,x.pesData=W;var re={audioTrack:y,avcTrack:v,id3Track:x,textTrack:this._txtTrack};return t&&this.extractRemainingSamples(re),re},l.flush=function(){var a=this.remainderData;this.remainderData=null;var h;return a?h=this.demux(a,-1,!1,!0):h={audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(h),this.sampleAes?this.decrypt(h,this.sampleAes):h},l.extractRemainingSamples=function(a){var h=a.audioTrack,u=a.avcTrack,t=a.id3Track,n=u.pesData,v=h.pesData,y=t.pesData,x;n&&(x=o(n))?(this.parseAVCPES(x,!0),u.pesData=null):u.pesData=n,v&&(x=o(v))?(h.isAAC?this.parseAACPES(x):this.parseMPEGPES(x),h.pesData=null):(v!=null&&v.size&&T.logger.log("last AAC PES packet truncated,might overlap between fragments"),h.pesData=v),y&&(x=o(y))?(this.parseID3PES(x),t.pesData=null):t.pesData=y},l.demuxSampleAes=function(a,h,u){var t=this.demux(a,u,!0,!this.config.progressive),n=this.sampleAes=new _.default(this.observer,this.config,h);return this.decrypt(t,n)},l.decrypt=function(a,h){return new Promise(function(u){var t=a.audioTrack,n=a.avcTrack;t.samples&&t.isAAC?h.decryptAacSamples(t.samples,0,function(){n.samples?h.decryptAvcSamples(n.samples,0,0,function(){u(a)}):u(a)}):n.samples&&h.decryptAvcSamples(n.samples,0,0,function(){u(a)})})},l.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},l.parseAVCPES=function(a,h){var u=this,t=this._avcTrack,n=this.parseAVCNALu(a.data),v=this.avcSample,y,x=!1;a.data=null,v&&n.length&&!t.audFound&&(f(v,t),v=this.avcSample=L(!1,a.pts,a.dts,"")),n.forEach(function(I){switch(I.type){case 1:{y=!0,v||(v=u.avcSample=L(!0,a.pts,a.dts,"")),v.frame=!0;var F=I.data;if(x&&F.length>4){var U=new O.default(F).readSliceType();(U===2||U===4||U===7||U===9)&&(v.key=!0)}break}case 5:y=!0,v||(v=u.avcSample=L(!0,a.pts,a.dts,"")),v.key=!0,v.frame=!0;break;case 6:{y=!0;var k=new O.default(p(I.data));k.readUByte();for(var $=0,W=0,G=!1,H=0;!G&&k.bytesAvailable>1;){$=0;do H=k.readUByte(),$+=H;while(H===255);W=0;do H=k.readUByte(),W+=H;while(H===255);if($===4&&k.bytesAvailable!==0){G=!0;var z=k.readUByte();if(z===181){var V=k.readUShort();if(V===49){var Y=k.readUInt();if(Y===1195456820){var Q=k.readUByte();if(Q===3){for(var X=k.readUByte(),q=k.readUByte(),J=31&X,Z=[X,q],ee=0;ee<J;ee++)Z.push(k.readUByte()),Z.push(k.readUByte()),Z.push(k.readUByte());r(u._txtTrack.samples,{type:3,pts:a.pts,bytes:Z})}}}}}else if($===5&&k.bytesAvailable!==0){if(G=!0,W>16){for(var te=[],re=0;re<16;re++)te.push(k.readUByte().toString(16)),(re===3||re===5||re===7||re===9)&&te.push("-");for(var ne=W-16,se=new Uint8Array(ne),ie=0;ie<ne;ie++)se[ie]=k.readUByte();r(u._txtTrack.samples,{pts:a.pts,payloadType:$,uuid:te.join(""),userData:Object(w.utf8ArrayToStr)(se),userDataBytes:se})}}else if(W<k.bytesAvailable)for(var oe=0;oe<W;oe++)k.readUByte()}break}case 7:if(y=!0,x=!0,!t.sps){var de=new O.default(I.data),le=de.readSPS();t.width=le.width,t.height=le.height,t.pixelRatio=le.pixelRatio,t.sps=[I.data],t.duration=u._duration;for(var fe=I.data.subarray(1,4),ue="avc1.",ce=0;ce<3;ce++){var ae=fe[ce].toString(16);ae.length<2&&(ae="0"+ae),ue+=ae}t.codec=ue}break;case 8:y=!0,t.pps||(t.pps=[I.data]);break;case 9:y=!1,t.audFound=!0,v&&f(v,t),v=u.avcSample=L(!1,a.pts,a.dts,"");break;case 12:y=!1;break;default:y=!1,v&&(v.debug+="unknown NAL "+I.type+" ");break}if(v&&y){var xe=v.units;xe.push(I)}}),h&&v&&(f(v,t),this.avcSample=null)},l.getLastNalUnit=function(){var a,h=this.avcSample,u;if(!h||h.units.length===0){var t=this._avcTrack.samples;h=t[t.length-1]}if((a=h)!==null&&a!==void 0&&a.units){var n=h.units;u=n[n.length-1]}return u},l.parseAVCNALu=function(a){var h=a.byteLength,u=this._avcTrack,t=u.naluState||0,n=t,v=[],y=0,x,I,F,U=-1,k=0;for(t===-1&&(U=0,k=a[0]&31,t=0,y=1);y<h;){if(x=a[y++],!t){t=x?0:1;continue}if(t===1){t=x?0:2;continue}if(!x)t=3;else if(x===1){if(U>=0){var $={data:a.subarray(U,y-t-1),type:k};v.push($)}else{var W=this.getLastNalUnit();if(W&&(n&&y<=4-n&&W.state&&(W.data=W.data.subarray(0,W.data.byteLength-n)),I=y-t-1,I>0)){var G=new Uint8Array(W.data.byteLength+I);G.set(W.data,0),G.set(a.subarray(0,I),W.data.byteLength),W.data=G,W.state=0}}y<h?(F=a[y]&31,U=y,k=F,t=0):t=-1}else t=0}if(U>=0&&t>=0){var H={data:a.subarray(U,h),type:k,state:t};v.push(H)}if(v.length===0){var z=this.getLastNalUnit();if(z){var V=new Uint8Array(z.data.byteLength+a.byteLength);V.set(z.data,0),V.set(a,z.data.byteLength),z.data=V}}return u.naluState=t,v},l.parseAACPES=function(a){var h=0,u=this._audioTrack,t=this.aacOverFlow,n=a.data;if(t){this.aacOverFlow=null;var v=t.sample.unit.byteLength,y=Math.min(t.missing,v),x=v-y;t.sample.unit.set(n.subarray(0,y),x),u.samples.push(t.sample),h=t.missing}var I,F;for(I=h,F=n.length;I<F-1&&!B.isHeader(n,I);I++);if(I!==h){var U,k;if(I<F-1?(U="AAC PES did not start with ADTS header,offset:"+I,k=!1):(U="no ADTS header found in AAC PES",k=!0),T.logger.warn("parsing error:"+U),this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.FRAG_PARSING_ERROR,fatal:k,reason:U}),k)return}B.initTrackConfig(u,this.observer,n,I,this.audioCodec);var $;if(a.pts!==void 0)$=a.pts;else if(t){var W=B.getFrameDuration(u.samplerate);$=t.sample.pts+W}else{T.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var G=0;I<F;)if(B.isHeader(n,I)){if(I+5<F){var H=B.appendFrame(u,n,I,$,G);if(H)if(H.missing)this.aacOverFlow=H;else{I+=H.length,G++;continue}}break}else I++},l.parseMPEGPES=function(a){var h=a.data,u=h.length,t=0,n=0,v=a.pts;if(v===void 0){T.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;n<u;)if(P.isHeader(h,n)){var y=P.appendFrame(this._audioTrack,h,n,v,t);if(y)n+=y.length,t++;else break}else n++},l.parseID3PES=function(a){if(a.pts===void 0){T.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}this._id3Track.samples.push(a)},m}();A.minProbeByteLength=188;function L(m,l,e,a){return{key:m,frame:!1,pts:l,dts:e,units:[],debug:a,length:0}}function E(m,l){return(m[l+10]&31)<<8|m[l+11]}function g(m,l,e,a){var h={audio:-1,avc:-1,id3:-1,isAAC:!0},u=(m[l+1]&15)<<8|m[l+2],t=l+3+u-4,n=(m[l+10]&15)<<8|m[l+11];for(l+=12+n;l<t;){var v=(m[l+1]&31)<<8|m[l+2];switch(m[l]){case 207:if(!a){T.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:h.audio===-1&&(h.audio=v);break;case 21:h.id3===-1&&(h.id3=v);break;case 219:if(!a){T.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:h.avc===-1&&(h.avc=v);break;case 3:case 4:e?h.audio===-1&&(h.audio=v,h.isAAC=!1):T.logger.log("MPEG audio found, not supported in this browser");break;case 36:T.logger.warn("Unsupported HEVC stream type found");break}l+=((m[l+3]&15)<<8|m[l+4])+5}return h}function o(m){var l=0,e,a,h,u,t,n=m.data;if(!m||m.size===0)return null;for(;n[0].length<19&&n.length>1;){var v=new Uint8Array(n[0].length+n[1].length);v.set(n[0]),v.set(n[1],n[0].length),n[0]=v,n.splice(1,1)}e=n[0];var y=(e[0]<<16)+(e[1]<<8)+e[2];if(y===1){if(a=(e[4]<<8)+e[5],a&&a>m.size-6)return null;var x=e[7];x&192&&(u=(e[9]&14)*536870912+(e[10]&255)*4194304+(e[11]&254)*16384+(e[12]&255)*128+(e[13]&254)/2,x&64?(t=(e[14]&14)*536870912+(e[15]&255)*4194304+(e[16]&254)*16384+(e[17]&255)*128+(e[18]&254)/2,u-t>60*9e4&&(T.logger.warn(Math.round((u-t)/9e4)+"s delta between PTS and DTS, align them"),u=t)):t=u),h=e[8];var I=h+9;if(m.size<=I)return null;m.size-=I;for(var F=new Uint8Array(m.size),U=0,k=n.length;U<k;U++){e=n[U];var $=e.byteLength;if(I)if(I>$){I-=$;continue}else e=e.subarray(I),$-=I,I=0;F.set(e,l),l+=$}return a&&(a-=h+3),{data:F,pts:u,dts:t,len:a}}return null}function f(m,l){if(m.units.length&&m.frame){if(m.pts===void 0){var e=l.samples,a=e.length;if(a){var h=e[a-1];m.pts=h.pts,m.dts=h.dts}else{l.dropped++;return}}l.samples.push(m)}m.debug.length&&T.logger.log(m.pts+"/"+m.dts+":"+m.debug)}function r(m,l){var e=m.length;if(e>0){if(l.pts>=m[e-1].pts)m.push(l);else for(var a=e-1;a>=0;a--)if(l.pts<m[a].pts){m.splice(a,0,l);break}}else m.push(l)}function p(m){for(var l=m.byteLength,e=[],a=1;a<l-2;)m[a]===0&&m[a+1]===0&&m[a+2]===3?(e.push(a+2),a+=2):a++;if(e.length===0)return m;var h=l-e.length,u=new Uint8Array(h),t=0;for(a=0;a<h;t++,a++)t===e[0]&&(t++,e.shift()),u[a]=m[t];return u}M.default=A},"./src/errors.ts":function(K,M,S){S.r(M),S.d(M,"ErrorTypes",function(){return B}),S.d(M,"ErrorDetails",function(){return P});var B;(function(O){O.NETWORK_ERROR="networkError",O.MEDIA_ERROR="mediaError",O.KEY_SYSTEM_ERROR="keySystemError",O.MUX_ERROR="muxError",O.OTHER_ERROR="otherError"})(B||(B={}));var P;(function(O){O.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",O.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",O.KEY_SYSTEM_NO_SESSION="keySystemNoSession",O.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",O.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",O.MANIFEST_LOAD_ERROR="manifestLoadError",O.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",O.MANIFEST_PARSING_ERROR="manifestParsingError",O.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",O.LEVEL_EMPTY_ERROR="levelEmptyError",O.LEVEL_LOAD_ERROR="levelLoadError",O.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",O.LEVEL_SWITCH_ERROR="levelSwitchError",O.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",O.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",O.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",O.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",O.FRAG_LOAD_ERROR="fragLoadError",O.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",O.FRAG_DECRYPT_ERROR="fragDecryptError",O.FRAG_PARSING_ERROR="fragParsingError",O.REMUX_ALLOC_ERROR="remuxAllocError",O.KEY_LOAD_ERROR="keyLoadError",O.KEY_LOAD_TIMEOUT="keyLoadTimeOut",O.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",O.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",O.BUFFER_APPEND_ERROR="bufferAppendError",O.BUFFER_APPENDING_ERROR="bufferAppendingError",O.BUFFER_STALLED_ERROR="bufferStalledError",O.BUFFER_FULL_ERROR="bufferFullError",O.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",O.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",O.INTERNAL_EXCEPTION="internalException",O.INTERNAL_ABORTED="aborted",O.UNKNOWN="unknown"})(P||(P={}))},"./src/events.ts":function(K,M,S){S.r(M),S.d(M,"Events",function(){return B});var B;(function(P){P.MEDIA_ATTACHING="hlsMediaAttaching",P.MEDIA_ATTACHED="hlsMediaAttached",P.MEDIA_DETACHING="hlsMediaDetaching",P.MEDIA_DETACHED="hlsMediaDetached",P.BUFFER_RESET="hlsBufferReset",P.BUFFER_CODECS="hlsBufferCodecs",P.BUFFER_CREATED="hlsBufferCreated",P.BUFFER_APPENDING="hlsBufferAppending",P.BUFFER_APPENDED="hlsBufferAppended",P.BUFFER_EOS="hlsBufferEos",P.BUFFER_FLUSHING="hlsBufferFlushing",P.BUFFER_FLUSHED="hlsBufferFlushed",P.MANIFEST_LOADING="hlsManifestLoading",P.MANIFEST_LOADED="hlsManifestLoaded",P.MANIFEST_PARSED="hlsManifestParsed",P.LEVEL_SWITCHING="hlsLevelSwitching",P.LEVEL_SWITCHED="hlsLevelSwitched",P.LEVEL_LOADING="hlsLevelLoading",P.LEVEL_LOADED="hlsLevelLoaded",P.LEVEL_UPDATED="hlsLevelUpdated",P.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",P.LEVELS_UPDATED="hlsLevelsUpdated",P.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",P.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",P.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",P.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",P.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",P.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",P.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",P.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",P.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",P.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",P.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",P.CUES_PARSED="hlsCuesParsed",P.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",P.INIT_PTS_FOUND="hlsInitPtsFound",P.FRAG_LOADING="hlsFragLoading",P.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",P.FRAG_LOADED="hlsFragLoaded",P.FRAG_DECRYPTED="hlsFragDecrypted",P.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",P.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",P.FRAG_PARSING_METADATA="hlsFragParsingMetadata",P.FRAG_PARSED="hlsFragParsed",P.FRAG_BUFFERED="hlsFragBuffered",P.FRAG_CHANGED="hlsFragChanged",P.FPS_DROP="hlsFpsDrop",P.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",P.ERROR="hlsError",P.DESTROYING="hlsDestroying",P.KEY_LOADING="hlsKeyLoading",P.KEY_LOADED="hlsKeyLoaded",P.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",P.BACK_BUFFER_REACHED="hlsBackBufferReached"})(B||(B={}))},"./src/hls.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return r});var B=S("./node_modules/url-toolkit/src/url-toolkit.js"),P=S("./src/loader/playlist-loader.ts"),O=S("./src/loader/key-loader.ts"),w=S("./src/controller/id3-track-controller.ts"),_=S("./src/controller/latency-controller.ts"),R=S("./src/controller/level-controller.ts"),C=S("./src/controller/fragment-tracker.ts"),T=S("./src/controller/stream-controller.ts"),D=S("./src/is-supported.ts"),c=S("./src/utils/logger.ts"),A=S("./src/config.ts"),L=S("./node_modules/eventemitter3/index.js"),E=S("./src/events.ts"),g=S("./src/errors.ts");function o(p,m){for(var l=0;l<m.length;l++){var e=m[l];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(p,e.key,e)}}function f(p,m,l){return m&&o(p.prototype,m),l&&o(p,l),p}var r=function(){p.isSupported=function(){return Object(D.isSupported)()};function p(l){l===void 0&&(l={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new L.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var e=this.config=Object(A.mergeConfig)(p.DefaultConfig,l);this.userConfig=l,Object(c.enableLogs)(e.debug),this._autoLevelCapping=-1,e.progressive&&Object(A.enableStreamingMode)(e);var a=e.abrController,h=e.bufferController,u=e.capLevelController,t=e.fpsController,n=this.abrController=new a(this),v=this.bufferController=new h(this),y=this.capLevelController=new u(this),x=new t(this),I=new P.default(this),F=new O.default(this),U=new w.default(this),k=this.levelController=new R.default(this),$=new C.FragmentTracker(this),W=this.streamController=new T.default(this,$);y.setStreamController(W),x.setStreamController(W);var G=[k,W];this.networkControllers=G;var H=[I,F,n,v,y,x,U,$];this.audioTrackController=this.createController(e.audioTrackController,null,G),this.createController(e.audioStreamController,$,G),this.subtitleTrackController=this.createController(e.subtitleTrackController,null,G),this.createController(e.subtitleStreamController,$,G),this.createController(e.timelineController,null,H),this.emeController=this.createController(e.emeController,null,H),this.cmcdController=this.createController(e.cmcdController,null,H),this.latencyController=this.createController(_.default,null,H),this.coreComponents=H}var m=p.prototype;return m.createController=function(e,a,h){if(e){var u=a?new e(this,a):new e(this);return h&&h.push(u),u}return null},m.on=function(e,a,h){h===void 0&&(h=this),this._emitter.on(e,a,h)},m.once=function(e,a,h){h===void 0&&(h=this),this._emitter.once(e,a,h)},m.removeAllListeners=function(e){this._emitter.removeAllListeners(e)},m.off=function(e,a,h,u){h===void 0&&(h=this),this._emitter.off(e,a,h,u)},m.listeners=function(e){return this._emitter.listeners(e)},m.emit=function(e,a,h){return this._emitter.emit(e,a,h)},m.trigger=function(e,a){if(this.config.debug)return this.emit(e,e,a);try{return this.emit(e,e,a)}catch(h){c.logger.error("An internal error happened while handling event "+e+'. Error message: "'+h.message+'". Here is a stacktrace:',h),this.trigger(E.Events.ERROR,{type:g.ErrorTypes.OTHER_ERROR,details:g.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,error:h})}return!1},m.listenerCount=function(e){return this._emitter.listenerCount(e)},m.destroy=function(){c.logger.log("destroy"),this.trigger(E.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(e){return e.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(e){return e.destroy()}),this.coreComponents.length=0},m.attachMedia=function(e){c.logger.log("attachMedia"),this._media=e,this.trigger(E.Events.MEDIA_ATTACHING,{media:e})},m.detachMedia=function(){c.logger.log("detachMedia"),this.trigger(E.Events.MEDIA_DETACHING,void 0),this._media=null},m.loadSource=function(e){this.stopLoad();var a=this.media,h=this.url,u=this.url=B.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});c.logger.log("loadSource:"+u),a&&h&&h!==u&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(a)),this.trigger(E.Events.MANIFEST_LOADING,{url:e})},m.startLoad=function(e){e===void 0&&(e=-1),c.logger.log("startLoad("+e+")"),this.networkControllers.forEach(function(a){a.startLoad(e)})},m.stopLoad=function(){c.logger.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})},m.swapAudioCodec=function(){c.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},m.recoverMediaError=function(){c.logger.log("recoverMediaError");var e=this._media;this.detachMedia(),e&&this.attachMedia(e)},m.removeLevel=function(e,a){a===void 0&&(a=0),this.levelController.removeLevel(e,a)},f(p,[{key:"levels",get:function(){var e=this.levelController.levels;return e||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){c.logger.log("set currentLevel:"+e),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){c.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){c.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){c.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){c.logger.log("set startLevel:"+e),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(e){var a=!!e;a!==this.config.capLevelToPlayerSize&&(a?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=a)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping!==e&&(c.logger.log("set autoLevelCapping:"+e),this._autoLevelCapping=e)}},{key:"bandwidthEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var e=this.levels,a=this.config.minAutoBitrate;if(!e)return 0;for(var h=e.length,u=0;u<h;u++)if(e[u].maxBitrate>a)return u;return 0}},{key:"maxAutoLevel",get:function(){var e=this.levels,a=this.autoLevelCapping,h;return a===-1&&e&&e.length?h=e.length-1:h=a,h}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var a=this.audioTrackController;a&&(a.audioTrack=e)}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var a=this.subtitleTrackController;a&&(a.subtitleTrack=e)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return e?e.subtitleDisplay:!1},set:function(e){var a=this.subtitleTrackController;a&&(a.subtitleDisplay=e)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(e){this.config.lowLatencyMode=e}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.1.5"}},{key:"Events",get:function(){return E.Events}},{key:"ErrorTypes",get:function(){return g.ErrorTypes}},{key:"ErrorDetails",get:function(){return g.ErrorDetails}},{key:"DefaultConfig",get:function(){return p.defaultConfig?p.defaultConfig:A.hlsDefaultConfig},set:function(e){p.defaultConfig=e}}]),p}();r.defaultConfig=void 0},"./src/is-supported.ts":function(K,M,S){S.r(M),S.d(M,"isSupported",function(){return O}),S.d(M,"changeTypeSupported",function(){return w});var B=S("./src/utils/mediasource-helper.ts");function P(){return self.SourceBuffer||self.WebKitSourceBuffer}function O(){var _=Object(B.getMediaSource)();if(!_)return!1;var R=P(),C=_&&typeof _.isTypeSupported=="function"&&_.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),T=!R||R.prototype&&typeof R.prototype.appendBuffer=="function"&&typeof R.prototype.remove=="function";return!!C&&!!T}function w(){var _,R=P();return typeof(R==null||(_=R.prototype)===null||_===void 0?void 0:_.changeType)=="function"}},"./src/loader/fragment-loader.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return A}),S.d(M,"LoadError",function(){return E});var B=S("./src/polyfills/number.ts"),P=S("./src/errors.ts");function O(g,o){g.prototype=Object.create(o.prototype),g.prototype.constructor=g,T(g,o)}function w(g){var o=typeof Map=="function"?new Map:void 0;return w=function(r){if(r===null||!C(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof o!="undefined"){if(o.has(r))return o.get(r);o.set(r,p)}function p(){return _(r,arguments,D(this).constructor)}return p.prototype=Object.create(r.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}}),T(p,r)},w(g)}function _(g,o,f){return R()?_=Reflect.construct:_=function(p,m,l){var e=[null];e.push.apply(e,m);var a=Function.bind.apply(p,e),h=new a;return l&&T(h,l.prototype),h},_.apply(null,arguments)}function R(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function C(g){return Function.toString.call(g).indexOf("[native code]")!==-1}function T(g,o){return T=Object.setPrototypeOf||function(r,p){return r.__proto__=p,r},T(g,o)}function D(g){return D=Object.setPrototypeOf?Object.getPrototypeOf:function(f){return f.__proto__||Object.getPrototypeOf(f)},D(g)}var c=Math.pow(2,17),A=function(){function g(f){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=f}var o=g.prototype;return o.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},o.abort=function(){this.loader&&this.loader.abort()},o.load=function(r,p){var m=this,l=r.url;if(!l)return Promise.reject(new E({type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:r,networkDetails:null},"Fragment does not have a "+(l?"part list":"url")));this.abort();var e=this.config,a=e.fLoader,h=e.loader;return new Promise(function(u,t){m.loader&&m.loader.destroy();var n=m.loader=r.loader=a?new a(e):new h(e),v=L(r),y={timeout:e.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:e.fragLoadingMaxRetryTimeout,highWaterMark:c};r.stats=n.stats,n.load(v,y,{onSuccess:function(I,F,U,k){m.resetLoader(r,n),u({frag:r,part:null,payload:I.data,networkDetails:k})},onError:function(I,F,U){m.resetLoader(r,n),t(new E({type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:r,response:I,networkDetails:U}))},onAbort:function(I,F,U){m.resetLoader(r,n),t(new E({type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:r,networkDetails:U}))},onTimeout:function(I,F,U){m.resetLoader(r,n),t(new E({type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:r,networkDetails:U}))},onProgress:function(I,F,U,k){p&&p({frag:r,part:null,payload:U,networkDetails:k})}})})},o.loadPart=function(r,p,m){var l=this;this.abort();var e=this.config,a=e.fLoader,h=e.loader;return new Promise(function(u,t){l.loader&&l.loader.destroy();var n=l.loader=r.loader=a?new a(e):new h(e),v=L(r,p),y={timeout:e.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:e.fragLoadingMaxRetryTimeout,highWaterMark:c};p.stats=n.stats,n.load(v,y,{onSuccess:function(I,F,U,k){l.resetLoader(r,n),l.updateStatsFromPart(r,p);var $={frag:r,part:p,payload:I.data,networkDetails:k};m($),u($)},onError:function(I,F,U){l.resetLoader(r,n),t(new E({type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:r,part:p,response:I,networkDetails:U}))},onAbort:function(I,F,U){r.stats.aborted=p.stats.aborted,l.resetLoader(r,n),t(new E({type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:r,part:p,networkDetails:U}))},onTimeout:function(I,F,U){l.resetLoader(r,n),t(new E({type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:r,part:p,networkDetails:U}))}})})},o.updateStatsFromPart=function(r,p){var m=r.stats,l=p.stats,e=l.total;if(m.loaded+=l.loaded,e){var a=Math.round(r.duration/p.duration),h=Math.min(Math.round(m.loaded/e),a),u=a-h,t=u*Math.round(m.loaded/h);m.total=m.loaded+t}else m.total=Math.max(m.loaded,m.total);var n=m.loading,v=l.loading;n.start?n.first+=v.first-v.start:(n.start=v.start,n.first=v.first),n.end=v.end},o.resetLoader=function(r,p){r.loader=null,this.loader===p&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),p.destroy()},g}();function L(g,o){o===void 0&&(o=null);var f=o||g,r={frag:g,part:o,responseType:"arraybuffer",url:f.url,headers:{},rangeStart:0,rangeEnd:0},p=f.byteRangeStartOffset,m=f.byteRangeEndOffset;return Object(B.isFiniteNumber)(p)&&Object(B.isFiniteNumber)(m)&&(r.rangeStart=p,r.rangeEnd=m),r}var E=function(g){O(o,g);function o(f){for(var r,p=arguments.length,m=new Array(p>1?p-1:0),l=1;l<p;l++)m[l-1]=arguments[l];return r=g.call.apply(g,[this].concat(m))||this,r.data=void 0,r.data=f,r}return o}(w(Error))},"./src/loader/fragment.ts":function(K,M,S){S.r(M),S.d(M,"ElementaryStreamTypes",function(){return c}),S.d(M,"BaseSegment",function(){return A}),S.d(M,"Fragment",function(){return L}),S.d(M,"Part",function(){return E});var B=S("./src/polyfills/number.ts"),P=S("./node_modules/url-toolkit/src/url-toolkit.js"),O=S("./src/utils/logger.ts"),w=S("./src/loader/level-key.ts"),_=S("./src/loader/load-stats.ts");function R(g,o){g.prototype=Object.create(o.prototype),g.prototype.constructor=g,C(g,o)}function C(g,o){return C=Object.setPrototypeOf||function(r,p){return r.__proto__=p,r},C(g,o)}function T(g,o){for(var f=0;f<o.length;f++){var r=o[f];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(g,r.key,r)}}function D(g,o,f){return o&&T(g.prototype,o),f&&T(g,f),g}var c;(function(g){g.AUDIO="audio",g.VIDEO="video",g.AUDIOVIDEO="audiovideo"})(c||(c={}));var A=function(){function g(f){var r;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(r={},r[c.AUDIO]=null,r[c.VIDEO]=null,r[c.AUDIOVIDEO]=null,r),this.baseurl=f}var o=g.prototype;return o.setByteRange=function(r,p){var m=r.split("@",2),l=[];m.length===1?l[0]=p?p.byteRangeEndOffset:0:l[0]=parseInt(m[1]),l[1]=parseInt(m[0])+l[0],this._byteRange=l},D(g,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(P.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(r){this._url=r}}]),g}(),L=function(g){R(o,g);function o(r,p){var m;return m=g.call(this,p)||this,m._decryptdata=null,m.rawProgramDateTime=null,m.programDateTime=null,m.tagList=[],m.duration=0,m.sn=0,m.levelkey=void 0,m.type=void 0,m.loader=null,m.level=-1,m.cc=0,m.startPTS=void 0,m.endPTS=void 0,m.appendedPTS=void 0,m.startDTS=void 0,m.endDTS=void 0,m.start=0,m.deltaPTS=void 0,m.maxStartPTS=void 0,m.minEndPTS=void 0,m.stats=new _.LoadStats,m.urlId=0,m.data=void 0,m.bitrateTest=!1,m.title=null,m.initSegment=null,m.type=r,m}var f=o.prototype;return f.createInitializationVector=function(p){for(var m=new Uint8Array(16),l=12;l<16;l++)m[l]=p>>8*(15-l)&255;return m},f.setDecryptDataFromLevelKey=function(p,m){var l=p;return(p==null?void 0:p.method)==="AES-128"&&p.uri&&!p.iv&&(l=w.LevelKey.fromURI(p.uri),l.method=p.method,l.iv=this.createInitializationVector(m),l.keyFormat="identity"),l},f.setElementaryStreamInfo=function(p,m,l,e,a,h){h===void 0&&(h=!1);var u=this.elementaryStreams,t=u[p];if(!t){u[p]={startPTS:m,endPTS:l,startDTS:e,endDTS:a,partial:h};return}t.startPTS=Math.min(t.startPTS,m),t.endPTS=Math.max(t.endPTS,l),t.startDTS=Math.min(t.startDTS,e),t.endDTS=Math.max(t.endDTS,a)},f.clearElementaryStreamInfo=function(){var p=this.elementaryStreams;p[c.AUDIO]=null,p[c.VIDEO]=null,p[c.AUDIOVIDEO]=null},D(o,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var p=this.sn;typeof p!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&O.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),p=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,p)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(B.isFiniteNumber)(this.programDateTime))return null;var p=Object(B.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+p*1e3}},{key:"encrypted",get:function(){var p;return!!((p=this.decryptdata)!==null&&p!==void 0&&p.keyFormat&&this.decryptdata.uri)}}]),o}(A),E=function(g){R(o,g);function o(f,r,p,m,l){var e;e=g.call(this,p)||this,e.fragOffset=0,e.duration=0,e.gap=!1,e.independent=!1,e.relurl=void 0,e.fragment=void 0,e.index=void 0,e.stats=new _.LoadStats,e.duration=f.decimalFloatingPoint("DURATION"),e.gap=f.bool("GAP"),e.independent=f.bool("INDEPENDENT"),e.relurl=f.enumeratedString("URI"),e.fragment=r,e.index=m;var a=f.enumeratedString("BYTERANGE");return a&&e.setByteRange(a,l),l&&(e.fragOffset=l.fragOffset+l.duration),e}return D(o,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var r=this.elementaryStreams;return!!(r.audio||r.video||r.audiovideo)}}]),o}(A)},"./src/loader/key-loader.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return w});var B=S("./src/events.ts"),P=S("./src/errors.ts"),O=S("./src/utils/logger.ts"),w=function(){function _(C){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=C,this._registerListeners()}var R=_.prototype;return R._registerListeners=function(){this.hls.on(B.Events.KEY_LOADING,this.onKeyLoading,this)},R._unregisterListeners=function(){this.hls.off(B.Events.KEY_LOADING,this.onKeyLoading)},R.destroy=function(){this._unregisterListeners();for(var T in this.loaders){var D=this.loaders[T];D&&D.destroy()}this.loaders={}},R.onKeyLoading=function(T,D){var c=D.frag,A=c.type,L=this.loaders[A];if(!c.decryptdata){O.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var E=c.decryptdata.uri;if(E!==this.decrypturl||this.decryptkey===null){var g=this.hls.config;if(L&&(O.logger.warn("abort previous key loader for type:"+A),L.abort()),!E){O.logger.warn("key uri is falsy");return}var o=g.loader,f=c.loader=this.loaders[A]=new o(g);this.decrypturl=E,this.decryptkey=null;var r={url:E,frag:c,responseType:"arraybuffer"},p={timeout:g.fragLoadingTimeOut,maxRetry:0,retryDelay:g.fragLoadingRetryDelay,maxRetryDelay:g.fragLoadingMaxRetryTimeout,highWaterMark:0},m={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};f.load(r,p,m)}else this.decryptkey&&(c.decryptdata.key=this.decryptkey,this.hls.trigger(B.Events.KEY_LOADED,{frag:c}))},R.loadsuccess=function(T,D,c){var A=c.frag;if(!A.decryptdata){O.logger.error("after key load, decryptdata unset");return}this.decryptkey=A.decryptdata.key=new Uint8Array(T.data),A.loader=null,delete this.loaders[A.type],this.hls.trigger(B.Events.KEY_LOADED,{frag:A})},R.loaderror=function(T,D){var c=D.frag,A=c.loader;A&&A.abort(),delete this.loaders[c.type],this.hls.trigger(B.Events.ERROR,{type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:c,response:T})},R.loadtimeout=function(T,D){var c=D.frag,A=c.loader;A&&A.abort(),delete this.loaders[c.type],this.hls.trigger(B.Events.ERROR,{type:P.ErrorTypes.NETWORK_ERROR,details:P.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:c})},_}()},"./src/loader/level-details.ts":function(K,M,S){S.r(M),S.d(M,"LevelDetails",function(){return _});var B=S("./src/polyfills/number.ts");function P(R,C){for(var T=0;T<C.length;T++){var D=C[T];D.enumerable=D.enumerable||!1,D.configurable=!0,"value"in D&&(D.writable=!0),Object.defineProperty(R,D.key,D)}}function O(R,C,T){return C&&P(R.prototype,C),T&&P(R,T),R}var w=10,_=function(){function R(T){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=T}var C=R.prototype;return C.reloaded=function(D){if(!D){this.advanced=!0,this.updated=!0;return}var c=this.lastPartSn-D.lastPartSn,A=this.lastPartIndex-D.lastPartIndex;this.updated=this.endSN!==D.endSN||!!A||!!c,this.advanced=this.endSN>D.endSN||c>0||c===0&&A>0,this.updated||this.advanced?this.misses=Math.floor(D.misses*.6):this.misses=D.misses+1,this.availabilityDelay=D.availabilityDelay},O(R,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Object(B.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||w}},{key:"drift",get:function(){var D=this.driftEndTime-this.driftStartTime;if(D>0){var c=this.driftEnd-this.driftStart;return c*1e3/D}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var D;return(D=this.partList)!==null&&D!==void 0&&D.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var D;return(D=this.fragments)!==null&&D!==void 0&&D.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var D;return(D=this.partList)!==null&&D!==void 0&&D.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var D;return(D=this.partList)!==null&&D!==void 0&&D.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),R}()},"./src/loader/level-key.ts":function(K,M,S){S.r(M),S.d(M,"LevelKey",function(){return w});var B=S("./node_modules/url-toolkit/src/url-toolkit.js");function P(_,R){for(var C=0;C<R.length;C++){var T=R[C];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(_,T.key,T)}}function O(_,R,C){return R&&P(_.prototype,R),C&&P(_,C),_}var w=function(){_.fromURL=function(C,T){return new _(C,T)},_.fromURI=function(C){return new _(C)};function _(R,C){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,C?this._uri=Object(B.buildAbsoluteURL)(R,C,{alwaysNormalize:!0}):this._uri=R}return O(_,[{key:"uri",get:function(){return this._uri}}]),_}()},"./src/loader/load-stats.ts":function(K,M,S){S.r(M),S.d(M,"LoadStats",function(){return B});var B=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return o});var B=S("./src/polyfills/number.ts"),P=S("./node_modules/url-toolkit/src/url-toolkit.js"),O=S("./src/loader/fragment.ts"),w=S("./src/loader/level-details.ts"),_=S("./src/loader/level-key.ts"),R=S("./src/utils/attr-list.ts"),C=S("./src/utils/logger.ts"),T=S("./src/utils/codecs.ts"),D=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,c=/#EXT-X-MEDIA:(.*)/g,A=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),L=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),E=/\.(mp4|m4s|m4v|m4a)$/i;function g(l){var e,a;return E.test((e=(a=P.parseURL(l))===null||a===void 0?void 0:a.path)!=null?e:"")}var o=function(){function l(){}return l.findGroup=function(a,h){for(var u=0;u<a.length;u++){var t=a[u];if(t.id===h)return t}},l.convertAVC1ToAVCOTI=function(a){var h=a.split(".");if(h.length>2){var u=h.shift()+".";return u+=parseInt(h.shift()).toString(16),u+=("000"+parseInt(h.shift()).toString(16)).substr(-4),u}return a},l.resolve=function(a,h){return P.buildAbsoluteURL(h,a,{alwaysNormalize:!0})},l.parseMasterPlaylist=function(a,h){var u=[],t={},n=!1;D.lastIndex=0;for(var v;(v=D.exec(a))!=null;)if(v[1]){var y=new R.AttrList(v[1]),x={attrs:y,bitrate:y.decimalInteger("AVERAGE-BANDWIDTH")||y.decimalInteger("BANDWIDTH"),name:y.NAME,url:l.resolve(v[2],h)},I=y.decimalResolution("RESOLUTION");I&&(x.width=I.width,x.height=I.height),f((y.CODECS||"").split(/[ ,]+/).filter(function(U){return U}),x),x.videoCodec&&x.videoCodec.indexOf("avc1")!==-1&&(x.videoCodec=l.convertAVC1ToAVCOTI(x.videoCodec)),u.push(x)}else if(v[3]){var F=new R.AttrList(v[3]);F["DATA-ID"]&&(n=!0,t[F["DATA-ID"]]=F)}return{levels:u,sessionData:n?t:null}},l.parseMasterPlaylistMedia=function(a,h,u,t){t===void 0&&(t=[]);var n,v=[],y=0;for(c.lastIndex=0;(n=c.exec(a))!==null;){var x=new R.AttrList(n[1]);if(x.TYPE===u){var I={attrs:x,bitrate:0,id:y++,groupId:x["GROUP-ID"],instreamId:x["INSTREAM-ID"],name:x.NAME||x.LANGUAGE||"",type:u,default:x.bool("DEFAULT"),autoselect:x.bool("AUTOSELECT"),forced:x.bool("FORCED"),lang:x.LANGUAGE,url:x.URI?l.resolve(x.URI,h):""};if(t.length){var F=l.findGroup(t,I.groupId)||t[0];r(I,F,"audioCodec"),r(I,F,"textCodec")}v.push(I)}}return v},l.parseLevelPlaylist=function(a,h,u,t,n){var v=new w.LevelDetails(h),y=v.fragments,x=null,I=0,F=0,U=0,k=0,$=null,W=new O.Fragment(t,h),G,H,z,V=-1,Y=!1;for(A.lastIndex=0,v.m3u8=a;(G=A.exec(a))!==null;){Y&&(Y=!1,W=new O.Fragment(t,h),W.start=U,W.sn=I,W.cc=k,W.level=u,x&&(W.initSegment=x,W.rawProgramDateTime=x.rawProgramDateTime));var Q=G[1];if(Q){W.duration=parseFloat(Q);var X=(" "+G[2]).slice(1);W.title=X||null,W.tagList.push(X?["INF",Q,X]:["INF",Q])}else if(G[3])Object(B.isFiniteNumber)(W.duration)&&(W.start=U,z&&(W.levelkey=z),W.sn=I,W.level=u,W.cc=k,W.urlId=n,y.push(W),W.relurl=(" "+G[3]).slice(1),m(W,$),$=W,U+=W.duration,I++,F=0,Y=!0);else if(G[4]){var q=(" "+G[4]).slice(1);$?W.setByteRange(q,$):W.setByteRange(q)}else if(G[5])W.rawProgramDateTime=(" "+G[5]).slice(1),W.tagList.push(["PROGRAM-DATE-TIME",W.rawProgramDateTime]),V===-1&&(V=y.length);else{if(G=G[0].match(L),!G){C.logger.warn("No matches on slow regex match for level playlist!");continue}for(H=1;H<G.length&&typeof G[H]=="undefined";H++);var J=(" "+G[H]).slice(1),Z=(" "+G[H+1]).slice(1),ee=G[H+2]?(" "+G[H+2]).slice(1):"";switch(J){case"PLAYLIST-TYPE":v.type=Z.toUpperCase();break;case"MEDIA-SEQUENCE":I=v.startSN=parseInt(Z);break;case"SKIP":{var te=new R.AttrList(Z),re=te.decimalInteger("SKIPPED-SEGMENTS");if(Object(B.isFiniteNumber)(re)){v.skippedSegments=re;for(var ne=re;ne--;)y.unshift(null);I+=re}var se=te.enumeratedString("RECENTLY-REMOVED-DATERANGES");se&&(v.recentlyRemovedDateranges=se.split("	"));break}case"TARGETDURATION":v.targetduration=parseFloat(Z);break;case"VERSION":v.version=parseInt(Z);break;case"EXTM3U":break;case"ENDLIST":v.live=!1;break;case"#":(Z||ee)&&W.tagList.push(ee?[Z,ee]:[Z]);break;case"DIS":k++;case"GAP":W.tagList.push([J]);break;case"BITRATE":W.tagList.push([J,Z]);break;case"DISCONTINUITY-SEQ":k=parseInt(Z);break;case"KEY":{var ie,oe=new R.AttrList(Z),de=oe.enumeratedString("METHOD"),le=oe.URI,fe=oe.hexadecimalInteger("IV"),ue=oe.enumeratedString("KEYFORMATVERSIONS"),ce=oe.enumeratedString("KEYID"),ae=(ie=oe.enumeratedString("KEYFORMAT"))!=null?ie:"identity",xe=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(xe.indexOf(ae)>-1){C.logger.warn("Keyformat "+ae+" is not supported from the manifest");continue}else if(ae!=="identity")continue;de&&(z=_.LevelKey.fromURL(h,le),le&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(de)>=0&&(z.method=de,z.keyFormat=ae,ce&&(z.keyID=ce),ue&&(z.keyFormatVersions=ue),z.iv=fe));break}case"START":{var Ae=new R.AttrList(Z),Te=Ae.decimalFloatingPoint("TIME-OFFSET");Object(B.isFiniteNumber)(Te)&&(v.startTimeOffset=Te);break}case"MAP":{var ve=new R.AttrList(Z);W.relurl=ve.URI,ve.BYTERANGE&&W.setByteRange(ve.BYTERANGE),W.level=u,W.sn="initSegment",z&&(W.levelkey=z),W.initSegment=null,x=W,Y=!0;break}case"SERVER-CONTROL":{var ge=new R.AttrList(Z);v.canBlockReload=ge.bool("CAN-BLOCK-RELOAD"),v.canSkipUntil=ge.optionalFloat("CAN-SKIP-UNTIL",0),v.canSkipDateRanges=v.canSkipUntil>0&&ge.bool("CAN-SKIP-DATERANGES"),v.partHoldBack=ge.optionalFloat("PART-HOLD-BACK",0),v.holdBack=ge.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var Ee=new R.AttrList(Z);v.partTarget=Ee.decimalFloatingPoint("PART-TARGET");break}case"PART":{var me=v.partList;me||(me=v.partList=[]);var he=F>0?me[me.length-1]:void 0,pe=F++,De=new O.Part(new R.AttrList(Z),W,h,pe,he);me.push(De),W.duration+=De.duration;break}case"PRELOAD-HINT":{var Pe=new R.AttrList(Z);v.preloadHint=Pe;break}case"RENDITION-REPORT":{var Le=new R.AttrList(Z);v.renditionReports=v.renditionReports||[],v.renditionReports.push(Le);break}default:C.logger.warn("line parsed but not handled: "+G);break}}}$&&!$.relurl?(y.pop(),U-=$.duration,v.partList&&(v.fragmentHint=$)):v.partList&&(m(W,$),W.cc=k,v.fragmentHint=W);var be=y.length,Se=y[0],ye=y[be-1];if(U+=v.skippedSegments*v.targetduration,U>0&&be&&ye){v.averagetargetduration=U/be;var Ce=ye.sn;v.endSN=Ce!=="initSegment"?Ce:0,Se&&(v.startCC=Se.cc,Se.initSegment||v.fragments.every(function(Oe){return Oe.relurl&&g(Oe.relurl)})&&(C.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),W=new O.Fragment(t,h),W.relurl=ye.relurl,W.level=u,W.sn="initSegment",Se.initSegment=W,v.needSidxRanges=!0))}else v.endSN=0,v.startCC=0;return v.fragmentHint&&(U+=v.fragmentHint.duration),v.totalduration=U,v.endCC=k,V>0&&p(y,V),v},l}();function f(l,e){["video","audio","text"].forEach(function(a){var h=l.filter(function(t){return Object(T.isCodecType)(t,a)});if(h.length){var u=h.filter(function(t){return t.lastIndexOf("avc1",0)===0||t.lastIndexOf("mp4a",0)===0});e[a+"Codec"]=u.length>0?u[0]:h[0],l=l.filter(function(t){return h.indexOf(t)===-1})}}),e.unknownCodecs=l}function r(l,e,a){var h=e[a];h&&(l[a]=h)}function p(l,e){for(var a=l[e],h=e;h--;){var u=l[h];if(!u)return;u.programDateTime=a.programDateTime-u.duration*1e3,a=u}}function m(l,e){l.rawProgramDateTime?l.programDateTime=Date.parse(l.rawProgramDateTime):e!=null&&e.programDateTime&&(l.programDateTime=e.endProgramDateTime),Object(B.isFiniteNumber)(l.programDateTime)||(l.programDateTime=null,l.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(K,M,S){S.r(M);var B=S("./src/polyfills/number.ts"),P=S("./src/events.ts"),O=S("./src/errors.ts"),w=S("./src/utils/logger.ts"),_=S("./src/utils/mp4-tools.ts"),R=S("./src/loader/m3u8-parser.ts"),C=S("./src/types/loader.ts"),T=S("./src/utils/attr-list.ts");function D(L){var E=L.type;switch(E){case C.PlaylistContextType.AUDIO_TRACK:return C.PlaylistLevelType.AUDIO;case C.PlaylistContextType.SUBTITLE_TRACK:return C.PlaylistLevelType.SUBTITLE;default:return C.PlaylistLevelType.MAIN}}function c(L,E){var g=L.url;return(g===void 0||g.indexOf("data:")===0)&&(g=E.url),g}var A=function(){function L(g){this.hls=void 0,this.loaders=Object.create(null),this.hls=g,this.registerListeners()}var E=L.prototype;return E.registerListeners=function(){var o=this.hls;o.on(P.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.on(P.Events.LEVEL_LOADING,this.onLevelLoading,this),o.on(P.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),o.on(P.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},E.unregisterListeners=function(){var o=this.hls;o.off(P.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.off(P.Events.LEVEL_LOADING,this.onLevelLoading,this),o.off(P.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),o.off(P.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},E.createInternalLoader=function(o){var f=this.hls.config,r=f.pLoader,p=f.loader,m=r||p,l=new m(f);return o.loader=l,this.loaders[o.type]=l,l},E.getInternalLoader=function(o){return this.loaders[o.type]},E.resetInternalLoader=function(o){this.loaders[o]&&delete this.loaders[o]},E.destroyInternalLoaders=function(){for(var o in this.loaders){var f=this.loaders[o];f&&f.destroy(),this.resetInternalLoader(o)}},E.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},E.onManifestLoading=function(o,f){var r=f.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:C.PlaylistContextType.MANIFEST,url:r,deliveryDirectives:null})},E.onLevelLoading=function(o,f){var r=f.id,p=f.level,m=f.url,l=f.deliveryDirectives;this.load({id:r,groupId:null,level:p,responseType:"text",type:C.PlaylistContextType.LEVEL,url:m,deliveryDirectives:l})},E.onAudioTrackLoading=function(o,f){var r=f.id,p=f.groupId,m=f.url,l=f.deliveryDirectives;this.load({id:r,groupId:p,level:null,responseType:"text",type:C.PlaylistContextType.AUDIO_TRACK,url:m,deliveryDirectives:l})},E.onSubtitleTrackLoading=function(o,f){var r=f.id,p=f.groupId,m=f.url,l=f.deliveryDirectives;this.load({id:r,groupId:p,level:null,responseType:"text",type:C.PlaylistContextType.SUBTITLE_TRACK,url:m,deliveryDirectives:l})},E.load=function(o){var f,r=this.hls.config,p=this.getInternalLoader(o);if(p){var m=p.context;if(m&&m.url===o.url){w.logger.trace("[playlist-loader]: playlist request ongoing");return}w.logger.log("[playlist-loader]: aborting previous loader for type: "+o.type),p.abort()}var l,e,a,h;switch(o.type){case C.PlaylistContextType.MANIFEST:l=r.manifestLoadingMaxRetry,e=r.manifestLoadingTimeOut,a=r.manifestLoadingRetryDelay,h=r.manifestLoadingMaxRetryTimeout;break;case C.PlaylistContextType.LEVEL:case C.PlaylistContextType.AUDIO_TRACK:case C.PlaylistContextType.SUBTITLE_TRACK:l=0,e=r.levelLoadingTimeOut;break;default:l=r.levelLoadingMaxRetry,e=r.levelLoadingTimeOut,a=r.levelLoadingRetryDelay,h=r.levelLoadingMaxRetryTimeout;break}if(p=this.createInternalLoader(o),(f=o.deliveryDirectives)!==null&&f!==void 0&&f.part){var u;if(o.type===C.PlaylistContextType.LEVEL&&o.level!==null?u=this.hls.levels[o.level].details:o.type===C.PlaylistContextType.AUDIO_TRACK&&o.id!==null?u=this.hls.audioTracks[o.id].details:o.type===C.PlaylistContextType.SUBTITLE_TRACK&&o.id!==null&&(u=this.hls.subtitleTracks[o.id].details),u){var t=u.partTarget,n=u.targetduration;t&&n&&(e=Math.min(Math.max(t*3,n*.8)*1e3,e))}}var v={timeout:e,maxRetry:l,retryDelay:a,maxRetryDelay:h,highWaterMark:0},y={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};p.load(o,v,y)},E.loadsuccess=function(o,f,r,p){if(p===void 0&&(p=null),r.isSidxRequest){this.handleSidxRequest(o,r),this.handlePlaylistLoaded(o,f,r,p);return}this.resetInternalLoader(r.type);var m=o.data;if(m.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(o,r,"no EXTM3U delimiter",p);return}f.parsing.start=performance.now(),m.indexOf("#EXTINF:")>0||m.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(o,f,r,p):this.handleMasterPlaylist(o,f,r,p)},E.loaderror=function(o,f,r){r===void 0&&(r=null),this.handleNetworkError(f,r,!1,o)},E.loadtimeout=function(o,f,r){r===void 0&&(r=null),this.handleNetworkError(f,r,!0)},E.handleMasterPlaylist=function(o,f,r,p){var m=this.hls,l=o.data,e=c(o,r),a=R.default.parseMasterPlaylist(l,e),h=a.levels,u=a.sessionData;if(!h.length){this.handleManifestParsingError(o,r,"no level found in manifest",p);return}var t=h.map(function(F){return{id:F.attrs.AUDIO,audioCodec:F.audioCodec}}),n=h.map(function(F){return{id:F.attrs.SUBTITLES,textCodec:F.textCodec}}),v=R.default.parseMasterPlaylistMedia(l,e,"AUDIO",t),y=R.default.parseMasterPlaylistMedia(l,e,"SUBTITLES",n),x=R.default.parseMasterPlaylistMedia(l,e,"CLOSED-CAPTIONS");if(v.length){var I=v.some(function(F){return!F.url});!I&&h[0].audioCodec&&!h[0].attrs.AUDIO&&(w.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),v.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new T.AttrList({}),bitrate:0,url:""}))}m.trigger(P.Events.MANIFEST_LOADED,{levels:h,audioTracks:v,subtitles:y,captions:x,url:e,stats:f,networkDetails:p,sessionData:u})},E.handleTrackOrLevelPlaylist=function(o,f,r,p){var m=this.hls,l=r.id,e=r.level,a=r.type,h=c(o,r),u=Object(B.isFiniteNumber)(l)?l:0,t=Object(B.isFiniteNumber)(e)?e:u,n=D(r),v=R.default.parseLevelPlaylist(o.data,h,t,n,u);if(!v.fragments.length){m.trigger(P.Events.ERROR,{type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:h,reason:"no fragments found in level",level:typeof r.level=="number"?r.level:void 0});return}if(a===C.PlaylistContextType.MANIFEST){var y={attrs:new T.AttrList({}),bitrate:0,details:v,name:"",url:h};m.trigger(P.Events.MANIFEST_LOADED,{levels:[y],audioTracks:[],url:h,stats:f,networkDetails:p,sessionData:null})}if(f.parsing.end=performance.now(),v.needSidxRanges){var x,I=(x=v.fragments[0].initSegment)===null||x===void 0?void 0:x.url;this.load({url:I,isSidxRequest:!0,type:a,level:e,levelDetails:v,id:l,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}r.levelDetails=v,this.handlePlaylistLoaded(o,f,r,p)},E.handleSidxRequest=function(o,f){var r=Object(_.parseSegmentIndex)(new Uint8Array(o.data));if(!!r){var p=r.references,m=f.levelDetails;p.forEach(function(l,e){var a=l.info,h=m.fragments[e];h.byteRange.length===0&&h.setByteRange(String(1+a.end-a.start)+"@"+String(a.start)),h.initSegment&&h.initSegment.setByteRange(String(r.moovEndOffset)+"@0")})}},E.handleManifestParsingError=function(o,f,r,p){this.hls.trigger(P.Events.ERROR,{type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:f.type===C.PlaylistContextType.MANIFEST,url:o.url,reason:r,response:o,context:f,networkDetails:p})},E.handleNetworkError=function(o,f,r,p){r===void 0&&(r=!1),w.logger.warn("[playlist-loader]: A network "+(r?"timeout":"error")+" occurred while loading "+o.type+" level: "+o.level+" id: "+o.id+' group-id: "'+o.groupId+'"');var m=O.ErrorDetails.UNKNOWN,l=!1,e=this.getInternalLoader(o);switch(o.type){case C.PlaylistContextType.MANIFEST:m=r?O.ErrorDetails.MANIFEST_LOAD_TIMEOUT:O.ErrorDetails.MANIFEST_LOAD_ERROR,l=!0;break;case C.PlaylistContextType.LEVEL:m=r?O.ErrorDetails.LEVEL_LOAD_TIMEOUT:O.ErrorDetails.LEVEL_LOAD_ERROR,l=!1;break;case C.PlaylistContextType.AUDIO_TRACK:m=r?O.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:O.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case C.PlaylistContextType.SUBTITLE_TRACK:m=r?O.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:O.ErrorDetails.SUBTITLE_LOAD_ERROR,l=!1;break}e&&this.resetInternalLoader(o.type);var a={type:O.ErrorTypes.NETWORK_ERROR,details:m,fatal:l,url:o.url,loader:e,context:o,networkDetails:f};p&&(a.response=p),this.hls.trigger(P.Events.ERROR,a)},E.handlePlaylistLoaded=function(o,f,r,p){var m=r.type,l=r.level,e=r.id,a=r.groupId,h=r.loader,u=r.levelDetails,t=r.deliveryDirectives;if(!(u!=null&&u.targetduration)){this.handleManifestParsingError(o,r,"invalid target duration",p);return}if(!!h)switch(u.live&&(h.getCacheAge&&(u.ageHeader=h.getCacheAge()||0),(!h.getCacheAge||isNaN(u.ageHeader))&&(u.ageHeader=0)),m){case C.PlaylistContextType.MANIFEST:case C.PlaylistContextType.LEVEL:this.hls.trigger(P.Events.LEVEL_LOADED,{details:u,level:l||0,id:e||0,stats:f,networkDetails:p,deliveryDirectives:t});break;case C.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(P.Events.AUDIO_TRACK_LOADED,{details:u,id:e||0,groupId:a||"",stats:f,networkDetails:p,deliveryDirectives:t});break;case C.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(P.Events.SUBTITLE_TRACK_LOADED,{details:u,id:e||0,groupId:a||"",stats:f,networkDetails:p,deliveryDirectives:t});break}},L}();M.default=A},"./src/polyfills/number.ts":function(K,M,S){S.r(M),S.d(M,"isFiniteNumber",function(){return B}),S.d(M,"MAX_SAFE_INTEGER",function(){return P});var B=Number.isFinite||function(O){return typeof O=="number"&&isFinite(O)},P=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(K,M,S){S.r(M);var B=function(){function P(){}return P.getSilentFrame=function(w,_){switch(w){case"mp4a.40.2":if(_===1)return new Uint8Array([0,200,0,128,35,128]);if(_===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(_===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(_===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(_===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(_===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(_===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(_===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(_===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},P}();M.default=B},"./src/remux/mp4-generator.ts":function(K,M,S){S.r(M);var B=Math.pow(2,32)-1,P=function(){function O(){}return O.init=function(){O.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var _;for(_ in O.types)O.types.hasOwnProperty(_)&&(O.types[_]=[_.charCodeAt(0),_.charCodeAt(1),_.charCodeAt(2),_.charCodeAt(3)]);var R=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),C=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);O.HDLR_TYPES={video:R,audio:C};var T=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),D=new Uint8Array([0,0,0,0,0,0,0,0]);O.STTS=O.STSC=O.STCO=D,O.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),O.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),O.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),O.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var c=new Uint8Array([105,115,111,109]),A=new Uint8Array([97,118,99,49]),L=new Uint8Array([0,0,0,1]);O.FTYP=O.box(O.types.ftyp,c,L,c,A),O.DINF=O.box(O.types.dinf,O.box(O.types.dref,T))},O.box=function(_){for(var R=8,C=arguments.length,T=new Array(C>1?C-1:0),D=1;D<C;D++)T[D-1]=arguments[D];for(var c=T.length,A=c;c--;)R+=T[c].byteLength;var L=new Uint8Array(R);for(L[0]=R>>24&255,L[1]=R>>16&255,L[2]=R>>8&255,L[3]=R&255,L.set(_,4),c=0,R=8;c<A;c++)L.set(T[c],R),R+=T[c].byteLength;return L},O.hdlr=function(_){return O.box(O.types.hdlr,O.HDLR_TYPES[_])},O.mdat=function(_){return O.box(O.types.mdat,_)},O.mdhd=function(_,R){R*=_;var C=Math.floor(R/(B+1)),T=Math.floor(R%(B+1));return O.box(O.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,_>>24&255,_>>16&255,_>>8&255,_&255,C>>24,C>>16&255,C>>8&255,C&255,T>>24,T>>16&255,T>>8&255,T&255,85,196,0,0]))},O.mdia=function(_){return O.box(O.types.mdia,O.mdhd(_.timescale,_.duration),O.hdlr(_.type),O.minf(_))},O.mfhd=function(_){return O.box(O.types.mfhd,new Uint8Array([0,0,0,0,_>>24,_>>16&255,_>>8&255,_&255]))},O.minf=function(_){return _.type==="audio"?O.box(O.types.minf,O.box(O.types.smhd,O.SMHD),O.DINF,O.stbl(_)):O.box(O.types.minf,O.box(O.types.vmhd,O.VMHD),O.DINF,O.stbl(_))},O.moof=function(_,R,C){return O.box(O.types.moof,O.mfhd(_),O.traf(C,R))},O.moov=function(_){for(var R=_.length,C=[];R--;)C[R]=O.trak(_[R]);return O.box.apply(null,[O.types.moov,O.mvhd(_[0].timescale,_[0].duration)].concat(C).concat(O.mvex(_)))},O.mvex=function(_){for(var R=_.length,C=[];R--;)C[R]=O.trex(_[R]);return O.box.apply(null,[O.types.mvex].concat(C))},O.mvhd=function(_,R){R*=_;var C=Math.floor(R/(B+1)),T=Math.floor(R%(B+1)),D=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,_>>24&255,_>>16&255,_>>8&255,_&255,C>>24,C>>16&255,C>>8&255,C&255,T>>24,T>>16&255,T>>8&255,T&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return O.box(O.types.mvhd,D)},O.sdtp=function(_){var R=_.samples||[],C=new Uint8Array(4+R.length),T,D;for(T=0;T<R.length;T++)D=R[T].flags,C[T+4]=D.dependsOn<<4|D.isDependedOn<<2|D.hasRedundancy;return O.box(O.types.sdtp,C)},O.stbl=function(_){return O.box(O.types.stbl,O.stsd(_),O.box(O.types.stts,O.STTS),O.box(O.types.stsc,O.STSC),O.box(O.types.stsz,O.STSZ),O.box(O.types.stco,O.STCO))},O.avc1=function(_){var R=[],C=[],T,D,c;for(T=0;T<_.sps.length;T++)D=_.sps[T],c=D.byteLength,R.push(c>>>8&255),R.push(c&255),R=R.concat(Array.prototype.slice.call(D));for(T=0;T<_.pps.length;T++)D=_.pps[T],c=D.byteLength,C.push(c>>>8&255),C.push(c&255),C=C.concat(Array.prototype.slice.call(D));var A=O.box(O.types.avcC,new Uint8Array([1,R[3],R[4],R[5],255,224|_.sps.length].concat(R).concat([_.pps.length]).concat(C))),L=_.width,E=_.height,g=_.pixelRatio[0],o=_.pixelRatio[1];return O.box(O.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,L>>8&255,L&255,E>>8&255,E&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),A,O.box(O.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),O.box(O.types.pasp,new Uint8Array([g>>24,g>>16&255,g>>8&255,g&255,o>>24,o>>16&255,o>>8&255,o&255])))},O.esds=function(_){var R=_.config.length;return new Uint8Array([0,0,0,0,3,23+R,0,1,0,4,15+R,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([R]).concat(_.config).concat([6,1,2]))},O.mp4a=function(_){var R=_.samplerate;return O.box(O.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,_.channelCount,0,16,0,0,0,0,R>>8&255,R&255,0,0]),O.box(O.types.esds,O.esds(_)))},O.mp3=function(_){var R=_.samplerate;return O.box(O.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,_.channelCount,0,16,0,0,0,0,R>>8&255,R&255,0,0]))},O.stsd=function(_){return _.type==="audio"?!_.isAAC&&_.codec==="mp3"?O.box(O.types.stsd,O.STSD,O.mp3(_)):O.box(O.types.stsd,O.STSD,O.mp4a(_)):O.box(O.types.stsd,O.STSD,O.avc1(_))},O.tkhd=function(_){var R=_.id,C=_.duration*_.timescale,T=_.width,D=_.height,c=Math.floor(C/(B+1)),A=Math.floor(C%(B+1));return O.box(O.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,R&255,0,0,0,0,c>>24,c>>16&255,c>>8&255,c&255,A>>24,A>>16&255,A>>8&255,A&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,T>>8&255,T&255,0,0,D>>8&255,D&255,0,0]))},O.traf=function(_,R){var C=O.sdtp(_),T=_.id,D=Math.floor(R/(B+1)),c=Math.floor(R%(B+1));return O.box(O.types.traf,O.box(O.types.tfhd,new Uint8Array([0,0,0,0,T>>24,T>>16&255,T>>8&255,T&255])),O.box(O.types.tfdt,new Uint8Array([1,0,0,0,D>>24,D>>16&255,D>>8&255,D&255,c>>24,c>>16&255,c>>8&255,c&255])),O.trun(_,C.length+16+20+8+16+8+8),C)},O.trak=function(_){return _.duration=_.duration||4294967295,O.box(O.types.trak,O.tkhd(_),O.mdia(_))},O.trex=function(_){var R=_.id;return O.box(O.types.trex,new Uint8Array([0,0,0,0,R>>24,R>>16&255,R>>8&255,R&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},O.trun=function(_,R){var C=_.samples||[],T=C.length,D=12+16*T,c=new Uint8Array(D),A,L,E,g,o,f;for(R+=8+D,c.set([0,0,15,1,T>>>24&255,T>>>16&255,T>>>8&255,T&255,R>>>24&255,R>>>16&255,R>>>8&255,R&255],0),A=0;A<T;A++)L=C[A],E=L.duration,g=L.size,o=L.flags,f=L.cts,c.set([E>>>24&255,E>>>16&255,E>>>8&255,E&255,g>>>24&255,g>>>16&255,g>>>8&255,g&255,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,o.degradPrio&240<<8,o.degradPrio&15,f>>>24&255,f>>>16&255,f>>>8&255,f&255],12+16*A);return O.box(O.types.trun,c)},O.initSegment=function(_){O.types||O.init();var R=O.moov(_),C=new Uint8Array(O.FTYP.byteLength+R.byteLength);return C.set(O.FTYP),C.set(R,O.FTYP.byteLength),C},O}();P.types=void 0,P.HDLR_TYPES=void 0,P.STTS=void 0,P.STSC=void 0,P.STCO=void 0,P.STSZ=void 0,P.VMHD=void 0,P.SMHD=void 0,P.STSD=void 0,P.FTYP=void 0,P.DINF=void 0,M.default=P},"./src/remux/mp4-remuxer.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return f}),S.d(M,"normalizePts",function(){return r});var B=S("./src/polyfills/number.ts"),P=S("./src/remux/aac-helper.ts"),O=S("./src/remux/mp4-generator.ts"),w=S("./src/events.ts"),_=S("./src/errors.ts"),R=S("./src/utils/logger.ts"),C=S("./src/types/loader.ts"),T=S("./src/utils/timescale-conversion.ts");function D(){return D=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var h=arguments[a];for(var u in h)Object.prototype.hasOwnProperty.call(h,u)&&(e[u]=h[u])}return e},D.apply(this,arguments)}var c=10*1e3,A=1024,L=1152,E=null,g=null,o=!1,f=function(){function e(h,u,t,n){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=h,this.config=u,this.typeSupported=t,this.ISGenerated=!1,E===null){var v=navigator.userAgent||"",y=v.match(/Chrome\/(\d+)/i);E=y?parseInt(y[1]):0}if(g===null){var x=navigator.userAgent.match(/Safari\/(\d+)/i);g=x?parseInt(x[1]):0}o=!!E&&E<75||!!g&&g<600}var a=e.prototype;return a.destroy=function(){},a.resetTimeStamp=function(u){R.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=u},a.resetNextTimestamp=function(){R.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},a.resetInitSegment=function(){R.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},a.getVideoStartPts=function(u){var t=!1,n=u.reduce(function(v,y){var x=y.pts-v;return x<-4294967296?(t=!0,r(v,y.pts)):x>0?v:y.pts},u[0].pts);return t&&R.logger.debug("PTS rollover detected"),n},a.remux=function(u,t,n,v,y,x,I,F){var U,k,$,W,G,H,z=y,V=y,Y=u.pid>-1,Q=t.pid>-1,X=t.samples.length,q=u.samples.length>0,J=X>1,Z=(!Y||q)&&(!Q||J)||this.ISGenerated||I;if(Z){this.ISGenerated||($=this.generateIS(u,t,y));var ee=this.isVideoContiguous,te=-1;if(J&&(te=p(t.samples),!ee&&this.config.forceKeyFrameOnDiscontinuity))if(H=!0,te>0){R.logger.warn("[mp4-remuxer]: Dropped "+te+" out of "+X+" video samples due to a missing keyframe");var re=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(te),t.dropped+=te,V+=(t.samples[0].pts-re)/(t.timescale||9e4)}else te===-1&&(R.logger.warn("[mp4-remuxer]: No keyframe found out of "+X+" video samples"),H=!1);if(this.ISGenerated){if(q&&J){var ne=this.getVideoStartPts(t.samples),se=r(u.samples[0].pts,ne)-ne,ie=se/t.inputTimeScale;z+=Math.max(0,ie),V+=Math.max(0,-ie)}if(q){if(u.samplerate||(R.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),$=this.generateIS(u,t,y)),k=this.remuxAudio(u,z,this.isAudioContiguous,x,Q||J||F===C.PlaylistLevelType.AUDIO?V:void 0),J){var oe=k?k.endPTS-k.startPTS:0;t.inputTimeScale||(R.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),$=this.generateIS(u,t,y)),U=this.remuxVideo(t,V,ee,oe)}}else J&&(U=this.remuxVideo(t,V,ee,0));U&&(U.firstKeyFrame=te,U.independent=te!==-1)}}return this.ISGenerated&&(n.samples.length&&(G=this.remuxID3(n,y)),v.samples.length&&(W=this.remuxText(v,y))),{audio:k,video:U,initSegment:$,independent:H,text:W,id3:G}},a.generateIS=function(u,t,n){var v=u.samples,y=t.samples,x=this.typeSupported,I={},F=!Object(B.isFiniteNumber)(this._initPTS),U="audio/mp4",k,$,W;if(F&&(k=$=1/0),u.config&&v.length&&(u.timescale=u.samplerate,u.isAAC||(x.mpeg?(U="audio/mpeg",u.codec=""):x.mp3&&(u.codec="mp3")),I.audio={id:"audio",container:U,codec:u.codec,initSegment:!u.isAAC&&x.mpeg?new Uint8Array(0):O.default.initSegment([u]),metadata:{channelCount:u.channelCount}},F&&(W=u.inputTimeScale,k=$=v[0].pts-Math.round(W*n))),t.sps&&t.pps&&y.length&&(t.timescale=t.inputTimeScale,I.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:O.default.initSegment([t]),metadata:{width:t.width,height:t.height}},F)){W=t.inputTimeScale;var G=this.getVideoStartPts(y),H=Math.round(W*n);$=Math.min($,r(y[0].dts,G)-H),k=Math.min(k,G-H)}if(Object.keys(I).length)return this.ISGenerated=!0,F&&(this._initPTS=k,this._initDTS=$),{tracks:I,initPTS:k,timescale:W}},a.remuxVideo=function(u,t,n,v){var y=u.inputTimeScale,x=u.samples,I=[],F=x.length,U=this._initPTS,k=this.nextAvcDts,$=8,W,G,H,z=Number.POSITIVE_INFINITY,V=Number.NEGATIVE_INFINITY,Y=0,Q=!1;if(!n||k===null){var X=t*y,q=x[0].pts-r(x[0].dts,x[0].pts);k=X-q}for(var J=0;J<F;J++){var Z=x[J];if(Z.pts=r(Z.pts-U,k),Z.dts=r(Z.dts-U,k),Z.dts>Z.pts){var ee=18e3;Y=Math.max(Math.min(Y,Z.pts-Z.dts),-1*ee)}Z.dts<x[J>0?J-1:J].dts&&(Q=!0)}Q&&x.sort(function(Me,Fe){var $e=Me.dts-Fe.dts,Ke=Me.pts-Fe.pts;return $e||Ke}),G=x[0].dts,H=x[x.length-1].dts;var te=Math.round((H-G)/(F-1));if(Y<0){if(Y<te*-2){R.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(T.toMsFromMpegTsClock)(-te,!0)+" ms");for(var re=Y,ne=0;ne<F;ne++)x[ne].dts=re=Math.max(re,x[ne].pts-te),x[ne].pts=Math.max(re,x[ne].pts)}else{R.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(T.toMsFromMpegTsClock)(Y,!0)+" ms to overcome this issue");for(var se=0;se<F;se++)x[se].dts=x[se].dts+Y}G=x[0].dts}if(n){var ie=G-k,oe=ie>te,de=ie<-1;if(oe||de){oe?R.logger.warn("AVC: "+Object(T.toMsFromMpegTsClock)(ie,!0)+" ms ("+ie+"dts) hole between fragments detected, filling it"):R.logger.warn("AVC: "+Object(T.toMsFromMpegTsClock)(-ie,!0)+" ms ("+ie+"dts) overlapping between fragments detected"),G=k;var le=x[0].pts-ie;x[0].dts=G,x[0].pts=le,R.logger.log("Video: First PTS/DTS adjusted: "+Object(T.toMsFromMpegTsClock)(le,!0)+"/"+Object(T.toMsFromMpegTsClock)(G,!0)+", delta: "+Object(T.toMsFromMpegTsClock)(ie,!0)+" ms")}}o&&(G=Math.max(0,G));for(var fe=0,ue=0,ce=0;ce<F;ce++){for(var ae=x[ce],xe=ae.units,Ae=xe.length,Te=0,ve=0;ve<Ae;ve++)Te+=xe[ve].data.length;ue+=Te,fe+=Ae,ae.length=Te,ae.dts=Math.max(ae.dts,G),ae.pts=Math.max(ae.pts,ae.dts,0),z=Math.min(ae.pts,z),V=Math.max(ae.pts,V)}H=x[F-1].dts;var ge=ue+4*fe+8,Ee;try{Ee=new Uint8Array(ge)}catch{this.observer.emit(w.Events.ERROR,w.Events.ERROR,{type:_.ErrorTypes.MUX_ERROR,details:_.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ge,reason:"fail allocating video mdat "+ge});return}var me=new DataView(Ee.buffer);me.setUint32(0,ge),Ee.set(O.default.types.mdat,4);for(var he=0;he<F;he++){for(var pe=x[he],De=pe.units,Pe=0,Le=0,be=De.length;Le<be;Le++){var Se=De[Le],ye=Se.data,Ce=Se.data.byteLength;me.setUint32($,Ce),$+=4,Ee.set(ye,$),$+=Ce,Pe+=4+Ce}if(he<F-1)W=x[he+1].dts-pe.dts;else{var Oe=this.config,Re=pe.dts-x[he>0?he-1:he].dts;if(Oe.stretchShortVideoTrack&&this.nextAudioPts!==null){var Be=Math.floor(Oe.maxBufferHole*y),Ie=(v?z+v*y:this.nextAudioPts)-pe.pts;Ie>Be?(W=Ie-Re,W<0&&(W=Re),R.logger.log("[mp4-remuxer]: It is approximately "+Ie/90+" ms to the next segment; using duration "+W/90+" ms for the last video frame.")):W=Re}else W=Re}var we=Math.round(pe.pts-pe.dts);I.push(new m(pe.key,W,Pe,we))}if(I.length&&E&&E<70){var _e=I[0].flags;_e.dependsOn=2,_e.isNonSync=0}console.assert(W!==void 0,"mp4SampleDuration must be computed"),this.nextAvcDts=k=H+W,this.isVideoContiguous=!0;var Ue=O.default.moof(u.sequenceNumber++,G,D({},u,{samples:I})),ke="video",Ne={data1:Ue,data2:Ee,startPTS:z/y,endPTS:(V+W)/y,startDTS:G/y,endDTS:k/y,type:ke,hasAudio:!1,hasVideo:!0,nb:I.length,dropped:u.dropped};return u.samples=[],u.dropped=0,console.assert(Ee.length,"MDAT length must not be zero"),Ne},a.remuxAudio=function(u,t,n,v,y){var x=u.inputTimeScale,I=u.samplerate?u.samplerate:x,F=x/I,U=u.isAAC?A:L,k=U*F,$=this._initPTS,W=!u.isAAC&&this.typeSupported.mpeg,G=[],H=u.samples,z=W?0:8,V=this.nextAudioPts||-1,Y=t*x;if(this.isAudioContiguous=n=n||H.length&&V>0&&(v&&Math.abs(Y-V)<9e3||Math.abs(r(H[0].pts-$,Y)-V)<20*k),H.forEach(function(ye){ye.pts=r(ye.pts-$,Y)}),!n||V<0){if(H=H.filter(function(ye){return ye.pts>=0}),!H.length)return;y===0?V=0:v?V=Math.max(0,Y):V=H[0].pts}if(u.isAAC)for(var Q=y!==void 0,X=this.config.maxAudioFramesDrift,q=0,J=V;q<H.length;q++){var Z=H[q],ee=Z.pts,te=ee-J,re=Math.abs(1e3*te/x);if(te<=-X*k&&Q)q===0&&(R.logger.warn("Audio frame @ "+(ee/x).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*te/x)+" ms."),this.nextAudioPts=V=J=ee);else if(te>=X*k&&re<c&&Q){var ne=Math.round(te/k);J=ee-ne*k,J<0&&(ne--,J+=k),q===0&&(this.nextAudioPts=V=J),R.logger.warn("[mp4-remuxer]: Injecting "+ne+" audio frame @ "+(J/x).toFixed(3)+"s due to "+Math.round(1e3*te/x)+" ms gap.");for(var se=0;se<ne;se++){var ie=Math.max(J,0),oe=P.default.getSilentFrame(u.manifestCodec||u.codec,u.channelCount);oe||(R.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),oe=Z.unit.subarray()),H.splice(q,0,{unit:oe,pts:ie}),J+=k,q++}}Z.pts=J,J+=k}for(var de=null,le=null,fe,ue=0,ce=H.length;ce--;)ue+=H[ce].unit.byteLength;for(var ae=0,xe=H.length;ae<xe;ae++){var Ae=H[ae],Te=Ae.unit,ve=Ae.pts;if(le!==null){var ge=G[ae-1];ge.duration=Math.round((ve-le)/F)}else if(n&&u.isAAC&&(ve=V),de=ve,ue>0){ue+=z;try{fe=new Uint8Array(ue)}catch{this.observer.emit(w.Events.ERROR,w.Events.ERROR,{type:_.ErrorTypes.MUX_ERROR,details:_.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ue,reason:"fail allocating audio mdat "+ue});return}if(!W){var Ee=new DataView(fe.buffer);Ee.setUint32(0,ue),fe.set(O.default.types.mdat,4)}}else return;fe.set(Te,z);var me=Te.byteLength;z+=me,G.push(new m(!0,U,me,0)),le=ve}var he=G.length;if(!!he){var pe=G[G.length-1];this.nextAudioPts=V=le+F*pe.duration;var De=W?new Uint8Array(0):O.default.moof(u.sequenceNumber++,de/F,D({},u,{samples:G}));u.samples=[];var Pe=de/x,Le=V/x,be="audio",Se={data1:De,data2:fe,startPTS:Pe,endPTS:Le,startDTS:Pe,endDTS:Le,type:be,hasAudio:!0,hasVideo:!1,nb:he};return this.isAudioContiguous=!0,console.assert(fe.length,"MDAT length must not be zero"),Se}},a.remuxEmptyAudio=function(u,t,n,v){var y=u.inputTimeScale,x=u.samplerate?u.samplerate:y,I=y/x,F=this.nextAudioPts,U=(F!==null?F:v.startDTS*y)+this._initDTS,k=v.endDTS*y+this._initDTS,$=I*A,W=Math.ceil((k-U)/$),G=P.default.getSilentFrame(u.manifestCodec||u.codec,u.channelCount);if(R.logger.warn("[mp4-remuxer]: remux empty Audio"),!G){R.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var H=[],z=0;z<W;z++){var V=U+z*$;H.push({unit:G,pts:V,dts:V})}return u.samples=H,this.remuxAudio(u,t,n,!1)},a.remuxID3=function(u,t){var n=u.samples.length;if(!!n){for(var v=u.inputTimeScale,y=this._initPTS,x=this._initDTS,I=0;I<n;I++){var F=u.samples[I];F.pts=r(F.pts-y,t*v)/v,F.dts=r(F.dts-x,t*v)/v}var U=u.samples;return u.samples=[],{samples:U}}},a.remuxText=function(u,t){var n=u.samples.length;if(!!n){for(var v=u.inputTimeScale,y=this._initPTS,x=0;x<n;x++){var I=u.samples[x];I.pts=r(I.pts-y,t*v)/v}u.samples.sort(function(U,k){return U.pts-k.pts});var F=u.samples;return u.samples=[],{samples:F}}},e}();function r(e,a){var h;if(a===null)return e;for(a<e?h=-8589934592:h=8589934592;Math.abs(e-a)>4294967296;)e+=h;return e}function p(e){for(var a=0;a<e.length;a++)if(e[a].key)return a;return-1}var m=function(a,h,u,t){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=h,this.size=u,this.cts=t,this.flags=new l(a)},l=function(a){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=a?2:1,this.isNonSync=a?0:1}},"./src/remux/passthrough-remuxer.ts":function(K,M,S){S.r(M);var B=S("./src/polyfills/number.ts"),P=S("./src/utils/mp4-tools.ts"),O=S("./src/loader/fragment.ts"),w=S("./src/utils/logger.ts"),_=function(){function T(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var D=T.prototype;return D.destroy=function(){},D.resetTimeStamp=function(A){this.initPTS=A,this.lastEndDTS=null},D.resetNextTimestamp=function(){this.lastEndDTS=null},D.resetInitSegment=function(A,L,E){this.audioCodec=L,this.videoCodec=E,this.generateInitSegment(A),this.emitInitSegment=!0},D.generateInitSegment=function(A){var L=this.audioCodec,E=this.videoCodec;if(!A||!A.byteLength){this.initTracks=void 0,this.initData=void 0;return}var g=this.initData=Object(P.parseInitSegment)(A);L||(L=C(g.audio,O.ElementaryStreamTypes.AUDIO)),E||(E=C(g.video,O.ElementaryStreamTypes.VIDEO));var o={};g.audio&&g.video?o.audiovideo={container:"video/mp4",codec:L+","+E,initSegment:A,id:"main"}:g.audio?o.audio={container:"audio/mp4",codec:L,initSegment:A,id:"audio"}:g.video?o.video={container:"video/mp4",codec:E,initSegment:A,id:"main"}:w.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=o},D.remux=function(A,L,E,g,o){var f=this.initPTS,r=this.lastEndDTS,p={audio:void 0,video:void 0,text:g,id3:E,initSegment:void 0};Object(B.isFiniteNumber)(r)||(r=this.lastEndDTS=o||0);var m=L.samples;if(!m||!m.length)return p;var l={initPTS:void 0,timescale:1},e=this.initData;if((!e||!e.length)&&(this.generateInitSegment(m),e=this.initData),!e||!e.length)return w.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),p;this.emitInitSegment&&(l.tracks=this.initTracks,this.emitInitSegment=!1),Object(B.isFiniteNumber)(f)||(this.initPTS=l.initPTS=f=R(e,m,r));var a=Object(P.getDuration)(m,e),h=r,u=a+h;Object(P.offsetStartDTS)(e,m,f),a>0?this.lastEndDTS=u:(w.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var t=!!e.audio,n=!!e.video,v="";t&&(v+="audio"),n&&(v+="video");var y={data1:m,startPTS:h,startDTS:h,endPTS:u,endDTS:u,type:v,hasAudio:t,hasVideo:n,nb:1,dropped:0};return p.audio=y.type==="audio"?y:void 0,p.video=y.type!=="audio"?y:void 0,p.text=g,p.id3=E,p.initSegment=l,p},T}(),R=function(D,c,A){return Object(P.getStartDTS)(D,c)-A};function C(T,D){var c=T==null?void 0:T.codec;return c&&c.length>4?c:c==="hvc1"?"hvc1.1.c.L120.90":c==="av01"?"av01.0.04M.08":c==="avc1"||D===O.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}M.default=_},"./src/task-loop.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return B});var B=function(){function P(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var O=P.prototype;return O.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},O.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},O.onHandlerDestroyed=function(){},O.hasInterval=function(){return!!this._tickInterval},O.hasNextTick=function(){return!!this._tickTimer},O.setInterval=function(_){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,_),!0)},O.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},O.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},O.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},O.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},O.doTick=function(){},P}()},"./src/types/cmcd.ts":function(K,M,S){S.r(M),S.d(M,"CMCDVersion",function(){return B}),S.d(M,"CMCDObjectType",function(){return P}),S.d(M,"CMCDStreamingFormat",function(){return O}),S.d(M,"CMCDStreamType",function(){return w});var B=1,P;(function(_){_.MANIFEST="m",_.AUDIO="a",_.VIDEO="v",_.MUXED="av",_.INIT="i",_.CAPTION="c",_.TIMED_TEXT="tt",_.KEY="k",_.OTHER="o"})(P||(P={}));var O;(function(_){_.DASH="d",_.HLS="h",_.SMOOTH="s",_.OTHER="o"})(O||(O={}));var w;(function(_){_.VOD="v",_.LIVE="l"})(w||(w={}))},"./src/types/level.ts":function(K,M,S){S.r(M),S.d(M,"HlsSkip",function(){return O}),S.d(M,"getSkipValue",function(){return w}),S.d(M,"HlsUrlParameters",function(){return _}),S.d(M,"Level",function(){return R});function B(C,T){for(var D=0;D<T.length;D++){var c=T[D];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(C,c.key,c)}}function P(C,T,D){return T&&B(C.prototype,T),D&&B(C,D),C}var O;(function(C){C.No="",C.Yes="YES",C.v2="v2"})(O||(O={}));function w(C,T){var D=C.canSkipUntil,c=C.canSkipDateRanges,A=C.endSN,L=T!==void 0?T-A:0;return D&&L<D?c?O.v2:O.Yes:O.No}var _=function(){function C(D,c,A){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=D,this.part=c,this.skip=A}var T=C.prototype;return T.addDirectives=function(c){var A=new self.URL(c);return this.msn!==void 0&&A.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&A.searchParams.set("_HLS_part",this.part.toString()),this.skip&&A.searchParams.set("_HLS_skip",this.skip),A.toString()},C}(),R=function(){function C(T){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[T.url],this.attrs=T.attrs,this.bitrate=T.bitrate,T.details&&(this.details=T.details),this.id=T.id||0,this.name=T.name,this.width=T.width||0,this.height=T.height||0,this.audioCodec=T.audioCodec,this.videoCodec=T.videoCodec,this.unknownCodecs=T.unknownCodecs,this.codecSet=[T.videoCodec,T.audioCodec].filter(function(D){return D}).join(",").replace(/\.[^.,]+/g,"")}return P(C,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(D){var c=D%this.url.length;this._urlId!==c&&(this.details=void 0,this._urlId=c)}}]),C}()},"./src/types/loader.ts":function(K,M,S){S.r(M),S.d(M,"PlaylistContextType",function(){return B}),S.d(M,"PlaylistLevelType",function(){return P});var B;(function(O){O.MANIFEST="manifest",O.LEVEL="level",O.AUDIO_TRACK="audioTrack",O.SUBTITLE_TRACK="subtitleTrack"})(B||(B={}));var P;(function(O){O.MAIN="main",O.AUDIO="audio",O.SUBTITLE="subtitle"})(P||(P={}))},"./src/types/transmuxer.ts":function(K,M,S){S.r(M),S.d(M,"ChunkMetadata",function(){return B});var B=function(w,_,R,C,T,D){C===void 0&&(C=0),T===void 0&&(T=-1),D===void 0&&(D=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=P(),this.buffering={audio:P(),video:P(),audiovideo:P()},this.level=w,this.sn=_,this.id=R,this.size=C,this.part=T,this.partial=D};function P(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(K,M,S){S.r(M),S.d(M,"AttrList",function(){return O});var B=/^(\d+)x(\d+)$/,P=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,O=function(){function w(R){typeof R=="string"&&(R=w.parseAttrList(R));for(var C in R)R.hasOwnProperty(C)&&(this[C]=R[C])}var _=w.prototype;return _.decimalInteger=function(C){var T=parseInt(this[C],10);return T>Number.MAX_SAFE_INTEGER?1/0:T},_.hexadecimalInteger=function(C){if(this[C]){var T=(this[C]||"0x").slice(2);T=(T.length&1?"0":"")+T;for(var D=new Uint8Array(T.length/2),c=0;c<T.length/2;c++)D[c]=parseInt(T.slice(c*2,c*2+2),16);return D}else return null},_.hexadecimalIntegerAsNumber=function(C){var T=parseInt(this[C],16);return T>Number.MAX_SAFE_INTEGER?1/0:T},_.decimalFloatingPoint=function(C){return parseFloat(this[C])},_.optionalFloat=function(C,T){var D=this[C];return D?parseFloat(D):T},_.enumeratedString=function(C){return this[C]},_.bool=function(C){return this[C]==="YES"},_.decimalResolution=function(C){var T=B.exec(this[C]);if(T!==null)return{width:parseInt(T[1],10),height:parseInt(T[2],10)}},w.parseAttrList=function(C){var T,D={},c='"';for(P.lastIndex=0;(T=P.exec(C))!==null;){var A=T[2];A.indexOf(c)===0&&A.lastIndexOf(c)===A.length-1&&(A=A.slice(1,-1)),D[T[1]]=A}return D},w}()},"./src/utils/binary-search.ts":function(K,M,S){S.r(M);var B={search:function(O,w){for(var _=0,R=O.length-1,C=null,T=null;_<=R;){C=(_+R)/2|0,T=O[C];var D=w(T);if(D>0)_=C+1;else if(D<0)R=C-1;else return T}return null}};M.default=B},"./src/utils/buffer-helper.ts":function(K,M,S){S.r(M),S.d(M,"BufferHelper",function(){return O});var B=S("./src/utils/logger.ts"),P={length:0,start:function(){return 0},end:function(){return 0}},O=function(){function w(){}return w.isBuffered=function(R,C){try{if(R){for(var T=w.getBuffered(R),D=0;D<T.length;D++)if(C>=T.start(D)&&C<=T.end(D))return!0}}catch{}return!1},w.bufferInfo=function(R,C,T){try{if(R){var D=w.getBuffered(R),c=[],A;for(A=0;A<D.length;A++)c.push({start:D.start(A),end:D.end(A)});return this.bufferedInfo(c,C,T)}}catch{}return{len:0,start:C,end:C,nextStart:void 0}},w.bufferedInfo=function(R,C,T){C=Math.max(0,C),R.sort(function(l,e){var a=l.start-e.start;return a||e.end-l.end});var D=[];if(T)for(var c=0;c<R.length;c++){var A=D.length;if(A){var L=D[A-1].end;R[c].start-L<T?R[c].end>L&&(D[A-1].end=R[c].end):D.push(R[c])}else D.push(R[c])}else D=R;for(var E=0,g,o=C,f=C,r=0;r<D.length;r++){var p=D[r].start,m=D[r].end;if(C+T>=p&&C<m)o=p,f=m,E=f-C;else if(C+T<p){g=p;break}}return{len:E,start:o||0,end:f||0,nextStart:g}},w.getBuffered=function(R){try{return R.buffered}catch(C){return B.logger.log("failed to get media.buffered",C),P}},w}()},"./src/utils/cea-608-parser.ts":function(K,M,S){S.r(M),S.d(M,"Row",function(){return f}),S.d(M,"CaptionScreen",function(){return r});var B=S("./src/utils/logger.ts"),P={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},O=function(u){var t=u;return P.hasOwnProperty(u)&&(t=P[u]),String.fromCharCode(t)},w=15,_=100,R={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},C={17:2,18:4,21:6,22:8,23:10,19:13,20:15},T={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},D={25:2,26:4,29:6,30:8,31:10,27:13,28:15},c=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],A;(function(h){h[h.ERROR=0]="ERROR",h[h.TEXT=1]="TEXT",h[h.WARNING=2]="WARNING",h[h.INFO=2]="INFO",h[h.DEBUG=3]="DEBUG",h[h.DATA=3]="DATA"})(A||(A={}));var L=function(){function h(){this.time=null,this.verboseLevel=A.ERROR}var u=h.prototype;return u.log=function(n,v){this.verboseLevel>=n&&B.logger.log(this.time+" ["+n+"] "+v)},h}(),E=function(u){for(var t=[],n=0;n<u.length;n++)t.push(u[n].toString(16));return t},g=function(){function h(t,n,v,y,x){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=t||"white",this.underline=n||!1,this.italics=v||!1,this.background=y||"black",this.flash=x||!1}var u=h.prototype;return u.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},u.setStyles=function(n){for(var v=["foreground","underline","italics","background","flash"],y=0;y<v.length;y++){var x=v[y];n.hasOwnProperty(x)&&(this[x]=n[x])}},u.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},u.equals=function(n){return this.foreground===n.foreground&&this.underline===n.underline&&this.italics===n.italics&&this.background===n.background&&this.flash===n.flash},u.copy=function(n){this.foreground=n.foreground,this.underline=n.underline,this.italics=n.italics,this.background=n.background,this.flash=n.flash},u.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},h}(),o=function(){function h(t,n,v,y,x,I){this.uchar=void 0,this.penState=void 0,this.uchar=t||" ",this.penState=new g(n,v,y,x,I)}var u=h.prototype;return u.reset=function(){this.uchar=" ",this.penState.reset()},u.setChar=function(n,v){this.uchar=n,this.penState.copy(v)},u.setPenState=function(n){this.penState.copy(n)},u.equals=function(n){return this.uchar===n.uchar&&this.penState.equals(n.penState)},u.copy=function(n){this.uchar=n.uchar,this.penState.copy(n.penState)},u.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},h}(),f=function(){function h(t){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var n=0;n<_;n++)this.chars.push(new o);this.logger=t,this.pos=0,this.currPenState=new g}var u=h.prototype;return u.equals=function(n){for(var v=!0,y=0;y<_;y++)if(!this.chars[y].equals(n.chars[y])){v=!1;break}return v},u.copy=function(n){for(var v=0;v<_;v++)this.chars[v].copy(n.chars[v])},u.isEmpty=function(){for(var n=!0,v=0;v<_;v++)if(!this.chars[v].isEmpty()){n=!1;break}return n},u.setCursor=function(n){this.pos!==n&&(this.pos=n),this.pos<0?(this.logger.log(A.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>_&&(this.logger.log(A.DEBUG,"Too large cursor position "+this.pos),this.pos=_)},u.moveCursor=function(n){var v=this.pos+n;if(n>1)for(var y=this.pos+1;y<v+1;y++)this.chars[y].setPenState(this.currPenState);this.setCursor(v)},u.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},u.insertChar=function(n){n>=144&&this.backSpace();var v=O(n);if(this.pos>=_){this.logger.log(A.ERROR,"Cannot insert "+n.toString(16)+" ("+v+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(v,this.currPenState),this.moveCursor(1)},u.clearFromPos=function(n){var v;for(v=n;v<_;v++)this.chars[v].reset()},u.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},u.clearToEndOfRow=function(){this.clearFromPos(this.pos)},u.getTextString=function(){for(var n=[],v=!0,y=0;y<_;y++){var x=this.chars[y].uchar;x!==" "&&(v=!1),n.push(x)}return v?"":n.join("")},u.setPenStyles=function(n){this.currPenState.setStyles(n);var v=this.chars[this.pos];v.setPenState(this.currPenState)},h}(),r=function(){function h(t){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var n=0;n<w;n++)this.rows.push(new f(t));this.logger=t,this.currRow=w-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var u=h.prototype;return u.reset=function(){for(var n=0;n<w;n++)this.rows[n].clear();this.currRow=w-1},u.equals=function(n){for(var v=!0,y=0;y<w;y++)if(!this.rows[y].equals(n.rows[y])){v=!1;break}return v},u.copy=function(n){for(var v=0;v<w;v++)this.rows[v].copy(n.rows[v])},u.isEmpty=function(){for(var n=!0,v=0;v<w;v++)if(!this.rows[v].isEmpty()){n=!1;break}return n},u.backSpace=function(){var n=this.rows[this.currRow];n.backSpace()},u.clearToEndOfRow=function(){var n=this.rows[this.currRow];n.clearToEndOfRow()},u.insertChar=function(n){var v=this.rows[this.currRow];v.insertChar(n)},u.setPen=function(n){var v=this.rows[this.currRow];v.setPenStyles(n)},u.moveCursor=function(n){var v=this.rows[this.currRow];v.moveCursor(n)},u.setCursor=function(n){this.logger.log(A.INFO,"setCursor: "+n);var v=this.rows[this.currRow];v.setCursor(n)},u.setPAC=function(n){this.logger.log(A.INFO,"pacData = "+JSON.stringify(n));var v=n.row-1;if(this.nrRollUpRows&&v<this.nrRollUpRows-1&&(v=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==v){for(var y=0;y<w;y++)this.rows[y].clear();var x=this.currRow+1-this.nrRollUpRows,I=this.lastOutputScreen;if(I){var F=I.rows[x].cueStartTime,U=this.logger.time;if(F&&U!==null&&F<U)for(var k=0;k<this.nrRollUpRows;k++)this.rows[v-this.nrRollUpRows+k+1].copy(I.rows[x+k])}}this.currRow=v;var $=this.rows[this.currRow];if(n.indent!==null){var W=n.indent,G=Math.max(W-1,0);$.setCursor(n.indent),n.color=$.chars[G].penState.foreground}var H={foreground:n.color,underline:n.underline,italics:n.italics,background:"black",flash:!1};this.setPen(H)},u.setBkgData=function(n){this.logger.log(A.INFO,"bkgData = "+JSON.stringify(n)),this.backSpace(),this.setPen(n),this.insertChar(32)},u.setRollUpRows=function(n){this.nrRollUpRows=n},u.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(A.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(A.TEXT,this.getDisplayText());var n=this.currRow+1-this.nrRollUpRows,v=this.rows.splice(n,1)[0];v.clear(),this.rows.splice(this.currRow,0,v),this.logger.log(A.INFO,"Rolling up")},u.getDisplayText=function(n){n=n||!1;for(var v=[],y="",x=-1,I=0;I<w;I++){var F=this.rows[I].getTextString();F&&(x=I+1,n?v.push("Row "+x+": '"+F+"'"):v.push(F.trim()))}return v.length>0&&(n?y="["+v.join(" | ")+"]":y=v.join(`
`)),y},u.getTextAndFormat=function(){return this.rows},h}(),p=function(){function h(t,n,v){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=n,this.mode=null,this.verbose=0,this.displayedMemory=new r(v),this.nonDisplayedMemory=new r(v),this.lastOutputScreen=new r(v),this.currRollUpRow=this.displayedMemory.rows[w-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=v}var u=h.prototype;return u.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[w-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},u.getHandler=function(){return this.outputFilter},u.setHandler=function(n){this.outputFilter=n},u.setPAC=function(n){this.writeScreen.setPAC(n)},u.setBkgData=function(n){this.writeScreen.setBkgData(n)},u.setMode=function(n){n!==this.mode&&(this.mode=n,this.logger.log(A.INFO,"MODE="+n),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=n)},u.insertChars=function(n){for(var v=0;v<n.length;v++)this.writeScreen.insertChar(n[v]);var y=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(A.INFO,y+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(A.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},u.ccRCL=function(){this.logger.log(A.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},u.ccBS=function(){this.logger.log(A.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},u.ccAOF=function(){},u.ccAON=function(){},u.ccDER=function(){this.logger.log(A.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},u.ccRU=function(n){this.logger.log(A.INFO,"RU("+n+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(n)},u.ccFON=function(){this.logger.log(A.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},u.ccRDC=function(){this.logger.log(A.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},u.ccTR=function(){this.logger.log(A.INFO,"TR"),this.setMode("MODE_TEXT")},u.ccRTD=function(){this.logger.log(A.INFO,"RTD"),this.setMode("MODE_TEXT")},u.ccEDM=function(){this.logger.log(A.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},u.ccCR=function(){this.logger.log(A.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},u.ccENM=function(){this.logger.log(A.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},u.ccEOC=function(){if(this.logger.log(A.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var n=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=n,this.writeScreen=this.nonDisplayedMemory,this.logger.log(A.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},u.ccTO=function(n){this.logger.log(A.INFO,"TO("+n+") - Tab Offset"),this.writeScreen.moveCursor(n)},u.ccMIDROW=function(n){var v={flash:!1};if(v.underline=n%2===1,v.italics=n>=46,v.italics)v.foreground="white";else{var y=Math.floor(n/2)-16,x=["white","green","blue","cyan","red","yellow","magenta"];v.foreground=x[y]}this.logger.log(A.INFO,"MIDROW: "+JSON.stringify(v)),this.writeScreen.setPen(v)},u.outputDataUpdate=function(n){n===void 0&&(n=!1);var v=this.logger.time;v!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=v:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,v,this.lastOutputScreen),n&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:v),this.lastOutputScreen.copy(this.displayedMemory))},u.cueSplitAtTime=function(n){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,n,this.displayedMemory),this.cueStartTime=n))},h}(),m=function(){function h(t,n,v){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var y=new L;this.channels=[null,new p(t,n,y),new p(t+1,v,y)],this.cmdHistory=a(),this.logger=y}var u=h.prototype;return u.getHandler=function(n){return this.channels[n].getHandler()},u.setHandler=function(n,v){this.channels[n].setHandler(v)},u.addData=function(n,v){var y,x,I,F=!1;this.logger.time=n;for(var U=0;U<v.length;U+=2)if(x=v[U]&127,I=v[U+1]&127,!(x===0&&I===0)){if(this.logger.log(A.DATA,"["+E([v[U],v[U+1]])+"] -> ("+E([x,I])+")"),y=this.parseCmd(x,I),y||(y=this.parseMidrow(x,I)),y||(y=this.parsePAC(x,I)),y||(y=this.parseBackgroundAttributes(x,I)),!y&&(F=this.parseChars(x,I),F)){var k=this.currentChannel;if(k&&k>0){var $=this.channels[k];$.insertChars(F)}else this.logger.log(A.WARNING,"No channel found yet. TEXT-MODE?")}!y&&!F&&this.logger.log(A.WARNING,"Couldn't parse cleaned data "+E([x,I])+" orig: "+E([v[U],v[U+1]]))}},u.parseCmd=function(n,v){var y=this.cmdHistory,x=(n===20||n===28||n===21||n===29)&&v>=32&&v<=47,I=(n===23||n===31)&&v>=33&&v<=35;if(!(x||I))return!1;if(e(n,v,y))return l(null,null,y),this.logger.log(A.DEBUG,"Repeated command ("+E([n,v])+") is dropped"),!0;var F=n===20||n===21||n===23?1:2,U=this.channels[F];return n===20||n===21||n===28||n===29?v===32?U.ccRCL():v===33?U.ccBS():v===34?U.ccAOF():v===35?U.ccAON():v===36?U.ccDER():v===37?U.ccRU(2):v===38?U.ccRU(3):v===39?U.ccRU(4):v===40?U.ccFON():v===41?U.ccRDC():v===42?U.ccTR():v===43?U.ccRTD():v===44?U.ccEDM():v===45?U.ccCR():v===46?U.ccENM():v===47&&U.ccEOC():U.ccTO(v-32),l(n,v,y),this.currentChannel=F,!0},u.parseMidrow=function(n,v){var y=0;if((n===17||n===25)&&v>=32&&v<=47){if(n===17?y=1:y=2,y!==this.currentChannel)return this.logger.log(A.ERROR,"Mismatch channel in midrow parsing"),!1;var x=this.channels[y];return x?(x.ccMIDROW(v),this.logger.log(A.DEBUG,"MIDROW ("+E([n,v])+")"),!0):!1}return!1},u.parsePAC=function(n,v){var y,x=this.cmdHistory,I=(n>=17&&n<=23||n>=25&&n<=31)&&v>=64&&v<=127,F=(n===16||n===24)&&v>=64&&v<=95;if(!(I||F))return!1;if(e(n,v,x))return l(null,null,x),!0;var U=n<=23?1:2;v>=64&&v<=95?y=U===1?R[n]:T[n]:y=U===1?C[n]:D[n];var k=this.channels[U];return k?(k.setPAC(this.interpretPAC(y,v)),l(n,v,x),this.currentChannel=U,!0):!1},u.interpretPAC=function(n,v){var y,x={color:null,italics:!1,indent:null,underline:!1,row:n};return v>95?y=v-96:y=v-64,x.underline=(y&1)===1,y<=13?x.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(y/2)]:y<=15?(x.italics=!0,x.color="white"):x.indent=Math.floor((y-16)/2)*4,x},u.parseChars=function(n,v){var y,x=null,I=null;if(n>=25?(y=2,I=n-8):(y=1,I=n),I>=17&&I<=19){var F;I===17?F=v+80:I===18?F=v+112:F=v+144,this.logger.log(A.INFO,"Special char '"+O(F)+"' in channel "+y),x=[F]}else n>=32&&n<=127&&(x=v===0?[n]:[n,v]);if(x){var U=E(x);this.logger.log(A.DEBUG,"Char codes =  "+U.join(",")),l(n,v,this.cmdHistory)}return x},u.parseBackgroundAttributes=function(n,v){var y=(n===16||n===24)&&v>=32&&v<=47,x=(n===23||n===31)&&v>=45&&v<=47;if(!(y||x))return!1;var I,F={};n===16||n===24?(I=Math.floor((v-32)/2),F.background=c[I],v%2===1&&(F.background=F.background+"_semi")):v===45?F.background="transparent":(F.foreground="black",v===47&&(F.underline=!0));var U=n<=23?1:2,k=this.channels[U];return k.setBkgData(F),l(n,v,this.cmdHistory),!0},u.reset=function(){for(var n=0;n<Object.keys(this.channels).length;n++){var v=this.channels[n];v&&v.reset()}this.cmdHistory=a()},u.cueSplitAtTime=function(n){for(var v=0;v<this.channels.length;v++){var y=this.channels[v];y&&y.cueSplitAtTime(n)}},h}();function l(h,u,t){t.a=h,t.b=u}function e(h,u,t){return t.a===h&&t.b===u}function a(){return{a:null,b:null}}M.default=m},"./src/utils/codecs.ts":function(K,M,S){S.r(M),S.d(M,"isCodecType",function(){return P}),S.d(M,"isCodecSupportedInMp4",function(){return O});var B={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function P(w,_){var R=B[_];return!!R&&R[w.slice(0,4)]===!0}function O(w,_){return MediaSource.isTypeSupported((_||"video")+'/mp4;codecs="'+w+'"')}},"./src/utils/cues.ts":function(K,M,S){S.r(M);var B=S("./src/utils/vttparser.ts"),P=S("./src/utils/webvtt-parser.ts"),O=S("./src/utils/texttrack-utils.ts"),w=/\s/,_={newCue:function(C,T,D,c){for(var A=[],L,E,g,o,f,r=self.VTTCue||self.TextTrackCue,p=0;p<c.rows.length;p++)if(L=c.rows[p],g=!0,o=0,f="",!L.isEmpty()){for(var m=0;m<L.chars.length;m++)w.test(L.chars[m].uchar)&&g?o++:(f+=L.chars[m].uchar,g=!1);L.cueStartTime=T,T===D&&(D+=1e-4),o>=16?o--:o++;var l=Object(B.fixLineBreaks)(f.trim()),e=Object(P.generateCueId)(T,D,l);(!C||!C.cues||!C.cues.getCueById(e))&&(E=new r(T,D,l),E.id=e,E.line=p+1,E.align="left",E.position=10+Math.min(80,Math.floor(o*8/32)*10),A.push(E))}return C&&A.length&&(A.sort(function(a,h){return a.line==="auto"||h.line==="auto"?0:a.line>8&&h.line>8?h.line-a.line:a.line-h.line}),A.forEach(function(a){return Object(O.addCueToTrack)(C,a)})),A}};M.default=_},"./src/utils/discontinuities.ts":function(K,M,S){S.r(M),S.d(M,"findFirstFragWithCC",function(){return w}),S.d(M,"shouldAlignOnDiscontinuities",function(){return _}),S.d(M,"findDiscontinuousReferenceFrag",function(){return R}),S.d(M,"adjustSlidingStart",function(){return T}),S.d(M,"alignStream",function(){return D}),S.d(M,"alignPDT",function(){return A}),S.d(M,"alignFragmentByPDTDelta",function(){return L}),S.d(M,"alignMediaPlaylistByPDT",function(){return E});var B=S("./src/polyfills/number.ts"),P=S("./src/utils/logger.ts"),O=S("./src/controller/level-helper.ts");function w(g,o){for(var f=null,r=0,p=g.length;r<p;r++){var m=g[r];if(m&&m.cc===o){f=m;break}}return f}function _(g,o,f){return!!(o.details&&(f.endCC>f.startCC||g&&g.cc<f.startCC))}function R(g,o){var f=g.fragments,r=o.fragments;if(!r.length||!f.length){P.logger.log("No fragments to align");return}var p=w(f,r[0].cc);if(!p||p&&!p.startPTS){P.logger.log("No frag in previous level to align on");return}return p}function C(g,o){if(g){var f=g.start+o;g.start=g.startPTS=f,g.endPTS=f+g.duration}}function T(g,o){for(var f=o.fragments,r=0,p=f.length;r<p;r++)C(f[r],g);o.fragmentHint&&C(o.fragmentHint,g),o.alignedSliding=!0}function D(g,o,f){!o||(c(g,f,o),!f.alignedSliding&&o.details&&A(f,o.details),!f.alignedSliding&&o.details&&!f.skippedSegments&&Object(O.adjustSliding)(o.details,f))}function c(g,o,f){if(_(g,f,o)){var r=R(f.details,o);r&&Object(B.isFiniteNumber)(r.start)&&(P.logger.log("Adjusting PTS using last level due to CC increase within current level "+o.url),T(r.start,o))}}function A(g,o){if(!(!o.fragments.length||!g.hasProgramDateTime||!o.hasProgramDateTime)){var f=o.fragments[0].programDateTime,r=g.fragments[0].programDateTime,p=(r-f)/1e3+o.fragments[0].start;p&&Object(B.isFiniteNumber)(p)&&(P.logger.log("Adjusting PTS using programDateTime delta "+(r-f)+"ms, sliding:"+p.toFixed(3)+" "+g.url+" "),T(p,g))}}function L(g,o){var f=g.programDateTime;if(!!f){var r=(f-o)/1e3;g.start=g.startPTS=r,g.endPTS=r+g.duration}}function E(g,o){if(!(!o.fragments.length||!g.hasProgramDateTime||!o.hasProgramDateTime)){var f=o.fragments[0].programDateTime,r=o.fragments[0].start,p=f-r*1e3;g.fragments.forEach(function(m){L(m,p)}),g.fragmentHint&&L(g.fragmentHint,p),g.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(K,M,S){S.r(M);var B=S("./src/utils/ewma.ts"),P=function(){function O(_,R,C){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=C,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new B.default(_),this.fast_=new B.default(R)}var w=O.prototype;return w.update=function(R,C){var T=this.slow_,D=this.fast_;this.slow_.halfLife!==R&&(this.slow_=new B.default(R,T.getEstimate(),T.getTotalWeight())),this.fast_.halfLife!==C&&(this.fast_=new B.default(C,D.getEstimate(),D.getTotalWeight()))},w.sample=function(R,C){R=Math.max(R,this.minDelayMs_);var T=8*C,D=R/1e3,c=T/D;this.fast_.sample(D,c),this.slow_.sample(D,c)},w.canEstimate=function(){var R=this.fast_;return R&&R.getTotalWeight()>=this.minWeight_},w.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},w.destroy=function(){},O}();M.default=P},"./src/utils/ewma.ts":function(K,M,S){S.r(M);var B=function(){function P(w,_,R){_===void 0&&(_=0),R===void 0&&(R=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=w,this.alpha_=w?Math.exp(Math.log(.5)/w):0,this.estimate_=_,this.totalWeight_=R}var O=P.prototype;return O.sample=function(_,R){var C=Math.pow(this.alpha_,_);this.estimate_=R*(1-C)+C*this.estimate_,this.totalWeight_+=_},O.getTotalWeight=function(){return this.totalWeight_},O.getEstimate=function(){if(this.alpha_){var _=1-Math.pow(this.alpha_,this.totalWeight_);if(_)return this.estimate_/_}return this.estimate_},P}();M.default=B},"./src/utils/fetch-loader.ts":function(K,M,S){S.r(M),S.d(M,"fetchSupported",function(){return L});var B=S("./src/polyfills/number.ts"),P=S("./src/loader/load-stats.ts"),O=S("./src/demux/chunk-cache.ts");function w(r,p){r.prototype=Object.create(p.prototype),r.prototype.constructor=r,D(r,p)}function _(r){var p=typeof Map=="function"?new Map:void 0;return _=function(l){if(l===null||!T(l))return l;if(typeof l!="function")throw new TypeError("Super expression must either be null or a function");if(typeof p!="undefined"){if(p.has(l))return p.get(l);p.set(l,e)}function e(){return R(l,arguments,c(this).constructor)}return e.prototype=Object.create(l.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),D(e,l)},_(r)}function R(r,p,m){return C()?R=Reflect.construct:R=function(e,a,h){var u=[null];u.push.apply(u,a);var t=Function.bind.apply(e,u),n=new t;return h&&D(n,h.prototype),n},R.apply(null,arguments)}function C(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function T(r){return Function.toString.call(r).indexOf("[native code]")!==-1}function D(r,p){return D=Object.setPrototypeOf||function(l,e){return l.__proto__=e,l},D(r,p)}function c(r){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(m){return m.__proto__||Object.getPrototypeOf(m)},c(r)}function A(){return A=Object.assign||function(r){for(var p=1;p<arguments.length;p++){var m=arguments[p];for(var l in m)Object.prototype.hasOwnProperty.call(m,l)&&(r[l]=m[l])}return r},A.apply(this,arguments)}function L(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var E=function(){function r(m){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=m.fetchSetup||o,this.controller=new self.AbortController,this.stats=new P.LoadStats}var p=r.prototype;return p.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},p.abortInternal=function(){var l=this.response;(!l||!l.ok)&&(this.stats.aborted=!0,this.controller.abort())},p.abort=function(){var l;this.abortInternal(),(l=this.callbacks)!==null&&l!==void 0&&l.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},p.load=function(l,e,a){var h=this,u=this.stats;if(u.loading.start)throw new Error("Loader can only be used once.");u.loading.start=self.performance.now();var t=g(l,this.controller.signal),n=a.onProgress,v=l.responseType==="arraybuffer",y=v?"byteLength":"length";this.context=l,this.config=e,this.callbacks=a,this.request=this.fetchSetup(l,t),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){h.abortInternal(),a.onTimeout(u,l,h.response)},e.timeout),self.fetch(this.request).then(function(x){if(h.response=h.loader=x,!x.ok){var I=x.status,F=x.statusText;throw new f(F||"fetch, bad network response",I,x)}return u.loading.first=Math.max(self.performance.now(),u.loading.start),u.total=parseInt(x.headers.get("Content-Length")||"0"),n&&Object(B.isFiniteNumber)(e.highWaterMark)?h.loadProgressively(x,u,l,e.highWaterMark,n):v?x.arrayBuffer():x.text()}).then(function(x){var I=h.response;self.clearTimeout(h.requestTimeout),u.loading.end=Math.max(self.performance.now(),u.loading.first),u.loaded=u.total=x[y];var F={url:I.url,data:x};n&&!Object(B.isFiniteNumber)(e.highWaterMark)&&n(u,l,x,I),a.onSuccess(F,u,l,I)}).catch(function(x){if(self.clearTimeout(h.requestTimeout),!u.aborted){var I=x.code||0;a.onError({code:I,text:x.message},l,x.details)}})},p.getCacheAge=function(){var l=null;if(this.response){var e=this.response.headers.get("age");l=e?parseFloat(e):null}return l},p.loadProgressively=function(l,e,a,h,u){h===void 0&&(h=0);var t=new O.default,n=l.body.getReader(),v=function y(){return n.read().then(function(x){if(x.done)return t.dataLength&&u(e,a,t.flush(),l),Promise.resolve(new ArrayBuffer(0));var I=x.value,F=I.length;return e.loaded+=F,F<h||t.dataLength?(t.push(I),t.dataLength>=h&&u(e,a,t.flush(),l)):u(e,a,I,l),y()}).catch(function(){return Promise.reject()})};return v()},r}();function g(r,p){var m={method:"GET",mode:"cors",credentials:"same-origin",signal:p,headers:new self.Headers(A({},r.headers))};return r.rangeEnd&&m.headers.set("Range","bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)),m}function o(r,p){return new self.Request(r.url,p)}var f=function(r){w(p,r);function p(m,l,e){var a;return a=r.call(this,m)||this,a.code=void 0,a.details=void 0,a.code=l,a.details=e,a}return p}(_(Error));M.default=E},"./src/utils/imsc1-ttml-parser.ts":function(K,M,S){S.r(M),S.d(M,"IMSC1_CODEC",function(){return T}),S.d(M,"parseIMSC1",function(){return L});var B=S("./src/utils/mp4-tools.ts"),P=S("./src/utils/vttparser.ts"),O=S("./src/utils/vttcue.ts"),w=S("./src/demux/id3.ts"),_=S("./src/utils/timescale-conversion.ts"),R=S("./src/utils/webvtt-parser.ts");function C(){return C=Object.assign||function(h){for(var u=1;u<arguments.length;u++){var t=arguments[u];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(h[n]=t[n])}return h},C.apply(this,arguments)}var T="stpp.ttml.im1t",D=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,c=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,A={left:"start",center:"center",right:"end",start:"start",end:"end"};function L(h,u,t,n,v){var y=Object(B.findBox)(new Uint8Array(h),["mdat"]);if(y.length===0){v(new Error("Could not parse IMSC1 mdat"));return}var x=y[0],I=Object(w.utf8ArrayToStr)(new Uint8Array(h,x.start,x.end-x.start)),F=Object(_.toTimescaleFromScale)(u,1,t);try{n(E(I,F))}catch(U){v(U)}}function E(h,u){var t=new DOMParser,n=t.parseFromString(h,"text/xml"),v=n.getElementsByTagName("tt")[0];if(!v)throw new Error("Invalid ttml");var y={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},x=Object.keys(y).reduce(function($,W){return $[W]=v.getAttribute("ttp:"+W)||y[W],$},{}),I=v.getAttribute("xml:space")!=="preserve",F=o(g(v,"styling","style")),U=o(g(v,"layout","region")),k=g(v,"body","[begin]");return[].map.call(k,function($){var W=f($,I);if(!W||!$.hasAttribute("begin"))return null;var G=l($.getAttribute("begin"),x),H=l($.getAttribute("dur"),x),z=l($.getAttribute("end"),x);if(G===null)throw m($);if(z===null){if(H===null)throw m($);z=G+H}var V=new O.default(G-u,z-u,W);V.id=Object(R.generateCueId)(V.startTime,V.endTime,V.text);var Y=U[$.getAttribute("region")],Q=F[$.getAttribute("style")];V.position=10,V.size=80;var X=r(Y,Q),q=X.textAlign;if(q){var J=A[q];J&&(V.lineAlign=J),V.align=q}return C(V,X),V}).filter(function($){return $!==null})}function g(h,u,t){var n=h.getElementsByTagName(u)[0];return n?[].slice.call(n.querySelectorAll(t)):[]}function o(h){return h.reduce(function(u,t){var n=t.getAttribute("xml:id");return n&&(u[n]=t),u},{})}function f(h,u){return[].slice.call(h.childNodes).reduce(function(t,n,v){var y;return n.nodeName==="br"&&v?t+`
`:(y=n.childNodes)!==null&&y!==void 0&&y.length?f(n,u):u?t+n.textContent.trim().replace(/\s+/g," "):t+n.textContent},"")}function r(h,u){var t="http://www.w3.org/ns/ttml#styling",n=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"];return n.reduce(function(v,y){var x=p(u,t,y)||p(h,t,y);return x&&(v[y]=x),v},{})}function p(h,u,t){return h.hasAttributeNS(u,t)?h.getAttributeNS(u,t):null}function m(h){return new Error("Could not parse ttml timestamp "+h)}function l(h,u){if(!h)return null;var t=Object(P.parseTimeStamp)(h);return t===null&&(D.test(h)?t=e(h,u):c.test(h)&&(t=a(h,u))),t}function e(h,u){var t=D.exec(h),n=(t[4]|0)+(t[5]|0)/u.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+n/u.frameRate}function a(h,u){var t=c.exec(h),n=Number(t[1]),v=t[2];switch(v){case"h":return n*3600;case"m":return n*60;case"ms":return n*1e3;case"f":return n/u.frameRate;case"t":return n/u.tickRate}return n}},"./src/utils/logger.ts":function(K,M,S){S.r(M),S.d(M,"enableLogs",function(){return R}),S.d(M,"logger",function(){return C});var B=function(){},P={trace:B,debug:B,log:B,warn:B,info:B,error:B},O=P;function w(T){var D=self.console[T];return D?D.bind(self.console,"["+T+"] >"):B}function _(T){for(var D=arguments.length,c=new Array(D>1?D-1:0),A=1;A<D;A++)c[A-1]=arguments[A];c.forEach(function(L){O[L]=T[L]?T[L].bind(T):w(L)})}function R(T){if(self.console&&T===!0||typeof T=="object"){_(T,"debug","log","info","warn","error");try{O.log()}catch{O=P}}else O=P}var C=O},"./src/utils/mediakeys-helper.ts":function(K,M,S){S.r(M),S.d(M,"KeySystems",function(){return B}),S.d(M,"requestMediaKeySystemAccess",function(){return P});var B;(function(O){O.WIDEVINE="com.widevine.alpha",O.PLAYREADY="com.microsoft.playready"})(B||(B={}));var P=function(){return typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(K,M,S){S.r(M),S.d(M,"getMediaSource",function(){return B});function B(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(K,M,S){S.r(M),S.d(M,"bin2str",function(){return _}),S.d(M,"readUint16",function(){return R}),S.d(M,"readUint32",function(){return C}),S.d(M,"writeUint32",function(){return T}),S.d(M,"findBox",function(){return D}),S.d(M,"parseSegmentIndex",function(){return c}),S.d(M,"parseInitSegment",function(){return A}),S.d(M,"getStartDTS",function(){return L}),S.d(M,"getDuration",function(){return E}),S.d(M,"computeRawDurationFromSamples",function(){return g}),S.d(M,"offsetStartDTS",function(){return o}),S.d(M,"segmentValidRange",function(){return f}),S.d(M,"appendUint8Array",function(){return r});var B=S("./src/utils/typed-array.ts"),P=S("./src/loader/fragment.ts"),O=Math.pow(2,32)-1,w=[].push;function _(p){return String.fromCharCode.apply(null,p)}function R(p,m){"data"in p&&(m+=p.start,p=p.data);var l=p[m]<<8|p[m+1];return l<0?65536+l:l}function C(p,m){"data"in p&&(m+=p.start,p=p.data);var l=p[m]<<24|p[m+1]<<16|p[m+2]<<8|p[m+3];return l<0?4294967296+l:l}function T(p,m,l){"data"in p&&(m+=p.start,p=p.data),p[m]=l>>24,p[m+1]=l>>16&255,p[m+2]=l>>8&255,p[m+3]=l&255}function D(p,m){var l=[];if(!m.length)return l;var e,a,h;"data"in p?(e=p.data,a=p.start,h=p.end):(e=p,a=0,h=e.byteLength);for(var u=a;u<h;){var t=C(e,u),n=_(e.subarray(u+4,u+8)),v=t>1?u+t:h;if(n===m[0])if(m.length===1)l.push({data:e,start:u+8,end:v});else{var y=D({data:e,start:u+8,end:v},m.slice(1));y.length&&w.apply(l,y)}u=v}return l}function c(p){var m=D(p,["moov"]),l=m[0],e=l?l.end:null,a=D(p,["sidx"]);if(!a||!a[0])return null;var h=[],u=a[0],t=u.data[0],n=t===0?8:16,v=C(u,n);n+=4;var y=0,x=0;t===0?n+=8:n+=16,n+=2;var I=u.end+x,F=R(u,n);n+=2;for(var U=0;U<F;U++){var k=n,$=C(u,k);k+=4;var W=$&2147483647,G=($&2147483648)>>>31;if(G===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var H=C(u,k);k+=4,h.push({referenceSize:W,subsegmentDuration:H,info:{duration:H/v,start:I,end:I+W-1}}),I+=W,k+=4,n=k}return{earliestPresentationTime:y,timescale:v,version:t,referencesCount:F,references:h,moovEndOffset:e}}function A(p){for(var m=[],l=D(p,["moov","trak"]),e=0;e<l.length;e++){var a=l[e],h=D(a,["tkhd"])[0];if(h){var u=h.data[h.start],t=u===0?12:20,n=C(h,t),v=D(a,["mdia","mdhd"])[0];if(v){u=v.data[v.start],t=u===0?12:20;var y=C(v,t),x=D(a,["mdia","hdlr"])[0];if(x){var I=_(x.data.subarray(x.start+8,x.start+12)),F={soun:P.ElementaryStreamTypes.AUDIO,vide:P.ElementaryStreamTypes.VIDEO}[I];if(F){var U=D(a,["mdia","minf","stbl","stsd"])[0],k=void 0;U&&(k=_(U.data.subarray(U.start+12,U.start+16))),m[n]={timescale:y,type:F},m[F]={timescale:y,id:n,codec:k}}}}}}var $=D(p,["moov","mvex","trex"]);return $.forEach(function(W){var G=C(W,4),H=m[G];H&&(H.default={duration:C(W,12),flags:C(W,20)})}),m}function L(p,m){return D(m,["moof","traf"]).reduce(function(l,e){var a=D(e,["tfdt"])[0],h=a.data[a.start],u=D(e,["tfhd"]).reduce(function(t,n){var v=C(n,4),y=p[v];if(y){var x=C(a,4);h===1&&(x*=Math.pow(2,32),x+=C(a,8));var I=y.timescale||9e4,F=x/I;if(isFinite(F)&&(t===null||F<t))return F}return t},null);return u!==null&&isFinite(u)&&(l===null||u<l)?u:l},null)||0}function E(p,m){for(var l=0,e=0,a=0,h=D(p,["moof","traf"]),u=0;u<h.length;u++){var t=h[u],n=D(t,["tfhd"])[0],v=C(n,4),y=m[v];if(!!y){var x=y.default,I=C(n,0)|(x==null?void 0:x.flags),F=x==null?void 0:x.duration;I&8&&(I&2?F=C(n,12):F=C(n,8));for(var U=y.timescale||9e4,k=D(t,["trun"]),$=0;$<k.length;$++){if(l=g(k[$]),!l&&F){var W=C(k[$],4);l=F*W}y.type===P.ElementaryStreamTypes.VIDEO?e+=l/U:y.type===P.ElementaryStreamTypes.AUDIO&&(a+=l/U)}}}if(e===0&&a===0){var G=c(p);if(G!=null&&G.references)return G.references.reduce(function(H,z){return H+z.info.duration||0},0)}return e||a}function g(p){var m=C(p,0),l=8;m&1&&(l+=4),m&4&&(l+=4);for(var e=0,a=C(p,4),h=0;h<a;h++){if(m&256){var u=C(p,l);e+=u,l+=4}m&512&&(l+=4),m&1024&&(l+=4),m&2048&&(l+=4)}return e}function o(p,m,l){D(m,["moof","traf"]).forEach(function(e){D(e,["tfhd"]).forEach(function(a){var h=C(a,4),u=p[h];if(!!u){var t=u.timescale||9e4;D(e,["tfdt"]).forEach(function(n){var v=n.data[n.start],y=C(n,4);if(v===0)T(n,4,y-l*t);else{y*=Math.pow(2,32),y+=C(n,8),y-=l*t,y=Math.max(y,0);var x=Math.floor(y/(O+1)),I=Math.floor(y%(O+1));T(n,4,x),T(n,8,I)}})}})})}function f(p){var m={valid:null,remainder:null},l=D(p,["moof"]);if(l){if(l.length<2)return m.remainder=p,m}else return m;var e=l[l.length-1];return m.valid=Object(B.sliceUint8)(p,0,e.start-8),m.remainder=Object(B.sliceUint8)(p,e.start-8),m}function r(p,m){var l=new Uint8Array(p.length+m.length);return l.set(p),l.set(m,p.length),l}},"./src/utils/output-filter.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return B});var B=function(){function P(w,_){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=w,this.trackName=_}var O=P.prototype;return O.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},O.newCue=function(_,R,C){(this.startTime===null||this.startTime>_)&&(this.startTime=_),this.endTime=R,this.screen=C,this.timelineController.createCaptionsTrack(this.trackName)},O.reset=function(){this.cueRanges=[],this.startTime=null},P}()},"./src/utils/texttrack-utils.ts":function(K,M,S){S.r(M),S.d(M,"sendAddTrackEvent",function(){return P}),S.d(M,"addCueToTrack",function(){return O}),S.d(M,"clearCurrentCues",function(){return w}),S.d(M,"removeCuesInRange",function(){return _}),S.d(M,"getCuesInRange",function(){return C});var B=S("./src/utils/logger.ts");function P(T,D){var c;try{c=new Event("addtrack")}catch{c=document.createEvent("Event"),c.initEvent("addtrack",!1,!1)}c.track=T,D.dispatchEvent(c)}function O(T,D){var c=T.mode;if(c==="disabled"&&(T.mode="hidden"),T.cues&&!T.cues.getCueById(D.id))try{if(T.addCue(D),!T.cues.getCueById(D.id))throw new Error("addCue is failed for: "+D)}catch(L){B.logger.debug("[texttrack-utils]: "+L);var A=new self.TextTrackCue(D.startTime,D.endTime,D.text);A.id=D.id,T.addCue(A)}c==="disabled"&&(T.mode=c)}function w(T){var D=T.mode;if(D==="disabled"&&(T.mode="hidden"),T.cues)for(var c=T.cues.length;c--;)T.removeCue(T.cues[c]);D==="disabled"&&(T.mode=D)}function _(T,D,c){var A=T.mode;if(A==="disabled"&&(T.mode="hidden"),T.cues&&T.cues.length>0)for(var L=C(T.cues,D,c),E=0;E<L.length;E++)T.removeCue(L[E]);A==="disabled"&&(T.mode=A)}function R(T,D){if(D<T[0].startTime)return 0;var c=T.length-1;if(D>T[c].endTime)return-1;for(var A=0,L=c;A<=L;){var E=Math.floor((L+A)/2);if(D<T[E].startTime)L=E-1;else if(D>T[E].startTime&&A<c)A=E+1;else return E}return T[A].startTime-D<D-T[L].startTime?A:L}function C(T,D,c){var A=[],L=R(T,D);if(L>-1)for(var E=L,g=T.length;E<g;E++){var o=T[E];if(o.startTime>=D&&o.endTime<=c)A.push(o);else if(o.startTime>c)return A}return A}},"./src/utils/time-ranges.ts":function(K,M,S){S.r(M);var B={toString:function(O){for(var w="",_=O.length,R=0;R<_;R++)w+="["+O.start(R).toFixed(3)+","+O.end(R).toFixed(3)+"]";return w}};M.default=B},"./src/utils/timescale-conversion.ts":function(K,M,S){S.r(M),S.d(M,"toTimescaleFromBase",function(){return P}),S.d(M,"toTimescaleFromScale",function(){return O}),S.d(M,"toMsFromMpegTsClock",function(){return w}),S.d(M,"toMpegTsClockFromTimescale",function(){return _});var B=9e4;function P(R,C,T,D){T===void 0&&(T=1),D===void 0&&(D=!1);var c=R*C*T;return D?Math.round(c):c}function O(R,C,T,D){return T===void 0&&(T=1),D===void 0&&(D=!1),P(R,C,1/T,D)}function w(R,C){return C===void 0&&(C=!1),P(R,1e3,1/B,C)}function _(R,C){return C===void 0&&(C=1),P(R,B,1/C)}},"./src/utils/typed-array.ts":function(K,M,S){S.r(M),S.d(M,"sliceUint8",function(){return B});function B(P,O,w){return Uint8Array.prototype.slice?P.slice(O,w):new Uint8Array(Array.prototype.slice.call(P,O,w))}},"./src/utils/vttcue.ts":function(K,M,S){S.r(M),M.default=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var B=["","lr","rl"],P=["start","middle","end","left","right"];function O(T,D){if(typeof D!="string"||!Array.isArray(T))return!1;var c=D.toLowerCase();return~T.indexOf(c)?c:!1}function w(T){return O(B,T)}function _(T){return O(P,T)}function R(T){for(var D=arguments.length,c=new Array(D>1?D-1:0),A=1;A<D;A++)c[A-1]=arguments[A];for(var L=1;L<arguments.length;L++){var E=arguments[L];for(var g in E)T[g]=E[g]}return T}function C(T,D,c){var A=this,L={enumerable:!0};A.hasBeenReset=!1;var E="",g=!1,o=T,f=D,r=c,p=null,m="",l=!0,e="auto",a="start",h=50,u="middle",t=50,n="middle";Object.defineProperty(A,"id",R({},L,{get:function(){return E},set:function(y){E=""+y}})),Object.defineProperty(A,"pauseOnExit",R({},L,{get:function(){return g},set:function(y){g=!!y}})),Object.defineProperty(A,"startTime",R({},L,{get:function(){return o},set:function(y){if(typeof y!="number")throw new TypeError("Start time must be set to a number.");o=y,this.hasBeenReset=!0}})),Object.defineProperty(A,"endTime",R({},L,{get:function(){return f},set:function(y){if(typeof y!="number")throw new TypeError("End time must be set to a number.");f=y,this.hasBeenReset=!0}})),Object.defineProperty(A,"text",R({},L,{get:function(){return r},set:function(y){r=""+y,this.hasBeenReset=!0}})),Object.defineProperty(A,"region",R({},L,{get:function(){return p},set:function(y){p=y,this.hasBeenReset=!0}})),Object.defineProperty(A,"vertical",R({},L,{get:function(){return m},set:function(y){var x=w(y);if(x===!1)throw new SyntaxError("An invalid or illegal string was specified.");m=x,this.hasBeenReset=!0}})),Object.defineProperty(A,"snapToLines",R({},L,{get:function(){return l},set:function(y){l=!!y,this.hasBeenReset=!0}})),Object.defineProperty(A,"line",R({},L,{get:function(){return e},set:function(y){if(typeof y!="number"&&y!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");e=y,this.hasBeenReset=!0}})),Object.defineProperty(A,"lineAlign",R({},L,{get:function(){return a},set:function(y){var x=_(y);if(!x)throw new SyntaxError("An invalid or illegal string was specified.");a=x,this.hasBeenReset=!0}})),Object.defineProperty(A,"position",R({},L,{get:function(){return h},set:function(y){if(y<0||y>100)throw new Error("Position must be between 0 and 100.");h=y,this.hasBeenReset=!0}})),Object.defineProperty(A,"positionAlign",R({},L,{get:function(){return u},set:function(y){var x=_(y);if(!x)throw new SyntaxError("An invalid or illegal string was specified.");u=x,this.hasBeenReset=!0}})),Object.defineProperty(A,"size",R({},L,{get:function(){return t},set:function(y){if(y<0||y>100)throw new Error("Size must be between 0 and 100.");t=y,this.hasBeenReset=!0}})),Object.defineProperty(A,"align",R({},L,{get:function(){return n},set:function(y){var x=_(y);if(!x)throw new SyntaxError("An invalid or illegal string was specified.");n=x,this.hasBeenReset=!0}})),A.displayState=void 0}return C.prototype.getCueAsHTML=function(){var T=self.WebVTT;return T.convertCueToDOMTree(self,this.text)},C}()},"./src/utils/vttparser.ts":function(K,M,S){S.r(M),S.d(M,"parseTimeStamp",function(){return O}),S.d(M,"fixLineBreaks",function(){return D}),S.d(M,"VTTParser",function(){return c});var B=S("./src/utils/vttcue.ts"),P=function(){function A(){}var L=A.prototype;return L.decode=function(g,o){if(!g)return"";if(typeof g!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(g))},A}();function O(A){function L(g,o,f,r){return(g|0)*3600+(o|0)*60+(f|0)+parseFloat(r||0)}var E=A.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return E?parseFloat(E[2])>59?L(E[2],E[3],0,E[4]):L(E[1],E[2],E[3],E[4]):null}var w=function(){function A(){this.values=Object.create(null)}var L=A.prototype;return L.set=function(g,o){!this.get(g)&&o!==""&&(this.values[g]=o)},L.get=function(g,o,f){return f?this.has(g)?this.values[g]:o[f]:this.has(g)?this.values[g]:o},L.has=function(g){return g in this.values},L.alt=function(g,o,f){for(var r=0;r<f.length;++r)if(o===f[r]){this.set(g,o);break}},L.integer=function(g,o){/^-?\d+$/.test(o)&&this.set(g,parseInt(o,10))},L.percent=function(g,o){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(o)){var f=parseFloat(o);if(f>=0&&f<=100)return this.set(g,f),!0}return!1},A}();function _(A,L,E,g){var o=g?A.split(g):[A];for(var f in o)if(typeof o[f]=="string"){var r=o[f].split(E);if(r.length===2){var p=r[0],m=r[1];L(p,m)}}}var R=new B.default(0,0,""),C=R.align==="middle"?"middle":"center";function T(A,L,E){var g=A;function o(){var p=O(A);if(p===null)throw new Error("Malformed timestamp: "+g);return A=A.replace(/^[^\sa-zA-Z-]+/,""),p}function f(p,m){var l=new w;_(p,function(h,u){var t;switch(h){case"region":for(var n=E.length-1;n>=0;n--)if(E[n].id===u){l.set(h,E[n].region);break}break;case"vertical":l.alt(h,u,["rl","lr"]);break;case"line":t=u.split(","),l.integer(h,t[0]),l.percent(h,t[0])&&l.set("snapToLines",!1),l.alt(h,t[0],["auto"]),t.length===2&&l.alt("lineAlign",t[1],["start",C,"end"]);break;case"position":t=u.split(","),l.percent(h,t[0]),t.length===2&&l.alt("positionAlign",t[1],["start",C,"end","line-left","line-right","auto"]);break;case"size":l.percent(h,u);break;case"align":l.alt(h,u,["start",C,"end","left","right"]);break}},/:/,/\s/),m.region=l.get("region",null),m.vertical=l.get("vertical","");var e=l.get("line","auto");e==="auto"&&R.line===-1&&(e=-1),m.line=e,m.lineAlign=l.get("lineAlign","start"),m.snapToLines=l.get("snapToLines",!0),m.size=l.get("size",100),m.align=l.get("align",C);var a=l.get("position","auto");a==="auto"&&R.position===50&&(a=m.align==="start"||m.align==="left"?0:m.align==="end"||m.align==="right"?100:50),m.position=a}function r(){A=A.replace(/^\s+/,"")}if(r(),L.startTime=o(),r(),A.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+g);A=A.substr(3),r(),L.endTime=o(),r(),f(A,L)}function D(A){return A.replace(/<br(?: \/)?>/gi,`
`)}var c=function(){function A(){this.state="INITIAL",this.buffer="",this.decoder=new P,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var L=A.prototype;return L.parse=function(g){var o=this;g&&(o.buffer+=o.decoder.decode(g,{stream:!0}));function f(){var a=o.buffer,h=0;for(a=D(a);h<a.length&&a[h]!=="\r"&&a[h]!==`
`;)++h;var u=a.substr(0,h);return a[h]==="\r"&&++h,a[h]===`
`&&++h,o.buffer=a.substr(h),u}function r(a){_(a,function(h,u){},/:/)}try{var p="";if(o.state==="INITIAL"){if(!/\r\n|\n/.test(o.buffer))return this;p=f();var m=p.match(/^(Ã¯Â»Â¿)?WEBVTT([ \t].*)?$/);if(!m||!m[0])throw new Error("Malformed WebVTT signature.");o.state="HEADER"}for(var l=!1;o.buffer;){if(!/\r\n|\n/.test(o.buffer))return this;switch(l?l=!1:p=f(),o.state){case"HEADER":/:/.test(p)?r(p):p||(o.state="ID");continue;case"NOTE":p||(o.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(p)){o.state="NOTE";break}if(!p)continue;if(o.cue=new B.default(0,0,""),o.state="CUE",p.indexOf("-->")===-1){o.cue.id=p;continue}case"CUE":if(!o.cue){o.state="BADCUE";continue}try{T(p,o.cue,o.regionList)}catch{o.cue=null,o.state="BADCUE";continue}o.state="CUETEXT";continue;case"CUETEXT":{var e=p.indexOf("-->")!==-1;if(!p||e&&(l=!0)){o.oncue&&o.cue&&o.oncue(o.cue),o.cue=null,o.state="ID";continue}if(o.cue===null)continue;o.cue.text&&(o.cue.text+=`
`),o.cue.text+=p}continue;case"BADCUE":p||(o.state="ID")}}}catch{o.state==="CUETEXT"&&o.cue&&o.oncue&&o.oncue(o.cue),o.cue=null,o.state=o.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},L.flush=function(){var g=this;try{if((g.cue||g.state==="HEADER")&&(g.buffer+=`

`,g.parse()),g.state==="INITIAL"||g.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(o){g.onparsingerror&&g.onparsingerror(o)}return g.onflush&&g.onflush(),this},A}()},"./src/utils/webvtt-parser.ts":function(K,M,S){S.r(M),S.d(M,"generateCueId",function(){return c}),S.d(M,"parseWebVTT",function(){return L});var B=S("./src/polyfills/number.ts"),P=S("./src/utils/vttparser.ts"),O=S("./src/demux/id3.ts"),w=S("./src/utils/timescale-conversion.ts"),_=S("./src/remux/mp4-remuxer.ts"),R=/\r\n|\n\r|\n|\r/g,C=function(g,o,f){return f===void 0&&(f=0),g.substr(f,o.length)===o},T=function(g){var o=parseInt(g.substr(-3)),f=parseInt(g.substr(-6,2)),r=parseInt(g.substr(-9,2)),p=g.length>9?parseInt(g.substr(0,g.indexOf(":"))):0;if(!Object(B.isFiniteNumber)(o)||!Object(B.isFiniteNumber)(f)||!Object(B.isFiniteNumber)(r)||!Object(B.isFiniteNumber)(p))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+g);return o+=1e3*f,o+=60*1e3*r,o+=60*60*1e3*p,o},D=function(g){for(var o=5381,f=g.length;f;)o=o*33^g.charCodeAt(--f);return(o>>>0).toString()};function c(E,g,o){return D(E.toString())+D(g.toString())+D(o)}var A=function(g,o,f){var r=g[o],p=g[r.prevCC];if(!p||!p.new&&r.new){g.ccOffset=g.presentationOffset=r.start,r.new=!1;return}for(;(m=p)!==null&&m!==void 0&&m.new;){var m;g.ccOffset+=r.start-p.start,r.new=!1,r=p,p=g[r.prevCC]}g.presentationOffset=f};function L(E,g,o,f,r,p,m,l){var e=new P.VTTParser,a=Object(O.utf8ArrayToStr)(new Uint8Array(E)).trim().replace(R,`
`).split(`
`),h=[],u=Object(w.toMpegTsClockFromTimescale)(g,o),t="00:00.000",n=0,v=0,y,x=!0,I=!1;e.oncue=function(F){var U=f[r],k=f.ccOffset,$=(n-u)/9e4;if(U!=null&&U.new&&(v!==void 0?k=f.ccOffset=U.start:A(f,r,$)),$&&(k=$-f.presentationOffset),I){var W=F.endTime-F.startTime,G=Object(_.normalizePts)((F.startTime+k-v)*9e4,p*9e4)/9e4;F.startTime=G,F.endTime=G+W}var H=F.text.trim();F.text=decodeURIComponent(encodeURIComponent(H)),F.id||(F.id=c(F.startTime,F.endTime,H)),F.endTime>0&&h.push(F)},e.onparsingerror=function(F){y=F},e.onflush=function(){if(y){l(y);return}m(h)},a.forEach(function(F){if(x)if(C(F,"X-TIMESTAMP-MAP=")){x=!1,I=!0,F.substr(16).split(",").forEach(function(U){C(U,"LOCAL:")?t=U.substr(6):C(U,"MPEGTS:")&&(n=parseInt(U.substr(7)))});try{v=T(t)/1e3}catch(U){I=!1,y=U}return}else F===""&&(x=!1);e.parse(F+`
`)}),e.flush()}},"./src/utils/xhr-loader.ts":function(K,M,S){S.r(M);var B=S("./src/utils/logger.ts"),P=S("./src/loader/load-stats.ts"),O=/^age:\s*[\d.]+\s*$/m,w=function(){function _(C){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=C?C.xhrSetup:null,this.stats=new P.LoadStats,this.retryDelay=0}var R=_.prototype;return R.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},R.abortInternal=function(){var T=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),T&&(T.onreadystatechange=null,T.onprogress=null,T.readyState!==4&&(this.stats.aborted=!0,T.abort()))},R.abort=function(){var T;this.abortInternal(),(T=this.callbacks)!==null&&T!==void 0&&T.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},R.load=function(T,D,c){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=T,this.config=D,this.callbacks=c,this.retryDelay=D.retryDelay,this.loadInternal()},R.loadInternal=function(){var T=this.config,D=this.context;if(!!T){var c=this.loader=new self.XMLHttpRequest,A=this.stats;A.loading.first=0,A.loaded=0;var L=this.xhrSetup;try{if(L)try{L(c,D.url)}catch{c.open("GET",D.url,!0),L(c,D.url)}c.readyState||c.open("GET",D.url,!0);var E=this.context.headers;if(E)for(var g in E)c.setRequestHeader(g,E[g])}catch(o){this.callbacks.onError({code:c.status,text:o.message},D,c);return}D.rangeEnd&&c.setRequestHeader("Range","bytes="+D.rangeStart+"-"+(D.rangeEnd-1)),c.onreadystatechange=this.readystatechange.bind(this),c.onprogress=this.loadprogress.bind(this),c.responseType=D.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),T.timeout),c.send()}},R.readystatechange=function(){var T=this.context,D=this.loader,c=this.stats;if(!(!T||!D)){var A=D.readyState,L=this.config;if(!c.aborted&&A>=2)if(self.clearTimeout(this.requestTimeout),c.loading.first===0&&(c.loading.first=Math.max(self.performance.now(),c.loading.start)),A===4){D.onreadystatechange=null,D.onprogress=null;var E=D.status;if(E>=200&&E<300){c.loading.end=Math.max(self.performance.now(),c.loading.first);var g,o;if(T.responseType==="arraybuffer"?(g=D.response,o=g.byteLength):(g=D.responseText,o=g.length),c.loaded=c.total=o,!this.callbacks)return;var f=this.callbacks.onProgress;if(f&&f(c,T,g,D),!this.callbacks)return;var r={url:D.responseURL,data:g};this.callbacks.onSuccess(r,c,T,D)}else c.retry>=L.maxRetry||E>=400&&E<499?(B.logger.error(E+" while loading "+T.url),this.callbacks.onError({code:E,text:D.statusText},T,D)):(B.logger.warn(E+" while loading "+T.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,L.maxRetryDelay),c.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),L.timeout)}},R.loadtimeout=function(){B.logger.warn("timeout while loading "+this.context.url);var T=this.callbacks;T&&(this.abortInternal(),T.onTimeout(this.stats,this.context,this.loader))},R.loadprogress=function(T){var D=this.stats;D.loaded=T.loaded,T.lengthComputable&&(D.total=T.total)},R.getCacheAge=function(){var T=null;if(this.loader&&O.test(this.loader.getAllResponseHeaders())){var D=this.loader.getResponseHeader("age");T=D?parseFloat(D):null}return T},_}();M.default=w}}).default})})(hls);var Hls=getDefaultExportFromCjs(hls.exports),muiPlayerDesktopPlugin_min={exports:{}};/*!
* Mui Player Desktop Plugin Javascript Library v1.4.2
* Dateï¼š2022-01-24
* Released under GPL-3.0 license
* https://muiplayer.js.org/
*/(function(N,j){function K(R){return B(R)||S(R)||O(R)||M()}function M(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function S(R){if(typeof Symbol!="undefined"&&R[Symbol.iterator]!=null||R["@@iterator"]!=null)return Array.from(R)}function B(R){if(Array.isArray(R))return w(R)}function P(R,C){var T=typeof Symbol!="undefined"&&R[Symbol.iterator]||R["@@iterator"];if(!T){if(Array.isArray(R)||(T=O(R))||C&&R&&typeof R.length=="number"){T&&(R=T);var D=0,C=function(){};return{s:C,n:function(){return D>=R.length?{done:!0}:{done:!1,value:R[D++]}},e:function(g){throw g},f:C}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c,A=!0,L=!1;return{s:function(){T=T.call(R)},n:function(){var E=T.next();return A=E.done,E},e:function(E){L=!0,c=E},f:function(){try{A||T.return==null||T.return()}finally{if(L)throw c}}}}function O(R,C){if(R){if(typeof R=="string")return w(R,C);var T=Object.prototype.toString.call(R).slice(8,-1);return(T=T==="Object"&&R.constructor?R.constructor.name:T)==="Map"||T==="Set"?Array.from(R):T==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(T)?w(R,C):void 0}}function w(R,C){(C==null||C>R.length)&&(C=R.length);for(var T=0,D=new Array(C);T<C;T++)D[T]=R[T];return D}function _(R){return(_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C})(R)}(function(R,C){_(j)=="object"&&_(N)=="object"?N.exports=C():R.MuiPlayerDesktopPlugin=C()})(window,function(){return function(R){function C(){return{defaults:[{functions:"\u5FAA\u73AF\u64AD\u653E",name:"loopPlay",show:!0,model:"switch",selected:!1,onToggle:function(e,a,h){a(),e.event.currentTarget.querySelector(".toogle-switch").classList.contains("open")?c.$el.videoObject.loop=!0:c.$el.videoObject.loop=!1}},{functions:"\u64AD\u653E\u901F\u5EA6",name:"playbackRate",show:!0,model:"select",childConfig:[{functions:"0.25"},{functions:"0.5"},{functions:"0.75"},{functions:"\u6B63\u5E38",selected:!0},{functions:"1.25"},{functions:"1.5"},{functions:"1.75"},{functions:"2"}],onToggle:function(e,a,h){a(),h(),h=c.$method.getLangObject(),e=e.functions,isNaN(parseFloat(e))?(c.$el.videoObject.playbackRate=1,g.rst(h.dsps)):(c.$el.videoObject.playbackRate=parseFloat(e),g.rst(h.tsps.replace("?",e)))}}],subtitle:{functions:"\u5B57\u5E55",name:"subtitle",childConfig:[{functions:"\u6253\u5F00",name:"loopPlay",model:"switch",selected:!0},{functions:"\u9009\u62E9\u8BED\u8A00",childConfig:[],onToggle:function(e,a,h){var u=e.getPanelOption(e.panelIndex,"parent").panelIndex,t=c.$el.videoObject.textTracks;t&&t instanceof TextTrackList?function(){for(var n=0;n<t.length;n++){var v=t[n];e.functions==v.label?(v.mode="showing",e.getPanelOption(u,"parent").childConfig[0].selected=!0,a()):v.mode=="showing"&&(v.mode="hidden")}}():g.rst("the textTracks api is not supported by the browser.")}}],onToggle:function(e,a,h){var u=e.event.currentTarget.querySelector(".toogle-switch").classList.contains("open"),t=c.$el.videoObject.textTracks;t&&t instanceof TextTrackList?function(){if(u)for(var n=0;n<t.length;n++){var v=t[n];v.mode=="showing"&&(v.mode="hidden")}else for(var y=e.getPanelOption(e.panelIndex,"parent").childConfig[1].childConfig,n=0;n<t.length;n++){var x,I=t[n],F=P(y);try{for(F.s();!(x=F.n()).done;){var U=x.value;if(I.label==U.functions&&U.selected==1){I.mode="showing";break}}}catch($){F.e($)}finally{F.f()}}a()}():g.rst("the textTracks api is not supported by the browser.")}}}}function T(e){e=="statics"&&(E=new C().defaults,p.initSubtitleOption()&&E.push(p.initSubtitleOption())),!E.map(function(F){return F.name}).includes("subtitle")&&e!="statics"&&p.initSubtitleOption()&&E.push(p.initSubtitleOption());var a,h=c.$method.getLangObject();for(a in E){var u=E[a].name;u!="loopPlay"?u!="playbackRate"?u!="subtitle"||(E[a].functions=h.subtitles,E[a].childConfig[0].functions=h.open,E[a].childConfig[1].functions=h.selectLangage):(E[a].functions=h.playbackSpeed,E[a].childConfig[3].functions=h.normal):E[a].functions=h.loopPlay}var t=K(R.customSetting||[]);if(t instanceof Array){for(var n=0;n<t.length;n++){var v=E.map(function(F){return F.name});v.indexOf(t[n].name)!=-1&&E.splice(v.indexOf(t[n].name),1)}(function F(){for(var U=0;U<t.length;U++)t[U].show===!1&&(t.splice(U,1),F())})()}var y=(e=c.option).loop,x=e.live;if(y==1||x===!0){for(var I in E)if(E[I].name=="loopPlay"){y==1&&(E[0].selected=!0),x===!0&&E.splice(0,E.length);break}}(e=[].concat(K(E),K(t))).sort(function(F,U){return F=F.zIndex||0,U=U.zIndex||0,U<F?-1:F<U?1:0}),function F(U,k){for(var $=0;$<U.length;$++)U[$].panelIndex=k==null?$.toString():k.toString()+"-"+$,U[$].childConfig instanceof Array&&0<U[$].childConfig.length&&F(U[$].childConfig,U[$].panelIndex)}(L=e)}var D=this,c=(R=R||{},{}),A=new function(){return{popupNodeInfo:{triggerButtonRect:{},popupRect:{}}}},L=null,E=[],g={rst:function(e){c.$method[c.$method.dc("03702W03303B02C03302P037038")](e)}},o={ctxmenuWrapper:function(){return c.$el.mPlayer.querySelector("#ctxmenu-wrapper")},hideShortcutPanel:function(){var e=c.$el.mPlayer.querySelector("#mplayer-shortcut");e&&(e.style.display="none")},hideCtxmenuList:function(e){(e=e||{}).stopPropagation&&e.stopPropagation();var a=o.ctxmenuWrapper().querySelector(".ctxmenulist");a.style.opacity=0,c._this._global_.ctxmenuTimer_1=setTimeout(function(){a.style.display="none"},100)},onCtxmenuFocus:function(e){c._this._global_.ctxmenuTimer_1&&clearTimeout(c._this._global_.ctxmenuTimer_1),c._this._global_.ctxmenuTimer_2&&clearTimeout(c._this._global_.ctxmenuTimer_2),o.ctxmenuWrapper().style.display="block",o.hideShortcutPanel()},onCtxmenuBlur:function(e){(e=e||{}).stopPropagation&&e.stopPropagation(),o.hideCtxmenuList(),c._this._global_.ctxmenuTimer_2=setTimeout(function(){o.ctxmenuWrapper().style.display="none",o.ctxmenuWrapper().removeChild(e.target)},300)},disCtx:function(e,a){for(var h=0;h<e.length;h++){var u=a.map(function(t){return t.name}).indexOf(e[h].name);u!=-1&&a.splice(u,1)}(function t(){for(var n=0;n<e.length;n++)e[n].show!==!1&&e[n].name&&e[n].context||(e.splice(n,1),t())})()},getCtxmenu:function(){var h=new this.dcm,e=[];(e=K(R.contextmenu||[]))instanceof Array&&this.disCtx(e,h);var a,h=[].concat(K(e),K(h)),u=c.$method.getLangObject(),t=P(h);try{for(t.s();!(a=t.n()).done;){var n=a.value;if(n.name=="shortcuts"){n.context=u.shortcuts;break}}}catch(v){t.e(v)}finally{t.f()}return h.sort(function(v,y){return v=v.zIndex||0,y=y.zIndex||0,y<v?-1:v<y?1:0}),h},createCtxmenu:function(e){var a=o.getCtxmenu();if(e.button==2&&a.length!=0){var h=document.createElement("ul");h.setAttribute("class","ctxmenulist"),h.setAttribute("tabindex","0"),h.addEventListener("blur",o.onCtxmenuBlur),o.onCtxmenuFocus();for(var u=a.map(function(I){return I.name}),t=0;t<a.length;t++){var n=document.createElement("li");n.innerText=a[t].context,n.setAttribute("name",a[t].name),n.addEventListener("dblclick",function(I){I.stopPropagation()}),n.addEventListener("mousemove",function(I){I.stopPropagation()}),n.addEventListener("click",function(I){I.stopPropagation(),I=u.indexOf(I.currentTarget.getAttribute("name")),a[I].click instanceof Function&&a[I].click(function(){c.$el.mPlayer.focus()})}),h.appendChild(n)}c.$method.removeNode(o.ctxmenuWrapper(),".ctxmenulist"),o.ctxmenuWrapper().appendChild(h),l.setElScale(h,{fontSize:14});var x=c.$el.mPlayer.getBoundingClientRect(),v=h.getBoundingClientRect(),y=e.clientX-x.left+v.width>x.width?x.width-v.width:e.clientX-x.left,x=e.clientY-x.top+v.height>x.height?x.height-v.height:e.clientY-x.top;h.style.top=x+"px",h.style.left=y+"px",h.focus(),setTimeout(function(){h.style.opacity=1},100)}},dcm:function(){var e=c.$method.dc;return[{name:e("03702W03303603802R039038037"),context:e("IY3JNBTGU"),click:function(){var a=c.$el.mPlayer.querySelector("#mplayer-shortcut");a&&(a.style.display="block"),c.$el.mPlayer.focus()}},{name:e("03103902X03403002P03D02T036"),context:e("02503902X02803002P03D02T036"),click:function(){window.open(e("02W03803803403701M01B01B02V02X03802W03902Q01A02R03303101B03103902X03403002P03D02T03601B02W02T03003003301903103902X03403002P03D02T036"))}}]},onContextmenuEvent:function(e){e.preventDefault()}},f={togglePictureIcon:function(){return document.pictureInPictureElement?'<svg class="off-picture" xmlns="http://www.w3.org/2000/svg"viewBox="0 0 24 24"fill="#ffffff"><path d="m19,7l-14,0l0,10l14,0l0,-10zm4,12l0,-14.02c0,-1.1 -0.9,-1.98 -2,-1.98l-18,0c-1.1,0 -2,0.88 -2,1.98l0,14.02c0,1.1 0.9,2 2,2l18,0c1.1,0 2,-0.9 2,-2zm-2,0.02l-18,0l0,-14.05l18,0l0,14.05z"/><path fill="none"d="m0,0l24,0l0,24l-24,0l0,-24z"/></svg>':'<svg class="on-picture" xmlns="http://www.w3.org/2000/svg"viewBox="0 0 24 24"fill="#ffffff"><path d="M19 11h-8v6h8v-6zm4 8V4.98C23 3.88 22.1 3 21 3H3c-1.1 0-2 .88-2 1.98V19c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2zm-2 .02H3V4.97h18v14.05z"/><path fill="none"d="M0 0h24v24H0V0z"/></svg>'},monitorPictureChange:function(){var e;c._this._global_.webpagePlugin.addMonitorPictureEvent||(c._this._global_.webpagePlugin.addMonitorPictureEvent=!0,e=function(){c.$el.mplayerFooter.querySelector("#picture-in-picture").innerHTML=f.togglePictureIcon()},c.$el.videoObject.addEventListener("enterpictureinpicture",function(a){c._this.emit("pip-change",{pip:!0}),e(),c.$data.isFullScreen&&c.$method.closeFullScreen(),c.$method.setTooltipText(c.$el.mplayerFooter.querySelector("#picture-in-picture"),c.$method.getLangObject().exitPictureInPicture)}),c.$el.videoObject.addEventListener("leavepictureinpicture",function(a){c._this.emit("pip-change",{pip:!1}),e(),c.$method.setTooltipText(c.$el.mplayerFooter.querySelector("#picture-in-picture"),c.$method.getLangObject().pictureInPicture)}))},onPictureInPicture:function(e){e.currentTarget.querySelector("svg").classList.contains("on-picture")?c.$el.videoObject!=document.pictureInPictureElement&&c.$el.videoObject.requestPictureInPicture():document.exitPictureInPicture(),f.monitorPictureChange()}},r={volumeContainer:null,el:null,$el:function(){return{volumeSize:r.volumeContainer.querySelector(".volume-size"),volumeCapacity:r.volumeContainer.querySelector(".volume-capacity"),volumeDragBall:r.volumeContainer.querySelector(".volume-drag-ball"),progressBar:r.volumeContainer.querySelector(".progress-bar")}},data:null,$data:function(){return{startY:null,moveY:null,_defaultVolumeSize:null,_capacityRect:{},_dragBallRect:{}}},toggleVolumeControl:function(e){var a;e=r.getStorageVolume().muted===!0?0:e,r.data&&(a=r.data._capacityRect.height*(e/100)-r.data._dragBallRect.height,r.el.volumeDragBall.style.bottom=(0<a?a:0)+"px",r.el.progressBar.style.height=e+"%",r.el.volumeSize.innerText=e+"%"),c.$el.mplayerFooter.querySelector("#volume-switch").innerHTML=r.toggleVolumeIcon()},setVolume:function(e,a){return a=Number.parseFloat(r.data._defaultVolumeSize||0)+(a==null?100:a),100<=a?a=100:a<=0&&(a=0),a=Number.parseInt(a),e instanceof Object&&typeof e.volume=="number"&&(a=e.volume),r.setStorageVolume(a),c.$el.videoObject.volume=a/100,r.toggleVolumeControl(a),a},computeProgress:function(e,a){a(e/r.el.volumeCapacity.getBoundingClientRect().height*100)},keyEventHandle:function(e){var a=c.$method.getKeyCode(e);new Array(13,38,40).indexOf(a)!=-1&&(e.stopPropagation(),e.preventDefault()),a!=13?a!=38?a==40&&m.bottomKeyDown():m.topKeyDown():r.onClickEvent({currentTarget:c.$el.mplayerFooter.querySelector("#volume-switch")},!0)},mouseEventHandle:function(e){switch(e.type){case"mousedown":(function(){r.data.startY=e.clientY;var a=r.el.volumeCapacity.getBoundingClientRect().bottom-e.clientY;r.computeProgress(a,function(h){c.$el.videoObject.muted&&(c.$el.videoObject.muted=!1),h=r.setVolume(!1,h),c._this._global_.webpagePlugin.startDownVolumeSize=h,r.data._defaultVolumeSize=r.el.progressBar.style.height.substr(0,r.el.progressBar.style.height.length-1)||0}),r.el.volumeDragBall.style.boxShadow="0 0 20px 3px "+c.$habit.themeColor,p.focusToggle("OFF"),r.volumeContainer.addEventListener("mousemove",r.mouseEventHandle),r.volumeContainer.addEventListener("mouseup",r.mouseEventHandle)})();break;case"mousemove":(function(){r.data.moveY=e.clientY,r.data.startY||(r.data.startY=e.clientY);var a=r.data.startY-r.data.moveY;r.computeProgress(a,function(h){h=r.setVolume(!1,h),c._this._global_.webpagePlugin.endDownVolumeSize=h})})();break;case"mouseup":r.data._defaultVolumeSize=0,r.el.volumeDragBall.style.boxShadow="none",r.volumeContainer.removeEventListener("mousemove",r.mouseEventHandle),r.volumeContainer.removeEventListener("mouseup",r.mouseEventHandle)}},getStorageVolume:function(){var e={};try{e=JSON.parse(window.localStorage.getItem("mp-player-volume"))||{}}catch{}return e},setStorageVolume:function(t,n){var u=r.getStorageVolume(),h=n!=null?u.volume||100:t,u=n!=null?n:c.$el.videoObject instanceof Element&&c.$el.videoObject.muted,t=new Date().setMonth(new Date().getMonth()+1),n=new Date().getTime();window.localStorage.setItem("mp-player-volume",JSON.stringify({volume:h,muted:u,expiration:t,creation:n}))},toggleVolumeIcon:function(){var e='<svg class="volume-full"fill="#ffffff"viewBox="0 0 24 24"xmlns="http://www.w3.org/2000/svg"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',a='<svg fill="#ffffff"viewBox="0 0 24 24"xmlns="http://www.w3.org/2000/svg"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',h='<svg class="volume-close"fill="#ffffff"viewBox="0 0 24 24"xmlns="http://www.w3.org/2000/svg"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',u=r.getStorageVolume();return u.expiration<=new Date().getTime()?e:u.muted===!0||u.volume==0?h:u.volume<50?a:e},createVolumePopup:function(){var e=new l.popupInstance().createPopupElement();return e.setAttribute("popup-name","volume"),e.innerHTML='<div class="volume-container keyboard-input"id="volume-container"tabindex="0"><div class="volume-size">0%</div><div class="volume-capacity"><div class="volume-drag-ball"></div><div class="progress-bar"></div></div></div>',e.querySelector(".progress-bar").style.backgroundColor=c.$habit.themeColor,r.volumeContainer=e.querySelector("#volume-container"),r.el=new r.$el,r.data=new r.$data,r.volumeContainer.addEventListener("mousedown",r.mouseEventHandle),r.volumeContainer.addEventListener("keydown",r.keyEventHandle),r.volumeContainer.addEventListener("blur",function(){new l.popupInstance().togglePopupVisible("OFF")}),e},showVolumePopup:function(e){var a;e=e||{},c.$data.isTouchMove||(a=c.$el.mPlayer.querySelector(".mp-popup"))||(a=r.createVolumePopup(),e.type=="keydown"&&setTimeout(function(){a.querySelector("#volume-container").focus()},100),c.$el.mplayerFooter.insertBefore(a,c.$el.mplayerFooter.childNodes[0]),c.$data.isFullScreen&&(l.setElScale(a,["width","height"]),l.setElScale(a.querySelector(".volume-capacity"),["width","height"]),l.setElScale(a.querySelector(".volume-drag-ball"),["width","height"]),l.setElScale(a.querySelector(".volume-container"),["fontSize"])),r.data._capacityRect=r.el.volumeCapacity.getBoundingClientRect(),r.data._dragBallRect=r.el.volumeDragBall.getBoundingClientRect(),e=r.getStorageVolume(),r.setVolume(e),new l.popupInstance().setVisiblePopup(a,c.$el.mplayerFooter.querySelector("#volume-switch")))},onClickEvent:function(e,a){var h,u;e.currentTarget.exist!==!1&&(e.currentTarget.querySelector("svg").classList.contains("volume-close")?(r.setStorageVolume(null,!1),h=r.getStorageVolume().volume||100,u=c._this._global_.webpagePlugin.endDownVolumeSize,e=c._this._global_.webpagePlugin.startDownVolumeSize,r.toggleVolumeControl(u==0?e:u||h),c.$el.videoObject.muted=!1):(r.setStorageVolume(null,!0),r.toggleVolumeControl(0),c.$el.videoObject.muted=!0),a===!0&&(c.$method.createTimerCloseControl(),l.showHandleIcon("volume-icon")))}},p={currentFocusPanelId:"",isFocusActive:!1,backPanel:function(e){var a=p.getPanelOption(e,"parent");p.showPanel(a,"previous",e)},selected:function(e){for(var a=c.$el.mPlayer.querySelector(".mp-popup"),h=a.querySelectorAll(".mp-panel-selected"),u=0;u<h.length;u++)h[u].classList.remove("mp-panel-selected");a.querySelector('[panel-index="'+e+'"]').classList.add("mp-panel-selected");for(var t=p.getPanelOption(e,"parent").childConfig||[],u=0;u<t.length;u++)t[u].panelIndex==e?t[u].selected=!0:t[u].selected&&t[u].model!="switch"&&(t[u].selected=!1)},switched:function(e){var a=p.getPanelOption(e);a.selected=!a.selected,e=c.$el.mPlayer.querySelector('.mp-popup [panel-index="'+e+'"] .toogle-switch'),e.classList.remove(a.selected?"close":"open"),e.classList.add(a.selected?"open":"close")},triggerSelected:function(e,a){var h,u;a.stopPropagation(),e&&(e.childConfig instanceof Array&&0<e.childConfig.length?p.showPanel(e):e.model!="switch"&&e.selected===!0||(u=null,(u=(h=p.getPanelOption(e.panelIndex,"parent"))instanceof Array?e:h).onToggle instanceof Function&&u.onToggle({functions:e.functions,panelIndex:e.panelIndex,getPanelOption:p.getPanelOption,event:a},function(t){e.model=="switch"?p.switched(e.panelIndex):p.selected(e.panelIndex),t instanceof Function&&t()},function(t){h instanceof Object&&h.childConfig instanceof Array&&0<h.childConfig.length?setTimeout(function(){p.backPanel(h.panelIndex)},typeof t=="number"?t:100):console.warn("no subpanel configuration options are available")})))},setScalePopup:function(e){if(c.$data.isFullScreen&&e instanceof Element){l.setElScale(e,["width","height",e.classList.contains("mp-popup")?"fontSize":""]),l.setElScale(e.querySelector(".toogle-switch"),["width","height"]),l.setElScale(e.querySelector(".toogle-switch .ball"),["width","height"]);for(var a=e.querySelectorAll(".mp-menuitem"),h=0;h<a.length;h++)l.setElScale(a[h],["height","lineHeight"])}},isNextReady:!0,showPanel:function(e,a,h){var u,t,n,v,y,x,I,F,U;p.isNextReady&&(u=p.createSettingPopup(e),t=c.$el.mPlayer.querySelector(".mp-popup"),n=t.querySelector(".mp-panel-item"),t.appendChild(u.childNodes[0]),e=e instanceof Array?"homeSetting":e.functions,(v=t.querySelector('[panel-name="'+e+'"]')).classList.add("mp-panel-item"),p.setScalePopup(v),y=t.getBoundingClientRect(),x=n.getBoundingClientRect(),I=v.getBoundingClientRect(),e=(e=c.$el.mPlayer.getBoundingClientRect()).height-(e.height-I.bottom)-(e.top+10),F=I.height>=e?e:I.height,v.style.width=I.width+"px",v.style.height=F+"px",v.style.right=(a=="previous"?x.width:-I.width)+"px",e=v.querySelector(".mp-panel-menu .mp-panel-selected"),h=v.querySelector('[panel-index="'+h+'"]'),U=e||h||v.querySelector("[panel-index]"),setTimeout(function(){U.focus()},250),setTimeout(function(){for(var k=t.querySelectorAll(".mp-panel"),$=0;$<k.length;$++)k[$].classList.contains("mp-popup-animation")||k[$].classList.add("mp-popup-animation");t.classList.contains("mp-popup-animation")||t.classList.add("mp-popup-animation"),n.style.opacity=0,n.style.right=(a=="previous"?-x.width:I.width)+"px",y.width!=I.width&&(t.style.width=I.width+"px"),y.height!=F&&(t.style.height=F+"px"),v.style.right="0px",p.currentFocusPanelId=""},30),p.isNextReady=!1,setTimeout(function(){var Y=t.getBoundingClientRect(),k=Y.bottom,$=Y.height,W=Y.left,G=Y.right,H=Y.top,z=Y.width,V=Y.x,Y=Y.y;A.popupNodeInfo.popupRect={bottom:k,height:$,left:W,right:G,top:H,width:z,x:V,y:Y},x.top<v.getBoundingClientRect().top&&(A.popupNodeInfo.popupRect.top=x.top,A.popupNodeInfo.popupRect.height=x.height),p.isNextReady=!0,t.removeChild(n)},250))},getPanelOption:function(e,a){var h=!1,u=null;return function t(n,v){for(var y=0;y<n.length&&!h;y++){var x=n[y];x.panelIndex==e?(h=!0,u=a=="parent"?v:x):x.childConfig instanceof Array&&0<x.childConfig.length&&t(x.childConfig,x)}}(L,L),u},setCurrentModelEl:function(e){var a=e.childConfig,h=e.model||"select",u="";if(h=="select"&&a instanceof Array&&0<a.length){for(var t=0;t<a.length;t++)if(a[t].selected===!0){u=a[t].functions||"";break}}else h=="switch"&&(u='<div class="toogle-switch '+(e.selected?"open":"close")+'" id="toggle-fit" style="background: '+c.$habit.themeColor+';"><div class="ball"></div></div>');return u},createSettingPopup:function(e){var a=new l.popupInstance().createPopupElement();a.setAttribute("popup-name","setting"),e instanceof Array?a.innerHTML='<div class="mp-panel" panel-name="homeSetting"><div class="mp-panel-menu"></div></div>':(a.innerHTML='<div class="mp-panel mp-panel-child" panel-name="'+e.functions+'"><div class="mp-panel-menu"><ul class="mp-menuitem mp-panel-header"><li class="title"><div class="mp-menuitem-content left-arrow-icon">'+e.functions+"</div></li><li></li></ul></div></div>",a.querySelector(".mp-panel-header .title").addEventListener("click",function(I){I.stopPropagation(),p.isFocusActive=!0,p.backPanel(e.panelIndex)}));for(var h=e instanceof Array?e:e.childConfig,u=0;u<h.length;u++){var t,n,v,y=h[u]||{},x=y.model||"select";y.functions&&typeof y.functions=="string"&&((t=document.createElement("ul")).setAttribute("class","mp-menuitem"),t.setAttribute("panel-index",y.panelIndex),t.setAttribute("tabindex","0"),y.selected!==!0||x!="select"||e instanceof Array||t.classList.add("mp-panel-selected"),(n=document.createElement("li")).innerHTML=y.functions,v=document.createElement("li"),(x=document.createElement("div")).setAttribute("class","mp-menuitem-content"),y.childConfig instanceof Array&&0<y.childConfig.length&&x.classList.add("arrow-icon"),y.model=="switch"&&x.classList.add("switch-icon"),x.innerHTML=p.setCurrentModelEl(y),v.appendChild(x),t.appendChild(n),t.appendChild(v),t.addEventListener("click",function(I){var F=p.getPanelOption(I.currentTarget.getAttribute("panel-index"));p.triggerSelected(F,I)}),t.addEventListener("mousedown",function(){p.focusToggle("OFF")}),t.addEventListener("blur",function(I){p.isFocusActive=!1,p.currentFocusPanelId=""}),t.addEventListener("focus",function(I){p.isFocusActive=!0,p.currentFocusPanelId=I.currentTarget.getAttribute("panel-index")}),t.addEventListener("keydown",function(I){p.settingOnKeyDownAction(I)}),a.querySelector(".mp-panel-menu").appendChild(t))}return a},showSettingPopup:function(e){if(e=e||{},!c.$data.isTouchMove){var a=c.$el.mPlayer.querySelector(".mp-popup");if(!a){T(),a=p.createSettingPopup(L),setTimeout(function(){a.querySelector("[panel-index]").focus()},100),c.$el.mplayerFooter.insertBefore(a,c.$el.mplayerFooter.childNodes[0]),p.setScalePopup(a),new l.popupInstance().setVisiblePopup(a,e.currentTarget);for(var h=a.getBoundingClientRect(),e=c.$el.mPlayer.getBoundingClientRect(),e=e.height-(e.height-h.bottom)-(e.top+10),u=h.height>=e?e:h.height,t=a.querySelectorAll(".mp-popup .mp-panel,.mp-popup .mp-panel-menu"),n=0;n<t.length;n++)t[n].style.width=h.width+"px",t[n].style.height=u+"px";a.style.width=h.width+"px",a.style.height=u+"px",a.querySelector(".mp-panel").classList.add("mp-panel-item")}}},focusToggle:function(e){var a=c.$el.mPlayer;e=="ON"?a.classList.contains("mp-keyboard-focus")||a.classList.add("mp-keyboard-focus"):a.classList.contains("mp-keyboard-focus")&&a.classList.remove("mp-keyboard-focus")},settingOnKeyDownAction:function(e){var a=c.$el.mPlayer.querySelector(".mp-popup"),h=c.$method.getKeyCode(e);if(p.focusToggle("ON"),new Array(13,32,37,38,39,40).indexOf(h)!=-1&&(e.stopPropagation(),e.preventDefault()),h!=32&&h!=13)if(h!=37)if(h!=38)if(h!=39){if(h==40){for(t=[],t=(u=p.getPanelOption(p.currentFocusPanelId,"parent"))instanceof Array?u:(u||{}).childConfig||[],v=0;v<t.length;v++)if(t[v].panelIndex==p.currentFocusPanelId){v!=t.length-1?(n=t[v+1].panelIndex,a.querySelector('[panel-index="'+n+'"]').focus()):a.querySelector('[panel-index="'+t[0].panelIndex+'"]').focus();break}}}else(u=p.getPanelOption(p.currentFocusPanelId,"current"))&&u.childConfig instanceof Array&&0<u.childConfig.length&&p.showPanel(u,"next");else{var u,t=[];t=(u=p.getPanelOption(p.currentFocusPanelId,"parent"))instanceof Array?u:(u||{}).childConfig||[];for(var n,v=0;v<t.length;v++)if(t[v].panelIndex==p.currentFocusPanelId){v==0?a.querySelector('[panel-index="'+t[t.length-1].panelIndex+'"]').focus():(n=t[v-1].panelIndex,a.querySelector('[panel-index="'+n+'"]').focus());break}}else{var y=a.querySelector(".mp-panel-header .title");y&&y.click()}else y=p.getPanelOption(p.currentFocusPanelId),p.triggerSelected(y,e)},onSettingKeyDown:function(e,a){e.preventDefault(),c.$el.mplayerFooter.querySelector(".mp-popup").querySelector("[panel-index]").focus(),p.focusToggle("ON"),p.settingOnKeyDownAction(e)},initSubtitleOption:function(){var e=c.$el.videoObject?c.$el.videoObject.textTracks:"";if(e&&e instanceof TextTrackList&&0<e.length){var a=new C().subtitle;a.childConfig[1].childConfig.splice(0,a.childConfig[1].childConfig.length);for(var h=0;h<e.length;h++){var u=e[h];a.childConfig[1].childConfig.push({functions:u.label,selected:u.mode=="showing"})}return a}}},m={toggleVisible:function(e,a){if(e===!0&&c.$data.showScreenControls)return c.$method.createTimerCloseControl(),void(c._this._global_.webpagePlugin.hiddleControl||a instanceof Function&&a());e!==!0||c.$data.showScreenControls||(c.$method.toggleControlsDisplay({type:"showControls"}),c._this._global_.webpagePlugin.hiddleControl=!0,setTimeout(function(){c._this._global_.webpagePlugin.hiddleControl=!1,a instanceof Function&&a()},300))},escKeyDown:function(){new l.popupInstance().togglePopupVisible("OFF"),p.focusToggle("OFF"),c.$el.mPlayer.focus()},confirmKeyDown:function(e){new D.interface()._onAgentMpTap("click"),m.escKeyDown()},leftKeyDown:function(){var e;c.option.live!==!0&&(m.toggleVisible(!0),e=c.$el.videoObject.currentTime-5,c.$data.currentTime=0<e?e:.1,c.$el.videoObject.currentTime=c.$data.currentTime,l.showHandleIcon("progress-back"),new l.popupInstance().togglePopupVisible("OFF"))},rightKeyDown:function(){var e,a;c.option.live!==!0&&(m.toggleVisible(!0),e=c.$data,(a=c.$el.videoObject.currentTime+5)<=e.duration?c.$data.currentTime=a:c.$data.currentTime=Number.parseInt(e.duration),c.$el.videoObject.currentTime=c.$data.currentTime,l.showHandleIcon("progress-forward"),new l.popupInstance().togglePopupVisible("OFF"))},topKeyDown:function(){c.$el.mplayerFooter.querySelector("#volume-switch").exist!==!1&&(m.toggleVisible(!0,function(){var e=r.getStorageVolume(),a=e.volume;e.muted===!0?(c.$el.videoObject.muted=!1,a=5):a+=5,r.showVolumePopup(event),r.setVolume(!1,a)}),l.showHandleIcon("volume-icon"))},bottomKeyDown:function(){c.$el.mplayerFooter.querySelector("#volume-switch").exist!==!1&&(m.toggleVisible(!0,function(){var e=r.getStorageVolume(),a=e.volume;e.muted===!0?(c.$el.videoObject.muted=!1,a=5):a-=5,r.showVolumePopup(event),r.setVolume(!1,a)}),l.showHandleIcon("volume-icon"))},onDocKeydown:function(e){var a=c.$method.getKeyCode(e);new Array(37,38,39,40,32,13).indexOf(a)!=-1&&(e.stopPropagation(),e.preventDefault()),a!=70?a!=77?a!=27?a!=32&&a!=75?a!=37?a!=38?a!=39?a==40&&m.bottomKeyDown():m.rightKeyDown():m.topKeyDown():m.leftKeyDown():m.confirmKeyDown(e):m.escKeyDown():r.onClickEvent({currentTarget:c.$el.mplayerFooter.querySelector("#volume-switch")},!0):(e=c.$el.mplayerFooter.querySelector("#full-switch"))instanceof Element&&e.click()}},l={popupInstance:function(){this.createPopupElement=function(){var e=document.createElement("div");return e.setAttribute("class","mp-popup"),e},this.setVisiblePopup=function(e,a){this.togglePopupVisible("ON");var h=a.getBoundingClientRect(),n=e.getBoundingClientRect(),u=c.$el.mPlayer.getBoundingClientRect(),t=c.$el.touchEffective instanceof Element?c.$el.touchEffective.getBoundingClientRect():{},n=u.width-h.left+u.left-n.width/2-h.width/2;return e.style.right=(12<=n?n:12)+"px",u=u.height-(t.top||h.top-5)+u.top,e.style.bottom=u+"px",A.popupNodeInfo.triggerButtonRect=a.getBoundingClientRect(),A.popupNodeInfo.popupRect=e.getBoundingClientRect(),e},this.togglePopupVisible=function(e){var a=!!c.$el.mPlayer&&c.$el.mPlayer.querySelector(".mp-popup");a&&(a.classList.add("popup-toggle"),e=="OFF"?(c.$el.mPlayer.focus(),a.style.opacity=0,setTimeout(function(){a.parentNode&&a.parentNode.removeChild(a)},110),c._this._global_.webpagePlugin.showSettingState=!1,c.$method.createTimerCloseControl(),document.removeEventListener("mousemove",l.onDocMousemoveEvent)):(setTimeout(function(){a.style.opacity=1},5),setTimeout(function(){a.classList.remove("popup-toggle")},110),c._this._global_.webpagePlugin.showSettingState=!0,setTimeout(function(){c.$method.createTimerCloseControl({type:"cancel"})},100),document.addEventListener("mousemove",l.onDocMousemoveEvent)))}},onEffectiveOverEvent:function(e){var a=(e=e||{}).type||"";if(!c._this._global_.webpagePlugin.showSettingState){var h=function(u){var t=c.$el.touchEffective.querySelectorAll("#progress-total,#progress-buffered,#progress-play");if(u){for(var n=0;n<t.length;n++)t[n].classList.add("progress-hover-scale");c.$el.progressBall.classList.add("hover-scale"),c.$el.touchEffective.querySelector(".mp-tooltip").style.display="block",c.$el.touchEffective.querySelector(".mp-thumbnails").style.display="block"}if(!u){for(n=0;n<t.length;n++)t[n].classList.remove("progress-hover-scale");c.$el.progressBall.classList.remove("hover-scale"),c.$el.touchEffective.querySelector(".mp-tooltip").style.display="none",c.$el.touchEffective.querySelector(".mp-thumbnails").style.display="none"}};switch(a){case"mouseover":h(!0),l.showTimeTooltip(e),l.showThumbnails(e),c.$el.touchEffective.addEventListener("mousemove",l.onEffectiveOverEvent),c.$el.touchEffective.addEventListener("mouseout",l.onEffectiveOverEvent);break;case"mousemove":h(!0),l.showTimeTooltip(e),l.showThumbnails(e);break;case"mouseout":h(!1),c.$el.touchEffective.removeEventListener("mousemove",l.onEffectiveOverEvent),c.$el.touchEffective.removeEventListener("mouseout",l.onEffectiveOverEvent)}}},addControlTooltip:function(e){for(var a=c.$el.mplayerFooter.querySelectorAll(".footer-control"),h=0;h<a.length;h++)a[h].getAttribute("tooltip")&&(a[h].addEventListener("mouseover",function(u){var t,n,v,y=document.createElement("div");y.setAttribute("class","mp-tooltip"),y.innerText=u.currentTarget.getAttribute("tooltip"),c.$el.mplayerFooter.querySelector(".mp-tooltip").exist!==!1||c.$data.isTouchMove||(c.$el.mplayerFooter.insertBefore(y,c.$el.mplayerFooter.childNodes[0]),t=u.currentTarget.getBoundingClientRect(),n=y.getBoundingClientRect(),v=c.$el.mPlayer.getBoundingClientRect(),u=c.$el.touchEffective instanceof Element?c.$el.touchEffective.getBoundingClientRect():{},n=v.width-t.left+v.left-n.width/2-t.width/2,y.style.right=(16<=n?n:16)+"px",v=v.height-(u.top||t.top-5)+v.top,y.style.bottom=v+"px")}),a[h].addEventListener("mouseout",function(u){c.$method.removeNode(c.$el.mplayerFooter,".mp-tooltip")}))},thumbnailStyleAtBottom:function(){var e=typeof R.fullScaling=="number"&&1<=R.fullScaling?R.fullScaling:1.2;return c.$data.isFullScreen?25.6*e:25.92},showThumbnails:function(e){var a,h,u,t=c.$el.touchEffective.querySelector(".mp-thumbnails"),n=0,v=0,I=R.thumbnails||{},y=I.preview||[],x=I.tile||[10,10],I=I.scale||[160,90],F=x[0]||10,U=x[1]||10,k=I[0]||160,$=I[1]||90;y.length!=0&&(a=c.$el.mPlayer.getBoundingClientRect(),h=c.$el.touchEffective.getBoundingClientRect(),u=e.clientX-h.left,c.$method.computeProgress(u,c.$el.touchEffective,function(z){100<=z?z=100:z<=0&&(z=0);var G=parseInt(z/100*c.$data.duration),H=(n=G)%F==0?0:parseInt(n%F)*k,z=n/F<1?0:parseInt(n/F)*$;(function(){v=parseInt(n/(F*U)),c.$el.touchEffective.querySelector('[data-playimage-index="'+v+'"]').exist===!1&&((V=document.createElement("div")).setAttribute("class","preview-image"),V.setAttribute("data-playimage-index",v),V.style.width="100%",V.style.height="100%",y.length>v&&(V.style.backgroundImage="url("+y[v]+")"),t.exist===!1?((t=document.createElement("div")).setAttribute("class","mp-thumbnails thumbnails-scale"),t.style.outline="2px #FFFFFF solid",t.style.width=k+"px",t.style.height=$+"px",t.style.position="absolute",t.style.pointerEvents="none",t.appendChild(V),c.$el.touchEffective.appendChild(t)):t.appendChild(V));for(var V=c.$el.touchEffective.querySelectorAll(".preview-image"),Y=0;Y<V.length;Y++){var Q=V[Y].getAttribute("data-playimage-index");V[Y].style.display=Q!=v?"none":"block"}})(),G=t.getBoundingClientRect(),c.$el.touchEffective.querySelector('[data-playimage-index="'+v+'"]').style.backgroundPosition=-H+"px "+-z+"px",H=l.thumbnailStyleAtBottom(),t.style.bottom=Math.round(H)+"px",z=u-G.width/2,H=h.left-a.left+z,G=a.width-(h.left-a.left+z+G.width),12<=H&&12<=G&&(t.style.left=z+"px")}))},showTimeTooltip:function(e){var a=c.$el.touchEffective.getBoundingClientRect(),h=e.clientX-a.left,u=c.$el.mPlayer.getBoundingClientRect(),t=c.$el.touchEffective.getBoundingClientRect();c.$method.computeProgress(h,c.$el.touchEffective,function(n){100<=n?n=100:n<=0&&(n=0);var v=n/100*c.$data.duration,y=c.$method.formatCurrentTime(v),x=c.$el.touchEffective.querySelector(".mp-tooltip");x.exist===!1&&((x=document.createElement("div")).setAttribute("class","mp-tooltip"),c.$el.touchEffective.appendChild(x)),n=l.thumbnailStyleAtBottom(),x.style.bottom=Math.round(n+2)+"px",v=x.getBoundingClientRect(),x.innerText=y,n=h-v.width/2,y=t.left-u.left+n,v=u.width-(t.left-u.left+n+v.width),12<=y&&12<=v&&(x.style.left=n+"px")})},addFocusKeyboardHandle:function(){for(var e=c.$el.mPlayer.querySelectorAll(".keyboard-input"),a=0;a<e.length;a++)e[a].addEventListener("keydown",function(h){var u=c.$method.getKeyCode(h),t=h.currentTarget.getAttribute("id");new Array(13,32).indexOf(u)!=-1&&(new l.popupInstance().togglePopupVisible("OFF"),u!=32&&(t!="setting-switch"?t!="volume-switch"?h.currentTarget.click():r.showVolumePopup(h):p.showSettingPopup(h)))}),e[a].addEventListener("mousedown",function(h){c._this._global_.webpagePlugin.inputMousedownFlag=!0,p.focusToggle("OFF"),c.$method.createTimerCloseControl()}),e[a].addEventListener("focus",function(h){setTimeout(function(){c._this._global_.webpagePlugin.inputMousedownFlag||p.focusToggle("ON"),c._this._global_.webpagePlugin.inputMousedownFlag=!1,l.onMpMousemoveEvent(),document.activeElement.classList.contains("keyboard-input")&&c.$method.createTimerCloseControl({type:"cancel"})},10)}),e[a].addEventListener("blur",function(){c.$el.mPlayer.querySelector(".mplayer-sidebar.open")||c.$method.createTimerCloseControl()})},onMpMousemoveEvent:function(){c.$data.showScreenControls?c._this._global_.webpagePlugin.showSettingState||c.$method.createTimerCloseControl():c.$method.toggleControlsDisplay({type:"showControls"}),c._this._global_.webpagePlugin.forControlsClose=!1},onMpMouseleaveEvent:function(e){c._this._global_.webpagePlugin.showSettingState||c._this._global_.webpagePlugin.forControlsClose||c.$data.isTouchMove||c.$method.toggleControlsDisplay({type:"hideControls"}),c._this._global_.webpagePlugin.forControlsClose=!0},onDocMousemoveEvent:function(e){var n=A.popupNodeInfo.popupRect,v=A.popupNodeInfo.triggerButtonRect,a=n.left,h=n.left+n.width,u=n.top,t=n.top+n.height,h=e.clientX>a&&e.clientX<h&&e.clientY>u&&e.clientY<t,u=v.left-15,t=v.left+v.width+15,n=n.bottom-5,v=v.bottom+5,v=e.clientX>u&&e.clientX<t&&e.clientY>n&&e.clientY<v;h||v||!p.isNextReady||new l.popupInstance().togglePopupVisible("OFF")},setElScale:function(e,a){var h=typeof R.fullScaling=="number"&&1<=R.fullScaling?R.fullScaling:1.2,u=c.$data.isFullScreen,t={};if(Array.isArray(a)?a.forEach(function(W){t[W]=""}):t=a,e instanceof Element){var n=function(W){return Math.round(W)},v=function(W){return Number(W.replace("px",""))},y=e.getBoundingClientRect(),x=e.getAttribute("stylesheet");try{x=x?JSON.parse(x):{}}catch{}var I,F,U,k,$=function(){e.style.lineHeight=u?n((t.lineHeight||y.height)*h)+"px":(t.lineHeight||n(y.height*h))+"px"};for(I in t)switch(I){case"width":k=void 0,u?(k=n((t.width||y.width)*h),e.style.width=(k%2==0?k:k+1)+"px"):e.style.width=t.width?t.width+"px":x.width||n(y.width/h)+"px";break;case"height":U=void 0,u?(U=n((t.height||y.height)*h),e.style.height=(U%2==0?U:U+1)+"px"):e.style.height=t.height?t.height+"px":x.height||n(y.height/h)+"px";break;case"fontSize":F=void 0,F=document.defaultView.getComputedStyle(e,null).fontSize,e.style.fontSize=u?n((t.fontSize||v(F))*h)+"px":t.fontSize?t.fontSize+"px":x.fontSize||n(v(F)/h)+"px";break;case"lineHeight":case"transform":$()}}},toggles:function(){this.pageFull=function(e){function a(){t.contains("page-fullscreen")||(c._this._global_.webpagePlugin.isPagefull=!0,c.$el.mPlayer.classList.add("page-fullscreen"),u[0].style.display="none",u[1].style.display="block",u[0].parentNode.setAttribute("tooltip",c.$method.getLangObject().exitPageScreen),c._this.emit("pagefull-change",{pagefull:!0})),e instanceof Object&&c.$method.changeVideoSize({type:"pagefulll"})}function h(){t.contains("page-fullscreen")&&(c._this._global_.webpagePlugin.isPagefull=!1,c.$el.mPlayer.classList.remove("page-fullscreen"),u[0].style.display="block",u[1].style.display="none",u[0].parentNode.setAttribute("tooltip",c.$method.getLangObject().pageScreen),c._this.emit("pagefull-change",{pagefull:!1})),e instanceof Object&&c.$method.changeVideoSize({type:"pagefulll"})}var u=c.$el.mPlayer.querySelectorAll("._fullpage,._unfullpage"),t=c.$el.mPlayer.classList;e=="change"?h():e=="initFullFixed"?a():((c.$el.mPlayer.classList.contains("page-fullscreen")?h:a)(),c.$data.isFullScreen&&c.$method.fullToggle())},this.timeControls=function(e){var a=c.$el.mPlayer.querySelector("#current-time");e?function h(){var t=new Date,u=t.getHours()<10?"0"+t.getHours():t.getHours(),t=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes();a&&(a.innerHTML=u+":"+t,a.style.display="inline-block"),c._this._global_.webpagePlugin.timer_1&&clearInterval(c._this._global_.webpagePlugin.timer_1),c._this._global_.webpagePlugin.timer_1=setTimeout(function(){c.$data.isFullScreen&&c.$data.showScreenControls&&h()},1e3)}():a&&(a.style.display="none")},this.scaleControls=function(e){var a=typeof R.fullScaling=="number"&&1<R.fullScaling?R.fullScaling:1.2,h=c.$el.mPlayer.classList;if((!e||!h.contains("fullscreen-scaling"))&&(e||h.contains("fullscreen-scaling"))){for(var u,t,n,v,y,x=[{selector:".mplayer-header,.mplayer-footer",attr:["height"]},{selector:".header-control,.footer-control,.mplayer-sidebar",attr:["width","fontSize"]},{selector:"#mplayer-loading .mplayer-loading__circular",attr:{width:40,height:40}},{selector:".mplayer-shortcut",attr:{width:430}},{selector:".mplayer-shortcut .title",attr:{fontSize:16}},{selector:".mplayer-shortcut .close-shortcut-panel",attr:{fontSize:28}},{selector:".mplayer-shortcut ul",attr:{fontSize:14}},{selector:"#progress-total,#progress-buffered,#progress-play",attr:{height:2}},{selector:"#progress-ball .progress-ball",attr:{width:15,height:15}},{selector:"#mplayer-toast",attr:["fontSize"]},{selector:"#mplayer-footer .spot",attr:["height","width"]}],I=0;I<x.length;I++)for(var F=c.$el.mPlayer.querySelectorAll(x[I].selector),U=0;U<F.length;U++)l.setElScale(F[U],x[I].attr);e?h.add("fullscreen-scaling"):h.remove("fullscreen-scaling"),e?(u="@-webkit-keyframes mp-bezel-fadeout {from{opacity: 1;}to{opacity: 0;-webkit-transform: scale("+1.5*a+");transform: scale("+1.5*a+");}}@keyframes mp-bezel-fadeout {from{opacity: 1;}to{opacity: 0;-webkit-transform: scale("+1.5*a+");transform: scale("+1.5*a+");}}",t=".mp-tooltip {font-size: "+14*a+"px !important;}",n=".mp-thumbnails.thumbnails-scale {-webkit-transform: scale("+a+");-ms-transform: scale("+a+");transform: scale("+a+");-webkit-transform-origin: left bottom;-ms-transform-origin: left bottom;transform-origin: left bottom;}",h=".toast-scaling{font-size: "+14*a+"px !important;}",e=".mp-keyboard-focus .mp-menuitem:focus {box-shadow: inset 0 0 0 "+2*a+"px rgba(27,127,204,0.8) !important;}.mp-keyboard-focus .keyboard-input:focus {box-shadow: inset 0 0 0 "+2*a+"px rgba(27,127,204,0.8) !important;}",a="",c.$el.mPlayer.querySelector("#progress-container")&&(v=c.$el.mPlayer.querySelector("#progress-container").getBoundingClientRect(),y=c.$el.mPlayer.querySelector("#progress-container #progress-total").getBoundingClientRect(),a=".mplayer-footer .progress .progress-container.upper-position {margin-bottom: -"+(v.height-y.height)/2+"px !important;}"),(y=(v=document.getElementsByTagName("head").item(0)).querySelector("#player-scaling-style"))?c.$method.removeNode(v,"#player-scaling-style"):((y=document.createElement("style")).setAttribute("id","player-scaling-style"),y.setAttribute("type","text/css")),y.innerHTML=u+t+n+h+e+a,v.appendChild(y)):c.$method.removeNode(document.getElementsByTagName("head").item(0),"#player-scaling-style")}}},showHandleIcon:function(e){var a='<svg t="1598581427609" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2856" width="24" height="24"><path d="M267.58370352 186.11160469h162.94419765v651.77679062H267.58370352zM593.47209883 186.11160469h162.94419765v651.77679062h-162.94419765z" p-id="2857" fill="#ffffff"></path></svg>',h='<svg t="1598581671973" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2357" width="24" height="24"><path d="M287.49910545 187.55999756l502.5923252 324.51242209-502.5923252 324.44000244z" p-id="2358" fill="#ffffff"></path></svg>',u='<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16579" width="100%" height="100%"><path d="M512 8v237.17647013h237.17647013m148.23529481 266.82352987a59.29411753 59.29411753 0 1 1-59.29411753 59.29411753 59.29411753 59.29411753 0 0 1 59.29411753-59.29411753zM512 245.17647012a326.11764741 326.11764741 0 1 0 326.11764741 326.11764741h118.58823506A444.70588247 444.70588247 0 1 1 512 126.58823506v118.58823507z m-60.77647013 140.17129482l-24.90352987 194.3068237a300.23576494 300.23576494 0 0 1 48.32470617-3.20188247c71.74588247 0 106.72941136 32.61176494 106.72941136 84.34588247a81.79623506 81.79623506 0 0 1-85.68 83.27858766 166.70541136 166.70541136 0 0 1-77.97176494-20.30823507l-13.93411753 46.99058864a191.31247013 191.31247013 0 0 0 93.9811763 22.4131763 137.76988247 137.76988247 0 0 0 146.75294123-137.71058864c0-82.21129383-63.14823506-124.93270617-136.08-124.93270617-11.26588247 0-18.67764741 1.06729383-26.68235259 1.60094123l13.3411763-95.55247012h140.82352987v-51.23011753h-184.70117629z" p-id="16580" fill="#ffffff"></path></svg>',t='<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16817" width="100%" height="100%"><path d="M512 1016A444.70588247 444.70588247 0 0 1 67.29411753 571.29411753a59.29411753 59.29411753 0 0 1 118.58823506 0A326.11764741 326.11764741 0 1 0 512 245.17647012V126.58823506a444.70588247 444.70588247 0 0 1 0 889.41176494z m108.50823506-360.53788247a137.76988247 137.76988247 0 0 1-146.75294123 137.71058864 190.42305877 190.42305877 0 0 1-93.9811763-22.4131763l13.63764741-46.99058864a166.70541136 166.70541136 0 0 0 77.97176493 20.30823507 82.03341136 82.03341136 0 0 0 85.97647013-83.27858766c0-51.79341136-35.28-84.34588247-106.72941136-84.34588247a304.23811753 304.23811753 0 0 0-48.62117728 3.20188247l25.2-194.3068237h184.70117728v51.23011753h-140.82352987l-13.3411763 95.55247012c8.00470617-0.53364741 15.41647013-1.60094123 26.68235259-1.60094123 72.93176494 0 136.08 42.72141136 136.08 124.93270617zM512 8v237.17647013H274.82352987z" p-id="16818" fill="#ffffff"></path></svg>',n=c.$el.mPlayer.querySelector(".mp-bezel-text-hide");switch(e){case"mouseclick":c.$data.isPlay?n.querySelector(".mp-bezel-icon").innerHTML=a:n.querySelector(".mp-bezel-icon").innerHTML=h;break;case"progress-forward":n.querySelector(".mp-bezel-icon").innerHTML=u;break;case"progress-back":n.querySelector(".mp-bezel-icon").innerHTML=t;break;case"volume-icon":n.querySelector(".mp-bezel-icon").innerHTML=r.toggleVolumeIcon()}n.style.display=="none"?n.style.display="block":(n.style.display="none",c._this._global_.webpagePlugin.handleIconTimer_1||(c._this._global_.webpagePlugin.handleIconTimer_1=setTimeout(function(){c._this._global_.webpagePlugin.handleIconTimer_1=!1,n.style.display="block"},15))),c._this._global_.webpagePlugin.handleIconTimer_2&&window.clearTimeout(c._this._global_.webpagePlugin.handleIconTimer_2),c._this._global_.webpagePlugin.handleIconTimer_2=setTimeout(function(){n.style.display="none"},400)},buildBasePanel:function(e){var a=e.querySelector("#right-part"),h=document.createElement("button");h.setAttribute("class","player-btn keyboard-input footer-control"),h.setAttribute("id","volume-switch"),h.setAttribute("control",""),h.innerHTML=r.toggleVolumeIcon(),a.insertBefore(h,a.childNodes[a.childNodes.length-1]),h.addEventListener("mouseover",r.showVolumePopup),h.addEventListener("click",r.onClickEvent),!document.pictureInPictureEnabled||e.querySelector("video").disablePictureInPicture||((u=document.createElement("button")).setAttribute("class","player-btn keyboard-input footer-control picture-in-picture"),u.setAttribute("id","picture-in-picture"),u.setAttribute("tooltip",c.$method.getLangObject().pictureInPicture),u.setAttribute("control",""),u.innerHTML=f.togglePictureIcon(),a.insertBefore(u,a.childNodes[a.childNodes.length-1]),u.addEventListener("click",f.onPictureInPicture)),T("statics");var u=(c.option.subtitle||{}).tracks;(0<L.length||Array.isArray(u)&&0<u.length)&&((t=document.createElement("button")).setAttribute("class","player-btn keyboard-input footer-control"),t.setAttribute("id","setting-switch"),t.setAttribute("control",""),t.innerHTML='<svg t="1607605827678" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2386"><path d="M857.9375 512c0-49.125 30.84375-90.75 74.0625-107.34375-10.3125-40.5-26.25-78.65625-47.0625-113.71875C842.5625 309.78125 791.375 302.09375 756.6875 267.3125c-34.6875-34.6875-42.375-85.96875-23.53125-128.25C698 118.25 659.84375 102.3125 619.34375 92c-16.6875 43.21875-58.3125 74.0625-107.34375 74.0625-49.125 0-90.75-30.84375-107.34375-74.0625-40.5 10.3125-78.65625 26.25-113.71875 47.0625 18.84375 42.375 11.15625 93.5625-23.53125 128.25-34.6875 34.6875-85.96875 42.375-128.25 23.625C118.25 326 102.3125 364.15625 92 404.65625c43.21875 16.6875 74.0625 58.3125 74.0625 107.34375 0 49.125-30.84375 90.75-74.0625 107.34375 10.3125 40.5 26.25 78.65625 47.0625 113.71875C181.4375 714.21875 232.625 721.90625 267.3125 756.6875c34.6875 34.6875 42.375 85.96875 23.53125 128.25C326 905.75 364.15625 921.6875 404.65625 932c16.6875-43.21875 58.3125-74.0625 107.34375-74.0625 49.125 0 90.75 30.84375 107.34375 74.0625 40.5-10.3125 78.65625-26.25 113.71875-47.0625-18.84375-42.375-11.15625-93.5625 23.53125-128.25 34.6875-34.6875 85.96875-42.375 128.25-23.625C905.75 698 921.6875 659.84375 932 619.34375c-43.21875-16.59375-74.0625-58.21875-74.0625-107.34375zM512 627.3125c-63.65625 0-115.3125-51.65625-115.3125-115.3125s51.65625-115.3125 115.3125-115.3125 115.3125 51.65625 115.3125 115.3125-51.65625 115.3125-115.3125 115.3125z" p-id="2387" fill="#ffffff"></path></svg>',t.addEventListener("mouseover",p.showSettingPopup),a.insertBefore(t,a.childNodes[a.childNodes.length-1]));var t=document.createElement("button");t.setAttribute("class","player-btn keyboard-input footer-control"),t.setAttribute("id","pagefull-switch"),t.setAttribute("tooltip",c.$method.getLangObject().pageScreen),t.setAttribute("control",""),t.innerHTML='<div class="_fullpage"controls="full-page"><svg t="1607605504727"class="icon"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"p-id="2356"><path d="M948.90666667 851.69493333H75.09333333c-27.30666667 0-49.152-21.84533333-49.152-43.69066666v-655.36c0-27.30666667 21.84533333-49.152 49.152-49.152h873.81333334c27.30666667 0 43.69066667 21.84533333 43.69066666 49.152v655.36c0 27.30666667-16.384 43.69066667-43.69066666 43.69066666z m-824.66133334-87.38133333h780.97066667V196.33493333H124.24533333v567.97866667z"p-id="2357"fill="#ffffff"></path><path d="M238.93333333 496.70826667c-21.84533333 0-43.69066667-16.384-43.69066666-43.69066667v-136.53333333c0-21.84533333 16.384-43.69066667 43.69066666-43.69066667h136.53333334c21.84533333 0 43.69066667 16.384 43.69066666 43.69066667s-21.84533333 38.22933333-43.69066666 38.22933333H282.624v98.304c0 21.84533333-21.84533333 43.69066667-43.69066667 43.69066667zM785.06666667 687.85493333h-136.53333334c-21.84533333 0-43.69066667-16.384-43.69066666-43.69066666s16.384-43.69066667 43.69066666-43.69066667h92.84266667v-98.304c0-21.84533333 16.384-43.69066667 43.69066667-43.69066667s43.69066667 16.384 43.69066666 43.69066667v141.99466667c-5.46133333 21.84533333-21.84533333 43.69066667-43.69066666 43.69066666z"p-id="2358"fill="#ffffff"></path></svg></div><div class="_unfullpage"controls="unfull-page"style="display: none;"><svg t="1607605550628"class="icon"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"p-id="2519"><path d="M948.90666667 851.69493333H75.09333333c-27.30666667 0-49.152-21.84533333-49.152-43.69066666v-655.36c0-27.30666667 21.84533333-49.152 49.152-49.152h873.81333334c27.30666667 0 43.69066667 21.84533333 43.69066666 49.152v655.36c0 27.30666667-16.384 43.69066667-43.69066666 43.69066666z m-824.66133334-87.38133333h780.97066667V196.33493333H124.24533333v567.97866667z"p-id="2520"fill="#ffffff"></path><path d="M375.46666667 496.70826667H238.93333333c-21.84533333 0-43.69066667-16.384-43.69066666-43.69066667s21.84533333-38.22933333 43.69066666-38.22933333h92.84266667v-98.304c0-21.84533333 16.384-43.69066667 43.69066667-43.69066667s38.22933333 21.84533333 38.22933333 43.69066667v136.53333333c0 21.84533333-16.384 43.69066667-38.22933333 43.69066667zM648.53333333 687.85493333c-21.84533333 0-43.69066667-16.384-43.69066666-43.69066666v-136.53333334c0-21.84533333 16.384-43.69066667 43.69066666-43.69066666H785.06666667c21.84533333 0 43.69066667 16.384 43.69066666 43.69066666s-16.384 43.69066667-43.69066666 43.69066667h-92.84266667v92.84266667c-5.46133333 21.84533333-21.84533333 43.69066667-43.69066667 43.69066666z"p-id="2521"fill="#ffffff"></path></svg></div>',a.insertBefore(t,a.childNodes[a.childNodes.length-1]),t.addEventListener("click",new l.toggles().pageFull),c.$method.removeNode(e,"#back-button #back-icon-svg"),t=document.createElement("button"),c.$method.setElementStyle(t,{fontSize:"18px",color:"#FFFFFF",width:"auto"}),t.setAttribute("class","player-btn header-control"),t.setAttribute("id","current-time"),t.setAttribute("control",""),t.innerHTML='<div id="" style="display: none;"></div>',e.querySelector("#buttom-group").appendChild(t),e.appendChild(c.$method.createRangeIsDocFragment('<div style="display: none;"class="mp-bezel-text-hide"><div class="mp-bezel"><div class="mp-bezel-icon"></div></div></div>')),t=document.createElement("div"),t.setAttribute("class","ctxmenu-wrapper"),t.setAttribute("id","ctxmenu-wrapper"),t.addEventListener("click",function(v){v.stopPropagation()}),e.appendChild(t);var n=document.createElement("div");return n.setAttribute("class","mplayer-shortcut"),n.setAttribute("id","mplayer-shortcut"),t=c.$method.getLangObject().shortcutsPanel,n.innerHTML='<p class="title">'+t.title+'</p><div class="close-shortcut-panel">\xD7</div><ul><li><label>'+t.space+"\uFF1A</label><span>"+t.spaceAction+"</span></li><li><label>Esc\uFF1A</label><span>"+t.esc+"</span></li></ul><ul><li><label>\u2191\uFF1A</label><span>"+t.up+"</span></li><li><label>\u2193\uFF1A</label><span>"+t.down+"</span></li></ul><ul><li><label>\u2192\uFF1A</label><span>"+t.right+"</span></li><li><label>\u2190\uFF1A</label><span>"+t.left+"</span></li></ul>",n.addEventListener("click",function(v){v.stopPropagation()}),n.addEventListener("dblclick",function(v){v.stopPropagation()}),n.addEventListener("mouseup",function(v){v.stopPropagation()}),n.querySelector(".close-shortcut-panel").addEventListener("click",function(){n.style.display="none"}),e.appendChild(n),e},initConfigControls:function(e){c.option.live!=1&&((t=document.createElement("button")).setAttribute("class","player-btn footer-control keyboard-input"),t.setAttribute("style","color: white;display: flex;align-items: center;width: auto;"),t.innerHTML='<div class="progress-begin" id="progress-begin"style="width: initial;margin-right: 5px;font-size: inherit;">'+c.$method.getLangObject().begin+'</div><div class="time-symbol">/</div><div class="progress-long" id="progress-long" style="color: #dddddd;width: initial;margin-left: 5px;font-size: inherit;">'+c.$method.getLangObject().end+"</div>",c.$method.setElementStyle(t,{color:"#FFFFFF",display:"flex",width:"auto"}),c.$method.removeNode(e,"#progress-begin"),c.$method.removeNode(e,"#progress-long"),e.querySelector("#left-part").appendChild(t)),e.querySelector("#progress-ball")&&e.querySelector("#progress-ball").classList.add("default-scale"),e.querySelector(".progress-ball")&&(e.querySelector(".progress-ball").style.height="15px"),e.querySelector(".progress-ball")&&(e.querySelector(".progress-ball").style.width="15px"),e.querySelector("#progress-container")&&e.querySelector("#progress-container").setAttribute("style","left: 12px;right: 12px;"),e.querySelector("#touch-effective")&&(e.querySelector("#touch-effective").style.margin="0");for(var a=e.querySelectorAll("#progress-total,#progress-buffered,#progress-play"),h=0;h<a.length;h++)a[h]&&a[h].classList.add("progress-default-scale");var n=r.getStorageVolume(),u=n.expiration,t=n.muted,n=n.volume;return typeof u=="number"&&u>new Date().getTime()?(typeof t=="boolean"&&(e.querySelector("video").muted=t),typeof n=="number"&&(e.querySelector("video").volume=0<n&&n<100?Number.parseInt(n)/100:1)):(n=c.option.volume,r.setStorageVolume(0<=n&&n<=1?100*n:100)),c.option.muted===!0&&(e.querySelector("video").muted=!0,r.setStorageVolume(null,!0)),e=l.buildBasePanel(e)},onFullscreenChange:function(e){c._this._global_.isReady&&(e.fullscreen?(new l.toggles().pageFull("change"),new l.toggles().timeControls(!0),new l.toggles().scaleControls(!0)):(new l.toggles().scaleControls(!1),new l.toggles().timeControls(!1),new l.popupInstance().togglePopupVisible("OFF")))},onControlsToggle:function(e){e.show||new l.popupInstance().togglePopupVisible("OFF"),c.$data.isFullScreen&&new l.toggles().timeControls(e.show);function a(h){c.$el.mPlayer.style.cursor=h}c._this._global_.webpagePlugin.timer_2&&clearTimeout(c._this._global_.webpagePlugin.timer_2),e.show||!c.$data.isFullScreen&&!c._this._global_.webpagePlugin.isPagefull?a("default"):c._this._global_.webpagePlugin.timer_2=setTimeout(function(){a("none")},1e3)},onReady:function(){var e;typeof c.$el=="function"&&(e=new c.$el,c.$el=e),c.option.initFullFixed===!0&&new l.toggles().pageFull("initFullFixed"),l.addFocusKeyboardHandle(),l.addControlTooltip(),l.toggleEventListenerGlobal("add","playerReady")},onDestory:function(){l.toggleEventListenerGlobal("remove","playerDestory")},onError:function(){l.toggleEventListenerGlobal("remove","playerError")},onAction:function(e){e=e=="add"?"on":"off",c._this[e]("fullscreen-change",l.onFullscreenChange),c._this[e]("controls-toggle",l.onControlsToggle),c._this[e]("ready",l.onReady),c._this[e]("destory",l.onDestory),c._this[e]("error",l.onError)},vaks:function(){return!0},toggleEventListenerGlobal:function(e,a){var h=e=="add"?"addEventListener":"removeEventListener";c._this._global_.webpagePlugin.eventStatus=h,c.$el.touchEffective instanceof Element&&c.$el.touchEffective[h]("mouseover",l.onEffectiveOverEvent),c.$el.mPlayer[h]("mousemove",l.onMpMousemoveEvent),R.leaveHiddenControls===!0&&c.$el.mPlayer[h]("mouseleave",l.onMpMouseleaveEvent),c.$el.mPlayer[h]("keydown",m.onDocKeydown),c.$el.mPlayer[h]("mouseup",o.createCtxmenu),c.$el.mPlayer[h]("contextmenu",o.onContextmenuEvent),a=="playerDestory"&&l.onAction("remove")}};this.interface=function(e){this._onAgentMpTap=function(a){if(a=="click"){if(c.$el.mPlayer.querySelector(".mplayer-sidebar.open"))return void c.$method.toggleControlsDisplay(e);c.$method.onPlayTap({type:"dblscreen"}),l.showHandleIcon("mouseclick"),c._this._global_.webpagePlugin.eventStatus=="removeEventListener"&&this._addEvent()}a=="dbclick"&&c.$method.fullToggle(e)},this._removeEvent=function(){l.toggleEventListenerGlobal("remove","activeRemove")},this._addEvent=function(){l.toggleEventListenerGlobal("add")}},this.appendTemplate=function(e,a){return c={},c=a,console.info("loading mui player desktop plugin..."),l.onAction("add"),e=l.initConfigControls(e),e},this.name="MuiPlayerDesktopPlugin"}})})(muiPlayerDesktopPlugin_min,muiPlayerDesktopPlugin_min.exports);var MuiPlayerDesktopPlugin=muiPlayerDesktopPlugin_min.exports,Home_vue_vue_type_style_index_0_scoped_true_lang="",_export_sfc=(N,j)=>{const K=N.__vccOpts||N;for(const[M,S]of j)K[M]=S;return K};const _withScopeId=N=>(pushScopeId("data-v-eb6b0fec"),N=N(),popScopeId(),N),_hoisted_1={class:"home"},_hoisted_2=_withScopeId(()=>createBaseVNode("div",{class:"video"},[createBaseVNode("div",{id:"mui-player"})],-1)),_hoisted_3=[_hoisted_2],_sfc_main={setup(N){onMounted(()=>{j()});const j=()=>{new MuiPlayer({container:"#mui-player",title:"\u6211\u5011\u7684\u85CD\u8ABF",src:"https://new.iskcd.com/20220409/xQswwnmI/1100kb/hls/playlist_up.m3u8",plugins:[new MuiPlayerDesktopPlugin({})],parse:{type:"hls",loader:Hls,config:{debug:!1}}})};return(K,M)=>(openBlock(),createElementBlock("div",_hoisted_1,_hoisted_3))}};var Home=_export_sfc(_sfc_main,[["__scopeId","data-v-eb6b0fec"]]);export{Home as default};
//# sourceMappingURL=Home.js.map
