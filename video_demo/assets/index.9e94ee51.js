const p$1=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const R of r)if(R.type==="childList")for(const T of R.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&l(T)}).observe(document,{childList:!0,subtree:!0});function S(r){const R={};return r.integrity&&(R.integrity=r.integrity),r.referrerpolicy&&(R.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?R.credentials="include":r.crossorigin==="anonymous"?R.credentials="omit":R.credentials="same-origin",R}function l(r){if(r.ep)return;r.ep=!0;const R=S(r);fetch(r.href,R)}};p$1();function makeMap(e,n){const S=Object.create(null),l=e.split(",");for(let r=0;r<l.length;r++)S[l[r]]=!0;return n?r=>!!S[r.toLowerCase()]:r=>!!S[r]}const specialBooleanAttrs="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",isSpecialBooleanAttr=makeMap(specialBooleanAttrs);function includeBooleanAttr(e){return!!e||e===""}function normalizeStyle(e){if(isArray(e)){const n={};for(let S=0;S<e.length;S++){const l=e[S],r=isString(l)?parseStringStyle(l):normalizeStyle(l);if(r)for(const R in r)n[R]=r[R]}return n}else{if(isString(e))return e;if(isObject(e))return e}}const listDelimiterRE=/;(?![^(]*\))/g,propertyDelimiterRE=/:(.+)/;function parseStringStyle(e){const n={};return e.split(listDelimiterRE).forEach(S=>{if(S){const l=S.split(propertyDelimiterRE);l.length>1&&(n[l[0].trim()]=l[1].trim())}}),n}function normalizeClass(e){let n="";if(isString(e))n=e;else if(isArray(e))for(let S=0;S<e.length;S++){const l=normalizeClass(e[S]);l&&(n+=l+" ")}else if(isObject(e))for(const S in e)e[S]&&(n+=S+" ");return n.trim()}const EMPTY_OBJ={},EMPTY_ARR=[],NOOP=()=>{},NO=()=>!1,onRE=/^on[^a-z]/,isOn=e=>onRE.test(e),isModelListener=e=>e.startsWith("onUpdate:"),extend=Object.assign,remove=(e,n)=>{const S=e.indexOf(n);S>-1&&e.splice(S,1)},hasOwnProperty=Object.prototype.hasOwnProperty,hasOwn=(e,n)=>hasOwnProperty.call(e,n),isArray=Array.isArray,isMap=e=>toTypeString(e)==="[object Map]",isSet=e=>toTypeString(e)==="[object Set]",isFunction=e=>typeof e=="function",isString=e=>typeof e=="string",isSymbol=e=>typeof e=="symbol",isObject=e=>e!==null&&typeof e=="object",isPromise=e=>isObject(e)&&isFunction(e.then)&&isFunction(e.catch),objectToString=Object.prototype.toString,toTypeString=e=>objectToString.call(e),toRawType=e=>toTypeString(e).slice(8,-1),isPlainObject=e=>toTypeString(e)==="[object Object]",isIntegerKey=e=>isString(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,isReservedProp=makeMap(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),cacheStringFunction=e=>{const n=Object.create(null);return S=>n[S]||(n[S]=e(S))},camelizeRE=/-(\w)/g,camelize=cacheStringFunction(e=>e.replace(camelizeRE,(n,S)=>S?S.toUpperCase():"")),hyphenateRE=/\B([A-Z])/g,hyphenate=cacheStringFunction(e=>e.replace(hyphenateRE,"-$1").toLowerCase()),capitalize=cacheStringFunction(e=>e.charAt(0).toUpperCase()+e.slice(1)),toHandlerKey=cacheStringFunction(e=>e?`on${capitalize(e)}`:""),hasChanged=(e,n)=>!Object.is(e,n),invokeArrayFns=(e,n)=>{for(let S=0;S<e.length;S++)e[S](n)},def=(e,n,S)=>{Object.defineProperty(e,n,{configurable:!0,enumerable:!1,value:S})},toNumber=e=>{const n=parseFloat(e);return isNaN(n)?e:n};let _globalThis;const getGlobalThis=()=>_globalThis||(_globalThis=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{});let activeEffectScope;class EffectScope{constructor(n=!1){this.active=!0,this.effects=[],this.cleanups=[],!n&&activeEffectScope&&(this.parent=activeEffectScope,this.index=(activeEffectScope.scopes||(activeEffectScope.scopes=[])).push(this)-1)}run(n){if(this.active){const S=activeEffectScope;try{return activeEffectScope=this,n()}finally{activeEffectScope=S}}}on(){activeEffectScope=this}off(){activeEffectScope=this.parent}stop(n){if(this.active){let S,l;for(S=0,l=this.effects.length;S<l;S++)this.effects[S].stop();for(S=0,l=this.cleanups.length;S<l;S++)this.cleanups[S]();if(this.scopes)for(S=0,l=this.scopes.length;S<l;S++)this.scopes[S].stop(!0);if(this.parent&&!n){const r=this.parent.scopes.pop();r&&r!==this&&(this.parent.scopes[this.index]=r,r.index=this.index)}this.active=!1}}}function recordEffectScope(e,n=activeEffectScope){n&&n.active&&n.effects.push(e)}const createDep=e=>{const n=new Set(e);return n.w=0,n.n=0,n},wasTracked=e=>(e.w&trackOpBit)>0,newTracked=e=>(e.n&trackOpBit)>0,initDepMarkers=({deps:e})=>{if(e.length)for(let n=0;n<e.length;n++)e[n].w|=trackOpBit},finalizeDepMarkers=e=>{const{deps:n}=e;if(n.length){let S=0;for(let l=0;l<n.length;l++){const r=n[l];wasTracked(r)&&!newTracked(r)?r.delete(e):n[S++]=r,r.w&=~trackOpBit,r.n&=~trackOpBit}n.length=S}},targetMap=new WeakMap;let effectTrackDepth=0,trackOpBit=1;const maxMarkerBits=30;let activeEffect;const ITERATE_KEY=Symbol(""),MAP_KEY_ITERATE_KEY=Symbol("");class ReactiveEffect{constructor(n,S=null,l){this.fn=n,this.scheduler=S,this.active=!0,this.deps=[],this.parent=void 0,recordEffectScope(this,l)}run(){if(!this.active)return this.fn();let n=activeEffect,S=shouldTrack;for(;n;){if(n===this)return;n=n.parent}try{return this.parent=activeEffect,activeEffect=this,shouldTrack=!0,trackOpBit=1<<++effectTrackDepth,effectTrackDepth<=maxMarkerBits?initDepMarkers(this):cleanupEffect(this),this.fn()}finally{effectTrackDepth<=maxMarkerBits&&finalizeDepMarkers(this),trackOpBit=1<<--effectTrackDepth,activeEffect=this.parent,shouldTrack=S,this.parent=void 0,this.deferStop&&this.stop()}}stop(){activeEffect===this?this.deferStop=!0:this.active&&(cleanupEffect(this),this.onStop&&this.onStop(),this.active=!1)}}function cleanupEffect(e){const{deps:n}=e;if(n.length){for(let S=0;S<n.length;S++)n[S].delete(e);n.length=0}}let shouldTrack=!0;const trackStack=[];function pauseTracking(){trackStack.push(shouldTrack),shouldTrack=!1}function resetTracking(){const e=trackStack.pop();shouldTrack=e===void 0?!0:e}function track(e,n,S){if(shouldTrack&&activeEffect){let l=targetMap.get(e);l||targetMap.set(e,l=new Map);let r=l.get(S);r||l.set(S,r=createDep()),trackEffects(r)}}function trackEffects(e,n){let S=!1;effectTrackDepth<=maxMarkerBits?newTracked(e)||(e.n|=trackOpBit,S=!wasTracked(e)):S=!e.has(activeEffect),S&&(e.add(activeEffect),activeEffect.deps.push(e))}function trigger(e,n,S,l,r,R){const T=targetMap.get(e);if(!T)return;let O=[];if(n==="clear")O=[...T.values()];else if(S==="length"&&isArray(e))T.forEach((N,U)=>{(U==="length"||U>=l)&&O.push(N)});else switch(S!==void 0&&O.push(T.get(S)),n){case"add":isArray(e)?isIntegerKey(S)&&O.push(T.get("length")):(O.push(T.get(ITERATE_KEY)),isMap(e)&&O.push(T.get(MAP_KEY_ITERATE_KEY)));break;case"delete":isArray(e)||(O.push(T.get(ITERATE_KEY)),isMap(e)&&O.push(T.get(MAP_KEY_ITERATE_KEY)));break;case"set":isMap(e)&&O.push(T.get(ITERATE_KEY));break}if(O.length===1)O[0]&&triggerEffects(O[0]);else{const N=[];for(const U of O)U&&N.push(...U);triggerEffects(createDep(N))}}function triggerEffects(e,n){for(const S of isArray(e)?e:[...e])(S!==activeEffect||S.allowRecurse)&&(S.scheduler?S.scheduler():S.run())}const isNonTrackableKeys=makeMap("__proto__,__v_isRef,__isVue"),builtInSymbols=new Set(Object.getOwnPropertyNames(Symbol).map(e=>Symbol[e]).filter(isSymbol)),get=createGetter(),shallowGet=createGetter(!1,!0),readonlyGet=createGetter(!0),arrayInstrumentations=createArrayInstrumentations();function createArrayInstrumentations(){const e={};return["includes","indexOf","lastIndexOf"].forEach(n=>{e[n]=function(...S){const l=toRaw(this);for(let R=0,T=this.length;R<T;R++)track(l,"get",R+"");const r=l[n](...S);return r===-1||r===!1?l[n](...S.map(toRaw)):r}}),["push","pop","shift","unshift","splice"].forEach(n=>{e[n]=function(...S){pauseTracking();const l=toRaw(this)[n].apply(this,S);return resetTracking(),l}}),e}function createGetter(e=!1,n=!1){return function(l,r,R){if(r==="__v_isReactive")return!e;if(r==="__v_isReadonly")return e;if(r==="__v_isShallow")return n;if(r==="__v_raw"&&R===(e?n?shallowReadonlyMap:readonlyMap:n?shallowReactiveMap:reactiveMap).get(l))return l;const T=isArray(l);if(!e&&T&&hasOwn(arrayInstrumentations,r))return Reflect.get(arrayInstrumentations,r,R);const O=Reflect.get(l,r,R);return(isSymbol(r)?builtInSymbols.has(r):isNonTrackableKeys(r))||(e||track(l,"get",r),n)?O:isRef(O)?!T||!isIntegerKey(r)?O.value:O:isObject(O)?e?readonly(O):reactive(O):O}}const set=createSetter(),shallowSet=createSetter(!0);function createSetter(e=!1){return function(S,l,r,R){let T=S[l];if(isReadonly(T)&&isRef(T)&&!isRef(r))return!1;if(!e&&!isReadonly(r)&&(isShallow(r)||(r=toRaw(r),T=toRaw(T)),!isArray(S)&&isRef(T)&&!isRef(r)))return T.value=r,!0;const O=isArray(S)&&isIntegerKey(l)?Number(l)<S.length:hasOwn(S,l),N=Reflect.set(S,l,r,R);return S===toRaw(R)&&(O?hasChanged(r,T)&&trigger(S,"set",l,r):trigger(S,"add",l,r)),N}}function deleteProperty(e,n){const S=hasOwn(e,n);e[n];const l=Reflect.deleteProperty(e,n);return l&&S&&trigger(e,"delete",n,void 0),l}function has(e,n){const S=Reflect.has(e,n);return(!isSymbol(n)||!builtInSymbols.has(n))&&track(e,"has",n),S}function ownKeys(e){return track(e,"iterate",isArray(e)?"length":ITERATE_KEY),Reflect.ownKeys(e)}const mutableHandlers={get,set,deleteProperty,has,ownKeys},readonlyHandlers={get:readonlyGet,set(e,n){return!0},deleteProperty(e,n){return!0}},shallowReactiveHandlers=extend({},mutableHandlers,{get:shallowGet,set:shallowSet}),toShallow=e=>e,getProto=e=>Reflect.getPrototypeOf(e);function get$1(e,n,S=!1,l=!1){e=e.__v_raw;const r=toRaw(e),R=toRaw(n);n!==R&&!S&&track(r,"get",n),!S&&track(r,"get",R);const{has:T}=getProto(r),O=l?toShallow:S?toReadonly:toReactive;if(T.call(r,n))return O(e.get(n));if(T.call(r,R))return O(e.get(R));e!==r&&e.get(n)}function has$1(e,n=!1){const S=this.__v_raw,l=toRaw(S),r=toRaw(e);return e!==r&&!n&&track(l,"has",e),!n&&track(l,"has",r),e===r?S.has(e):S.has(e)||S.has(r)}function size(e,n=!1){return e=e.__v_raw,!n&&track(toRaw(e),"iterate",ITERATE_KEY),Reflect.get(e,"size",e)}function add(e){e=toRaw(e);const n=toRaw(this);return getProto(n).has.call(n,e)||(n.add(e),trigger(n,"add",e,e)),this}function set$1(e,n){n=toRaw(n);const S=toRaw(this),{has:l,get:r}=getProto(S);let R=l.call(S,e);R||(e=toRaw(e),R=l.call(S,e));const T=r.call(S,e);return S.set(e,n),R?hasChanged(n,T)&&trigger(S,"set",e,n):trigger(S,"add",e,n),this}function deleteEntry(e){const n=toRaw(this),{has:S,get:l}=getProto(n);let r=S.call(n,e);r||(e=toRaw(e),r=S.call(n,e)),l&&l.call(n,e);const R=n.delete(e);return r&&trigger(n,"delete",e,void 0),R}function clear(){const e=toRaw(this),n=e.size!==0,S=e.clear();return n&&trigger(e,"clear",void 0,void 0),S}function createForEach(e,n){return function(l,r){const R=this,T=R.__v_raw,O=toRaw(T),N=n?toShallow:e?toReadonly:toReactive;return!e&&track(O,"iterate",ITERATE_KEY),T.forEach((U,I)=>l.call(r,N(U),N(I),R))}}function createIterableMethod(e,n,S){return function(...l){const r=this.__v_raw,R=toRaw(r),T=isMap(R),O=e==="entries"||e===Symbol.iterator&&T,N=e==="keys"&&T,U=r[e](...l),I=S?toShallow:n?toReadonly:toReactive;return!n&&track(R,"iterate",N?MAP_KEY_ITERATE_KEY:ITERATE_KEY),{next(){const{value:M,done:C}=U.next();return C?{value:M,done:C}:{value:O?[I(M[0]),I(M[1])]:I(M),done:C}},[Symbol.iterator](){return this}}}}function createReadonlyMethod(e){return function(...n){return e==="delete"?!1:this}}function createInstrumentations(){const e={get(R){return get$1(this,R)},get size(){return size(this)},has:has$1,add,set:set$1,delete:deleteEntry,clear,forEach:createForEach(!1,!1)},n={get(R){return get$1(this,R,!1,!0)},get size(){return size(this)},has:has$1,add,set:set$1,delete:deleteEntry,clear,forEach:createForEach(!1,!0)},S={get(R){return get$1(this,R,!0)},get size(){return size(this,!0)},has(R){return has$1.call(this,R,!0)},add:createReadonlyMethod("add"),set:createReadonlyMethod("set"),delete:createReadonlyMethod("delete"),clear:createReadonlyMethod("clear"),forEach:createForEach(!0,!1)},l={get(R){return get$1(this,R,!0,!0)},get size(){return size(this,!0)},has(R){return has$1.call(this,R,!0)},add:createReadonlyMethod("add"),set:createReadonlyMethod("set"),delete:createReadonlyMethod("delete"),clear:createReadonlyMethod("clear"),forEach:createForEach(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(R=>{e[R]=createIterableMethod(R,!1,!1),S[R]=createIterableMethod(R,!0,!1),n[R]=createIterableMethod(R,!1,!0),l[R]=createIterableMethod(R,!0,!0)}),[e,S,n,l]}const[mutableInstrumentations,readonlyInstrumentations,shallowInstrumentations,shallowReadonlyInstrumentations]=createInstrumentations();function createInstrumentationGetter(e,n){const S=n?e?shallowReadonlyInstrumentations:shallowInstrumentations:e?readonlyInstrumentations:mutableInstrumentations;return(l,r,R)=>r==="__v_isReactive"?!e:r==="__v_isReadonly"?e:r==="__v_raw"?l:Reflect.get(hasOwn(S,r)&&r in l?S:l,r,R)}const mutableCollectionHandlers={get:createInstrumentationGetter(!1,!1)},shallowCollectionHandlers={get:createInstrumentationGetter(!1,!0)},readonlyCollectionHandlers={get:createInstrumentationGetter(!0,!1)},reactiveMap=new WeakMap,shallowReactiveMap=new WeakMap,readonlyMap=new WeakMap,shallowReadonlyMap=new WeakMap;function targetTypeMap(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function getTargetType(e){return e.__v_skip||!Object.isExtensible(e)?0:targetTypeMap(toRawType(e))}function reactive(e){return isReadonly(e)?e:createReactiveObject(e,!1,mutableHandlers,mutableCollectionHandlers,reactiveMap)}function shallowReactive(e){return createReactiveObject(e,!1,shallowReactiveHandlers,shallowCollectionHandlers,shallowReactiveMap)}function readonly(e){return createReactiveObject(e,!0,readonlyHandlers,readonlyCollectionHandlers,readonlyMap)}function createReactiveObject(e,n,S,l,r){if(!isObject(e)||e.__v_raw&&!(n&&e.__v_isReactive))return e;const R=r.get(e);if(R)return R;const T=getTargetType(e);if(T===0)return e;const O=new Proxy(e,T===2?l:S);return r.set(e,O),O}function isReactive(e){return isReadonly(e)?isReactive(e.__v_raw):!!(e&&e.__v_isReactive)}function isReadonly(e){return!!(e&&e.__v_isReadonly)}function isShallow(e){return!!(e&&e.__v_isShallow)}function isProxy(e){return isReactive(e)||isReadonly(e)}function toRaw(e){const n=e&&e.__v_raw;return n?toRaw(n):e}function markRaw(e){return def(e,"__v_skip",!0),e}const toReactive=e=>isObject(e)?reactive(e):e,toReadonly=e=>isObject(e)?readonly(e):e;function trackRefValue(e){shouldTrack&&activeEffect&&(e=toRaw(e),trackEffects(e.dep||(e.dep=createDep())))}function triggerRefValue(e,n){e=toRaw(e),e.dep&&triggerEffects(e.dep)}function isRef(e){return!!(e&&e.__v_isRef===!0)}function ref(e){return createRef(e,!1)}function shallowRef(e){return createRef(e,!0)}function createRef(e,n){return isRef(e)?e:new RefImpl(e,n)}class RefImpl{constructor(n,S){this.__v_isShallow=S,this.dep=void 0,this.__v_isRef=!0,this._rawValue=S?n:toRaw(n),this._value=S?n:toReactive(n)}get value(){return trackRefValue(this),this._value}set value(n){n=this.__v_isShallow?n:toRaw(n),hasChanged(n,this._rawValue)&&(this._rawValue=n,this._value=this.__v_isShallow?n:toReactive(n),triggerRefValue(this))}}function unref(e){return isRef(e)?e.value:e}const shallowUnwrapHandlers={get:(e,n,S)=>unref(Reflect.get(e,n,S)),set:(e,n,S,l)=>{const r=e[n];return isRef(r)&&!isRef(S)?(r.value=S,!0):Reflect.set(e,n,S,l)}};function proxyRefs(e){return isReactive(e)?e:new Proxy(e,shallowUnwrapHandlers)}class ComputedRefImpl{constructor(n,S,l,r){this._setter=S,this.dep=void 0,this.__v_isRef=!0,this._dirty=!0,this.effect=new ReactiveEffect(n,()=>{this._dirty||(this._dirty=!0,triggerRefValue(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!r,this.__v_isReadonly=l}get value(){const n=toRaw(this);return trackRefValue(n),(n._dirty||!n._cacheable)&&(n._dirty=!1,n._value=n.effect.run()),n._value}set value(n){this._setter(n)}}function computed$1(e,n,S=!1){let l,r;const R=isFunction(e);return R?(l=e,r=NOOP):(l=e.get,r=e.set),new ComputedRefImpl(l,r,R||!r,S)}function callWithErrorHandling(e,n,S,l){let r;try{r=l?e(...l):e()}catch(R){handleError(R,n,S)}return r}function callWithAsyncErrorHandling(e,n,S,l){if(isFunction(e)){const R=callWithErrorHandling(e,n,S,l);return R&&isPromise(R)&&R.catch(T=>{handleError(T,n,S)}),R}const r=[];for(let R=0;R<e.length;R++)r.push(callWithAsyncErrorHandling(e[R],n,S,l));return r}function handleError(e,n,S,l=!0){const r=n?n.vnode:null;if(n){let R=n.parent;const T=n.proxy,O=S;for(;R;){const U=R.ec;if(U){for(let I=0;I<U.length;I++)if(U[I](e,T,O)===!1)return}R=R.parent}const N=n.appContext.config.errorHandler;if(N){callWithErrorHandling(N,null,10,[e,T,O]);return}}logError(e,S,r,l)}function logError(e,n,S,l=!0){console.error(e)}let isFlushing=!1,isFlushPending=!1;const queue=[];let flushIndex=0;const pendingPreFlushCbs=[];let activePreFlushCbs=null,preFlushIndex=0;const pendingPostFlushCbs=[];let activePostFlushCbs=null,postFlushIndex=0;const resolvedPromise=Promise.resolve();let currentFlushPromise=null,currentPreFlushParentJob=null;function nextTick(e){const n=currentFlushPromise||resolvedPromise;return e?n.then(this?e.bind(this):e):n}function findInsertionIndex(e){let n=flushIndex+1,S=queue.length;for(;n<S;){const l=n+S>>>1;getId(queue[l])<e?n=l+1:S=l}return n}function queueJob(e){(!queue.length||!queue.includes(e,isFlushing&&e.allowRecurse?flushIndex+1:flushIndex))&&e!==currentPreFlushParentJob&&(e.id==null?queue.push(e):queue.splice(findInsertionIndex(e.id),0,e),queueFlush())}function queueFlush(){!isFlushing&&!isFlushPending&&(isFlushPending=!0,currentFlushPromise=resolvedPromise.then(flushJobs))}function invalidateJob(e){const n=queue.indexOf(e);n>flushIndex&&queue.splice(n,1)}function queueCb(e,n,S,l){isArray(e)?S.push(...e):(!n||!n.includes(e,e.allowRecurse?l+1:l))&&S.push(e),queueFlush()}function queuePreFlushCb(e){queueCb(e,activePreFlushCbs,pendingPreFlushCbs,preFlushIndex)}function queuePostFlushCb(e){queueCb(e,activePostFlushCbs,pendingPostFlushCbs,postFlushIndex)}function flushPreFlushCbs(e,n=null){if(pendingPreFlushCbs.length){for(currentPreFlushParentJob=n,activePreFlushCbs=[...new Set(pendingPreFlushCbs)],pendingPreFlushCbs.length=0,preFlushIndex=0;preFlushIndex<activePreFlushCbs.length;preFlushIndex++)activePreFlushCbs[preFlushIndex]();activePreFlushCbs=null,preFlushIndex=0,currentPreFlushParentJob=null,flushPreFlushCbs(e,n)}}function flushPostFlushCbs(e){if(pendingPostFlushCbs.length){const n=[...new Set(pendingPostFlushCbs)];if(pendingPostFlushCbs.length=0,activePostFlushCbs){activePostFlushCbs.push(...n);return}for(activePostFlushCbs=n,activePostFlushCbs.sort((S,l)=>getId(S)-getId(l)),postFlushIndex=0;postFlushIndex<activePostFlushCbs.length;postFlushIndex++)activePostFlushCbs[postFlushIndex]();activePostFlushCbs=null,postFlushIndex=0}}const getId=e=>e.id==null?1/0:e.id;function flushJobs(e){isFlushPending=!1,isFlushing=!0,flushPreFlushCbs(e),queue.sort((S,l)=>getId(S)-getId(l));const n=NOOP;try{for(flushIndex=0;flushIndex<queue.length;flushIndex++){const S=queue[flushIndex];S&&S.active!==!1&&callWithErrorHandling(S,null,14)}}finally{flushIndex=0,queue.length=0,flushPostFlushCbs(),isFlushing=!1,currentFlushPromise=null,(queue.length||pendingPreFlushCbs.length||pendingPostFlushCbs.length)&&flushJobs(e)}}function emit$1(e,n,...S){if(e.isUnmounted)return;const l=e.vnode.props||EMPTY_OBJ;let r=S;const R=n.startsWith("update:"),T=R&&n.slice(7);if(T&&T in l){const I=`${T==="modelValue"?"model":T}Modifiers`,{number:M,trim:C}=l[I]||EMPTY_OBJ;C?r=S.map(w=>w.trim()):M&&(r=S.map(toNumber))}let O,N=l[O=toHandlerKey(n)]||l[O=toHandlerKey(camelize(n))];!N&&R&&(N=l[O=toHandlerKey(hyphenate(n))]),N&&callWithAsyncErrorHandling(N,e,6,r);const U=l[O+"Once"];if(U){if(!e.emitted)e.emitted={};else if(e.emitted[O])return;e.emitted[O]=!0,callWithAsyncErrorHandling(U,e,6,r)}}function normalizeEmitsOptions(e,n,S=!1){const l=n.emitsCache,r=l.get(e);if(r!==void 0)return r;const R=e.emits;let T={},O=!1;if(!isFunction(e)){const N=U=>{const I=normalizeEmitsOptions(U,n,!0);I&&(O=!0,extend(T,I))};!S&&n.mixins.length&&n.mixins.forEach(N),e.extends&&N(e.extends),e.mixins&&e.mixins.forEach(N)}return!R&&!O?(l.set(e,null),null):(isArray(R)?R.forEach(N=>T[N]=null):extend(T,R),l.set(e,T),T)}function isEmitListener(e,n){return!e||!isOn(n)?!1:(n=n.slice(2).replace(/Once$/,""),hasOwn(e,n[0].toLowerCase()+n.slice(1))||hasOwn(e,hyphenate(n))||hasOwn(e,n))}let currentRenderingInstance=null,currentScopeId=null;function setCurrentRenderingInstance(e){const n=currentRenderingInstance;return currentRenderingInstance=e,currentScopeId=e&&e.type.__scopeId||null,n}function pushScopeId(e){currentScopeId=e}function popScopeId(){currentScopeId=null}function withCtx(e,n=currentRenderingInstance,S){if(!n||e._n)return e;const l=(...r)=>{l._d&&setBlockTracking(-1);const R=setCurrentRenderingInstance(n),T=e(...r);return setCurrentRenderingInstance(R),l._d&&setBlockTracking(1),T};return l._n=!0,l._c=!0,l._d=!0,l}function markAttrsAccessed(){}function renderComponentRoot(e){const{type:n,vnode:S,proxy:l,withProxy:r,props:R,propsOptions:[T],slots:O,attrs:N,emit:U,render:I,renderCache:M,data:C,setupState:w,ctx:v,inheritAttrs:k}=e;let F,D;const E=setCurrentRenderingInstance(e);try{if(S.shapeFlag&4){const y=r||l;F=normalizeVNode(I.call(y,y,M,R,w,C,v)),D=N}else{const y=n;F=normalizeVNode(y.length>1?y(R,{attrs:N,slots:O,emit:U}):y(R,null)),D=n.props?N:getFunctionalFallthrough(N)}}catch(y){blockStack.length=0,handleError(y,e,1),F=createVNode(Comment)}let u=F;if(D&&k!==!1){const y=Object.keys(D),{shapeFlag:o}=u;y.length&&o&7&&(T&&y.some(isModelListener)&&(D=filterModelListeners(D,T)),u=cloneVNode(u,D))}return S.dirs&&(u.dirs=u.dirs?u.dirs.concat(S.dirs):S.dirs),S.transition&&(u.transition=S.transition),F=u,setCurrentRenderingInstance(E),F}const getFunctionalFallthrough=e=>{let n;for(const S in e)(S==="class"||S==="style"||isOn(S))&&((n||(n={}))[S]=e[S]);return n},filterModelListeners=(e,n)=>{const S={};for(const l in e)(!isModelListener(l)||!(l.slice(9)in n))&&(S[l]=e[l]);return S};function shouldUpdateComponent(e,n,S){const{props:l,children:r,component:R}=e,{props:T,children:O,patchFlag:N}=n,U=R.emitsOptions;if(n.dirs||n.transition)return!0;if(S&&N>=0){if(N&1024)return!0;if(N&16)return l?hasPropsChanged(l,T,U):!!T;if(N&8){const I=n.dynamicProps;for(let M=0;M<I.length;M++){const C=I[M];if(T[C]!==l[C]&&!isEmitListener(U,C))return!0}}}else return(r||O)&&(!O||!O.$stable)?!0:l===T?!1:l?T?hasPropsChanged(l,T,U):!0:!!T;return!1}function hasPropsChanged(e,n,S){const l=Object.keys(n);if(l.length!==Object.keys(e).length)return!0;for(let r=0;r<l.length;r++){const R=l[r];if(n[R]!==e[R]&&!isEmitListener(S,R))return!0}return!1}function updateHOCHostEl({vnode:e,parent:n},S){for(;n&&n.subTree===e;)(e=n.vnode).el=S,n=n.parent}const isSuspense=e=>e.__isSuspense;function queueEffectWithSuspense(e,n){n&&n.pendingBranch?isArray(e)?n.effects.push(...e):n.effects.push(e):queuePostFlushCb(e)}function provide(e,n){if(currentInstance){let S=currentInstance.provides;const l=currentInstance.parent&&currentInstance.parent.provides;l===S&&(S=currentInstance.provides=Object.create(l)),S[e]=n}}function inject(e,n,S=!1){const l=currentInstance||currentRenderingInstance;if(l){const r=l.parent==null?l.vnode.appContext&&l.vnode.appContext.provides:l.parent.provides;if(r&&e in r)return r[e];if(arguments.length>1)return S&&isFunction(n)?n.call(l.proxy):n}}const INITIAL_WATCHER_VALUE={};function watch(e,n,S){return doWatch(e,n,S)}function doWatch(e,n,{immediate:S,deep:l,flush:r,onTrack:R,onTrigger:T}=EMPTY_OBJ){const O=currentInstance;let N,U=!1,I=!1;if(isRef(e)?(N=()=>e.value,U=isShallow(e)):isReactive(e)?(N=()=>e,l=!0):isArray(e)?(I=!0,U=e.some(isReactive),N=()=>e.map(D=>{if(isRef(D))return D.value;if(isReactive(D))return traverse(D);if(isFunction(D))return callWithErrorHandling(D,O,2)})):isFunction(e)?n?N=()=>callWithErrorHandling(e,O,2):N=()=>{if(!(O&&O.isUnmounted))return M&&M(),callWithAsyncErrorHandling(e,O,3,[C])}:N=NOOP,n&&l){const D=N;N=()=>traverse(D())}let M,C=D=>{M=F.onStop=()=>{callWithErrorHandling(D,O,4)}};if(isInSSRComponentSetup)return C=NOOP,n?S&&callWithAsyncErrorHandling(n,O,3,[N(),I?[]:void 0,C]):N(),NOOP;let w=I?[]:INITIAL_WATCHER_VALUE;const v=()=>{if(!!F.active)if(n){const D=F.run();(l||U||(I?D.some((E,u)=>hasChanged(E,w[u])):hasChanged(D,w)))&&(M&&M(),callWithAsyncErrorHandling(n,O,3,[D,w===INITIAL_WATCHER_VALUE?void 0:w,C]),w=D)}else F.run()};v.allowRecurse=!!n;let k;r==="sync"?k=v:r==="post"?k=()=>queuePostRenderEffect(v,O&&O.suspense):k=()=>{!O||O.isMounted?queuePreFlushCb(v):v()};const F=new ReactiveEffect(N,k);return n?S?v():w=F.run():r==="post"?queuePostRenderEffect(F.run.bind(F),O&&O.suspense):F.run(),()=>{F.stop(),O&&O.scope&&remove(O.scope.effects,F)}}function instanceWatch(e,n,S){const l=this.proxy,r=isString(e)?e.includes(".")?createPathGetter(l,e):()=>l[e]:e.bind(l,l);let R;isFunction(n)?R=n:(R=n.handler,S=n);const T=currentInstance;setCurrentInstance(this);const O=doWatch(r,R.bind(l),S);return T?setCurrentInstance(T):unsetCurrentInstance(),O}function createPathGetter(e,n){const S=n.split(".");return()=>{let l=e;for(let r=0;r<S.length&&l;r++)l=l[S[r]];return l}}function traverse(e,n){if(!isObject(e)||e.__v_skip||(n=n||new Set,n.has(e)))return e;if(n.add(e),isRef(e))traverse(e.value,n);else if(isArray(e))for(let S=0;S<e.length;S++)traverse(e[S],n);else if(isSet(e)||isMap(e))e.forEach(S=>{traverse(S,n)});else if(isPlainObject(e))for(const S in e)traverse(e[S],n);return e}function useTransitionState(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return onMounted(()=>{e.isMounted=!0}),onBeforeUnmount(()=>{e.isUnmounting=!0}),e}const TransitionHookValidator=[Function,Array],BaseTransitionImpl={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:TransitionHookValidator,onEnter:TransitionHookValidator,onAfterEnter:TransitionHookValidator,onEnterCancelled:TransitionHookValidator,onBeforeLeave:TransitionHookValidator,onLeave:TransitionHookValidator,onAfterLeave:TransitionHookValidator,onLeaveCancelled:TransitionHookValidator,onBeforeAppear:TransitionHookValidator,onAppear:TransitionHookValidator,onAfterAppear:TransitionHookValidator,onAppearCancelled:TransitionHookValidator},setup(e,{slots:n}){const S=getCurrentInstance(),l=useTransitionState();let r;return()=>{const R=n.default&&getTransitionRawChildren(n.default(),!0);if(!R||!R.length)return;let T=R[0];if(R.length>1){for(const k of R)if(k.type!==Comment){T=k;break}}const O=toRaw(e),{mode:N}=O;if(l.isLeaving)return emptyPlaceholder(T);const U=getKeepAliveChild(T);if(!U)return emptyPlaceholder(T);const I=resolveTransitionHooks(U,O,l,S);setTransitionHooks(U,I);const M=S.subTree,C=M&&getKeepAliveChild(M);let w=!1;const{getTransitionKey:v}=U.type;if(v){const k=v();r===void 0?r=k:k!==r&&(r=k,w=!0)}if(C&&C.type!==Comment&&(!isSameVNodeType(U,C)||w)){const k=resolveTransitionHooks(C,O,l,S);if(setTransitionHooks(C,k),N==="out-in")return l.isLeaving=!0,k.afterLeave=()=>{l.isLeaving=!1,S.update()},emptyPlaceholder(T);N==="in-out"&&U.type!==Comment&&(k.delayLeave=(F,D,E)=>{const u=getLeavingNodesForType(l,C);u[String(C.key)]=C,F._leaveCb=()=>{D(),F._leaveCb=void 0,delete I.delayedLeave},I.delayedLeave=E})}return T}}},BaseTransition=BaseTransitionImpl;function getLeavingNodesForType(e,n){const{leavingVNodes:S}=e;let l=S.get(n.type);return l||(l=Object.create(null),S.set(n.type,l)),l}function resolveTransitionHooks(e,n,S,l){const{appear:r,mode:R,persisted:T=!1,onBeforeEnter:O,onEnter:N,onAfterEnter:U,onEnterCancelled:I,onBeforeLeave:M,onLeave:C,onAfterLeave:w,onLeaveCancelled:v,onBeforeAppear:k,onAppear:F,onAfterAppear:D,onAppearCancelled:E}=n,u=String(e.key),y=getLeavingNodesForType(S,e),o=(A,g)=>{A&&callWithAsyncErrorHandling(A,l,9,g)},P={mode:R,persisted:T,beforeEnter(A){let g=O;if(!S.isMounted)if(r)g=k||O;else return;A._leaveCb&&A._leaveCb(!0);const t=y[u];t&&isSameVNodeType(e,t)&&t.el._leaveCb&&t.el._leaveCb(),o(g,[A])},enter(A){let g=N,t=U,f=I;if(!S.isMounted)if(r)g=F||N,t=D||U,f=E||I;else return;let x=!1;const m=A._enterCb=a=>{x||(x=!0,a?o(f,[A]):o(t,[A]),P.delayedLeave&&P.delayedLeave(),A._enterCb=void 0)};g?(g(A,m),g.length<=1&&m()):m()},leave(A,g){const t=String(e.key);if(A._enterCb&&A._enterCb(!0),S.isUnmounting)return g();o(M,[A]);let f=!1;const x=A._leaveCb=m=>{f||(f=!0,g(),m?o(v,[A]):o(w,[A]),A._leaveCb=void 0,y[t]===e&&delete y[t])};y[t]=e,C?(C(A,x),C.length<=1&&x()):x()},clone(A){return resolveTransitionHooks(A,n,S,l)}};return P}function emptyPlaceholder(e){if(isKeepAlive(e))return e=cloneVNode(e),e.children=null,e}function getKeepAliveChild(e){return isKeepAlive(e)?e.children?e.children[0]:void 0:e}function setTransitionHooks(e,n){e.shapeFlag&6&&e.component?setTransitionHooks(e.component.subTree,n):e.shapeFlag&128?(e.ssContent.transition=n.clone(e.ssContent),e.ssFallback.transition=n.clone(e.ssFallback)):e.transition=n}function getTransitionRawChildren(e,n=!1,S){let l=[],r=0;for(let R=0;R<e.length;R++){let T=e[R];const O=S==null?T.key:String(S)+String(T.key!=null?T.key:R);T.type===Fragment?(T.patchFlag&128&&r++,l=l.concat(getTransitionRawChildren(T.children,n,O))):(n||T.type!==Comment)&&l.push(O!=null?cloneVNode(T,{key:O}):T)}if(r>1)for(let R=0;R<l.length;R++)l[R].patchFlag=-2;return l}function defineComponent(e){return isFunction(e)?{setup:e,name:e.name}:e}const isAsyncWrapper=e=>!!e.type.__asyncLoader,isKeepAlive=e=>e.type.__isKeepAlive;function onActivated(e,n){registerKeepAliveHook(e,"a",n)}function onDeactivated(e,n){registerKeepAliveHook(e,"da",n)}function registerKeepAliveHook(e,n,S=currentInstance){const l=e.__wdc||(e.__wdc=()=>{let r=S;for(;r;){if(r.isDeactivated)return;r=r.parent}return e()});if(injectHook(n,l,S),S){let r=S.parent;for(;r&&r.parent;)isKeepAlive(r.parent.vnode)&&injectToKeepAliveRoot(l,n,S,r),r=r.parent}}function injectToKeepAliveRoot(e,n,S,l){const r=injectHook(n,e,l,!0);onUnmounted(()=>{remove(l[n],r)},S)}function injectHook(e,n,S=currentInstance,l=!1){if(S){const r=S[e]||(S[e]=[]),R=n.__weh||(n.__weh=(...T)=>{if(S.isUnmounted)return;pauseTracking(),setCurrentInstance(S);const O=callWithAsyncErrorHandling(n,S,e,T);return unsetCurrentInstance(),resetTracking(),O});return l?r.unshift(R):r.push(R),R}}const createHook=e=>(n,S=currentInstance)=>(!isInSSRComponentSetup||e==="sp")&&injectHook(e,n,S),onBeforeMount=createHook("bm"),onMounted=createHook("m"),onBeforeUpdate=createHook("bu"),onUpdated=createHook("u"),onBeforeUnmount=createHook("bum"),onUnmounted=createHook("um"),onServerPrefetch=createHook("sp"),onRenderTriggered=createHook("rtg"),onRenderTracked=createHook("rtc");function onErrorCaptured(e,n=currentInstance){injectHook("ec",e,n)}let shouldCacheAccess=!0;function applyOptions(e){const n=resolveMergedOptions(e),S=e.proxy,l=e.ctx;shouldCacheAccess=!1,n.beforeCreate&&callHook(n.beforeCreate,e,"bc");const{data:r,computed:R,methods:T,watch:O,provide:N,inject:U,created:I,beforeMount:M,mounted:C,beforeUpdate:w,updated:v,activated:k,deactivated:F,beforeDestroy:D,beforeUnmount:E,destroyed:u,unmounted:y,render:o,renderTracked:P,renderTriggered:A,errorCaptured:g,serverPrefetch:t,expose:f,inheritAttrs:x,components:m,directives:a,filters:c}=n;if(U&&resolveInjections(U,l,null,e.appContext.config.unwrapInjectedRef),T)for(const B in T){const $=T[B];isFunction($)&&(l[B]=$.bind(S))}if(r){const B=r.call(S,S);isObject(B)&&(e.data=reactive(B))}if(shouldCacheAccess=!0,R)for(const B in R){const $=R[B],K=isFunction($)?$.bind(S,S):isFunction($.get)?$.get.bind(S,S):NOOP,H=!isFunction($)&&isFunction($.set)?$.set.bind(S):NOOP,j=computed({get:K,set:H});Object.defineProperty(l,B,{enumerable:!0,configurable:!0,get:()=>j.value,set:W=>j.value=W})}if(O)for(const B in O)createWatcher(O[B],l,S,B);if(N){const B=isFunction(N)?N.call(S):N;Reflect.ownKeys(B).forEach($=>{provide($,B[$])})}I&&callHook(I,e,"c");function _(B,$){isArray($)?$.forEach(K=>B(K.bind(S))):$&&B($.bind(S))}if(_(onBeforeMount,M),_(onMounted,C),_(onBeforeUpdate,w),_(onUpdated,v),_(onActivated,k),_(onDeactivated,F),_(onErrorCaptured,g),_(onRenderTracked,P),_(onRenderTriggered,A),_(onBeforeUnmount,E),_(onUnmounted,y),_(onServerPrefetch,t),isArray(f))if(f.length){const B=e.exposed||(e.exposed={});f.forEach($=>{Object.defineProperty(B,$,{get:()=>S[$],set:K=>S[$]=K})})}else e.exposed||(e.exposed={});o&&e.render===NOOP&&(e.render=o),x!=null&&(e.inheritAttrs=x),m&&(e.components=m),a&&(e.directives=a)}function resolveInjections(e,n,S=NOOP,l=!1){isArray(e)&&(e=normalizeInject(e));for(const r in e){const R=e[r];let T;isObject(R)?"default"in R?T=inject(R.from||r,R.default,!0):T=inject(R.from||r):T=inject(R),isRef(T)&&l?Object.defineProperty(n,r,{enumerable:!0,configurable:!0,get:()=>T.value,set:O=>T.value=O}):n[r]=T}}function callHook(e,n,S){callWithAsyncErrorHandling(isArray(e)?e.map(l=>l.bind(n.proxy)):e.bind(n.proxy),n,S)}function createWatcher(e,n,S,l){const r=l.includes(".")?createPathGetter(S,l):()=>S[l];if(isString(e)){const R=n[e];isFunction(R)&&watch(r,R)}else if(isFunction(e))watch(r,e.bind(S));else if(isObject(e))if(isArray(e))e.forEach(R=>createWatcher(R,n,S,l));else{const R=isFunction(e.handler)?e.handler.bind(S):n[e.handler];isFunction(R)&&watch(r,R,e)}}function resolveMergedOptions(e){const n=e.type,{mixins:S,extends:l}=n,{mixins:r,optionsCache:R,config:{optionMergeStrategies:T}}=e.appContext,O=R.get(n);let N;return O?N=O:!r.length&&!S&&!l?N=n:(N={},r.length&&r.forEach(U=>mergeOptions$1(N,U,T,!0)),mergeOptions$1(N,n,T)),R.set(n,N),N}function mergeOptions$1(e,n,S,l=!1){const{mixins:r,extends:R}=n;R&&mergeOptions$1(e,R,S,!0),r&&r.forEach(T=>mergeOptions$1(e,T,S,!0));for(const T in n)if(!(l&&T==="expose")){const O=internalOptionMergeStrats[T]||S&&S[T];e[T]=O?O(e[T],n[T]):n[T]}return e}const internalOptionMergeStrats={data:mergeDataFn,props:mergeObjectOptions,emits:mergeObjectOptions,methods:mergeObjectOptions,computed:mergeObjectOptions,beforeCreate:mergeAsArray,created:mergeAsArray,beforeMount:mergeAsArray,mounted:mergeAsArray,beforeUpdate:mergeAsArray,updated:mergeAsArray,beforeDestroy:mergeAsArray,beforeUnmount:mergeAsArray,destroyed:mergeAsArray,unmounted:mergeAsArray,activated:mergeAsArray,deactivated:mergeAsArray,errorCaptured:mergeAsArray,serverPrefetch:mergeAsArray,components:mergeObjectOptions,directives:mergeObjectOptions,watch:mergeWatchOptions,provide:mergeDataFn,inject:mergeInject};function mergeDataFn(e,n){return n?e?function(){return extend(isFunction(e)?e.call(this,this):e,isFunction(n)?n.call(this,this):n)}:n:e}function mergeInject(e,n){return mergeObjectOptions(normalizeInject(e),normalizeInject(n))}function normalizeInject(e){if(isArray(e)){const n={};for(let S=0;S<e.length;S++)n[e[S]]=e[S];return n}return e}function mergeAsArray(e,n){return e?[...new Set([].concat(e,n))]:n}function mergeObjectOptions(e,n){return e?extend(extend(Object.create(null),e),n):n}function mergeWatchOptions(e,n){if(!e)return n;if(!n)return e;const S=extend(Object.create(null),e);for(const l in n)S[l]=mergeAsArray(e[l],n[l]);return S}function initProps(e,n,S,l=!1){const r={},R={};def(R,InternalObjectKey,1),e.propsDefaults=Object.create(null),setFullProps(e,n,r,R);for(const T in e.propsOptions[0])T in r||(r[T]=void 0);S?e.props=l?r:shallowReactive(r):e.type.props?e.props=r:e.props=R,e.attrs=R}function updateProps(e,n,S,l){const{props:r,attrs:R,vnode:{patchFlag:T}}=e,O=toRaw(r),[N]=e.propsOptions;let U=!1;if((l||T>0)&&!(T&16)){if(T&8){const I=e.vnode.dynamicProps;for(let M=0;M<I.length;M++){let C=I[M];if(isEmitListener(e.emitsOptions,C))continue;const w=n[C];if(N)if(hasOwn(R,C))w!==R[C]&&(R[C]=w,U=!0);else{const v=camelize(C);r[v]=resolvePropValue(N,O,v,w,e,!1)}else w!==R[C]&&(R[C]=w,U=!0)}}}else{setFullProps(e,n,r,R)&&(U=!0);let I;for(const M in O)(!n||!hasOwn(n,M)&&((I=hyphenate(M))===M||!hasOwn(n,I)))&&(N?S&&(S[M]!==void 0||S[I]!==void 0)&&(r[M]=resolvePropValue(N,O,M,void 0,e,!0)):delete r[M]);if(R!==O)for(const M in R)(!n||!hasOwn(n,M)&&!0)&&(delete R[M],U=!0)}U&&trigger(e,"set","$attrs")}function setFullProps(e,n,S,l){const[r,R]=e.propsOptions;let T=!1,O;if(n)for(let N in n){if(isReservedProp(N))continue;const U=n[N];let I;r&&hasOwn(r,I=camelize(N))?!R||!R.includes(I)?S[I]=U:(O||(O={}))[I]=U:isEmitListener(e.emitsOptions,N)||(!(N in l)||U!==l[N])&&(l[N]=U,T=!0)}if(R){const N=toRaw(S),U=O||EMPTY_OBJ;for(let I=0;I<R.length;I++){const M=R[I];S[M]=resolvePropValue(r,N,M,U[M],e,!hasOwn(U,M))}}return T}function resolvePropValue(e,n,S,l,r,R){const T=e[S];if(T!=null){const O=hasOwn(T,"default");if(O&&l===void 0){const N=T.default;if(T.type!==Function&&isFunction(N)){const{propsDefaults:U}=r;S in U?l=U[S]:(setCurrentInstance(r),l=U[S]=N.call(null,n),unsetCurrentInstance())}else l=N}T[0]&&(R&&!O?l=!1:T[1]&&(l===""||l===hyphenate(S))&&(l=!0))}return l}function normalizePropsOptions(e,n,S=!1){const l=n.propsCache,r=l.get(e);if(r)return r;const R=e.props,T={},O=[];let N=!1;if(!isFunction(e)){const I=M=>{N=!0;const[C,w]=normalizePropsOptions(M,n,!0);extend(T,C),w&&O.push(...w)};!S&&n.mixins.length&&n.mixins.forEach(I),e.extends&&I(e.extends),e.mixins&&e.mixins.forEach(I)}if(!R&&!N)return l.set(e,EMPTY_ARR),EMPTY_ARR;if(isArray(R))for(let I=0;I<R.length;I++){const M=camelize(R[I]);validatePropName(M)&&(T[M]=EMPTY_OBJ)}else if(R)for(const I in R){const M=camelize(I);if(validatePropName(M)){const C=R[I],w=T[M]=isArray(C)||isFunction(C)?{type:C}:C;if(w){const v=getTypeIndex(Boolean,w.type),k=getTypeIndex(String,w.type);w[0]=v>-1,w[1]=k<0||v<k,(v>-1||hasOwn(w,"default"))&&O.push(M)}}}const U=[T,O];return l.set(e,U),U}function validatePropName(e){return e[0]!=="$"}function getType(e){const n=e&&e.toString().match(/^\s*function (\w+)/);return n?n[1]:e===null?"null":""}function isSameType(e,n){return getType(e)===getType(n)}function getTypeIndex(e,n){return isArray(n)?n.findIndex(S=>isSameType(S,e)):isFunction(n)&&isSameType(n,e)?0:-1}const isInternalKey=e=>e[0]==="_"||e==="$stable",normalizeSlotValue=e=>isArray(e)?e.map(normalizeVNode):[normalizeVNode(e)],normalizeSlot$1=(e,n,S)=>{const l=withCtx((...r)=>normalizeSlotValue(n(...r)),S);return l._c=!1,l},normalizeObjectSlots=(e,n,S)=>{const l=e._ctx;for(const r in e){if(isInternalKey(r))continue;const R=e[r];if(isFunction(R))n[r]=normalizeSlot$1(r,R,l);else if(R!=null){const T=normalizeSlotValue(R);n[r]=()=>T}}},normalizeVNodeSlots=(e,n)=>{const S=normalizeSlotValue(n);e.slots.default=()=>S},initSlots=(e,n)=>{if(e.vnode.shapeFlag&32){const S=n._;S?(e.slots=toRaw(n),def(n,"_",S)):normalizeObjectSlots(n,e.slots={})}else e.slots={},n&&normalizeVNodeSlots(e,n);def(e.slots,InternalObjectKey,1)},updateSlots=(e,n,S)=>{const{vnode:l,slots:r}=e;let R=!0,T=EMPTY_OBJ;if(l.shapeFlag&32){const O=n._;O?S&&O===1?R=!1:(extend(r,n),!S&&O===1&&delete r._):(R=!n.$stable,normalizeObjectSlots(n,r)),T=n}else n&&(normalizeVNodeSlots(e,n),T={default:1});if(R)for(const O in r)!isInternalKey(O)&&!(O in T)&&delete r[O]};function invokeDirectiveHook(e,n,S,l){const r=e.dirs,R=n&&n.dirs;for(let T=0;T<r.length;T++){const O=r[T];R&&(O.oldValue=R[T].value);let N=O.dir[l];N&&(pauseTracking(),callWithAsyncErrorHandling(N,S,8,[e.el,O,e,n]),resetTracking())}}function createAppContext(){return{app:null,config:{isNativeTag:NO,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let uid=0;function createAppAPI(e,n){return function(l,r=null){isFunction(l)||(l=Object.assign({},l)),r!=null&&!isObject(r)&&(r=null);const R=createAppContext(),T=new Set;let O=!1;const N=R.app={_uid:uid++,_component:l,_props:r,_container:null,_context:R,_instance:null,version,get config(){return R.config},set config(U){},use(U,...I){return T.has(U)||(U&&isFunction(U.install)?(T.add(U),U.install(N,...I)):isFunction(U)&&(T.add(U),U(N,...I))),N},mixin(U){return R.mixins.includes(U)||R.mixins.push(U),N},component(U,I){return I?(R.components[U]=I,N):R.components[U]},directive(U,I){return I?(R.directives[U]=I,N):R.directives[U]},mount(U,I,M){if(!O){const C=createVNode(l,r);return C.appContext=R,I&&n?n(C,U):e(C,U,M),O=!0,N._container=U,U.__vue_app__=N,getExposeProxy(C.component)||C.component.proxy}},unmount(){O&&(e(null,N._container),delete N._container.__vue_app__)},provide(U,I){return R.provides[U]=I,N}};return N}}function setRef(e,n,S,l,r=!1){if(isArray(e)){e.forEach((C,w)=>setRef(C,n&&(isArray(n)?n[w]:n),S,l,r));return}if(isAsyncWrapper(l)&&!r)return;const R=l.shapeFlag&4?getExposeProxy(l.component)||l.component.proxy:l.el,T=r?null:R,{i:O,r:N}=e,U=n&&n.r,I=O.refs===EMPTY_OBJ?O.refs={}:O.refs,M=O.setupState;if(U!=null&&U!==N&&(isString(U)?(I[U]=null,hasOwn(M,U)&&(M[U]=null)):isRef(U)&&(U.value=null)),isFunction(N))callWithErrorHandling(N,O,12,[T,I]);else{const C=isString(N),w=isRef(N);if(C||w){const v=()=>{if(e.f){const k=C?I[N]:N.value;r?isArray(k)&&remove(k,R):isArray(k)?k.includes(R)||k.push(R):C?(I[N]=[R],hasOwn(M,N)&&(M[N]=I[N])):(N.value=[R],e.k&&(I[e.k]=N.value))}else C?(I[N]=T,hasOwn(M,N)&&(M[N]=T)):isRef(N)&&(N.value=T,e.k&&(I[e.k]=T))};T?(v.id=-1,queuePostRenderEffect(v,S)):v()}}}const queuePostRenderEffect=queueEffectWithSuspense;function createRenderer(e){return baseCreateRenderer(e)}function baseCreateRenderer(e,n){const S=getGlobalThis();S.__VUE__=!0;const{insert:l,remove:r,patchProp:R,createElement:T,createText:O,createComment:N,setText:U,setElementText:I,parentNode:M,nextSibling:C,setScopeId:w=NOOP,cloneNode:v,insertStaticContent:k}=e,F=(G,Y,Z,ee=null,te=null,ie=null,se=!1,ne=null,ae=!!Y.dynamicChildren)=>{if(G===Y)return;G&&!isSameVNodeType(G,Y)&&(ee=q(G),z(G,te,ie,!0),G=null),Y.patchFlag===-2&&(ae=!1,Y.dynamicChildren=null);const{type:re,ref:de,shapeFlag:fe}=Y;switch(re){case Text:D(G,Y,Z,ee);break;case Comment:E(G,Y,Z,ee);break;case Static:G==null&&u(Y,Z,ee,se);break;case Fragment:a(G,Y,Z,ee,te,ie,se,ne,ae);break;default:fe&1?P(G,Y,Z,ee,te,ie,se,ne,ae):fe&6?c(G,Y,Z,ee,te,ie,se,ne,ae):(fe&64||fe&128)&&re.process(G,Y,Z,ee,te,ie,se,ne,ae,oe)}de!=null&&te&&setRef(de,G&&G.ref,ie,Y||G,!Y)},D=(G,Y,Z,ee)=>{if(G==null)l(Y.el=O(Y.children),Z,ee);else{const te=Y.el=G.el;Y.children!==G.children&&U(te,Y.children)}},E=(G,Y,Z,ee)=>{G==null?l(Y.el=N(Y.children||""),Z,ee):Y.el=G.el},u=(G,Y,Z,ee)=>{[G.el,G.anchor]=k(G.children,Y,Z,ee,G.el,G.anchor)},y=({el:G,anchor:Y},Z,ee)=>{let te;for(;G&&G!==Y;)te=C(G),l(G,Z,ee),G=te;l(Y,Z,ee)},o=({el:G,anchor:Y})=>{let Z;for(;G&&G!==Y;)Z=C(G),r(G),G=Z;r(Y)},P=(G,Y,Z,ee,te,ie,se,ne,ae)=>{se=se||Y.type==="svg",G==null?A(Y,Z,ee,te,ie,se,ne,ae):f(G,Y,te,ie,se,ne,ae)},A=(G,Y,Z,ee,te,ie,se,ne)=>{let ae,re;const{type:de,props:fe,shapeFlag:ge,transition:he,patchFlag:ve,dirs:ye}=G;if(G.el&&v!==void 0&&ve===-1)ae=G.el=v(G.el);else{if(ae=G.el=T(G.type,ie,fe&&fe.is,fe),ge&8?I(ae,G.children):ge&16&&t(G.children,ae,null,ee,te,ie&&de!=="foreignObject",se,ne),ye&&invokeDirectiveHook(G,null,ee,"created"),fe){for(const me in fe)me!=="value"&&!isReservedProp(me)&&R(ae,me,null,fe[me],ie,G.children,ee,te,X);"value"in fe&&R(ae,"value",null,fe.value),(re=fe.onVnodeBeforeMount)&&invokeVNodeHook(re,ee,G)}g(ae,G,G.scopeId,se,ee)}ye&&invokeDirectiveHook(G,null,ee,"beforeMount");const pe=(!te||te&&!te.pendingBranch)&&he&&!he.persisted;pe&&he.beforeEnter(ae),l(ae,Y,Z),((re=fe&&fe.onVnodeMounted)||pe||ye)&&queuePostRenderEffect(()=>{re&&invokeVNodeHook(re,ee,G),pe&&he.enter(ae),ye&&invokeDirectiveHook(G,null,ee,"mounted")},te)},g=(G,Y,Z,ee,te)=>{if(Z&&w(G,Z),ee)for(let ie=0;ie<ee.length;ie++)w(G,ee[ie]);if(te){let ie=te.subTree;if(Y===ie){const se=te.vnode;g(G,se,se.scopeId,se.slotScopeIds,te.parent)}}},t=(G,Y,Z,ee,te,ie,se,ne,ae=0)=>{for(let re=ae;re<G.length;re++){const de=G[re]=ne?cloneIfMounted(G[re]):normalizeVNode(G[re]);F(null,de,Y,Z,ee,te,ie,se,ne)}},f=(G,Y,Z,ee,te,ie,se)=>{const ne=Y.el=G.el;let{patchFlag:ae,dynamicChildren:re,dirs:de}=Y;ae|=G.patchFlag&16;const fe=G.props||EMPTY_OBJ,ge=Y.props||EMPTY_OBJ;let he;Z&&toggleRecurse(Z,!1),(he=ge.onVnodeBeforeUpdate)&&invokeVNodeHook(he,Z,Y,G),de&&invokeDirectiveHook(Y,G,Z,"beforeUpdate"),Z&&toggleRecurse(Z,!0);const ve=te&&Y.type!=="foreignObject";if(re?x(G.dynamicChildren,re,ne,Z,ee,ve,ie):se||K(G,Y,ne,null,Z,ee,ve,ie,!1),ae>0){if(ae&16)m(ne,Y,fe,ge,Z,ee,te);else if(ae&2&&fe.class!==ge.class&&R(ne,"class",null,ge.class,te),ae&4&&R(ne,"style",fe.style,ge.style,te),ae&8){const ye=Y.dynamicProps;for(let pe=0;pe<ye.length;pe++){const me=ye[pe],Ee=fe[me],Ae=ge[me];(Ae!==Ee||me==="value")&&R(ne,me,Ee,Ae,te,G.children,Z,ee,X)}}ae&1&&G.children!==Y.children&&I(ne,Y.children)}else!se&&re==null&&m(ne,Y,fe,ge,Z,ee,te);((he=ge.onVnodeUpdated)||de)&&queuePostRenderEffect(()=>{he&&invokeVNodeHook(he,Z,Y,G),de&&invokeDirectiveHook(Y,G,Z,"updated")},ee)},x=(G,Y,Z,ee,te,ie,se)=>{for(let ne=0;ne<Y.length;ne++){const ae=G[ne],re=Y[ne],de=ae.el&&(ae.type===Fragment||!isSameVNodeType(ae,re)||ae.shapeFlag&70)?M(ae.el):Z;F(ae,re,de,null,ee,te,ie,se,!0)}},m=(G,Y,Z,ee,te,ie,se)=>{if(Z!==ee){for(const ne in ee){if(isReservedProp(ne))continue;const ae=ee[ne],re=Z[ne];ae!==re&&ne!=="value"&&R(G,ne,re,ae,se,Y.children,te,ie,X)}if(Z!==EMPTY_OBJ)for(const ne in Z)!isReservedProp(ne)&&!(ne in ee)&&R(G,ne,Z[ne],null,se,Y.children,te,ie,X);"value"in ee&&R(G,"value",Z.value,ee.value)}},a=(G,Y,Z,ee,te,ie,se,ne,ae)=>{const re=Y.el=G?G.el:O(""),de=Y.anchor=G?G.anchor:O("");let{patchFlag:fe,dynamicChildren:ge,slotScopeIds:he}=Y;he&&(ne=ne?ne.concat(he):he),G==null?(l(re,Z,ee),l(de,Z,ee),t(Y.children,Z,de,te,ie,se,ne,ae)):fe>0&&fe&64&&ge&&G.dynamicChildren?(x(G.dynamicChildren,ge,Z,te,ie,se,ne),(Y.key!=null||te&&Y===te.subTree)&&traverseStaticChildren(G,Y,!0)):K(G,Y,Z,de,te,ie,se,ne,ae)},c=(G,Y,Z,ee,te,ie,se,ne,ae)=>{Y.slotScopeIds=ne,G==null?Y.shapeFlag&512?te.ctx.activate(Y,Z,ee,se,ae):L(Y,Z,ee,te,ie,se,ae):_(G,Y,ae)},L=(G,Y,Z,ee,te,ie,se)=>{const ne=G.component=createComponentInstance(G,ee,te);if(isKeepAlive(G)&&(ne.ctx.renderer=oe),setupComponent(ne),ne.asyncDep){if(te&&te.registerDep(ne,B),!G.el){const ae=ne.subTree=createVNode(Comment);E(null,ae,Y,Z)}return}B(ne,G,Y,Z,te,ie,se)},_=(G,Y,Z)=>{const ee=Y.component=G.component;if(shouldUpdateComponent(G,Y,Z))if(ee.asyncDep&&!ee.asyncResolved){$(ee,Y,Z);return}else ee.next=Y,invalidateJob(ee.update),ee.update();else Y.component=G.component,Y.el=G.el,ee.vnode=Y},B=(G,Y,Z,ee,te,ie,se)=>{const ne=()=>{if(G.isMounted){let{next:de,bu:fe,u:ge,parent:he,vnode:ve}=G,ye=de,pe;toggleRecurse(G,!1),de?(de.el=ve.el,$(G,de,se)):de=ve,fe&&invokeArrayFns(fe),(pe=de.props&&de.props.onVnodeBeforeUpdate)&&invokeVNodeHook(pe,he,de,ve),toggleRecurse(G,!0);const me=renderComponentRoot(G),Ee=G.subTree;G.subTree=me,F(Ee,me,M(Ee.el),q(Ee),G,te,ie),de.el=me.el,ye===null&&updateHOCHostEl(G,me.el),ge&&queuePostRenderEffect(ge,te),(pe=de.props&&de.props.onVnodeUpdated)&&queuePostRenderEffect(()=>invokeVNodeHook(pe,he,de,ve),te)}else{let de;const{el:fe,props:ge}=Y,{bm:he,m:ve,parent:ye}=G,pe=isAsyncWrapper(Y);if(toggleRecurse(G,!1),he&&invokeArrayFns(he),!pe&&(de=ge&&ge.onVnodeBeforeMount)&&invokeVNodeHook(de,ye,Y),toggleRecurse(G,!0),fe&&le){const me=()=>{G.subTree=renderComponentRoot(G),le(fe,G.subTree,G,te,null)};pe?Y.type.__asyncLoader().then(()=>!G.isUnmounted&&me()):me()}else{const me=G.subTree=renderComponentRoot(G);F(null,me,Z,ee,G,te,ie),Y.el=me.el}if(ve&&queuePostRenderEffect(ve,te),!pe&&(de=ge&&ge.onVnodeMounted)){const me=Y;queuePostRenderEffect(()=>invokeVNodeHook(de,ye,me),te)}Y.shapeFlag&256&&G.a&&queuePostRenderEffect(G.a,te),G.isMounted=!0,Y=Z=ee=null}},ae=G.effect=new ReactiveEffect(ne,()=>queueJob(G.update),G.scope),re=G.update=ae.run.bind(ae);re.id=G.uid,toggleRecurse(G,!0),re()},$=(G,Y,Z)=>{Y.component=G;const ee=G.vnode.props;G.vnode=Y,G.next=null,updateProps(G,Y.props,ee,Z),updateSlots(G,Y.children,Z),pauseTracking(),flushPreFlushCbs(void 0,G.update),resetTracking()},K=(G,Y,Z,ee,te,ie,se,ne,ae=!1)=>{const re=G&&G.children,de=G?G.shapeFlag:0,fe=Y.children,{patchFlag:ge,shapeFlag:he}=Y;if(ge>0){if(ge&128){j(re,fe,Z,ee,te,ie,se,ne,ae);return}else if(ge&256){H(re,fe,Z,ee,te,ie,se,ne,ae);return}}he&8?(de&16&&X(re,te,ie),fe!==re&&I(Z,fe)):de&16?he&16?j(re,fe,Z,ee,te,ie,se,ne,ae):X(re,te,ie,!0):(de&8&&I(Z,""),he&16&&t(fe,Z,ee,te,ie,se,ne,ae))},H=(G,Y,Z,ee,te,ie,se,ne,ae)=>{G=G||EMPTY_ARR,Y=Y||EMPTY_ARR;const re=G.length,de=Y.length,fe=Math.min(re,de);let ge;for(ge=0;ge<fe;ge++){const he=Y[ge]=ae?cloneIfMounted(Y[ge]):normalizeVNode(Y[ge]);F(G[ge],he,Z,null,te,ie,se,ne,ae)}re>de?X(G,te,ie,!0,!1,fe):t(Y,Z,ee,te,ie,se,ne,ae,fe)},j=(G,Y,Z,ee,te,ie,se,ne,ae)=>{let re=0;const de=Y.length;let fe=G.length-1,ge=de-1;for(;re<=fe&&re<=ge;){const he=G[re],ve=Y[re]=ae?cloneIfMounted(Y[re]):normalizeVNode(Y[re]);if(isSameVNodeType(he,ve))F(he,ve,Z,null,te,ie,se,ne,ae);else break;re++}for(;re<=fe&&re<=ge;){const he=G[fe],ve=Y[ge]=ae?cloneIfMounted(Y[ge]):normalizeVNode(Y[ge]);if(isSameVNodeType(he,ve))F(he,ve,Z,null,te,ie,se,ne,ae);else break;fe--,ge--}if(re>fe){if(re<=ge){const he=ge+1,ve=he<de?Y[he].el:ee;for(;re<=ge;)F(null,Y[re]=ae?cloneIfMounted(Y[re]):normalizeVNode(Y[re]),Z,ve,te,ie,se,ne,ae),re++}}else if(re>ge)for(;re<=fe;)z(G[re],te,ie,!0),re++;else{const he=re,ve=re,ye=new Map;for(re=ve;re<=ge;re++){const Te=Y[re]=ae?cloneIfMounted(Y[re]):normalizeVNode(Y[re]);Te.key!=null&&ye.set(Te.key,re)}let pe,me=0;const Ee=ge-ve+1;let Ae=!1,Le=0;const Se=new Array(Ee);for(re=0;re<Ee;re++)Se[re]=0;for(re=he;re<=fe;re++){const Te=G[re];if(me>=Ee){z(Te,te,ie,!0);continue}let xe;if(Te.key!=null)xe=ye.get(Te.key);else for(pe=ve;pe<=ge;pe++)if(Se[pe-ve]===0&&isSameVNodeType(Te,Y[pe])){xe=pe;break}xe===void 0?z(Te,te,ie,!0):(Se[xe-ve]=re+1,xe>=Le?Le=xe:Ae=!0,F(Te,Y[xe],Z,null,te,ie,se,ne,ae),me++)}const Pe=Ae?getSequence(Se):EMPTY_ARR;for(pe=Pe.length-1,re=Ee-1;re>=0;re--){const Te=ve+re,xe=Y[Te],be=Te+1<de?Y[Te+1].el:ee;Se[re]===0?F(null,xe,Z,be,te,ie,se,ne,ae):Ae&&(pe<0||re!==Pe[pe]?W(xe,Z,be,2):pe--)}}},W=(G,Y,Z,ee,te=null)=>{const{el:ie,type:se,transition:ne,children:ae,shapeFlag:re}=G;if(re&6){W(G.component.subTree,Y,Z,ee);return}if(re&128){G.suspense.move(Y,Z,ee);return}if(re&64){se.move(G,Y,Z,oe);return}if(se===Fragment){l(ie,Y,Z);for(let fe=0;fe<ae.length;fe++)W(ae[fe],Y,Z,ee);l(G.anchor,Y,Z);return}if(se===Static){y(G,Y,Z);return}if(ee!==2&&re&1&&ne)if(ee===0)ne.beforeEnter(ie),l(ie,Y,Z),queuePostRenderEffect(()=>ne.enter(ie),te);else{const{leave:fe,delayLeave:ge,afterLeave:he}=ne,ve=()=>l(ie,Y,Z),ye=()=>{fe(ie,()=>{ve(),he&&he()})};ge?ge(ie,ve,ye):ye()}else l(ie,Y,Z)},z=(G,Y,Z,ee=!1,te=!1)=>{const{type:ie,props:se,ref:ne,children:ae,dynamicChildren:re,shapeFlag:de,patchFlag:fe,dirs:ge}=G;if(ne!=null&&setRef(ne,null,Z,G,!0),de&256){Y.ctx.deactivate(G);return}const he=de&1&&ge,ve=!isAsyncWrapper(G);let ye;if(ve&&(ye=se&&se.onVnodeBeforeUnmount)&&invokeVNodeHook(ye,Y,G),de&6)J(G.component,Z,ee);else{if(de&128){G.suspense.unmount(Z,ee);return}he&&invokeDirectiveHook(G,null,Y,"beforeUnmount"),de&64?G.type.remove(G,Y,Z,te,oe,ee):re&&(ie!==Fragment||fe>0&&fe&64)?X(re,Y,Z,!1,!0):(ie===Fragment&&fe&384||!te&&de&16)&&X(ae,Y,Z),ee&&Q(G)}(ve&&(ye=se&&se.onVnodeUnmounted)||he)&&queuePostRenderEffect(()=>{ye&&invokeVNodeHook(ye,Y,G),he&&invokeDirectiveHook(G,null,Y,"unmounted")},Z)},Q=G=>{const{type:Y,el:Z,anchor:ee,transition:te}=G;if(Y===Fragment){V(Z,ee);return}if(Y===Static){o(G);return}const ie=()=>{r(Z),te&&!te.persisted&&te.afterLeave&&te.afterLeave()};if(G.shapeFlag&1&&te&&!te.persisted){const{leave:se,delayLeave:ne}=te,ae=()=>se(Z,ie);ne?ne(G.el,ie,ae):ae()}else ie()},V=(G,Y)=>{let Z;for(;G!==Y;)Z=C(G),r(G),G=Z;r(Y)},J=(G,Y,Z)=>{const{bum:ee,scope:te,update:ie,subTree:se,um:ne}=G;ee&&invokeArrayFns(ee),te.stop(),ie&&(ie.active=!1,z(se,G,Y,Z)),ne&&queuePostRenderEffect(ne,Y),queuePostRenderEffect(()=>{G.isUnmounted=!0},Y),Y&&Y.pendingBranch&&!Y.isUnmounted&&G.asyncDep&&!G.asyncResolved&&G.suspenseId===Y.pendingId&&(Y.deps--,Y.deps===0&&Y.resolve())},X=(G,Y,Z,ee=!1,te=!1,ie=0)=>{for(let se=ie;se<G.length;se++)z(G[se],Y,Z,ee,te)},q=G=>G.shapeFlag&6?q(G.component.subTree):G.shapeFlag&128?G.suspense.next():C(G.anchor||G.el),ue=(G,Y,Z)=>{G==null?Y._vnode&&z(Y._vnode,null,null,!0):F(Y._vnode||null,G,Y,null,null,null,Z),flushPostFlushCbs(),Y._vnode=G},oe={p:F,um:z,m:W,r:Q,mt:L,mc:t,pc:K,pbc:x,n:q,o:e};let ce,le;return n&&([ce,le]=n(oe)),{render:ue,hydrate:ce,createApp:createAppAPI(ue,ce)}}function toggleRecurse({effect:e,update:n},S){e.allowRecurse=n.allowRecurse=S}function traverseStaticChildren(e,n,S=!1){const l=e.children,r=n.children;if(isArray(l)&&isArray(r))for(let R=0;R<l.length;R++){const T=l[R];let O=r[R];O.shapeFlag&1&&!O.dynamicChildren&&((O.patchFlag<=0||O.patchFlag===32)&&(O=r[R]=cloneIfMounted(r[R]),O.el=T.el),S||traverseStaticChildren(T,O))}}function getSequence(e){const n=e.slice(),S=[0];let l,r,R,T,O;const N=e.length;for(l=0;l<N;l++){const U=e[l];if(U!==0){if(r=S[S.length-1],e[r]<U){n[l]=r,S.push(l);continue}for(R=0,T=S.length-1;R<T;)O=R+T>>1,e[S[O]]<U?R=O+1:T=O;U<e[S[R]]&&(R>0&&(n[l]=S[R-1]),S[R]=l)}}for(R=S.length,T=S[R-1];R-- >0;)S[R]=T,T=n[T];return S}const isTeleport=e=>e.__isTeleport,COMPONENTS="components";function resolveComponent(e,n){return resolveAsset(COMPONENTS,e,!0,n)||e}const NULL_DYNAMIC_COMPONENT=Symbol();function resolveAsset(e,n,S=!0,l=!1){const r=currentRenderingInstance||currentInstance;if(r){const R=r.type;if(e===COMPONENTS){const O=getComponentName(R);if(O&&(O===n||O===camelize(n)||O===capitalize(camelize(n))))return R}const T=resolve(r[e]||R[e],n)||resolve(r.appContext[e],n);return!T&&l?R:T}}function resolve(e,n){return e&&(e[n]||e[camelize(n)]||e[capitalize(camelize(n))])}const Fragment=Symbol(void 0),Text=Symbol(void 0),Comment=Symbol(void 0),Static=Symbol(void 0),blockStack=[];let currentBlock=null;function openBlock(e=!1){blockStack.push(currentBlock=e?null:[])}function closeBlock(){blockStack.pop(),currentBlock=blockStack[blockStack.length-1]||null}let isBlockTreeEnabled=1;function setBlockTracking(e){isBlockTreeEnabled+=e}function setupBlock(e){return e.dynamicChildren=isBlockTreeEnabled>0?currentBlock||EMPTY_ARR:null,closeBlock(),isBlockTreeEnabled>0&&currentBlock&&currentBlock.push(e),e}function createElementBlock(e,n,S,l,r,R){return setupBlock(createBaseVNode(e,n,S,l,r,R,!0))}function createBlock(e,n,S,l,r){return setupBlock(createVNode(e,n,S,l,r,!0))}function isVNode(e){return e?e.__v_isVNode===!0:!1}function isSameVNodeType(e,n){return e.type===n.type&&e.key===n.key}const InternalObjectKey="__vInternal",normalizeKey=({key:e})=>e!=null?e:null,normalizeRef=({ref:e,ref_key:n,ref_for:S})=>e!=null?isString(e)||isRef(e)||isFunction(e)?{i:currentRenderingInstance,r:e,k:n,f:!!S}:e:null;function createBaseVNode(e,n=null,S=null,l=0,r=null,R=e===Fragment?0:1,T=!1,O=!1){const N={__v_isVNode:!0,__v_skip:!0,type:e,props:n,key:n&&normalizeKey(n),ref:n&&normalizeRef(n),scopeId:currentScopeId,slotScopeIds:null,children:S,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:R,patchFlag:l,dynamicProps:r,dynamicChildren:null,appContext:null};return O?(normalizeChildren(N,S),R&128&&e.normalize(N)):S&&(N.shapeFlag|=isString(S)?8:16),isBlockTreeEnabled>0&&!T&&currentBlock&&(N.patchFlag>0||R&6)&&N.patchFlag!==32&&currentBlock.push(N),N}const createVNode=_createVNode;function _createVNode(e,n=null,S=null,l=0,r=null,R=!1){if((!e||e===NULL_DYNAMIC_COMPONENT)&&(e=Comment),isVNode(e)){const O=cloneVNode(e,n,!0);return S&&normalizeChildren(O,S),O}if(isClassComponent(e)&&(e=e.__vccOpts),n){n=guardReactiveProps(n);let{class:O,style:N}=n;O&&!isString(O)&&(n.class=normalizeClass(O)),isObject(N)&&(isProxy(N)&&!isArray(N)&&(N=extend({},N)),n.style=normalizeStyle(N))}const T=isString(e)?1:isSuspense(e)?128:isTeleport(e)?64:isObject(e)?4:isFunction(e)?2:0;return createBaseVNode(e,n,S,l,r,T,R,!0)}function guardReactiveProps(e){return e?isProxy(e)||InternalObjectKey in e?extend({},e):e:null}function cloneVNode(e,n,S=!1){const{props:l,ref:r,patchFlag:R,children:T}=e,O=n?mergeProps(l||{},n):l;return{__v_isVNode:!0,__v_skip:!0,type:e.type,props:O,key:O&&normalizeKey(O),ref:n&&n.ref?S&&r?isArray(r)?r.concat(normalizeRef(n)):[r,normalizeRef(n)]:normalizeRef(n):r,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:T,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:n&&e.type!==Fragment?R===-1?16:R|16:R,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&cloneVNode(e.ssContent),ssFallback:e.ssFallback&&cloneVNode(e.ssFallback),el:e.el,anchor:e.anchor}}function createTextVNode(e=" ",n=0){return createVNode(Text,null,e,n)}function normalizeVNode(e){return e==null||typeof e=="boolean"?createVNode(Comment):isArray(e)?createVNode(Fragment,null,e.slice()):typeof e=="object"?cloneIfMounted(e):createVNode(Text,null,String(e))}function cloneIfMounted(e){return e.el===null||e.memo?e:cloneVNode(e)}function normalizeChildren(e,n){let S=0;const{shapeFlag:l}=e;if(n==null)n=null;else if(isArray(n))S=16;else if(typeof n=="object")if(l&65){const r=n.default;r&&(r._c&&(r._d=!1),normalizeChildren(e,r()),r._c&&(r._d=!0));return}else{S=32;const r=n._;!r&&!(InternalObjectKey in n)?n._ctx=currentRenderingInstance:r===3&&currentRenderingInstance&&(currentRenderingInstance.slots._===1?n._=1:(n._=2,e.patchFlag|=1024))}else isFunction(n)?(n={default:n,_ctx:currentRenderingInstance},S=32):(n=String(n),l&64?(S=16,n=[createTextVNode(n)]):S=8);e.children=n,e.shapeFlag|=S}function mergeProps(...e){const n={};for(let S=0;S<e.length;S++){const l=e[S];for(const r in l)if(r==="class")n.class!==l.class&&(n.class=normalizeClass([n.class,l.class]));else if(r==="style")n.style=normalizeStyle([n.style,l.style]);else if(isOn(r)){const R=n[r],T=l[r];T&&R!==T&&!(isArray(R)&&R.includes(T))&&(n[r]=R?[].concat(R,T):T)}else r!==""&&(n[r]=l[r])}return n}function invokeVNodeHook(e,n,S,l=null){callWithAsyncErrorHandling(e,n,7,[S,l])}const getPublicInstance=e=>e?isStatefulComponent(e)?getExposeProxy(e)||e.proxy:getPublicInstance(e.parent):null,publicPropertiesMap=extend(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>getPublicInstance(e.parent),$root:e=>getPublicInstance(e.root),$emit:e=>e.emit,$options:e=>resolveMergedOptions(e),$forceUpdate:e=>()=>queueJob(e.update),$nextTick:e=>nextTick.bind(e.proxy),$watch:e=>instanceWatch.bind(e)}),PublicInstanceProxyHandlers={get({_:e},n){const{ctx:S,setupState:l,data:r,props:R,accessCache:T,type:O,appContext:N}=e;let U;if(n[0]!=="$"){const w=T[n];if(w!==void 0)switch(w){case 1:return l[n];case 2:return r[n];case 4:return S[n];case 3:return R[n]}else{if(l!==EMPTY_OBJ&&hasOwn(l,n))return T[n]=1,l[n];if(r!==EMPTY_OBJ&&hasOwn(r,n))return T[n]=2,r[n];if((U=e.propsOptions[0])&&hasOwn(U,n))return T[n]=3,R[n];if(S!==EMPTY_OBJ&&hasOwn(S,n))return T[n]=4,S[n];shouldCacheAccess&&(T[n]=0)}}const I=publicPropertiesMap[n];let M,C;if(I)return n==="$attrs"&&track(e,"get",n),I(e);if((M=O.__cssModules)&&(M=M[n]))return M;if(S!==EMPTY_OBJ&&hasOwn(S,n))return T[n]=4,S[n];if(C=N.config.globalProperties,hasOwn(C,n))return C[n]},set({_:e},n,S){const{data:l,setupState:r,ctx:R}=e;return r!==EMPTY_OBJ&&hasOwn(r,n)?(r[n]=S,!0):l!==EMPTY_OBJ&&hasOwn(l,n)?(l[n]=S,!0):hasOwn(e.props,n)||n[0]==="$"&&n.slice(1)in e?!1:(R[n]=S,!0)},has({_:{data:e,setupState:n,accessCache:S,ctx:l,appContext:r,propsOptions:R}},T){let O;return!!S[T]||e!==EMPTY_OBJ&&hasOwn(e,T)||n!==EMPTY_OBJ&&hasOwn(n,T)||(O=R[0])&&hasOwn(O,T)||hasOwn(l,T)||hasOwn(publicPropertiesMap,T)||hasOwn(r.config.globalProperties,T)},defineProperty(e,n,S){return S.get!=null?e._.accessCache[n]=0:hasOwn(S,"value")&&this.set(e,n,S.value,null),Reflect.defineProperty(e,n,S)}},emptyAppContext=createAppContext();let uid$1=0;function createComponentInstance(e,n,S){const l=e.type,r=(n?n.appContext:e.appContext)||emptyAppContext,R={uid:uid$1++,vnode:e,type:l,parent:n,appContext:r,root:null,next:null,subTree:null,effect:null,update:null,scope:new EffectScope(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:n?n.provides:Object.create(r.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:normalizePropsOptions(l,r),emitsOptions:normalizeEmitsOptions(l,r),emit:null,emitted:null,propsDefaults:EMPTY_OBJ,inheritAttrs:l.inheritAttrs,ctx:EMPTY_OBJ,data:EMPTY_OBJ,props:EMPTY_OBJ,attrs:EMPTY_OBJ,slots:EMPTY_OBJ,refs:EMPTY_OBJ,setupState:EMPTY_OBJ,setupContext:null,suspense:S,suspenseId:S?S.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return R.ctx={_:R},R.root=n?n.root:R,R.emit=emit$1.bind(null,R),e.ce&&e.ce(R),R}let currentInstance=null;const getCurrentInstance=()=>currentInstance||currentRenderingInstance,setCurrentInstance=e=>{currentInstance=e,e.scope.on()},unsetCurrentInstance=()=>{currentInstance&&currentInstance.scope.off(),currentInstance=null};function isStatefulComponent(e){return e.vnode.shapeFlag&4}let isInSSRComponentSetup=!1;function setupComponent(e,n=!1){isInSSRComponentSetup=n;const{props:S,children:l}=e.vnode,r=isStatefulComponent(e);initProps(e,S,r,n),initSlots(e,l);const R=r?setupStatefulComponent(e,n):void 0;return isInSSRComponentSetup=!1,R}function setupStatefulComponent(e,n){const S=e.type;e.accessCache=Object.create(null),e.proxy=markRaw(new Proxy(e.ctx,PublicInstanceProxyHandlers));const{setup:l}=S;if(l){const r=e.setupContext=l.length>1?createSetupContext(e):null;setCurrentInstance(e),pauseTracking();const R=callWithErrorHandling(l,e,0,[e.props,r]);if(resetTracking(),unsetCurrentInstance(),isPromise(R)){if(R.then(unsetCurrentInstance,unsetCurrentInstance),n)return R.then(T=>{handleSetupResult(e,T,n)}).catch(T=>{handleError(T,e,0)});e.asyncDep=R}else handleSetupResult(e,R,n)}else finishComponentSetup(e,n)}function handleSetupResult(e,n,S){isFunction(n)?e.type.__ssrInlineRender?e.ssrRender=n:e.render=n:isObject(n)&&(e.setupState=proxyRefs(n)),finishComponentSetup(e,S)}let compile;function finishComponentSetup(e,n,S){const l=e.type;if(!e.render){if(!n&&compile&&!l.render){const r=l.template;if(r){const{isCustomElement:R,compilerOptions:T}=e.appContext.config,{delimiters:O,compilerOptions:N}=l,U=extend(extend({isCustomElement:R,delimiters:O},T),N);l.render=compile(r,U)}}e.render=l.render||NOOP}setCurrentInstance(e),pauseTracking(),applyOptions(e),resetTracking(),unsetCurrentInstance()}function createAttrsProxy(e){return new Proxy(e.attrs,{get(n,S){return track(e,"get","$attrs"),n[S]}})}function createSetupContext(e){const n=l=>{e.exposed=l||{}};let S;return{get attrs(){return S||(S=createAttrsProxy(e))},slots:e.slots,emit:e.emit,expose:n}}function getExposeProxy(e){if(e.exposed)return e.exposeProxy||(e.exposeProxy=new Proxy(proxyRefs(markRaw(e.exposed)),{get(n,S){if(S in n)return n[S];if(S in publicPropertiesMap)return publicPropertiesMap[S](e)}}))}function getComponentName(e){return isFunction(e)&&e.displayName||e.name}function isClassComponent(e){return isFunction(e)&&"__vccOpts"in e}const computed=(e,n)=>computed$1(e,n,isInSSRComponentSetup);function h(e,n,S){const l=arguments.length;return l===2?isObject(n)&&!isArray(n)?isVNode(n)?createVNode(e,null,[n]):createVNode(e,n):createVNode(e,null,n):(l>3?S=Array.prototype.slice.call(arguments,2):l===3&&isVNode(S)&&(S=[S]),createVNode(e,n,S))}const version="3.2.33",svgNS="http://www.w3.org/2000/svg",doc=typeof document!="undefined"?document:null,templateContainer=doc&&doc.createElement("template"),nodeOps={insert:(e,n,S)=>{n.insertBefore(e,S||null)},remove:e=>{const n=e.parentNode;n&&n.removeChild(e)},createElement:(e,n,S,l)=>{const r=n?doc.createElementNS(svgNS,e):doc.createElement(e,S?{is:S}:void 0);return e==="select"&&l&&l.multiple!=null&&r.setAttribute("multiple",l.multiple),r},createText:e=>doc.createTextNode(e),createComment:e=>doc.createComment(e),setText:(e,n)=>{e.nodeValue=n},setElementText:(e,n)=>{e.textContent=n},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>doc.querySelector(e),setScopeId(e,n){e.setAttribute(n,"")},cloneNode(e){const n=e.cloneNode(!0);return"_value"in e&&(n._value=e._value),n},insertStaticContent(e,n,S,l,r,R){const T=S?S.previousSibling:n.lastChild;if(r&&(r===R||r.nextSibling))for(;n.insertBefore(r.cloneNode(!0),S),!(r===R||!(r=r.nextSibling)););else{templateContainer.innerHTML=l?`<svg>${e}</svg>`:e;const O=templateContainer.content;if(l){const N=O.firstChild;for(;N.firstChild;)O.appendChild(N.firstChild);O.removeChild(N)}n.insertBefore(O,S)}return[T?T.nextSibling:n.firstChild,S?S.previousSibling:n.lastChild]}};function patchClass(e,n,S){const l=e._vtc;l&&(n=(n?[n,...l]:[...l]).join(" ")),n==null?e.removeAttribute("class"):S?e.setAttribute("class",n):e.className=n}function patchStyle(e,n,S){const l=e.style,r=isString(S);if(S&&!r){for(const R in S)setStyle(l,R,S[R]);if(n&&!isString(n))for(const R in n)S[R]==null&&setStyle(l,R,"")}else{const R=l.display;r?n!==S&&(l.cssText=S):n&&e.removeAttribute("style"),"_vod"in e&&(l.display=R)}}const importantRE=/\s*!important$/;function setStyle(e,n,S){if(isArray(S))S.forEach(l=>setStyle(e,n,l));else if(S==null&&(S=""),n.startsWith("--"))e.setProperty(n,S);else{const l=autoPrefix(e,n);importantRE.test(S)?e.setProperty(hyphenate(l),S.replace(importantRE,""),"important"):e[l]=S}}const prefixes=["Webkit","Moz","ms"],prefixCache={};function autoPrefix(e,n){const S=prefixCache[n];if(S)return S;let l=camelize(n);if(l!=="filter"&&l in e)return prefixCache[n]=l;l=capitalize(l);for(let r=0;r<prefixes.length;r++){const R=prefixes[r]+l;if(R in e)return prefixCache[n]=R}return n}const xlinkNS="http://www.w3.org/1999/xlink";function patchAttr(e,n,S,l,r){if(l&&n.startsWith("xlink:"))S==null?e.removeAttributeNS(xlinkNS,n.slice(6,n.length)):e.setAttributeNS(xlinkNS,n,S);else{const R=isSpecialBooleanAttr(n);S==null||R&&!includeBooleanAttr(S)?e.removeAttribute(n):e.setAttribute(n,R?"":S)}}function patchDOMProp(e,n,S,l,r,R,T){if(n==="innerHTML"||n==="textContent"){l&&T(l,r,R),e[n]=S==null?"":S;return}if(n==="value"&&e.tagName!=="PROGRESS"&&!e.tagName.includes("-")){e._value=S;const N=S==null?"":S;(e.value!==N||e.tagName==="OPTION")&&(e.value=N),S==null&&e.removeAttribute(n);return}let O=!1;if(S===""||S==null){const N=typeof e[n];N==="boolean"?S=includeBooleanAttr(S):S==null&&N==="string"?(S="",O=!0):N==="number"&&(S=0,O=!0)}try{e[n]=S}catch{}O&&e.removeAttribute(n)}const[_getNow,skipTimestampCheck]=(()=>{let e=Date.now,n=!1;if(typeof window!="undefined"){Date.now()>document.createEvent("Event").timeStamp&&(e=()=>performance.now());const S=navigator.userAgent.match(/firefox\/(\d+)/i);n=!!(S&&Number(S[1])<=53)}return[e,n]})();let cachedNow=0;const p=Promise.resolve(),reset=()=>{cachedNow=0},getNow=()=>cachedNow||(p.then(reset),cachedNow=_getNow());function addEventListener(e,n,S,l){e.addEventListener(n,S,l)}function removeEventListener(e,n,S,l){e.removeEventListener(n,S,l)}function patchEvent(e,n,S,l,r=null){const R=e._vei||(e._vei={}),T=R[n];if(l&&T)T.value=l;else{const[O,N]=parseName(n);if(l){const U=R[n]=createInvoker(l,r);addEventListener(e,O,U,N)}else T&&(removeEventListener(e,O,T,N),R[n]=void 0)}}const optionsModifierRE=/(?:Once|Passive|Capture)$/;function parseName(e){let n;if(optionsModifierRE.test(e)){n={};let S;for(;S=e.match(optionsModifierRE);)e=e.slice(0,e.length-S[0].length),n[S[0].toLowerCase()]=!0}return[hyphenate(e.slice(2)),n]}function createInvoker(e,n){const S=l=>{const r=l.timeStamp||_getNow();(skipTimestampCheck||r>=S.attached-1)&&callWithAsyncErrorHandling(patchStopImmediatePropagation(l,S.value),n,5,[l])};return S.value=e,S.attached=getNow(),S}function patchStopImmediatePropagation(e,n){if(isArray(n)){const S=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{S.call(e),e._stopped=!0},n.map(l=>r=>!r._stopped&&l&&l(r))}else return n}const nativeOnRE=/^on[a-z]/,patchProp=(e,n,S,l,r=!1,R,T,O,N)=>{n==="class"?patchClass(e,l,r):n==="style"?patchStyle(e,S,l):isOn(n)?isModelListener(n)||patchEvent(e,n,S,l,T):(n[0]==="."?(n=n.slice(1),!0):n[0]==="^"?(n=n.slice(1),!1):shouldSetAsProp(e,n,l,r))?patchDOMProp(e,n,l,R,T,O,N):(n==="true-value"?e._trueValue=l:n==="false-value"&&(e._falseValue=l),patchAttr(e,n,l,r))};function shouldSetAsProp(e,n,S,l){return l?!!(n==="innerHTML"||n==="textContent"||n in e&&nativeOnRE.test(n)&&isFunction(S)):n==="spellcheck"||n==="draggable"||n==="translate"||n==="form"||n==="list"&&e.tagName==="INPUT"||n==="type"&&e.tagName==="TEXTAREA"||nativeOnRE.test(n)&&isString(S)?!1:n in e}const DOMTransitionPropsValidators={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};BaseTransition.props;const rendererOptions=extend({patchProp},nodeOps);let renderer;function ensureRenderer(){return renderer||(renderer=createRenderer(rendererOptions))}const createApp=(...e)=>{const n=ensureRenderer().createApp(...e),{mount:S}=n;return n.mount=l=>{const r=normalizeContainer(l);if(!r)return;const R=n._component;!isFunction(R)&&!R.render&&!R.template&&(R.template=r.innerHTML),r.innerHTML="";const T=S(r,!1,r instanceof SVGElement);return r instanceof Element&&(r.removeAttribute("v-cloak"),r.setAttribute("data-v-app","")),T},n};function normalizeContainer(e){return isString(e)?document.querySelector(e):e}const _sfc_main$1={setup(e){return(n,S)=>{const l=resolveComponent("router-view");return openBlock(),createBlock(l)}}};/*!
  * vue-router v4.0.15
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */const hasSymbol=typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol",PolySymbol=e=>hasSymbol?Symbol(e):"_vr_"+e,matchedRouteKey=PolySymbol("rvlm"),viewDepthKey=PolySymbol("rvd"),routerKey=PolySymbol("r"),routeLocationKey=PolySymbol("rl"),routerViewLocationKey=PolySymbol("rvl"),isBrowser=typeof window!="undefined";function isESModule(e){return e.__esModule||hasSymbol&&e[Symbol.toStringTag]==="Module"}const assign=Object.assign;function applyToParams(e,n){const S={};for(const l in n){const r=n[l];S[l]=Array.isArray(r)?r.map(e):e(r)}return S}const noop=()=>{},TRAILING_SLASH_RE=/\/$/,removeTrailingSlash=e=>e.replace(TRAILING_SLASH_RE,"");function parseURL(e,n,S="/"){let l,r={},R="",T="";const O=n.indexOf("?"),N=n.indexOf("#",O>-1?O:0);return O>-1&&(l=n.slice(0,O),R=n.slice(O+1,N>-1?N:n.length),r=e(R)),N>-1&&(l=l||n.slice(0,N),T=n.slice(N,n.length)),l=resolveRelativePath(l!=null?l:n,S),{fullPath:l+(R&&"?")+R+T,path:l,query:r,hash:T}}function stringifyURL(e,n){const S=n.query?e(n.query):"";return n.path+(S&&"?")+S+(n.hash||"")}function stripBase(e,n){return!n||!e.toLowerCase().startsWith(n.toLowerCase())?e:e.slice(n.length)||"/"}function isSameRouteLocation(e,n,S){const l=n.matched.length-1,r=S.matched.length-1;return l>-1&&l===r&&isSameRouteRecord(n.matched[l],S.matched[r])&&isSameRouteLocationParams(n.params,S.params)&&e(n.query)===e(S.query)&&n.hash===S.hash}function isSameRouteRecord(e,n){return(e.aliasOf||e)===(n.aliasOf||n)}function isSameRouteLocationParams(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const S in e)if(!isSameRouteLocationParamsValue(e[S],n[S]))return!1;return!0}function isSameRouteLocationParamsValue(e,n){return Array.isArray(e)?isEquivalentArray(e,n):Array.isArray(n)?isEquivalentArray(n,e):e===n}function isEquivalentArray(e,n){return Array.isArray(n)?e.length===n.length&&e.every((S,l)=>S===n[l]):e.length===1&&e[0]===n}function resolveRelativePath(e,n){if(e.startsWith("/"))return e;if(!e)return n;const S=n.split("/"),l=e.split("/");let r=S.length-1,R,T;for(R=0;R<l.length;R++)if(T=l[R],!(r===1||T==="."))if(T==="..")r--;else break;return S.slice(0,r).join("/")+"/"+l.slice(R-(R===l.length?1:0)).join("/")}var NavigationType;(function(e){e.pop="pop",e.push="push"})(NavigationType||(NavigationType={}));var NavigationDirection;(function(e){e.back="back",e.forward="forward",e.unknown=""})(NavigationDirection||(NavigationDirection={}));function normalizeBase(e){if(!e)if(isBrowser){const n=document.querySelector("base");e=n&&n.getAttribute("href")||"/",e=e.replace(/^\w+:\/\/[^\/]+/,"")}else e="/";return e[0]!=="/"&&e[0]!=="#"&&(e="/"+e),removeTrailingSlash(e)}const BEFORE_HASH_RE=/^[^#]+#/;function createHref(e,n){return e.replace(BEFORE_HASH_RE,"#")+n}function getElementPosition(e,n){const S=document.documentElement.getBoundingClientRect(),l=e.getBoundingClientRect();return{behavior:n.behavior,left:l.left-S.left-(n.left||0),top:l.top-S.top-(n.top||0)}}const computeScrollPosition=()=>({left:window.pageXOffset,top:window.pageYOffset});function scrollToPosition(e){let n;if("el"in e){const S=e.el,l=typeof S=="string"&&S.startsWith("#"),r=typeof S=="string"?l?document.getElementById(S.slice(1)):document.querySelector(S):S;if(!r)return;n=getElementPosition(r,e)}else n=e;"scrollBehavior"in document.documentElement.style?window.scrollTo(n):window.scrollTo(n.left!=null?n.left:window.pageXOffset,n.top!=null?n.top:window.pageYOffset)}function getScrollKey(e,n){return(history.state?history.state.position-n:-1)+e}const scrollPositions=new Map;function saveScrollPosition(e,n){scrollPositions.set(e,n)}function getSavedScrollPosition(e){const n=scrollPositions.get(e);return scrollPositions.delete(e),n}let createBaseLocation=()=>location.protocol+"//"+location.host;function createCurrentLocation(e,n){const{pathname:S,search:l,hash:r}=n,R=e.indexOf("#");if(R>-1){let O=r.includes(e.slice(R))?e.slice(R).length:1,N=r.slice(O);return N[0]!=="/"&&(N="/"+N),stripBase(N,"")}return stripBase(S,e)+l+r}function useHistoryListeners(e,n,S,l){let r=[],R=[],T=null;const O=({state:C})=>{const w=createCurrentLocation(e,location),v=S.value,k=n.value;let F=0;if(C){if(S.value=w,n.value=C,T&&T===v){T=null;return}F=k?C.position-k.position:0}else l(w);r.forEach(D=>{D(S.value,v,{delta:F,type:NavigationType.pop,direction:F?F>0?NavigationDirection.forward:NavigationDirection.back:NavigationDirection.unknown})})};function N(){T=S.value}function U(C){r.push(C);const w=()=>{const v=r.indexOf(C);v>-1&&r.splice(v,1)};return R.push(w),w}function I(){const{history:C}=window;!C.state||C.replaceState(assign({},C.state,{scroll:computeScrollPosition()}),"")}function M(){for(const C of R)C();R=[],window.removeEventListener("popstate",O),window.removeEventListener("beforeunload",I)}return window.addEventListener("popstate",O),window.addEventListener("beforeunload",I),{pauseListeners:N,listen:U,destroy:M}}function buildState(e,n,S,l=!1,r=!1){return{back:e,current:n,forward:S,replaced:l,position:window.history.length,scroll:r?computeScrollPosition():null}}function useHistoryStateNavigation(e){const{history:n,location:S}=window,l={value:createCurrentLocation(e,S)},r={value:n.state};r.value||R(l.value,{back:null,current:l.value,forward:null,position:n.length-1,replaced:!0,scroll:null},!0);function R(N,U,I){const M=e.indexOf("#"),C=M>-1?(S.host&&document.querySelector("base")?e:e.slice(M))+N:createBaseLocation()+e+N;try{n[I?"replaceState":"pushState"](U,"",C),r.value=U}catch(w){console.error(w),S[I?"replace":"assign"](C)}}function T(N,U){const I=assign({},n.state,buildState(r.value.back,N,r.value.forward,!0),U,{position:r.value.position});R(N,I,!0),l.value=N}function O(N,U){const I=assign({},r.value,n.state,{forward:N,scroll:computeScrollPosition()});R(I.current,I,!0);const M=assign({},buildState(l.value,N,null),{position:I.position+1},U);R(N,M,!1),l.value=N}return{location:l,state:r,push:O,replace:T}}function createWebHistory(e){e=normalizeBase(e);const n=useHistoryStateNavigation(e),S=useHistoryListeners(e,n.state,n.location,n.replace);function l(R,T=!0){T||S.pauseListeners(),history.go(R)}const r=assign({location:"",base:e,go:l,createHref:createHref.bind(null,e)},n,S);return Object.defineProperty(r,"location",{enumerable:!0,get:()=>n.location.value}),Object.defineProperty(r,"state",{enumerable:!0,get:()=>n.state.value}),r}function isRouteLocation(e){return typeof e=="string"||e&&typeof e=="object"}function isRouteName(e){return typeof e=="string"||typeof e=="symbol"}const START_LOCATION_NORMALIZED={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},NavigationFailureSymbol=PolySymbol("nf");var NavigationFailureType;(function(e){e[e.aborted=4]="aborted",e[e.cancelled=8]="cancelled",e[e.duplicated=16]="duplicated"})(NavigationFailureType||(NavigationFailureType={}));function createRouterError(e,n){return assign(new Error,{type:e,[NavigationFailureSymbol]:!0},n)}function isNavigationFailure(e,n){return e instanceof Error&&NavigationFailureSymbol in e&&(n==null||!!(e.type&n))}const BASE_PARAM_PATTERN="[^/]+?",BASE_PATH_PARSER_OPTIONS={sensitive:!1,strict:!1,start:!0,end:!0},REGEX_CHARS_RE=/[.+*?^${}()[\]/\\]/g;function tokensToParser(e,n){const S=assign({},BASE_PATH_PARSER_OPTIONS,n),l=[];let r=S.start?"^":"";const R=[];for(const U of e){const I=U.length?[]:[90];S.strict&&!U.length&&(r+="/");for(let M=0;M<U.length;M++){const C=U[M];let w=40+(S.sensitive?.25:0);if(C.type===0)M||(r+="/"),r+=C.value.replace(REGEX_CHARS_RE,"\\$&"),w+=40;else if(C.type===1){const{value:v,repeatable:k,optional:F,regexp:D}=C;R.push({name:v,repeatable:k,optional:F});const E=D||BASE_PARAM_PATTERN;if(E!==BASE_PARAM_PATTERN){w+=10;try{new RegExp(`(${E})`)}catch(y){throw new Error(`Invalid custom RegExp for param "${v}" (${E}): `+y.message)}}let u=k?`((?:${E})(?:/(?:${E}))*)`:`(${E})`;M||(u=F&&U.length<2?`(?:/${u})`:"/"+u),F&&(u+="?"),r+=u,w+=20,F&&(w+=-8),k&&(w+=-20),E===".*"&&(w+=-50)}I.push(w)}l.push(I)}if(S.strict&&S.end){const U=l.length-1;l[U][l[U].length-1]+=.7000000000000001}S.strict||(r+="/?"),S.end?r+="$":S.strict&&(r+="(?:/|$)");const T=new RegExp(r,S.sensitive?"":"i");function O(U){const I=U.match(T),M={};if(!I)return null;for(let C=1;C<I.length;C++){const w=I[C]||"",v=R[C-1];M[v.name]=w&&v.repeatable?w.split("/"):w}return M}function N(U){let I="",M=!1;for(const C of e){(!M||!I.endsWith("/"))&&(I+="/"),M=!1;for(const w of C)if(w.type===0)I+=w.value;else if(w.type===1){const{value:v,repeatable:k,optional:F}=w,D=v in U?U[v]:"";if(Array.isArray(D)&&!k)throw new Error(`Provided param "${v}" is an array but it is not repeatable (* or + modifiers)`);const E=Array.isArray(D)?D.join("/"):D;if(!E)if(F)C.length<2&&e.length>1&&(I.endsWith("/")?I=I.slice(0,-1):M=!0);else throw new Error(`Missing required param "${v}"`);I+=E}}return I}return{re:T,score:l,keys:R,parse:O,stringify:N}}function compareScoreArray(e,n){let S=0;for(;S<e.length&&S<n.length;){const l=n[S]-e[S];if(l)return l;S++}return e.length<n.length?e.length===1&&e[0]===40+40?-1:1:e.length>n.length?n.length===1&&n[0]===40+40?1:-1:0}function comparePathParserScore(e,n){let S=0;const l=e.score,r=n.score;for(;S<l.length&&S<r.length;){const R=compareScoreArray(l[S],r[S]);if(R)return R;S++}return r.length-l.length}const ROOT_TOKEN={type:0,value:""},VALID_PARAM_RE=/[a-zA-Z0-9_]/;function tokenizePath(e){if(!e)return[[]];if(e==="/")return[[ROOT_TOKEN]];if(!e.startsWith("/"))throw new Error(`Invalid path "${e}"`);function n(w){throw new Error(`ERR (${S})/"${U}": ${w}`)}let S=0,l=S;const r=[];let R;function T(){R&&r.push(R),R=[]}let O=0,N,U="",I="";function M(){!U||(S===0?R.push({type:0,value:U}):S===1||S===2||S===3?(R.length>1&&(N==="*"||N==="+")&&n(`A repeatable param (${U}) must be alone in its segment. eg: '/:ids+.`),R.push({type:1,value:U,regexp:I,repeatable:N==="*"||N==="+",optional:N==="*"||N==="?"})):n("Invalid state to consume buffer"),U="")}function C(){U+=N}for(;O<e.length;){if(N=e[O++],N==="\\"&&S!==2){l=S,S=4;continue}switch(S){case 0:N==="/"?(U&&M(),T()):N===":"?(M(),S=1):C();break;case 4:C(),S=l;break;case 1:N==="("?S=2:VALID_PARAM_RE.test(N)?C():(M(),S=0,N!=="*"&&N!=="?"&&N!=="+"&&O--);break;case 2:N===")"?I[I.length-1]=="\\"?I=I.slice(0,-1)+N:S=3:I+=N;break;case 3:M(),S=0,N!=="*"&&N!=="?"&&N!=="+"&&O--,I="";break;default:n("Unknown state");break}}return S===2&&n(`Unfinished custom RegExp for param "${U}"`),M(),T(),r}function createRouteRecordMatcher(e,n,S){const l=tokensToParser(tokenizePath(e.path),S),r=assign(l,{record:e,parent:n,children:[],alias:[]});return n&&!r.record.aliasOf==!n.record.aliasOf&&n.children.push(r),r}function createRouterMatcher(e,n){const S=[],l=new Map;n=mergeOptions({strict:!1,end:!0,sensitive:!1},n);function r(I){return l.get(I)}function R(I,M,C){const w=!C,v=normalizeRouteRecord(I);v.aliasOf=C&&C.record;const k=mergeOptions(n,I),F=[v];if("alias"in I){const u=typeof I.alias=="string"?[I.alias]:I.alias;for(const y of u)F.push(assign({},v,{components:C?C.record.components:v.components,path:y,aliasOf:C?C.record:v}))}let D,E;for(const u of F){const{path:y}=u;if(M&&y[0]!=="/"){const o=M.record.path,P=o[o.length-1]==="/"?"":"/";u.path=M.record.path+(y&&P+y)}if(D=createRouteRecordMatcher(u,M,k),C?C.alias.push(D):(E=E||D,E!==D&&E.alias.push(D),w&&I.name&&!isAliasRecord(D)&&T(I.name)),"children"in v){const o=v.children;for(let P=0;P<o.length;P++)R(o[P],D,C&&C.children[P])}C=C||D,N(D)}return E?()=>{T(E)}:noop}function T(I){if(isRouteName(I)){const M=l.get(I);M&&(l.delete(I),S.splice(S.indexOf(M),1),M.children.forEach(T),M.alias.forEach(T))}else{const M=S.indexOf(I);M>-1&&(S.splice(M,1),I.record.name&&l.delete(I.record.name),I.children.forEach(T),I.alias.forEach(T))}}function O(){return S}function N(I){let M=0;for(;M<S.length&&comparePathParserScore(I,S[M])>=0&&(I.record.path!==S[M].record.path||!isRecordChildOf(I,S[M]));)M++;S.splice(M,0,I),I.record.name&&!isAliasRecord(I)&&l.set(I.record.name,I)}function U(I,M){let C,w={},v,k;if("name"in I&&I.name){if(C=l.get(I.name),!C)throw createRouterError(1,{location:I});k=C.record.name,w=assign(paramsFromLocation(M.params,C.keys.filter(E=>!E.optional).map(E=>E.name)),I.params),v=C.stringify(w)}else if("path"in I)v=I.path,C=S.find(E=>E.re.test(v)),C&&(w=C.parse(v),k=C.record.name);else{if(C=M.name?l.get(M.name):S.find(E=>E.re.test(M.path)),!C)throw createRouterError(1,{location:I,currentLocation:M});k=C.record.name,w=assign({},M.params,I.params),v=C.stringify(w)}const F=[];let D=C;for(;D;)F.unshift(D.record),D=D.parent;return{name:k,path:v,params:w,matched:F,meta:mergeMetaFields(F)}}return e.forEach(I=>R(I)),{addRoute:R,resolve:U,removeRoute:T,getRoutes:O,getRecordMatcher:r}}function paramsFromLocation(e,n){const S={};for(const l of n)l in e&&(S[l]=e[l]);return S}function normalizeRouteRecord(e){return{path:e.path,redirect:e.redirect,name:e.name,meta:e.meta||{},aliasOf:void 0,beforeEnter:e.beforeEnter,props:normalizeRecordProps(e),children:e.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in e?e.components||{}:{default:e.component}}}function normalizeRecordProps(e){const n={},S=e.props||!1;if("component"in e)n.default=S;else for(const l in e.components)n[l]=typeof S=="boolean"?S:S[l];return n}function isAliasRecord(e){for(;e;){if(e.record.aliasOf)return!0;e=e.parent}return!1}function mergeMetaFields(e){return e.reduce((n,S)=>assign(n,S.meta),{})}function mergeOptions(e,n){const S={};for(const l in e)S[l]=l in n?n[l]:e[l];return S}function isRecordChildOf(e,n){return n.children.some(S=>S===e||isRecordChildOf(e,S))}const HASH_RE=/#/g,AMPERSAND_RE=/&/g,SLASH_RE=/\//g,EQUAL_RE=/=/g,IM_RE=/\?/g,PLUS_RE=/\+/g,ENC_BRACKET_OPEN_RE=/%5B/g,ENC_BRACKET_CLOSE_RE=/%5D/g,ENC_CARET_RE=/%5E/g,ENC_BACKTICK_RE=/%60/g,ENC_CURLY_OPEN_RE=/%7B/g,ENC_PIPE_RE=/%7C/g,ENC_CURLY_CLOSE_RE=/%7D/g,ENC_SPACE_RE=/%20/g;function commonEncode(e){return encodeURI(""+e).replace(ENC_PIPE_RE,"|").replace(ENC_BRACKET_OPEN_RE,"[").replace(ENC_BRACKET_CLOSE_RE,"]")}function encodeHash(e){return commonEncode(e).replace(ENC_CURLY_OPEN_RE,"{").replace(ENC_CURLY_CLOSE_RE,"}").replace(ENC_CARET_RE,"^")}function encodeQueryValue(e){return commonEncode(e).replace(PLUS_RE,"%2B").replace(ENC_SPACE_RE,"+").replace(HASH_RE,"%23").replace(AMPERSAND_RE,"%26").replace(ENC_BACKTICK_RE,"`").replace(ENC_CURLY_OPEN_RE,"{").replace(ENC_CURLY_CLOSE_RE,"}").replace(ENC_CARET_RE,"^")}function encodeQueryKey(e){return encodeQueryValue(e).replace(EQUAL_RE,"%3D")}function encodePath(e){return commonEncode(e).replace(HASH_RE,"%23").replace(IM_RE,"%3F")}function encodeParam(e){return e==null?"":encodePath(e).replace(SLASH_RE,"%2F")}function decode(e){try{return decodeURIComponent(""+e)}catch{}return""+e}function parseQuery(e){const n={};if(e===""||e==="?")return n;const l=(e[0]==="?"?e.slice(1):e).split("&");for(let r=0;r<l.length;++r){const R=l[r].replace(PLUS_RE," "),T=R.indexOf("="),O=decode(T<0?R:R.slice(0,T)),N=T<0?null:decode(R.slice(T+1));if(O in n){let U=n[O];Array.isArray(U)||(U=n[O]=[U]),U.push(N)}else n[O]=N}return n}function stringifyQuery(e){let n="";for(let S in e){const l=e[S];if(S=encodeQueryKey(S),l==null){l!==void 0&&(n+=(n.length?"&":"")+S);continue}(Array.isArray(l)?l.map(R=>R&&encodeQueryValue(R)):[l&&encodeQueryValue(l)]).forEach(R=>{R!==void 0&&(n+=(n.length?"&":"")+S,R!=null&&(n+="="+R))})}return n}function normalizeQuery(e){const n={};for(const S in e){const l=e[S];l!==void 0&&(n[S]=Array.isArray(l)?l.map(r=>r==null?null:""+r):l==null?l:""+l)}return n}function useCallbacks(){let e=[];function n(l){return e.push(l),()=>{const r=e.indexOf(l);r>-1&&e.splice(r,1)}}function S(){e=[]}return{add:n,list:()=>e,reset:S}}function guardToPromiseFn(e,n,S,l,r){const R=l&&(l.enterCallbacks[r]=l.enterCallbacks[r]||[]);return()=>new Promise((T,O)=>{const N=M=>{M===!1?O(createRouterError(4,{from:S,to:n})):M instanceof Error?O(M):isRouteLocation(M)?O(createRouterError(2,{from:n,to:M})):(R&&l.enterCallbacks[r]===R&&typeof M=="function"&&R.push(M),T())},U=e.call(l&&l.instances[r],n,S,N);let I=Promise.resolve(U);e.length<3&&(I=I.then(N)),I.catch(M=>O(M))})}function extractComponentsGuards(e,n,S,l){const r=[];for(const R of e)for(const T in R.components){let O=R.components[T];if(!(n!=="beforeRouteEnter"&&!R.instances[T]))if(isRouteComponent(O)){const U=(O.__vccOpts||O)[n];U&&r.push(guardToPromiseFn(U,S,l,R,T))}else{let N=O();r.push(()=>N.then(U=>{if(!U)return Promise.reject(new Error(`Couldn't resolve component "${T}" at "${R.path}"`));const I=isESModule(U)?U.default:U;R.components[T]=I;const C=(I.__vccOpts||I)[n];return C&&guardToPromiseFn(C,S,l,R,T)()}))}}return r}function isRouteComponent(e){return typeof e=="object"||"displayName"in e||"props"in e||"__vccOpts"in e}function useLink(e){const n=inject(routerKey),S=inject(routeLocationKey),l=computed(()=>n.resolve(unref(e.to))),r=computed(()=>{const{matched:N}=l.value,{length:U}=N,I=N[U-1],M=S.matched;if(!I||!M.length)return-1;const C=M.findIndex(isSameRouteRecord.bind(null,I));if(C>-1)return C;const w=getOriginalPath(N[U-2]);return U>1&&getOriginalPath(I)===w&&M[M.length-1].path!==w?M.findIndex(isSameRouteRecord.bind(null,N[U-2])):C}),R=computed(()=>r.value>-1&&includesParams(S.params,l.value.params)),T=computed(()=>r.value>-1&&r.value===S.matched.length-1&&isSameRouteLocationParams(S.params,l.value.params));function O(N={}){return guardEvent(N)?n[unref(e.replace)?"replace":"push"](unref(e.to)).catch(noop):Promise.resolve()}return{route:l,href:computed(()=>l.value.href),isActive:R,isExactActive:T,navigate:O}}const RouterLinkImpl=defineComponent({name:"RouterLink",props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink,setup(e,{slots:n}){const S=reactive(useLink(e)),{options:l}=inject(routerKey),r=computed(()=>({[getLinkClass(e.activeClass,l.linkActiveClass,"router-link-active")]:S.isActive,[getLinkClass(e.exactActiveClass,l.linkExactActiveClass,"router-link-exact-active")]:S.isExactActive}));return()=>{const R=n.default&&n.default(S);return e.custom?R:h("a",{"aria-current":S.isExactActive?e.ariaCurrentValue:null,href:S.href,onClick:S.navigate,class:r.value},R)}}}),RouterLink=RouterLinkImpl;function guardEvent(e){if(!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)&&!e.defaultPrevented&&!(e.button!==void 0&&e.button!==0)){if(e.currentTarget&&e.currentTarget.getAttribute){const n=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(n))return}return e.preventDefault&&e.preventDefault(),!0}}function includesParams(e,n){for(const S in n){const l=n[S],r=e[S];if(typeof l=="string"){if(l!==r)return!1}else if(!Array.isArray(r)||r.length!==l.length||l.some((R,T)=>R!==r[T]))return!1}return!0}function getOriginalPath(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}const getLinkClass=(e,n,S)=>e!=null?e:n!=null?n:S,RouterViewImpl=defineComponent({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(e,{attrs:n,slots:S}){const l=inject(routerViewLocationKey),r=computed(()=>e.route||l.value),R=inject(viewDepthKey,0),T=computed(()=>r.value.matched[R]);provide(viewDepthKey,R+1),provide(matchedRouteKey,T),provide(routerViewLocationKey,r);const O=ref();return watch(()=>[O.value,T.value,e.name],([N,U,I],[M,C,w])=>{U&&(U.instances[I]=N,C&&C!==U&&N&&N===M&&(U.leaveGuards.size||(U.leaveGuards=C.leaveGuards),U.updateGuards.size||(U.updateGuards=C.updateGuards))),N&&U&&(!C||!isSameRouteRecord(U,C)||!M)&&(U.enterCallbacks[I]||[]).forEach(v=>v(N))},{flush:"post"}),()=>{const N=r.value,U=T.value,I=U&&U.components[e.name],M=e.name;if(!I)return normalizeSlot(S.default,{Component:I,route:N});const C=U.props[e.name],w=C?C===!0?N.params:typeof C=="function"?C(N):C:null,k=h(I,assign({},w,n,{onVnodeUnmounted:F=>{F.component.isUnmounted&&(U.instances[M]=null)},ref:O}));return normalizeSlot(S.default,{Component:k,route:N})||k}}});function normalizeSlot(e,n){if(!e)return null;const S=e(n);return S.length===1?S[0]:S}const RouterView=RouterViewImpl;function createRouter(e){const n=createRouterMatcher(e.routes,e),S=e.parseQuery||parseQuery,l=e.stringifyQuery||stringifyQuery,r=e.history,R=useCallbacks(),T=useCallbacks(),O=useCallbacks(),N=shallowRef(START_LOCATION_NORMALIZED);let U=START_LOCATION_NORMALIZED;isBrowser&&e.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const I=applyToParams.bind(null,V=>""+V),M=applyToParams.bind(null,encodeParam),C=applyToParams.bind(null,decode);function w(V,J){let X,q;return isRouteName(V)?(X=n.getRecordMatcher(V),q=J):q=V,n.addRoute(q,X)}function v(V){const J=n.getRecordMatcher(V);J&&n.removeRoute(J)}function k(){return n.getRoutes().map(V=>V.record)}function F(V){return!!n.getRecordMatcher(V)}function D(V,J){if(J=assign({},J||N.value),typeof V=="string"){const le=parseURL(S,V,J.path),G=n.resolve({path:le.path},J),Y=r.createHref(le.fullPath);return assign(le,G,{params:C(G.params),hash:decode(le.hash),redirectedFrom:void 0,href:Y})}let X;if("path"in V)X=assign({},V,{path:parseURL(S,V.path,J.path).path});else{const le=assign({},V.params);for(const G in le)le[G]==null&&delete le[G];X=assign({},V,{params:M(V.params)}),J.params=M(J.params)}const q=n.resolve(X,J),ue=V.hash||"";q.params=I(C(q.params));const oe=stringifyURL(l,assign({},V,{hash:encodeHash(ue),path:q.path})),ce=r.createHref(oe);return assign({fullPath:oe,hash:ue,query:l===stringifyQuery?normalizeQuery(V.query):V.query||{}},q,{redirectedFrom:void 0,href:ce})}function E(V){return typeof V=="string"?parseURL(S,V,N.value.path):assign({},V)}function u(V,J){if(U!==V)return createRouterError(8,{from:J,to:V})}function y(V){return A(V)}function o(V){return y(assign(E(V),{replace:!0}))}function P(V){const J=V.matched[V.matched.length-1];if(J&&J.redirect){const{redirect:X}=J;let q=typeof X=="function"?X(V):X;return typeof q=="string"&&(q=q.includes("?")||q.includes("#")?q=E(q):{path:q},q.params={}),assign({query:V.query,hash:V.hash,params:V.params},q)}}function A(V,J){const X=U=D(V),q=N.value,ue=V.state,oe=V.force,ce=V.replace===!0,le=P(X);if(le)return A(assign(E(le),{state:ue,force:oe,replace:ce}),J||X);const G=X;G.redirectedFrom=J;let Y;return!oe&&isSameRouteLocation(l,q,X)&&(Y=createRouterError(16,{to:G,from:q}),H(q,q,!0,!1)),(Y?Promise.resolve(Y):t(G,q)).catch(Z=>isNavigationFailure(Z)?isNavigationFailure(Z,2)?Z:K(Z):B(Z,G,q)).then(Z=>{if(Z){if(isNavigationFailure(Z,2))return A(assign(E(Z.to),{state:ue,force:oe,replace:ce}),J||G)}else Z=x(G,q,!0,ce,ue);return f(G,q,Z),Z})}function g(V,J){const X=u(V,J);return X?Promise.reject(X):Promise.resolve()}function t(V,J){let X;const[q,ue,oe]=extractChangingRecords(V,J);X=extractComponentsGuards(q.reverse(),"beforeRouteLeave",V,J);for(const le of q)le.leaveGuards.forEach(G=>{X.push(guardToPromiseFn(G,V,J))});const ce=g.bind(null,V,J);return X.push(ce),runGuardQueue(X).then(()=>{X=[];for(const le of R.list())X.push(guardToPromiseFn(le,V,J));return X.push(ce),runGuardQueue(X)}).then(()=>{X=extractComponentsGuards(ue,"beforeRouteUpdate",V,J);for(const le of ue)le.updateGuards.forEach(G=>{X.push(guardToPromiseFn(G,V,J))});return X.push(ce),runGuardQueue(X)}).then(()=>{X=[];for(const le of V.matched)if(le.beforeEnter&&!J.matched.includes(le))if(Array.isArray(le.beforeEnter))for(const G of le.beforeEnter)X.push(guardToPromiseFn(G,V,J));else X.push(guardToPromiseFn(le.beforeEnter,V,J));return X.push(ce),runGuardQueue(X)}).then(()=>(V.matched.forEach(le=>le.enterCallbacks={}),X=extractComponentsGuards(oe,"beforeRouteEnter",V,J),X.push(ce),runGuardQueue(X))).then(()=>{X=[];for(const le of T.list())X.push(guardToPromiseFn(le,V,J));return X.push(ce),runGuardQueue(X)}).catch(le=>isNavigationFailure(le,8)?le:Promise.reject(le))}function f(V,J,X){for(const q of O.list())q(V,J,X)}function x(V,J,X,q,ue){const oe=u(V,J);if(oe)return oe;const ce=J===START_LOCATION_NORMALIZED,le=isBrowser?history.state:{};X&&(q||ce?r.replace(V.fullPath,assign({scroll:ce&&le&&le.scroll},ue)):r.push(V.fullPath,ue)),N.value=V,H(V,J,X,ce),K()}let m;function a(){m||(m=r.listen((V,J,X)=>{const q=D(V),ue=P(q);if(ue){A(assign(ue,{replace:!0}),q).catch(noop);return}U=q;const oe=N.value;isBrowser&&saveScrollPosition(getScrollKey(oe.fullPath,X.delta),computeScrollPosition()),t(q,oe).catch(ce=>isNavigationFailure(ce,12)?ce:isNavigationFailure(ce,2)?(A(ce.to,q).then(le=>{isNavigationFailure(le,20)&&!X.delta&&X.type===NavigationType.pop&&r.go(-1,!1)}).catch(noop),Promise.reject()):(X.delta&&r.go(-X.delta,!1),B(ce,q,oe))).then(ce=>{ce=ce||x(q,oe,!1),ce&&(X.delta?r.go(-X.delta,!1):X.type===NavigationType.pop&&isNavigationFailure(ce,20)&&r.go(-1,!1)),f(q,oe,ce)}).catch(noop)}))}let c=useCallbacks(),L=useCallbacks(),_;function B(V,J,X){K(V);const q=L.list();return q.length?q.forEach(ue=>ue(V,J,X)):console.error(V),Promise.reject(V)}function $(){return _&&N.value!==START_LOCATION_NORMALIZED?Promise.resolve():new Promise((V,J)=>{c.add([V,J])})}function K(V){return _||(_=!V,a(),c.list().forEach(([J,X])=>V?X(V):J()),c.reset()),V}function H(V,J,X,q){const{scrollBehavior:ue}=e;if(!isBrowser||!ue)return Promise.resolve();const oe=!X&&getSavedScrollPosition(getScrollKey(V.fullPath,0))||(q||!X)&&history.state&&history.state.scroll||null;return nextTick().then(()=>ue(V,J,oe)).then(ce=>ce&&scrollToPosition(ce)).catch(ce=>B(ce,V,J))}const j=V=>r.go(V);let W;const z=new Set;return{currentRoute:N,addRoute:w,removeRoute:v,hasRoute:F,getRoutes:k,resolve:D,options:e,push:y,replace:o,go:j,back:()=>j(-1),forward:()=>j(1),beforeEach:R.add,beforeResolve:T.add,afterEach:O.add,onError:L.add,isReady:$,install(V){const J=this;V.component("RouterLink",RouterLink),V.component("RouterView",RouterView),V.config.globalProperties.$router=J,Object.defineProperty(V.config.globalProperties,"$route",{enumerable:!0,get:()=>unref(N)}),isBrowser&&!W&&N.value===START_LOCATION_NORMALIZED&&(W=!0,y(r.location).catch(ue=>{}));const X={};for(const ue in START_LOCATION_NORMALIZED)X[ue]=computed(()=>N.value[ue]);V.provide(routerKey,J),V.provide(routeLocationKey,reactive(X)),V.provide(routerViewLocationKey,N);const q=V.unmount;z.add(V),V.unmount=function(){z.delete(V),z.size<1&&(U=START_LOCATION_NORMALIZED,m&&m(),m=null,N.value=START_LOCATION_NORMALIZED,W=!1,_=!1),q()}}}}function runGuardQueue(e){return e.reduce((n,S)=>n.then(()=>S()),Promise.resolve())}function extractChangingRecords(e,n){const S=[],l=[],r=[],R=Math.max(n.matched.length,e.matched.length);for(let T=0;T<R;T++){const O=n.matched[T];O&&(e.matched.find(U=>isSameRouteRecord(U,O))?l.push(O):S.push(O));const N=e.matched[T];N&&(n.matched.find(U=>isSameRouteRecord(U,N))||r.push(N))}return[S,l,r]}var muiPlayer_min$1="",commonjsGlobal=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var muiPlayer_min={exports:{}};/*!
* Mui Player Javascript Library v1.6.0 @Professional edition
* Date：2021-12-01
* Released under GPL-3.0 license
* https://muiplayer.js.org/
*/(function(module,exports){function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _iterableToArray(e){if(typeof Symbol!="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _createForOfIteratorHelper(e,n){var S=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!S){if(Array.isArray(e)||(S=_unsupportedIterableToArray(e))||n&&e&&typeof e.length=="number"){S&&(e=S);var l=0,n=function(){};return{s:n,n:function(){return l>=e.length?{done:!0}:{done:!1,value:e[l++]}},e:function(N){throw N},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var r,R=!0,T=!1;return{s:function(){S=S.call(e)},n:function(){var O=S.next();return R=O.done,O},e:function(O){T=!0,r=O},f:function(){try{R||S.return==null||S.return()}finally{if(T)throw r}}}}function _unsupportedIterableToArray(e,n){if(e){if(typeof e=="string")return _arrayLikeToArray(e,n);var S=Object.prototype.toString.call(e).slice(8,-1);return(S=S==="Object"&&e.constructor?e.constructor.name:S)==="Map"||S==="Set"?Array.from(e):S==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(S)?_arrayLikeToArray(e,n):void 0}}function _arrayLikeToArray(e,n){(n==null||n>e.length)&&(n=e.length);for(var S=0,l=new Array(n);S<n;S++)l[S]=e[S];return l}function _typeof(e){return(_typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(e)}(function(e,n){_typeof(exports)=="object"&&_typeof(module)=="object"?module.exports=n():e.MuiPlayer=n()})(window,function(){var MuiPlayer=function MuiPlayer(config){var _this=this;_this._global_={};var webpagePlugin="",mobilePlugin="",hls=null,flv=null,option=config||{},plugins=option.plugins||[];this._event_={};var con=typeof option.container=="string"?document.querySelector(option.container):option.container,$CONSTANT,$habit,$node,$global,element,$el,variable,$data,$method;con&&($CONSTANT={unitLengthReg:/^(auto|inherit|initial|\d+(\.\d+)?(\%|px|cm|mm|em|rem|vw|vh|)?)$/i,encodeKey:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"},$habit={themeColor:"#1e98d4"},$node={video:'<!-- HTML5 Video --><div class="video-wrapper"><video width="100%" height="100%"></video></div>',mplayerPoster:'<div class="mplayer-poster" id="mplayer-poster"></div>',mplayerCover:'<!-- \u5A92\u4F53\u64AD\u653E\u906E\u7F69\u5C42 --><div class="mplayer-cover" id="mplayer-cover"></div>',mplayerLoading:'<!-- Mplayer\u52A0\u8F7DLoading --><div class="mplayer-loading"id="mplayer-loading"control><svg viewBox="25 25 50 50"class="mplayer-loading__circular"><circle cx="50"cy="50"r="20"fill="none"></circle></svg></div>',mplayerError:'<!-- \u89C6\u9891\u52A0\u8F7D\u9519\u8BEF\u663E\u793A --><div class="mplayer-error"id="mplayer-error"control><div class="errop-tip">\u89C6\u9891\u52A0\u8F7D\u5931\u8D25\uFF0C\u70B9\u51FB\u5237\u65B0</div><svg t="1575125481608"class="icon"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"p-id="5893"width="28"height="28"><path d="M513.34 831.74C337.03 831.74 193.6 688.31 193.6 512c0-71.09 23.31-138.85 65.53-194.03v51.61c0 17.67 14.33 32 32 32s32-14.33 32-32V239.45c0-5.87-1.59-11.36-4.34-16.09-0.06-0.1-0.11-0.2-0.17-0.3-0.16-0.28-0.34-0.55-0.51-0.82-0.13-0.2-0.26-0.41-0.39-0.61-0.08-0.13-0.17-0.25-0.26-0.37a35.5 35.5 0 0 0-1.58-2.13c-6.81-8.35-16.96-12.35-26.95-11.69h-130c-17.67 0-32 14.33-32 32s14.33 32 32 32h55.35C159.8 339 129.6 423.35 129.6 512c0 51.79 10.15 102.05 30.17 149.38 19.33 45.7 46.99 86.74 82.23 121.97 35.23 35.23 76.27 62.9 121.97 82.23 47.33 20.02 97.59 30.17 149.38 30.17 17.67 0 32-14.33 32-32s-14.34-32.01-32.01-32.01zM855.38 762.3h-51.23c19.81-23 36.93-48.3 50.75-75.22 27.6-53.74 42.18-114.28 42.18-175.08 0-51.79-10.15-102.05-30.17-149.38-19.33-45.7-46.99-86.73-82.23-121.97-35.23-35.23-76.27-62.9-121.97-82.23-47.33-20.02-97.59-30.17-149.38-30.17-17.67 0-32 14.33-32 32s14.33 32 32 32c176.31 0 319.74 143.44 319.74 319.74 0 78.31-27.68 151.61-77.6 209.05l0.24-56.04c0.08-17.67-14.19-32.06-31.86-32.14h-0.14c-17.61 0-31.92 14.24-32 31.86l-0.55 129.43a31.988 31.988 0 0 0 9.32 22.71 31.68 31.68 0 0 0 5.33 4.3c0.02 0.01 0.04 0.02 0.06 0.04 0.48 0.31 0.97 0.61 1.47 0.89l0.15 0.09c0.5 0.28 1 0.54 1.51 0.8 0.03 0.01 0.05 0.03 0.08 0.04 1.64 0.8 3.34 1.46 5.1 1.98 0.01 0 0.02 0.01 0.03 0.01 0.55 0.16 1.1 0.3 1.66 0.43 0.07 0.02 0.15 0.03 0.22 0.05 0.5 0.11 1 0.21 1.5 0.3 0.1 0.02 0.2 0.04 0.3 0.05 0.48 0.08 0.96 0.15 1.44 0.21 0.11 0.01 0.23 0.03 0.34 0.04 0.48 0.05 0.95 0.09 1.43 0.12l0.34 0.03c0.53 0.03 1.07 0.04 1.61 0.05h132.31c17.67 0 32-14.33 32-32s-14.31-31.99-31.98-31.99z"p-id="5894"fill="#ffffff"></path></svg></div>',mplayerHeader:'<!-- Mplayer \u9876\u90E8\u5BFC\u822A --><div class="mplayer-header"id="mplayer-header"><div class="title-groupt"id="title-groupt"><button class="player-btn header-control back-button keyboard-input"id="back-button"control><svg id="back-icon-svg"t="1573891955387"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"p-id="4550"width="18"height="18"><path d="M305.519192 557.640404c-11.636364 0-23.40202-4.39596-32.323232-13.317172-17.842424-17.842424-17.842424-46.674747 0-64.517171L683.830303 69.30101c17.842424-17.842424 46.674747-17.842424 64.517172 0 17.842424 17.842424 17.842424 46.674747 0 64.517172L337.713131 544.323232c-8.921212 8.921212-20.557576 13.317172-32.193939 13.317172z m0 0"fill="#ffffff"p-id="4551"></path><path d="M715.894949 968.145455c-11.636364 0-23.40202-4.39596-32.323232-13.317172L273.19596 544.323232c-17.842424-17.842424-17.842424-46.674747 0-64.517171 17.842424-17.842424 46.674747-17.842424 64.517171 0l410.505051 410.50505c17.842424 17.842424 17.842424 46.674747 0 64.517172-8.921212 8.921212-20.557576 13.317172-32.323233 13.317172z m0 0"fill="#ffffff"p-id="4552"></path></svg><div class="title-name"id="title-name"></div></button></div><div class="buttom-group"id="buttom-group"></div></div>',mplayerFooter:'<!-- Mplayer \u5E95\u90E8\u64CD\u4F5C\u63A7\u4EF6 --><div class="mplayer-footer"id="mplayer-footer"><div class="progress"id="progress"><div class="left-part"id="left-part"><button class="player-btn keyboard-input play-switch footer-control"id="play-switch"control><!--play button--><div class="_play"><svg t="1574051894346"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"p-id="1212"><path d="M324.085 95.787l500.422 300.664c82.373 50.453 79.284 136.946-1.030 186.37v0l-506.6 304.784c-41.187 23.683-87.522 37.068-131.798 9.267-36.037-22.653-46.335-58.691-46.335-97.819v-616.774c0-39.127 13.386-75.166 48.395-97.819 45.305-27.801 94.731-14.416 136.946 11.327v0z"p-id="1213"fill="#ffffff"></path></svg></div><!--pause button--><div class="_pause"style="display: none;"><svg t="1574051952939"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"p-id="1434"><path d="M248.26311111 515.072c0-110.592-0.22755555-221.184 0.11377778-331.776 0.11377778-35.84 18.20444445-60.87111111 49.26577778-70.99733333 27.53422222-8.87466667 56.88888889 0.34133333 75.32088888 23.77955555 10.58133333 13.42577778 15.13244445 28.89955555 15.01866667 45.96622223-0.11377778 223.11822222 0.11377778 446.23644445-0.22755555 669.35466666-0.11377778 42.55288889-31.06133333 73.27288889-70.54222222 72.81777778-39.25333333-0.45511111-68.72177778-31.51644445-68.94933334-74.52444444-0.34133333-111.50222222 0-223.11822222 0-334.62044445zM638.52088889 516.66488889V193.64977778c0-52.45155555 27.42044445-85.21955555 70.54222222-84.65066667 42.43911111 0.56888889 69.17688889 32.42666667 69.17688889 83.05777778 0.11377778 218.22577778 0.11377778 436.56533333 0 654.79111111 0 38.34311111-17.29422222 63.60177778-49.152 73.95555555-27.648 8.98844445-56.54755555 0-75.43466667-23.552-12.17422222-15.13244445-15.36-32.768-15.24622222-51.76888888 0.22755555-109.568 0.11377778-219.136 0.11377778-328.81777778z"p-id="1435"fill="#ffffff"></path></svg></div></button><!--\u76F4\u64AD\u6A21\u5F0F--><button class="player-btn live-mode footer-control"id="live-mode"control><div class="spot"></div><div class="mode-text">\u76F4\u64AD</div></button></div><!--\u5E95\u90E8\u8FDB\u5EA6\u5BB9\u5668--><div class="progress-container"id="progress-container"><!--\u5B89\u5168\u8FDB\u5EA6\u65F6\u957F--><div class="progress-begin"id="progress-begin">\u5F00\u59CB</div><!--\u62D6\u52A8\u6709\u6548\u7684\u4F5C\u7528\u57DF--><div class="touch-effective"id="touch-effective"><!--\u52A0\u8F7D\u8FDB\u5EA6\u6761\u603B\u957F--><div class="progress-total"id="progress-total"></div><!--\u8D44\u6E90\u7F13\u5B58\u8FDB\u5EA6--><div class="progress-buffered"id="progress-buffered"></div><!--\u64AD\u653E\u8FDB\u5EA6--><div class="progress-play"id="progress-play"></div><!--\u62D6\u52A8\u8FDB\u5EA6\u7403--><div class="ball-container"><div class="progress-drag"id="progress-ball"><div class="progress-ball"></div></div></div></div><!--\u603B\u65F6\u957F--><div class="progress-long"id="progress-long">\u7ED3\u675F</div></div><div class="right-part"id="right-part"><!--\u5168\u5C4F\u5F00\u5173--><button class="player-btn keyboard-input full-switch footer-control"id="full-switch"tooltip="\u5168\u5C4F"control><div class="_full"><svg t="1607611836872"class="icon"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"p-id="2384"><path d="M842 797.08l-226.07999999-226.08a30 30 0 0 0-42.42000001 42.42000001L799.58 839.5 692 839.5a30 30 0 0 0 0 60L872 899.5a29.91 29.91 0 0 0 30-29.99999999l0-180a30 30 0 0 0-60 0l0 107.57999999zM130.79 128.29A29.91 29.91 0 0 1 152 119.5l180 0a30 30 0 0 1 0 60l-107.58 0 226.08 226.08a30 30 0 0 1-42.42000001 42.42L182 221.92 182 329.50000001a30 30 0 0 1-60 0L122 149.50000001a29.91 29.91 0 0 1 8.79-21.21000001z"fill="#ffffff"p-id="2385"></path></svg></div><div class="_unfull"style="display: none;"><svg t="1607611848290"class="icon"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"p-id="2546"><path d="M416.00000001 370.752L174.848 129.59999999a32 32 0 0 0-45.24800001 45.24800001L370.752 416.00000001 256 416a32 32 0 0 0 0 64l192 0a31.904 31.904 0 0 0 32-32L480 256a32 32 0 0 0-64 0l1e-8 114.752z m137.37599999 182.624A31.904 31.904 0 0 1 576 544L768 544a32 32 0 0 1 0 64l-114.752-1e-8 241.15200001 241.15200001a32 32 0 1 1-45.24800001 45.24800001L607.99999999 653.248 608 768a32 32 0 0 1-64 0l0-192a31.904 31.904 0 0 1 9.376-22.624z"fill="#ffffff"p-id="2547"></path></svg></div></button></div></div></div>',miniProgress:'<!-- Mplayer \u5E95\u90E8\u64AD\u653E\u8FF7\u4F60\u8FDB\u5EA6\u6761 --><div class="mini-progress"id="mini-progress"><!--\u52A0\u8F7D\u8FDB\u5EA6\u6761\u603B\u957F--><div class="mini-total"id="mini-total"></div><!--\u8D44\u6E90\u7F13\u5B58\u8FDB\u5EA6--><div class="mini-buffered"id="mini-buffered"></div><!--\u64AD\u653E\u8FDB\u5EA6--><div class="mini-play"id="mini-play"></div></div>'},$global=function(){return{first_authplay:!1,isReady:!1,webpagePlugin:{},mobilePlugin:{},cssAutoprefixer:["webkit","ms","moz","o"]}},element=function(){return{mPlayer:con,videoObject:con.querySelector("video"),mplayerCover:con.querySelector("#mplayer-cover"),mplayerPoster:con.querySelector("#mplayer-poster"),mplayerHeader:con.querySelector("#mplayer-header"),headerMenu:con.querySelector("#buttom-group"),backButton:con.querySelector("#back-button"),mplayerFooter:con.querySelector("#mplayer-footer"),progressContainer:con.querySelector("#progress-container"),playSwitch:con.querySelector("#play-switch"),fullSwitch:con.querySelector("#full-switch"),progressBall:con.querySelector("#progress-ball"),progressBegin:con.querySelector("#progress-begin"),progressLong:con.querySelector("#progress-long"),touchEffective:con.querySelector("#touch-effective"),progressBuffered:con.querySelector("#progress-buffered"),progressPlay:con.querySelector("#progress-play"),miniProgress:con.querySelector("#mini-progress"),miniBuffered:con.querySelector("#mini-buffered"),miniPlay:con.querySelector("#mini-play"),mplayerLoading:con.querySelector("#mplayer-loading"),mplayerError:con.querySelector("#mplayer-error")}},$el=new element,variable=function(){return{mediaPlayDirectives:0,isFullScreen:!1,showScreenControls:!1,ball_move_status:!1,isPlay:!1,mediaStatus:!1,duration:0,percentage:0,currentTime:0,playError:0,isDestory:!1,startX:null,startY:null,moveX:null,moveY:null,_defaultPlayProgressPro:null,isTouchMove:!1}},$data=new variable,$method={getLanguageText:function(){return{"zh-cn":{srcNull:"\u89C6\u9891\u5730\u5740\u4E3A\u7A7A",begin:"\u5F00\u59CB",end:"\u7ED3\u675F",live:"\u76F4\u64AD",settings:"\u8BBE\u7F6E",coveredPlay:"\u94FA\u6EE1\u64AD\u653E",loopPlay:"\u5FAA\u73AF\u64AD\u653E",playbackSpeed:"\u64AD\u653E\u901F\u5EA6",share:"\u5206\u4EAB",pictureInPicture:"\u753B\u4E2D\u753B",exitPictureInPicture:"\u9000\u51FA\u753B\u4E2D\u753B",pageScreen:"\u7F51\u9875\u5168\u5C4F",exitPageScreen:"\u9000\u51FA\u7F51\u9875\u5168\u5C4F",fullScreen:"\u5168\u5C4F",exitFullScreen:"\u9000\u51FA\u5168\u5C4F",normal:"\u6B63\u5E38",open:"\u6253\u5F00",subtitles:"\u5B57\u5E55",selectLangage:"\u9009\u62E9\u8BED\u8A00",dsps:"\u5207\u6362\u5230\u9ED8\u8BA4\u500D\u901F\u5EA6\u64AD\u653E",tsps:"\u5207\u6362\u5230?\u500D\u901F\u5EA6\u64AD\u653E",errorTip:"\u89C6\u9891\u52A0\u8F7D\u5931\u8D25\uFF0C\u70B9\u51FB\u5237\u65B0",shortcuts:"\u5FEB\u6377\u952E",shortcutsPanel:{title:"\u5FEB\u6377\u529F\u80FD",space:"\u7A7A\u683C",spaceAction:"\u64AD\u653E/\u6682\u505C",esc:"\u9000\u51FA\u5168\u5C4F",up:"\u97F3\u91CF\u589E\u52A05%",down:"\u97F3\u91CF\u51CF\u5C115%",right:"\u5FEB\u8FDB5\u79D2",left:"\u5FEB\u90005\u79D2"}},en:{srcNull:"Video address is empty",begin:"Begin",end:"End",live:"Live",settings:"Settings",coveredPlay:"Covered play",loopPlay:"Loop play",playbackSpeed:"Playback speed",share:"Share",pictureInPicture:"Picture in picture",exitPictureInPicture:"Exit picture in picture",pageScreen:"Page screen",exitPageScreen:"Exit page screen",fullScreen:"Full screen",exitFullScreen:"Exit full screen",normal:"Normal",open:"Open",subtitles:"Subtitles",selectLangage:"Select langage",dsps:"to default speed playback",tsps:"to ?x speed playback",errorTip:"Video failed to load, click refresh",shortcuts:"Shortcuts",shortcutsPanel:{title:"Shortcuts function",space:"Space",spaceAction:"play/pause",esc:"exit full screen",up:"voice increase 5%",down:"voice reduce 5%",right:"fast forward 5 seconds",left:"fast backward 5 seconds"}},"zh-tw":{srcNull:"\u8996\u983B\u5730\u5740\u70BA\u7A7A",begin:"\u958B\u59CB",end:"\u7D50\u675F",live:"\u76F4\u64AD",settings:"\u8A2D\u7F6E",coveredPlay:"\u92EA\u6EFF\u64AD\u653E",loopPlay:"\u5FAA\u74B0\u64AD\u653E",playbackSpeed:"\u64AD\u653E\u901F\u5EA6",share:"\u5206\u4EAB",pictureInPicture:"\u756B\u4E2D\u756B",exitPictureInPicture:"\u9000\u51FA\u756B\u4E2D\u756B",pageScreen:"\u7DB2\u9801\u5168\u5C4F",exitPageScreen:"\u9000\u51FA\u7DB2\u9801\u5168\u5C4F",fullScreen:"\u5168\u5C4F",exitFullScreen:"\u9000\u51FA\u5168\u5C4F",normal:"\u6B63\u5E38",open:"\u6253\u958B",subtitles:"\u5B57\u5E55",selectLangage:"\u9078\u64C7\u8A9E\u8A00",dsps:"\u5207\u63DB\u5230\u9ED8\u8A8D\u500D\u901F\u5EA6\u64AD\u653E",tsps:"\u5207\u63DB\u5230?\u500D\u901F\u5EA6\u64AD\u653E",errorTip:"\u8996\u983B\u52A0\u8F09\u5931\u6557\uFF0C\u9EDE\u64CA\u5237\u65B0",shortcuts:"\u5FEB\u6377\u9375",shortcutsPanel:{title:"\u5FEB\u6377\u529F\u80FD",space:"\u7A7A\u683C",spaceAction:"\u64AD\u653E/\u66AB\u505C",esc:"\u9000\u51FA\u5168\u5C4F",up:"\u97F3\u91CF\u589E\u52A05%",down:"\u97F3\u91CF\u51CF\u5C115%",right:"\u5FEB\u90325\u79D2",left:"\u5FEB\u90005\u79D2"}}}},getLangObject:function(){var e=option.lang||navigator.language||navigator.browserLanguage||"zh-cn";return["zh-cn","en","zh-tw"].indexOf(e.toLowerCase())!=-1?$method.getLanguageText()[e.toLowerCase()]:$method.getLanguageText()["zh-cn"]},initCreateMplayer:function(e){for(var n=$node.video+$node.mplayerPoster+$node.mplayerCover+$node.mplayerLoading+$node.mplayerError+$node.mplayerHeader+$node.mplayerFooter+$node.miniProgress,n=$node.logWrite?n+$node.logWrite:n,S=0;S<plugins.length;S++)$method.returnSys()!="androd"&&$method.returnSys()!="ios"||plugins[S]instanceof Object&&plugins[S].name=="MuiPlayerMobilePlugin"&&(mobilePlugin=plugins[S]),$method.returnSys()=="window"&&plugins[S]instanceof Object&&plugins[S].name=="MuiPlayerDesktopPlugin"&&(webpagePlugin=plugins[S]);n=n.toString().replace(/<!--.*?-->/g,""),n=$method.createRangeIsDocFragment(n),n=$method.initConifgAttribute(n,e),n=$method.initConfigControl(n),n=$method.initConfigCustom(n),n=$method.initConfigTheme(n),e={option,_this,$el:element,$data,$method,$habit,$CONSTANT},mobilePlugin&&(n=mobilePlugin.appendTemplate(n,e)),webpagePlugin&&(n=webpagePlugin.appendTemplate(n,e)),e=con.querySelector("#mplayer-media-wrapper"),e&&$method.removeNode(con,"#mplayer-media-wrapper"),(e=document.createElement("div")).setAttribute("id","mplayer-media-wrapper"),e.setAttribute("class","player-wrapper"),e.appendChild(n),$el.mPlayer.appendChild(e),option.src?($method.playerReady(),setTimeout(function(){_this._global_.isReady=!0,_this.emit("ready"),setTimeout(function(){$method.onScreenResize({type:"showControls"})},10)},100)):$method.showToast($method.getLangObject().srcNull)},onAction:function(){},playerReady:function(){$method.resetVariable(),option.autoplay===!0&&($data.mediaPlayDirectives=1,$method.onPlay()),$method.toggleEventListenerGlobal("add","playerReady"),$method.toggleEventListenerCustom("add"),$method.nodesObserver()},overloadingEl:function(){$el=new element;for(var e=0,n=Object.keys($el);e<n.length;e++){var S=n[e];S!="mPlayer"&&($el[S]||($el[S]={style:{},classList:{add:function(){},contains:function(){},remove:function(){}},addEventListener:function(){},removeEventListener:function(){}}),$el[S].querySelector=function(l){return l=this.querySelectorAll?this.querySelectorAll(l):[],l[0]||{exist:!1,style:{},height:"",width:""}})}},resetVariable:function(){for(var e=new variable,n=0;n<Object.keys(e).length;n++){var S=Object.keys(e)[n];$data[S]=e[S]}$method.overloadingEl(),_this._global_=new $global},plusRuntimeHandle:function(e){(e=e||{}).type=="resume"&&(_this._global_._beferPlayState&&$el.videoObject.play(),$data.isFullScreen&&plus.navigator.hideSystemNavigation()),e.type=="pause"&&(_this._global_._beferPlayState=$data.isPlay,$el.videoObject.pause())},runtimeCompatibleHandle:function(e){(e=e||{}).type=="webkitbeginfullscreen"&&$method.createTimerCloseControl({type:"cancel"}),e.type=="webkitendfullscreen"&&$method.createTimerCloseControl()},assginConfig:function(){option.themeColor&&($habit.themeColor=option.themeColor)},parseCamel:function(e){return e.replace(/\B([A-Z])/g,"-$1").toLowerCase()},createRangeIsDocFragment:function(e){var n=document.createRange();return n.selectNode($el.mPlayer),n.createContextualFragment(e)},consoleLog:function(e,n){},removeNode:function(e,n){e instanceof Element||e instanceof DocumentFragment?(e=e.querySelector(n))instanceof Element?e.parentNode.removeChild(e):console.warn("the body element not query the selector node......"):(n=document.querySelector(n))?n.parentNode.removeChild(n):console.warn("from document not query the selector node......")},getKeyCode:function(e){return e.keyCode||e.which||""},focusToggle:function(e){$el.mPlayer.classList[e=="ON"?"add":"remove"]("mp-keyboard-focus")},setElementStyle:function(e,n){var S=Object.keys(n);if(0<S.length){var l,r=_createForOfIteratorHelper(S);try{for(r.s();!(l=r.n()).done;){var R=l.value;e.style[$method.parseCamel(R)]=n[R]}}catch(T){r.e(T)}finally{r.f()}e.setAttribute("stylesheet",JSON.stringify(n))}},initConfigTheme:function(e){return $method.assginConfig(),e.querySelector("#progress-play")&&(e.querySelector("#progress-play").style.background=$habit.themeColor),e.querySelector("#mplayer-loading")&&(e.querySelector("#mplayer-loading").style.color=$habit.themeColor),e.querySelector("#mini-play")&&(e.querySelector("#mini-play").style.background=$habit.themeColor),e.querySelector("#live-mode")&&(e.querySelector("#live-mode .spot").style.background=$habit.themeColor),e},initConfigCustom:function(e){for(var n=option.custom||{},S=n.headControls||[],l=0;l<S.length&&!(5<=l);l++)S[l]instanceof Object&&S[l].slot&&(R=S[l].slot,(T=$el.mPlayer.querySelector("[slot="+R+"]"))&&(O=T.tagName=="TEMPLATE"?T.content.cloneNode(!0):$method.createRangeIsDocFragment(T.innerHTML),(N=document.createElement("button")).setAttribute("class","player-btn header-control"),N.setAttribute("slot",R),N.setAttribute("control",""),S[l].click instanceof Function&&N.classList.add("keyboard-input"),S[l].style&&S[l].style instanceof Object&&$method.setElementStyle(N,S[l].style),N.appendChild(O),e.querySelector("#buttom-group").insertBefore(N,e.querySelector("#buttom-group .header-control")),T.style.display="none"));for(var r=n.footerControls||[],l=0;l<r.length&&!(5<=l);l++)r[l]instanceof Object&&r[l].slot&&(R=r[l].slot,(T=$el.mPlayer.querySelector("[slot="+R+"]"))&&(O=T.tagName=="TEMPLATE"?T.content.cloneNode(!0):$method.createRangeIsDocFragment(T.innerHTML),(N=document.createElement("button")).setAttribute("class","player-btn footer-control"),N.setAttribute("slot",R),N.setAttribute("control",""),r[l].tooltip&&N.setAttribute("tooltip",r[l].tooltip),r[l].click instanceof Function&&N.classList.add("keyboard-input"),r[l].style&&r[l].style instanceof Object&&$method.setElementStyle(N,r[l].style),N.appendChild(O),r[l].position=="left"?e.querySelector("#mplayer-footer #left-part").appendChild(N):e.querySelector("#mplayer-footer #right-part").insertBefore(N,e.querySelector("#mplayer-footer #right-part").childNodes[0]),T.style.display="none"));for(var R,T,O,N,U,I=n.rightSidebar||[],l=0;l<I.length&&!(5<=l);l++)I[l]instanceof Object&&I[l].slot&&(R=I[l].slot,(T=$el.mPlayer.querySelector("[slot="+R+"]"))&&(O=T.tagName=="TEMPLATE"?T.content.cloneNode(!0):$method.createRangeIsDocFragment(T.innerHTML),(N=document.createElement("div")).appendChild(O),N.setAttribute("slot",R),N.setAttribute("class","mplayer-sidebar"),U=I[l].width||"",$CONSTANT.unitLengthReg.test(U)&&(N.style.width=isNaN(Number(U))?U:U+"px"),e.appendChild(N),T.style.display="none"));return e},initConfigControl:function(e){option.showMiniProgress!==!1&&option.live!==!0||$method.removeNode(e,"#mini-progress"),option.live===!0?(e.querySelector("#live-mode .mode-text").innerText=$method.getLangObject().live,$method.removeNode(e,"#progress-container")):$method.removeNode(e,"#live-mode"),option.pageHead===!1&&(e.querySelector("#mplayer-header").style.opacity=0);var n=option.subtitle||{},S=n.tracks,l=n.styles;if(Object.prototype.toString.call(S)==="[object Array]"&&0<S.length){for(var r=document.createDocumentFragment(),R=0;R<S.length;R++){var T,O=S[R];_typeof(O)=="object"&&/.\.vtt$/.test(O.src)&&((T=document.createElement("track")).setAttribute("src",O.src),T.setAttribute("kind",O.kind||"subtitles"),T.setAttribute("label",O.label||"\u5B57\u5E55"+(R+1)),O.srclang&&T.setAttribute("srclang",O.srclang),O.default===!0&&T.setAttribute("default",!0),r.appendChild(T))}e.querySelector("video").appendChild(r)}if(Object.prototype.toString.call(l)=="[object Object]"&&0<Object.keys(l).length){var N=document.createElement("style");N.setAttribute("id","pseudo-classes-cue"),N.setAttribute("type","text/css");for(var U="",I=0,M=Object.keys(l);I<M.length;I++){var C=M[I];U+=$method.parseCamel(C)+":"+l[C]+"!important;"}n=document.createTextNode(".m-player video::cue {"+U+"}"),N.appendChild(n),document.getElementsByTagName("head").item(0).appendChild(N)}return e},initConifgAttribute:function(e,n){var r=$el.mPlayer.getBoundingClientRect(),T=r.width,S=r.height;$el.mPlayer.classList.add("m-player"),$el.mPlayer.setAttribute("tabindex","0");var l,r=option.width||"auto";!$CONSTANT.unitLengthReg.test(r)&&n!==!0||$data.isFullScreen||(l=isNaN(Number(r))?r:r+"px",$el.mPlayer.style.width=n===!0?T+"px":l,n===!0&&setTimeout(function(){$el.mPlayer.style.width=l},800));var R,T=option.height||"225px";!$CONSTANT.unitLengthReg.test(T)&&n!==!0||$data.isFullScreen||(R=isNaN(Number(T))?T:T+"px",$el.mPlayer.style.height=n===!0?S+"px":R,n===!0&&option.autoFit===!1&&setTimeout(function(){$el.mPlayer.style.height=R},800)),0<=option.volume&&option.volume<=1&&(e.querySelector("video").volume=option.volume),option.muted===!0&&(e.querySelector("video").muted=!0);function O(I,M){var C=e.querySelector("video");if(I=="src"){var w=option.parse||{},v=w.type,k=w.loader,F=w.config||{};if(w.customKernel&&w.customKernel instanceof Function)return console.info("custom kernel..."),w.customKernel(C,M),0;if(C.setAttribute(I,M),v=="hls"){if(typeof k!="function")return;k.isSupported()==1?$method.hlsDecodeAction(C,M,{loader:k,config:F}):console.error("browser does not support hls js. to check whether your browser is supporting MediaSource Extensions.")}v=="flv"&&_typeof(k)=="object"&&(k.isSupported()==1?$method.flvDecodeAction(C,M,{loader:k,config:F}):console.error("browser does not support flv js. to check whether your browser is supporting MediaSource Extensions."))}else C.setAttribute(I,M)}option.src&&O("src",option.src),option.autoplay===!0&&O("autoplay","autoplay"),option.autoplay==1||option.preload&&O("preload",option.preload),option.loop&&O("loop","loop");var N=option.videoAttribute||[];if(0<N.length)for(var U=0;U<N.length;U++)O(N[U].attrKey,N[U].attrValue);return option.poster?((n=document.createElement("img")).setAttribute("src",option.poster),n.setAttribute("style","width: 100%;height: 100%;object-fit: cover;"),e.querySelector("#mplayer-poster").appendChild(n)):$method.removeNode(e,"#mplayer-poster"),option.title&&(e.querySelector("#title-name").innerHTML=option.title),option.initFullFixed===!0&&$el.mPlayer.classList.add("page-fullscreen"),option.dragSpotShape=="square"&&(e.querySelector("#progress-ball .progress-ball").style.borderRadius="3px",e.querySelector("#progress-ball .progress-ball").style.width="9px",e.querySelector("#progress-ball .progress-ball").style.height="14px"),option.objectFit=="cover"&&e.querySelector("video").classList.add("covered"),e.querySelector("#mplayer-footer #full-switch").setAttribute("tooltip",$method.getLangObject().fullScreen),e.querySelector("#mplayer-error .errop-tip").innerText=$method.getLangObject().errorTip,e.querySelector("#progress-begin").innerText=$method.getLangObject().begin,e.querySelector("#progress-long").innerText=$method.getLangObject().end,e},hlsDecodeAction:function(e,n,S){console.info("hls create...");var l=Object.assign({autoStartLoad:option.autoplay===!0||option.preload!="none"},S.config);(hls=new S.loader(l)).attachMedia(e),hls.on(S.loader.Events.MEDIA_ATTACHED,function(){hls.loadSource(n)}),hls.on(S.loader.Events.ERROR,$method.onError)},flvDecodeAction:function(e,n,S){console.info("flv create..."),n=Object.assign({type:"flv",url:n},S.config),(flv=S.loader.createPlayer(n)).attachMediaElement(e),option.autoplay!==!0&&option.preload=="none"||flv.load(),flv.on(S.loader.Events.ERROR,$method.onError)},hasNotchInScreen:function(){return!!window.plus&&plus.navigator.hasNotchInScreen()},applicationFullHandle:function(e){window.plus&&(this._landscape_lock=function(){plus.navigator.setFullscreen(!0),plus.screen.lockOrientation("landscape"),setTimeout(function(){plus.navigator.hideSystemNavigation()},200),setTimeout(function(){var n=plus.navigator.getStatusbarHeight(),n=$method.hasNotchInScreen()?n+10:10;$el.mplayerHeader.style.paddingLeft=n+"px",$el.mplayerHeader.style.paddingRight=n+"px",$el.mplayerFooter.style.paddingLeft=n+"px",$el.mplayerFooter.style.paddingRight=n+"px",$el.progressContainer.style.left=n+"px",$el.progressContainer.style.right=n+"px"},100)},this._portrait_lock=function(){plus.navigator.setFullscreen(!1),plus.screen.lockOrientation("portrait"),setTimeout(function(){$el.mplayerHeader.style.paddingLeft="10px",$el.mplayerHeader.style.paddingRight="10px",$el.mplayerFooter.style.paddingLeft="10px",$el.mplayerFooter.style.paddingRight="10px"},100)})},setTooltipText:function(e,n){e.setAttribute&&e.setAttribute("tooltip",n),$el.mplayerFooter.querySelector(".mp-tooltip").innerText=n},fullToggle:function(e){(e=e||{type:""}).stopPropagation&&e.stopPropagation(),_this._global_.generate_fullscreen_listener||(_this._global_.generate_fullscreen_listener=!0,$el.mPlayer.requestFullscreen?document.addEventListener("fullscreenchange",function(){document.fullscreenElement?$method.fullScreenChangeAction("Y"):$method.fullScreenChangeAction("N")}):$el.mPlayer.webkitRequestFullscreen?document.addEventListener("webkitfullscreenchange",function(){document.webkitFullscreenElement?$method.fullScreenChangeAction("Y"):$method.fullScreenChangeAction("N")}):$el.mPlayer.mozRequestFullScreen?document.addEventListener("mozfullscreenchange",function(){document.mozFullScreenElement?$method.fullScreenChangeAction("Y"):$method.fullScreenChangeAction("N")}):$el.mPlayer.msRequestFullscreen&&document.addEventListener("msfullscreenchange",function(){document.msFullscreenElement?$method.fullScreenChangeAction("Y"):$method.fullScreenChangeAction("N")})),$data.isFullScreen?$method.closeFullScreen():$method.openFullScreen()},fullScreenChangeAction:function(e){e=="Y"?($data.isFullScreen=!0,$el.fullSwitch.querySelector("._full").style.display="none",$el.fullSwitch.querySelector("._unfull").style.display="block",$method.setTooltipText($el.fullSwitch,$method.getLangObject().exitFullScreen)):e=="N"&&($data.isFullScreen=!1,$el.fullSwitch.querySelector("._full").style.display="block",$el.fullSwitch.querySelector("._unfull").style.display="none",$method.setTooltipText($el.fullSwitch,$method.getLangObject().fullScreen),$el.mPlayer.classList.contains("browser-fullscreen")&&$method.closeFullScreen("completed")),window.plus&&($data.isPlay?plus.device.setWakelock(!0):plus.device.setWakelock(!1))},closeFullScreen:function(e){function n(){$data.isFullScreen=!1,$method.createTimerCloseControl(),$el.mPlayer.classList.remove("browser-fullscreen"),e!="completed"&&(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen())}option.autoOrientaion!=0&&window.plus&&$method.returnSys()!="ios"?(new $method.applicationFullHandle()._portrait_lock(),setTimeout(function(){n(),option.pageHead===!1&&($el.mplayerHeader.style.opacity=0)},100)):(n(),option.pageHead===!1&&($el.mplayerHeader.style.opacity=0))},openFullScreen:function(){var e;$method.returnSys()!="ios"?(e=function(){$el.mPlayer.requestFullscreen?$el.mPlayer.requestFullscreen():$el.mPlayer.webkitRequestFullscreen?$el.mPlayer.webkitRequestFullscreen():$el.mPlayer.mozRequestFullScreen?$el.mPlayer.mozRequestFullScreen():$el.mPlayer.msRequestFullscreen&&$el.mPlayer.msRequestFullscreen(),$data.isFullScreen=!0,$method.createTimerCloseControl(),$el.mPlayer.classList.add("browser-fullscreen")},option.autoOrientaion!=0&&window.plus?(new $method.applicationFullHandle()._landscape_lock(),setTimeout(function(){e(),option.pageHead===!1&&($el.mplayerHeader.style.opacity=1)},100)):(e(),option.pageHead===!1&&($el.mplayerHeader.style.opacity=1))):$el.videoObject.webkitEnterFullscreen()},onPlayTap:function(e){(e=e||{type:""}).stopPropagation&&e.stopPropagation();var n=$el.playSwitch.querySelector("._play").style.display;if($el.playSwitch.querySelector("._pause").style.display,$data.isPlay||n=="none")$el.videoObject.pause();else if(!$data.isPlay){if(!option.src)return void $method.showToast($method.getLangObject().srcNull);!hls&&!flv||$data.mediaStatus?($data.mediaPlayDirectives=0,$el.videoObject.play()):($data.mediaPlayDirectives=1,hls&&hls.startLoad(),flv&&flv.load()),_this._global_.mp_timeout_4||(_this._global_.mp_timeout_4=setTimeout(function(){_this._global_.mp_timeout_4=null,$data.isPlay||$method.showLoading()},500))}$method.createTimerCloseControl(e)},onContrainerTap:function(e){var n;(e=e||{}).stopPropagation&&e.stopPropagation(),$data.isTouchMove||(n=function(S){_this._global_.triggerDblclickEvent||(mobilePlugin?new mobilePlugin.interface(e)._onAgentMpTap("dbclick"):webpagePlugin?new webpagePlugin.interface(e)._onAgentMpTap("dbclick"):$method.onPlayTap({type:"dblscreen"}),_this._global_.triggerDblclickEvent=!0,setTimeout(function(){_this._global_.triggerDblclickEvent=!1},310))},_this._global_.clickCount=_this._global_.clickCount||0,_this._global_.clickCount++,_this._global_.clickCount==2?(n(),_this._global_.clickCount=0):(_this._global_.mp_timeout_2&&clearTimeout(_this._global_.mp_timeout_2),_this._global_.mp_timeout_2=setTimeout(function(){_this._global_.clickCount==1&&(_this._global_.triggerDblclickEvent||(mobilePlugin?new mobilePlugin.interface(e)._onAgentMpTap("click"):webpagePlugin?new webpagePlugin.interface(e)._onAgentMpTap("click"):$method.toggleControlsDisplay(e))),_this._global_.clickCount=0},300)),e.type=="dblclick"&&(n(),_this._global_.clickCount=0))},changeVideoSize:function(T){T=T||{};var n,S,l,r,R=$el.videoObject,T=(option.subtitle||{}).tracks;Object.prototype.toString.call(T)==="[object Array]"&&0<T.length&&R.videoHeight&&R.videoWidth&&$method.returnSys()=="window"&&(T=$el.mPlayer.getBoundingClientRect(),n=T.width,S=T.height,l=R.videoHeight/R.videoWidth,r=S/n,!(T=$el.mPlayer.classList).contains("browser-fullscreen")&&!T.contains("page-fullscreen")&&option.autoFit!=0||r.toFixed(2)>l.toFixed(2)?(R.style.width=n.toFixed()+"px",R.style.height=(n*l).toFixed()+"px"):r.toFixed(2)<l.toFixed(2)?(R.style.height=S.toFixed()+"px",R.style.width=(S/l).toFixed()+"px"):(R.style.width=n.toFixed()+"px",R.style.height=S.toFixed()+"px"))},onPause:function(e){$data.isPlay=!1,setTimeout(function(){$method.hideLoading()},500),$el.playSwitch.querySelector("._play").style.display="block",$el.playSwitch.querySelector("._pause").style.display="none",window.plus&&plus.device.setWakelock(!1)},onPlay:function(e){setTimeout(function(){$method.computeLoadingStatus(function(n){n||$data.playError||$method.showLoading()})},500)},onPlaying:function(){$method.computeLoadingStatus(function(e){e&&($method.hideLoading(),$method.hideCover(),option.live||$method.onTimeupdate())}),window.plus&&plus.device.setWakelock(!0),$data.isPlay=!0,1<$data.duration&&$el.videoObject.style.opacity!=1&&setTimeout(function(){$el.videoObject.style.opacity=1},500),$el.playSwitch.querySelector("._play").style.display="none",$el.playSwitch.querySelector("._pause").style.display="block",$el.mplayerError.style.display!="none"&&($el.mplayerError.style.display="none"),option.poster&&$el.mplayerPoster.style.display!="none"&&($el.mplayerPoster.style.display="none"),option.autoFit!=0&&1<$data.duration&&$el.mPlayer.style.height!="auto"&&!$data.isFullScreen&&($el.mPlayer.style.height="auto")},computeLoadingStatus:function(e){var n=0;(function S(){var l=$el.videoObject.duration||0,r=$el.videoObject.currentTime||0;1<l||0<r?e(!0):1e3<=n?e(!1):setTimeout(function(){n+=200,S()},200)})()},onBack:function(e){e.stopPropagation(),$data.isFullScreen?$method.fullToggle():_this.emit("back"),$method.createTimerCloseControl()},onCanplaythrough:function(e){$method.hideCover(),$method.hideLoading()},onDurationChange:function(e){$el.videoObject.duration;var n;1<(n=$el.videoObject.duration)&&($data.mediaStatus=!0,$data.duration=n,_this.emit("duration-change",{duration:n}),$data.mediaPlayDirectives!=1||_this._global_.first_authplay||(_this._global_.first_authplay=!0,$el.videoObject.play(),$method.hideLoading()),n!=1/0&&(n=$method.formatCurrentTime($data.duration),$el.progressLong.innerHTML=n,$el.progressBegin.innerHTML="00:00"),$el.videoObject.style.opacity!=1&&setTimeout(function(){$el.videoObject.style.opacity=1},500),option.autoFit!=0&&$el.mPlayer.style.height!="auto"&&($el.mPlayer.style.height="auto"),$method.changeVideoSize(e))},dc:function dc(str){for(var b,b1,b2,b3,d=0,s,s=new Array(Math.floor(str.length/3)),b=s.length,i=0;i<b;i++)b1=$CONSTANT.encodeKey.indexOf(str.charAt(d)),d++,b2=$CONSTANT.encodeKey.indexOf(str.charAt(d)),d++,b3=$CONSTANT.encodeKey.indexOf(str.charAt(d)),d++,s[i]=36*b1*36+36*b2+b3;return b=eval("String.fromCharCode("+s.join(",")+")"),b},formatCurrentTime:function(e){var n=0<(n=parseInt(e/3600))?n+":":"",S=parseInt(e%3600/60);return S=(S=0<S&&S.toString().length==1?"0"+S+":":S+":")==0?"00:":S,e=parseInt(e%60),e=(e=0<e&&e.toString().length==1?"0"+e:e)==0?"00":e,n.toString()+S.toString()+e.toString()},updateProgressBar:function(e){$data.percentage=e,$el.progressBall.style.left=$data.percentage+"%",$el.progressPlay.style.width=$data.percentage+"%",$method.computePlayTime($data.percentage,$data.duration,function(n){$el.progressBegin.innerHTML=n}),_this.emit("seek-progress",{percentage:e})},progressControlHandle:function(e,n,S,l){$method.computeProgress(e,n,function(r){r=Number.parseFloat($data._defaultPlayProgressPro||0)+r*(S||1),100<=r?r=100:r<=0&&(r=0),$method.updateProgressBar(r),l&&l()})},computeProgress:function(e,n,S){S(e/n.getBoundingClientRect().width*100)},computePlayTime:function(e,n,S){100<=e?e=100:e<=0&&(e=0),$data.currentTime=e/100*n,S($method.formatCurrentTime($data.currentTime))},onTimeupdate:function(e){var n,S;$data.duration<=1||$data.duration==1/0||(n=$el.videoObject.currentTime||0)<.1||(S=n/$data.duration*100,$el.miniPlay.style.width=(S=100<=S?100:S)+"%",$data.ball_move_status||function(){$el.progressBall.style.left=S+"%",$el.progressPlay.style.width=S+"%";var l=$method.formatCurrentTime(n);$el.progressBegin.innerHTML!=l&&($el.progressBegin.innerHTML=l)}(),option.live||(_this._global_.playingState=!1,_this._global_.mp_timeout_5&&clearTimeout(_this._global_.mp_timeout_5),_this._global_.mp_timeout_5=setTimeout(function(){!_this._global_.playingState&&$data.isPlay&&$method.showLoading()},700),$data.isPlay&&(_this._global_.beginTimeDot?(_this._global_.endTimeDot=new Date,_this._global_.endTimeDot.getTime()-_this._global_.beginTimeDot.getTime()<=700&&(_this._global_.playingState=!0,$method.hideLoading(),clearTimeout(_this._global_.mp_timeout_5)),_this._global_.nextTimeUpdateState=!1,_this._global_.mp_timeout_6&&clearTimeout(_this._global_.mp_timeout_6),_this._global_.mp_timeout_6=setTimeout(function(){!_this._global_.nextTimeUpdateState&&$data.isPlay&&$method.showLoading()},700),_this._global_.beginTimeDot=null):(_this._global_.beginTimeDot=new Date,_this._global_.nextTimeUpdateState=!0))),$data.mediaStatus||$method.onDurationChange(e))},progressBarSeeking:function(e){if((e=e||{}).stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),$data.mediaStatus&&$data.duration!=1/0&&$data.duration!="NaN"){var n=function(){$data.ball_move_status=!0,$method.createTimerCloseControl({type:"cancel"}),$data.startX=(e.type=="touchstart"?e.touches[0]:e).clientX,$data._defaultPlayProgressPro=0;var r=$el.touchEffective.getClientRects()[0],r=$data.startX-r.left;$method.progressControlHandle(r,$el.touchEffective),$data._defaultPlayProgressPro=$el.progressPlay.style.width.substr(0,$el.progressPlay.style.width.length-1)||0,e.type=="touchstart"?($el.touchEffective.addEventListener("touchmove",$method.progressBarSeeking),$el.touchEffective.addEventListener("touchend",$method.progressBarSeeking),$el.touchEffective.addEventListener("touchcancel",$method.progressBarSeeking)):(document.addEventListener("mousemove",$method.progressBarSeeking),document.addEventListener("mouseup",$method.progressBarSeeking))},S=function(){$data.moveX=(e.type=="touchmove"?e.touches[0]:e).clientX,$data.isTouchMove||($data.isTouchMove=!0,$el.progressBall.querySelector(".progress-ball").style.boxShadow="0 0 20px 3px "+$habit.themeColor,mobilePlugin&&new mobilePlugin.interface()._onAgentEventAction("touchmove-footerbar")),$data.startX||($data.startX=$data.moveX);var r=$data.moveX-$data.startX;$method.progressControlHandle(r,$el.touchEffective)},l=function(){e.type=="touchend"?($el.touchEffective.removeEventListener("touchmove",$method.progressBarSeeking),$el.touchEffective.removeEventListener("touchend",$method.progressBarSeeking),$el.touchEffective.removeEventListener("touchcancel",$method.progressBarSeeking)):(document.removeEventListener("mousemove",$method.progressBarSeeking),document.removeEventListener("mouseup",$method.progressBarSeeking)),$data.isTouchMove&&($el.progressBall.querySelector(".progress-ball").style.boxShadow="0 1px 10px #cccccc",mobilePlugin&&new mobilePlugin.interface()._onAgentEventAction("touchend-footerbar")),$el.videoObject.currentTime=$data.currentTime,$data.ball_move_status=!1,$method.resetTouchVariable(),$method.createTimerCloseControl()};switch(e.type){case"mousedown":n();break;case"mousemove":S();break;case"mouseup":l();break;case"touchstart":n();break;case"touchmove":S();break;case"touchend":l();break;case"touchcancel":$el.touchEffective.removeEventListener("touchmove",$method.progressBarSeeking),$el.touchEffective.removeEventListener("touchend",$method.progressBarSeeking),$el.touchEffective.removeEventListener("touchcancel",$method.progressBarSeeking),$data.ball_move_status=!1,$method.resetTouchVariable(),$method.createTimerCloseControl(),mobilePlugin&&new mobilePlugin.interface()._onAgentEventAction("touchend-footerbar");break;default:e.type}}},resetTouchVariable:function(){$data.startX=null,$data.startY=null,$data.moveX=null,$data.moveY=null,setTimeout(function(){$data.isTouchMove=!1},50)},createTimerCloseControl:function(e){var n;(e=e||{}).type!="cancel"?(n=function(){_this._global_.mp_timeout_3=setTimeout(function(){$method.toggleControlsDisplay({type:e.type||"timer"})},3500)},_this._global_.mp_timeout_3&&clearTimeout(_this._global_.mp_timeout_3),n()):_this._global_.mp_timeout_3&&clearTimeout(_this._global_.mp_timeout_3)},closeMpSidebar:function(){for(var e=!1,n=$el.mPlayer.querySelectorAll(".mplayer-sidebar"),S=0;S<n.length;S++)n[S].classList.contains("open")&&(n[S].classList.remove("open"),e=!0,_typeof(_this._global_.webpagePlugin)=="object"&&_this._global_.webpagePlugin.eventStatus=="removeEventListener"&&new webpagePlugin.interface()._addEvent());return e},toggleControlsDisplay:function(e){(e=e||{type:""}).stopPropagation&&e.stopPropagation();var n=$method.closeMpSidebar();if(!n&&e.type!="DOMContentLoaded"&&e.type!="resize"&&e.type!="orientationchange"){var S=["webkitTransform","transform","msTransform"],l=function(){$el.mplayerHeader.classList.toggle("show",!0)},r=function(){$el.mplayerHeader.classList.toggle("show",!1);for(var O=$el.mplayerHeader.getBoundingClientRect().height,N=0;N<S.length;N++)$el.mplayerHeader.style[S[N]]="translateY("+-O+"px)"},R=function(){$el.mplayerFooter.classList.toggle("show",!0),$el.miniProgress.style.opacity=0},n=function(){$el.mplayerFooter.classList.toggle("show",!1);for(var O=$el.mplayerFooter.getBoundingClientRect().height,N=$el.progressContainer.classList.contains("upper-position")?Number.parseInt($el.progressContainer.getBoundingClientRect().height/2)+1:0,U=0;U<S.length;U++)$el.mplayerFooter.style[S[U]]="translateY("+(O+N)+"px)";$el.miniProgress.style.opacity=1};return e.type=="showControls"?(R(),l(),$data.showScreenControls=!0,$method.createTimerCloseControl(),void _this.emit("controls-toggle",{show:!0})):e.type=="hideControls"?(n(),r(),$data.showScreenControls=!1,$method.createTimerCloseControl({type:"cancel"}),void _this.emit("controls-toggle",{show:!1})):void((e.type!="timer"&&e.type!="dblscreen"||$data.showScreenControls!=0)&&($data.showScreenControls?(n(),r(),$data.showScreenControls=!1,_this.emit("controls-toggle",{show:!1})):(R(),l(),$data.showScreenControls=!0,$method.createTimerCloseControl(),_this.emit("controls-toggle",{show:!0}),window.plus&&$data.isFullScreen&&plus.navigator.hideSystemNavigation())))}},onWaiting:function(){$data.isPlay=!1,_this._global_.mp_timeout_1||(_this._global_.mp_timeout_1=setTimeout(function(){$data.isPlay||$method.showLoading(),_this._global_.mp_timeout_1=null},500))},onError:function(e){console.error(e);var n=arguments;$data.isDestory&&1<=$data.playError||setTimeout(function(){(($el.videoObject.readyState||0)===0||$el.videoObject.duration<=1)&&($data.playError++,$el.mplayerError.style.display="block",$el.videoObject.style.opacity=0,$method.showCover(),$method.hideLoading(),$method.toggleControlsDisplay({type:"hideControls"}),$method.toggleEventListenerGlobal("remove"),$method.toggleEventListenerCustom("remove"),$el.mplayerError.addEventListener("click",function(S){S.stopPropagation(),$method.reloadUrl()},{once:!0}),_this.emit("error",_toConsumableArray(n)))},3e3)},reloadUrl:function(e){$method.destory(),$method.createTimerCloseControl({type:"cancel"}),e&&(option.src=e),$data.isFullScreen&&setTimeout(function(){$method.openFullScreen(),$method.fullScreenChangeAction("Y")},50),$method.initCreateMplayer(!0)},destory:function(){var e,n,S,l;$el.mPlayer.querySelector("#mplayer-media-wrapper video")&&($data.isDestory=!0,$method.toggleEventListenerGlobal("remove"),$method.toggleEventListenerCustom("remove"),$el.mPlayer.classList.remove("fullscreen-scaling"),hls&&hls.media&&(hls.destroy(),hls=""),flv&&(flv.destroy(),flv=""),n=(e=$el.mPlayer.querySelector("#mplayer-media-wrapper")).querySelector("video"),S=(l=e.getBoundingClientRect()).height,l=l.width,document.pictureInPictureElement==n&&document.exitPictureInPicture(),e.style.height=S+"px",e.style.width=l+"px",n.pause(),n.removeAttribute("src"),e.innerHTML="",_this.emit("destory"))},onProgress:function(){var e=$el.videoObject.buffered;if(0<e.length&&0<$data.duration){if(e.end(0)==$data.duration)return $el.miniBuffered.style.width="100%",$el.progressBuffered.style.width="100%",void($el.progressBuffered.style.borderRadius="5px");for(var n=0;n<e.length;n++){e.start(n);var S=e.end(n);if(S>$data.currentTime){S=S/$data.duration*100,$el.progressBuffered.style.width=S+"%",$el.miniBuffered.style.width=S+"%";break}}}},showLoading:function(){$el.mplayerLoading.style.display!="inline-block"&&($el.mplayerLoading.style.display="inline-block")},hideLoading:function(){$el.mplayerLoading.style.display!="none"&&($el.mplayerLoading.style.display="none")},showCover:function(){$el.mplayerCover.style.opacity<=0&&($el.mplayerCover.style.zIndex=8,$el.mplayerCover.style.opacity=.2)},hideCover:function(){$el.mplayerCover.style.opacity!="0"&&($el.mplayerCover.style.opacity=0,$el.mplayerCover.style.zIndex=-1)},showToast:function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},n={message:"",duration:1500,style:{}};typeof e=="string"&&(n.message=e),_typeof(e)=="object"&&Object.keys(n).forEach(function(R){e[R]&&(n[R]=e[R])});var S,l=0<(typeof n.duration=="number"&&n.duration)?n.duration:1500,r=$el.mPlayer.querySelector("#mplayer-media-wrapper");r.querySelector("#mplayer-toast")&&$method.removeNode(r,"#mplayer-toast"),(S=document.createElement("div")).setAttribute("class","mplayer-toast toast-scaling"),S.setAttribute("id","mplayer-toast"),S.innerHTML=n.message,Object.prototype.toString.call(n.style)=="[object Object]"&&Object.keys(n.style).forEach(function(R){S.style[R]=n.style[R]}),r.appendChild(S),S.addEventListener("click",function(R){R.stopPropagation()}),S.addEventListener("touchstart",function(R){R.stopPropagation()}),_this._global_.handleIconTimer_2&&window.clearTimeout(_this._global_.handleIconTimer_2),_this._global_.handleIconTimer_2=setTimeout(function(){$method.removeNode(r,"#mplayer-toast")},l)},toggleControlsStyle:function(e){for(var n,S=(option.custom||{}).footerControls||[],l=0;l<S.length;l++)S[l].oftenShow!==!0&&(n=S[l].slot,(n=$el.mplayerFooter.querySelector("[slot="+n+"]"))&&(e=="portrait"&&(n.style.display="none"),e=="landscape"&&(n.style.display="block")))},onDocVisibilitychange:function(e){$data.showScreenControls!==!1&&$method.createTimerCloseControl({type:document.visibilityState=="visible"?"":"cancel"})},onScreenResize:function(e){(e=e||{type:""}).stopPropagation&&e.stopPropagation();function n(){$method.toggleControlsDisplay(e),$el.progressContainer.classList.remove("upper-position"),$method.toggleControlsStyle("portrait"),setTimeout(function(){var l={direction:"portrait"};$method.returnSys()=="window"&&(l.fullscreen=$data.isFullScreen),_this.emit("fullscreen-change",l)},10),window.plus&&setTimeout(function(){plus.navigator.showSystemNavigation()},200)}function S(){$method.toggleControlsDisplay(e),$el.progressContainer.classList.add("upper-position"),$method.toggleControlsStyle("landscape"),setTimeout(function(){var l={direction:"landscape"};$method.returnSys()=="window"&&(l.fullscreen=$data.isFullScreen),_this.emit("fullscreen-change",l)},10),window.plus&&$data.isFullScreen&&setTimeout(function(){plus.navigator.hideSystemNavigation()},200)}$method.createTimerCloseControl(),$method.changeVideoSize(e),window.orientation||window.orientation==0?(window.orientation==0||window.orientation==180?n:S)():setTimeout(function(){(500<=$el.mPlayer.getBoundingClientRect().width?S:n)()},0),$data.showScreenControls==0&&$method.toggleControlsDisplay({type:"hideControls"})},returnSys:function(){var e=new function(){var n=navigator.userAgent;return{ios:!!n.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:-1<n.indexOf("Android")||-1<n.indexOf("Linux"),iPhone:-1<n.indexOf("iPhone"),iPad:-1<n.indexOf("iPad")}};return e.iPhone||e.iPad||e.ios?"ios":e.android?"androd":"window"},nodesObserver:function(){var e=new MutationObserver(function(S,l){var r,R=_createForOfIteratorHelper(S);try{for(R.s();!(r=R.n()).done;){var T=r.value;if(T.type==="childList"){var O,N=_createForOfIteratorHelper(T.removedNodes);try{for(N.s();!(O=N.n()).done;){var U=O.value;if(U instanceof HTMLVideoElement){hls&&hls.media&&(hls.destroy(),hls=""),flv&&(flv.destroy(),flv=""),document.pictureInPictureElement==U&&document.exitPictureInPicture(),U.pause(),U.removeAttribute("src"),l.disconnect();break}}}catch(I){N.e(I)}finally{N.f()}}}}catch(I){R.e(I)}finally{R.f()}}),n=$el.mPlayer.querySelector(".video-wrapper");e.observe(n,{childList:!0})},toggleEventListenerCustom:function(e){var n=option.custom||{},S=e=="add"?"addEventListener":"removeEventListener",l=n.headControls||[];if(0<l.length)for(var r=0;r<l.length;r++)!l[r].click instanceof Function||(T=l[r].slot,(O=$el.headerMenu.querySelector("[slot="+T+"]"))instanceof Element&&O[S]("click",l[r].click));var R=n.footerControls||[];if(0<R.length)for(var T,O,r=0;r<R.length;r++)!R[r].click instanceof Function||(T=R[r].slot,(O=$el.mplayerFooter.querySelector("[slot="+T+"]"))instanceof Element&&O[S]("click",R[r].click))},toggleEventListenerGlobal:function(e,n){var S,l=e=="add"?"addEventListener":"removeEventListener";S="onorientationchange"in window?"orientationchange":"resize",window[l](S,$method.onScreenResize),$el.backButton[l]("click",$method.onBack),$el.fullSwitch[l]("click",$method.fullToggle),$el.playSwitch[l]("click",$method.onPlayTap),$el.mPlayer[l]("click",$method.onContrainerTap),$el.mPlayer[l]("dblclick",$method.onContrainerTap),$el.touchEffective instanceof Element&&$el.touchEffective[l]("touchstart",$method.progressBarSeeking),$el.touchEffective instanceof Element&&$el.touchEffective[l]("mousedown",$method.progressBarSeeking),$el.videoObject[l]("webkitbeginfullscreen",$method.runtimeCompatibleHandle),$el.videoObject[l]("webkitendfullscreen",$method.runtimeCompatibleHandle),document[l]("resume",$method.plusRuntimeHandle),document[l]("pause",$method.plusRuntimeHandle),document[l]("visibilitychange",$method.onDocVisibilitychange),n=="playerReady"&&function(){$el.mplayerCover.addEventListener("touchstart",function(T){T.stopPropagation()}),$el.mplayerCover.addEventListener("touchmove",function(T){T.stopPropagation()}),$el.mplayerHeader.addEventListener("touchmove",function(T){T.stopPropagation()}),$el.mplayerHeader.addEventListener("click",function(T){T.stopPropagation()}),$el.mplayerHeader.addEventListener("dblclick",function(T){T.stopPropagation()}),$el.mplayerFooter.addEventListener("touchmove",function(T){T.stopPropagation()}),$el.mplayerFooter.addEventListener("click",function(T){T.stopPropagation()}),$el.mplayerFooter.addEventListener("dblclick",function(T){T.stopPropagation()}),$el.mplayerError.addEventListener("touchstart",function(T){T.stopPropagation()}),$el.mplayerError.addEventListener("touchmove",function(T){T.stopPropagation()}),$el.videoObject.addEventListener("canplaythrough",$method.onCanplaythrough),$el.videoObject.addEventListener("durationchange",$method.onDurationChange),option.live||$el.videoObject.addEventListener("timeupdate",$method.onTimeupdate),$el.videoObject.addEventListener("play",$method.onPlay),$el.videoObject.addEventListener("playing",$method.onPlaying),$el.videoObject.addEventListener("pause",$method.onPause),$el.videoObject.addEventListener("waiting",$method.onWaiting),$el.videoObject.addEventListener("error",$method.onError),option.live||$el.videoObject.addEventListener("progress",$method.onProgress);for(var r=$el.mPlayer.querySelectorAll(".mplayer-sidebar"),R=0;R<r.length;R++)r[R].addEventListener("touchstart",function(T){T.stopPropagation()}),r[R].addEventListener("touchmove",function(T){T.stopPropagation()}),r[R].addEventListener("touchend",function(T){T.stopPropagation()}),r[R].addEventListener("click",function(T){T.stopPropagation()}),r[R].addEventListener("dblclick",function(T){T.stopPropagation()})}()}},this.showRightSidebar=function(e){e=$el.mPlayer.querySelector("#mplayer-media-wrapper [slot="+e+"]"),e&&e.classList.contains("mplayer-sidebar")&&($method.toggleControlsDisplay({type:"sidebarRight"}),$method.createTimerCloseControl({type:"cancel"}),e.classList.add("open"),webpagePlugin&&new webpagePlugin.interface()._removeEvent())},this.toggleControls=function(e){e===!0?$data.showScreenControls==0?$method.toggleControlsDisplay({type:"showControls"}):$method.createTimerCloseControl():e===!1?$data.showScreenControls==1&&$method.toggleControlsDisplay({type:"hideControls"}):$method.toggleControlsDisplay()},this.showToast=function(e){$method.showToast(e)},this.showLoading=function(){$method.showLoading()},this.hideLoading=function(){$method.hideLoading()},this.video=function(){return $el.videoObject},this.reloadUrl=function(e){$method.reloadUrl(e)},this.destory=function(){$method.destory()},this.openFullScreen=function(){$method.openFullScreen()},this.closeFullScreen=function(){$method.closeFullScreen()},this.sendError=function(e){$method.onError(e)},this.getControls=function(){return setTimeout(function(){$method.overloadingEl()},10),$el.mPlayer.querySelectorAll("[control]")},document.readyState=="interactive"||document.readyState=="complete"?$method.initCreateMplayer():document.addEventListener("readystatechange",function(){document.readyState=="interactive"&&$method.initCreateMplayer()}))};return MuiPlayer.prototype.on=function(e,n){this._event_[e]||(this._event_[e]=[]),this._event_[e].push(n)},MuiPlayer.prototype.off=function(e,n){this._event_[e]&&(n?0<=(n=this._event_[e].indexOf(n))&&this._event_[e].splice(n,1):this._event_[e]=void 0)},MuiPlayer.prototype.emit=function(e,n){if(this._event_[e])for(var S=0;S<this._event_[e].length;S++){var l=this._event_[e][S];n instanceof Array?l.apply(this,n):l(n)}},MuiPlayer.prototype.once=function(e,n){var S=this;this.on(e,function l(){n.apply(this,Array.prototype.slice.call(arguments)),setTimeout(function(){S.off(e,l)},200)})},MuiPlayer})})(muiPlayer_min,muiPlayer_min.exports);var MuiPlayer=muiPlayer_min.exports,hls={exports:{}};(function(e,n){typeof window!="undefined"&&function(l,r){e.exports=r()}(commonjsGlobal,function(){return function(S){var l={};function r(R){if(l[R])return l[R].exports;var T=l[R]={i:R,l:!1,exports:{}};return S[R].call(T.exports,T,T.exports,r),T.l=!0,T.exports}return r.m=S,r.c=l,r.d=function(R,T,O){r.o(R,T)||Object.defineProperty(R,T,{enumerable:!0,get:O})},r.r=function(R){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(R,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(R,"__esModule",{value:!0})},r.t=function(R,T){if(T&1&&(R=r(R)),T&8||T&4&&typeof R=="object"&&R&&R.__esModule)return R;var O=Object.create(null);if(r.r(O),Object.defineProperty(O,"default",{enumerable:!0,value:R}),T&2&&typeof R!="string")for(var N in R)r.d(O,N,function(U){return R[U]}.bind(null,N));return O},r.n=function(R){var T=R&&R.__esModule?function(){return R.default}:function(){return R};return r.d(T,"a",T),T},r.o=function(R,T){return Object.prototype.hasOwnProperty.call(R,T)},r.p="/dist/",r(r.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(S,l,r){var R=Object.prototype.hasOwnProperty,T="~";function O(){}Object.create&&(O.prototype=Object.create(null),new O().__proto__||(T=!1));function N(C,w,v){this.fn=C,this.context=w,this.once=v||!1}function U(C,w,v,k,F){if(typeof v!="function")throw new TypeError("The listener must be a function");var D=new N(v,k||C,F),E=T?T+w:w;return C._events[E]?C._events[E].fn?C._events[E]=[C._events[E],D]:C._events[E].push(D):(C._events[E]=D,C._eventsCount++),C}function I(C,w){--C._eventsCount===0?C._events=new O:delete C._events[w]}function M(){this._events=new O,this._eventsCount=0}M.prototype.eventNames=function(){var w=[],v,k;if(this._eventsCount===0)return w;for(k in v=this._events)R.call(v,k)&&w.push(T?k.slice(1):k);return Object.getOwnPropertySymbols?w.concat(Object.getOwnPropertySymbols(v)):w},M.prototype.listeners=function(w){var v=T?T+w:w,k=this._events[v];if(!k)return[];if(k.fn)return[k.fn];for(var F=0,D=k.length,E=new Array(D);F<D;F++)E[F]=k[F].fn;return E},M.prototype.listenerCount=function(w){var v=T?T+w:w,k=this._events[v];return k?k.fn?1:k.length:0},M.prototype.emit=function(w,v,k,F,D,E){var u=T?T+w:w;if(!this._events[u])return!1;var y=this._events[u],o=arguments.length,P,A;if(y.fn){switch(y.once&&this.removeListener(w,y.fn,void 0,!0),o){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,v),!0;case 3:return y.fn.call(y.context,v,k),!0;case 4:return y.fn.call(y.context,v,k,F),!0;case 5:return y.fn.call(y.context,v,k,F,D),!0;case 6:return y.fn.call(y.context,v,k,F,D,E),!0}for(A=1,P=new Array(o-1);A<o;A++)P[A-1]=arguments[A];y.fn.apply(y.context,P)}else{var g=y.length,t;for(A=0;A<g;A++)switch(y[A].once&&this.removeListener(w,y[A].fn,void 0,!0),o){case 1:y[A].fn.call(y[A].context);break;case 2:y[A].fn.call(y[A].context,v);break;case 3:y[A].fn.call(y[A].context,v,k);break;case 4:y[A].fn.call(y[A].context,v,k,F);break;default:if(!P)for(t=1,P=new Array(o-1);t<o;t++)P[t-1]=arguments[t];y[A].fn.apply(y[A].context,P)}}return!0},M.prototype.on=function(w,v,k){return U(this,w,v,k,!1)},M.prototype.once=function(w,v,k){return U(this,w,v,k,!0)},M.prototype.removeListener=function(w,v,k,F){var D=T?T+w:w;if(!this._events[D])return this;if(!v)return I(this,D),this;var E=this._events[D];if(E.fn)E.fn===v&&(!F||E.once)&&(!k||E.context===k)&&I(this,D);else{for(var u=0,y=[],o=E.length;u<o;u++)(E[u].fn!==v||F&&!E[u].once||k&&E[u].context!==k)&&y.push(E[u]);y.length?this._events[D]=y.length===1?y[0]:y:I(this,D)}return this},M.prototype.removeAllListeners=function(w){var v;return w?(v=T?T+w:w,this._events[v]&&I(this,v)):(this._events=new O,this._eventsCount=0),this},M.prototype.off=M.prototype.removeListener,M.prototype.addListener=M.prototype.on,M.prefixed=T,M.EventEmitter=M,S.exports=M},"./node_modules/url-toolkit/src/url-toolkit.js":function(S,l,r){(function(R){var T=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,O=/^([^\/?#]*)([^]*)$/,N=/(?:\/|^)\.(?=\/)/g,U=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,I={buildAbsoluteURL:function(M,C,w){if(w=w||{},M=M.trim(),C=C.trim(),!C){if(!w.alwaysNormalize)return M;var v=I.parseURL(M);if(!v)throw new Error("Error trying to parse base URL.");return v.path=I.normalizePath(v.path),I.buildURLFromParts(v)}var k=I.parseURL(C);if(!k)throw new Error("Error trying to parse relative URL.");if(k.scheme)return w.alwaysNormalize?(k.path=I.normalizePath(k.path),I.buildURLFromParts(k)):C;var F=I.parseURL(M);if(!F)throw new Error("Error trying to parse base URL.");if(!F.netLoc&&F.path&&F.path[0]!=="/"){var D=O.exec(F.path);F.netLoc=D[1],F.path=D[2]}F.netLoc&&!F.path&&(F.path="/");var E={scheme:F.scheme,netLoc:k.netLoc,path:null,params:k.params,query:k.query,fragment:k.fragment};if(!k.netLoc&&(E.netLoc=F.netLoc,k.path[0]!=="/"))if(!k.path)E.path=F.path,k.params||(E.params=F.params,k.query||(E.query=F.query));else{var u=F.path,y=u.substring(0,u.lastIndexOf("/")+1)+k.path;E.path=I.normalizePath(y)}return E.path===null&&(E.path=w.alwaysNormalize?I.normalizePath(k.path):k.path),I.buildURLFromParts(E)},parseURL:function(M){var C=T.exec(M);return C?{scheme:C[1]||"",netLoc:C[2]||"",path:C[3]||"",params:C[4]||"",query:C[5]||"",fragment:C[6]||""}:null},normalizePath:function(M){for(M=M.split("").reverse().join("").replace(N,"");M.length!==(M=M.replace(U,"")).length;);return M.split("").reverse().join("")},buildURLFromParts:function(M){return M.scheme+M.netLoc+M.path+M.params+M.query+M.fragment}};S.exports=I})()},"./node_modules/webworkify-webpack/index.js":function(S,l,r){function R(w){var v={};function k(D){if(v[D])return v[D].exports;var E=v[D]={i:D,l:!1,exports:{}};return w[D].call(E.exports,E,E.exports,k),E.l=!0,E.exports}k.m=w,k.c=v,k.i=function(D){return D},k.d=function(D,E,u){k.o(D,E)||Object.defineProperty(D,E,{configurable:!1,enumerable:!0,get:u})},k.r=function(D){Object.defineProperty(D,"__esModule",{value:!0})},k.n=function(D){var E=D&&D.__esModule?function(){return D.default}:function(){return D};return k.d(E,"a",E),E},k.o=function(D,E){return Object.prototype.hasOwnProperty.call(D,E)},k.p="/",k.oe=function(D){throw console.error(D),D};var F=k(k.s=ENTRY_MODULE);return F.default||F}var T="[\\.|\\-|\\+|\\w|/|@]+",O="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+T+").*?\\)";function N(w){return(w+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function U(w){return!isNaN(1*w)}function I(w,v,k){var F={};F[k]=[];var D=v.toString(),E=D.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!E)return F;for(var u=E[1],y=new RegExp("(\\\\n|\\W)"+N(u)+O,"g"),o;o=y.exec(D);)o[3]!=="dll-reference"&&F[k].push(o[3]);for(y=new RegExp("\\("+N(u)+'\\("(dll-reference\\s('+T+'))"\\)\\)'+O,"g");o=y.exec(D);)w[o[2]]||(F[k].push(o[1]),w[o[2]]=r(o[1]).m),F[o[2]]=F[o[2]]||[],F[o[2]].push(o[4]);for(var P=Object.keys(F),A=0;A<P.length;A++)for(var g=0;g<F[P[A]].length;g++)U(F[P[A]][g])&&(F[P[A]][g]=1*F[P[A]][g]);return F}function M(w){var v=Object.keys(w);return v.reduce(function(k,F){return k||w[F].length>0},!1)}function C(w,v){for(var k={main:[v]},F={main:[]},D={main:{}};M(k);)for(var E=Object.keys(k),u=0;u<E.length;u++){var y=E[u],o=k[y],P=o.pop();if(D[y]=D[y]||{},!(D[y][P]||!w[y][P])){D[y][P]=!0,F[y]=F[y]||[],F[y].push(P);for(var A=I(w,w[y][P],y),g=Object.keys(A),t=0;t<g.length;t++)k[g[t]]=k[g[t]]||[],k[g[t]]=k[g[t]].concat(A[g[t]])}}return F}S.exports=function(w,v){v=v||{};var k={main:r.m},F=v.all?{main:Object.keys(k.main)}:C(k,w),D="";Object.keys(F).filter(function(P){return P!=="main"}).forEach(function(P){for(var A=0;F[P][A];)A++;F[P].push(A),k[P][A]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",D=D+"var "+P+" = ("+R.toString().replace("ENTRY_MODULE",JSON.stringify(A))+")({"+F[P].map(function(g){return""+JSON.stringify(g)+": "+k[P][g].toString()}).join(",")+`});
`}),D=D+"new (("+R.toString().replace("ENTRY_MODULE",JSON.stringify(w))+")({"+F.main.map(function(P){return""+JSON.stringify(P)+": "+k.main[P].toString()}).join(",")+"}))(self);";var E=new window.Blob([D],{type:"text/javascript"});if(v.bare)return E;var u=window.URL||window.webkitURL||window.mozURL||window.msURL,y=u.createObjectURL(E),o=new window.Worker(y);return o.objectURL=y,o}},"./src/config.ts":function(S,l,r){r.r(l),r.d(l,"hlsDefaultConfig",function(){return t}),r.d(l,"mergeConfig",function(){return x}),r.d(l,"enableStreamingMode",function(){return m});var R=r("./src/controller/abr-controller.ts"),T=r("./src/controller/audio-stream-controller.ts"),O=r("./src/controller/audio-track-controller.ts"),N=r("./src/controller/subtitle-stream-controller.ts"),U=r("./src/controller/subtitle-track-controller.ts"),I=r("./src/controller/buffer-controller.ts"),M=r("./src/controller/timeline-controller.ts"),C=r("./src/controller/cap-level-controller.ts"),w=r("./src/controller/fps-controller.ts"),v=r("./src/controller/eme-controller.ts"),k=r("./src/controller/cmcd-controller.ts"),F=r("./src/utils/xhr-loader.ts"),D=r("./src/utils/fetch-loader.ts"),E=r("./src/utils/cues.ts"),u=r("./src/utils/mediakeys-helper.ts"),y=r("./src/utils/logger.ts");function o(){return o=Object.assign||function(a){for(var c=1;c<arguments.length;c++){var L=arguments[c];for(var _ in L)Object.prototype.hasOwnProperty.call(L,_)&&(a[_]=L[_])}return a},o.apply(this,arguments)}function P(a,c){var L=Object.keys(a);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(a);c&&(_=_.filter(function(B){return Object.getOwnPropertyDescriptor(a,B).enumerable})),L.push.apply(L,_)}return L}function A(a){for(var c=1;c<arguments.length;c++){var L=arguments[c]!=null?arguments[c]:{};c%2?P(Object(L),!0).forEach(function(_){g(a,_,L[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(L)):P(Object(L)).forEach(function(_){Object.defineProperty(a,_,Object.getOwnPropertyDescriptor(L,_))})}return a}function g(a,c,L){return c in a?Object.defineProperty(a,c,{value:L,enumerable:!0,configurable:!0,writable:!0}):a[c]=L,a}var t=A(A({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:F.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:R.default,bufferController:I.default,capLevelController:C.default,fpsController:w.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:u.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0},f()),{},{subtitleStreamController:N.SubtitleStreamController,subtitleTrackController:U.default,timelineController:M.TimelineController,audioStreamController:T.default,audioTrackController:O.default,emeController:v.default,cmcdController:k.default});function f(){return{cueHandler:E.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function x(a,c){if((c.liveSyncDurationCount||c.liveMaxLatencyDurationCount)&&(c.liveSyncDuration||c.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(c.liveMaxLatencyDurationCount!==void 0&&(c.liveSyncDurationCount===void 0||c.liveMaxLatencyDurationCount<=c.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(c.liveMaxLatencyDuration!==void 0&&(c.liveSyncDuration===void 0||c.liveMaxLatencyDuration<=c.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return o({},a,c)}function m(a){var c=a.loader;if(c!==D.default&&c!==F.default)y.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),a.progressive=!1;else{var L=Object(D.fetchSupported)();L&&(a.loader=D.default,a.progressive=!0,a.enableSoftwareAES=!0,y.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":function(S,l,r){r.r(l);var R=r("./src/polyfills/number.ts"),T=r("./src/utils/ewma-bandwidth-estimator.ts"),O=r("./src/events.ts"),N=r("./src/utils/buffer-helper.ts"),U=r("./src/errors.ts"),I=r("./src/types/loader.ts"),M=r("./src/utils/logger.ts");function C(k,F){for(var D=0;D<F.length;D++){var E=F[D];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(k,E.key,E)}}function w(k,F,D){return F&&C(k.prototype,F),D&&C(k,D),k}var v=function(){function k(D){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=D;var E=D.config;this.bwEstimator=new T.default(E.abrEwmaSlowVoD,E.abrEwmaFastVoD,E.abrEwmaDefaultEstimate),this.registerListeners()}var F=k.prototype;return F.registerListeners=function(){var E=this.hls;E.on(O.Events.FRAG_LOADING,this.onFragLoading,this),E.on(O.Events.FRAG_LOADED,this.onFragLoaded,this),E.on(O.Events.FRAG_BUFFERED,this.onFragBuffered,this),E.on(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),E.on(O.Events.ERROR,this.onError,this)},F.unregisterListeners=function(){var E=this.hls;E.off(O.Events.FRAG_LOADING,this.onFragLoading,this),E.off(O.Events.FRAG_LOADED,this.onFragLoaded,this),E.off(O.Events.FRAG_BUFFERED,this.onFragBuffered,this),E.off(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),E.off(O.Events.ERROR,this.onError,this)},F.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},F.onFragLoading=function(E,u){var y=u.frag;if(y.type===I.PlaylistLevelType.MAIN&&!this.timer){var o;this.fragCurrent=y,this.partCurrent=(o=u.part)!=null?o:null,this.timer=self.setInterval(this.onCheck,100)}},F.onLevelLoaded=function(E,u){var y=this.hls.config;u.details.live?this.bwEstimator.update(y.abrEwmaSlowLive,y.abrEwmaFastLive):this.bwEstimator.update(y.abrEwmaSlowVoD,y.abrEwmaFastVoD)},F._abandonRulesCheck=function(){var E=this.fragCurrent,u=this.partCurrent,y=this.hls,o=y.autoLevelEnabled,P=y.config,A=y.media;if(!(!E||!A)){var g=u?u.stats:E.stats,t=u?u.duration:E.duration;if(g.aborted){M.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!o||A.paused||!A.playbackRate||!A.readyState)){var f=performance.now()-g.loading.start,x=Math.abs(A.playbackRate);if(!(f<=500*t/x)){var m=y.levels,a=y.minAutoLevel,c=m[E.level],L=g.total||Math.max(g.loaded,Math.round(t*c.maxBitrate/8)),_=Math.max(1,g.bwEstimate?g.bwEstimate/8:g.loaded*1e3/f),B=(L-g.loaded)/_,$=A.currentTime,K=(N.BufferHelper.bufferInfo(A,$,P.maxBufferHole).end-$)/x;if(!(K>=2*t/x||B<=K)){var H=Number.POSITIVE_INFINITY,j;for(j=E.level-1;j>a;j--){var W=m[j].maxBitrate;if(H=t*W/(8*.8*_),H<K)break}if(!(H>=B)){var z=this.bwEstimator.getEstimate();M.logger.warn("Fragment "+E.sn+(u?" part "+u.index:"")+" of level "+E.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+j+`
      Current BW estimate: `+(Object(R.isFiniteNumber)(z)?(z/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+B.toFixed(3)+` s
      Estimated load time for the next fragment: `+H.toFixed(3)+` s
      Time to underbuffer: `+K.toFixed(3)+" s"),y.nextLoadLevel=j,this.bwEstimator.sample(f,g.loaded),this.clearTimer(),E.loader&&(this.fragCurrent=this.partCurrent=null,E.loader.abort()),y.trigger(O.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:E,part:u,stats:g})}}}}}},F.onFragLoaded=function(E,u){var y=u.frag,o=u.part;if(y.type===I.PlaylistLevelType.MAIN&&Object(R.isFiniteNumber)(y.sn)){var P=o?o.stats:y.stats,A=o?o.duration:y.duration;if(this.clearTimer(),this.lastLoadedFragLevel=y.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var g=this.hls.levels[y.level],t=(g.loaded?g.loaded.bytes:0)+P.loaded,f=(g.loaded?g.loaded.duration:0)+A;g.loaded={bytes:t,duration:f},g.realBitrate=Math.round(8*t/f)}if(y.bitrateTest){var x={stats:P,frag:y,part:o,id:y.type};this.onFragBuffered(O.Events.FRAG_BUFFERED,x),y.bitrateTest=!1}}},F.onFragBuffered=function(E,u){var y=u.frag,o=u.part,P=o?o.stats:y.stats;if(!P.aborted&&!(y.type!==I.PlaylistLevelType.MAIN||y.sn==="initSegment")){var A=P.parsing.end-P.loading.start;this.bwEstimator.sample(A,P.loaded),P.bwEstimate=this.bwEstimator.getEstimate(),y.bitrateTest?this.bitrateTestDelay=A/1e3:this.bitrateTestDelay=0}},F.onError=function(E,u){switch(u.details){case U.ErrorDetails.FRAG_LOAD_ERROR:case U.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break}},F.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},F.getNextABRAutoLevel=function(){var E=this.fragCurrent,u=this.partCurrent,y=this.hls,o=y.maxAutoLevel,P=y.config,A=y.minAutoLevel,g=y.media,t=u?u.duration:E?E.duration:0,f=g?g.currentTime:0,x=g&&g.playbackRate!==0?Math.abs(g.playbackRate):1,m=this.bwEstimator?this.bwEstimator.getEstimate():P.abrEwmaDefaultEstimate,a=(N.BufferHelper.bufferInfo(g,f,P.maxBufferHole).end-f)/x,c=this.findBestLevel(m,A,o,a,P.abrBandWidthFactor,P.abrBandWidthUpFactor);if(c>=0)return c;M.logger.trace((a?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var L=t?Math.min(t,P.maxStarvationDelay):P.maxStarvationDelay,_=P.abrBandWidthFactor,B=P.abrBandWidthUpFactor;if(!a){var $=this.bitrateTestDelay;if($){var K=t?Math.min(t,P.maxLoadingDelay):P.maxLoadingDelay;L=K-$,M.logger.trace("bitrate test took "+Math.round(1e3*$)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*L)+" ms"),_=B=1}}return c=this.findBestLevel(m,A,o,a+L,_,B),Math.max(c,0)},F.findBestLevel=function(E,u,y,o,P,A){for(var g,t=this.fragCurrent,f=this.partCurrent,x=this.lastLoadedFragLevel,m=this.hls.levels,a=m[x],c=!!(a!=null&&(g=a.details)!==null&&g!==void 0&&g.live),L=a==null?void 0:a.codecSet,_=f?f.duration:t?t.duration:0,B=y;B>=u;B--){var $=m[B];if(!(!$||L&&$.codecSet!==L)){var K=$.details,H=(f?K==null?void 0:K.partTarget:K==null?void 0:K.averagetargetduration)||_,j=void 0;B<=x?j=P*E:j=A*E;var W=m[B].maxBitrate,z=W*H/j;if(M.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+B+"/"+Math.round(j)+"/"+W+"/"+H+"/"+o+"/"+z),j>W&&(!z||c&&!this.bitrateTestDelay||z<o))return B}}return-1},w(k,[{key:"nextAutoLevel",get:function(){var E=this._nextAutoLevel,u=this.bwEstimator;if(E!==-1&&(!u||!u.canEstimate()))return E;var y=this.getNextABRAutoLevel();return E!==-1&&(y=Math.min(E,y)),y},set:function(E){this._nextAutoLevel=E}}]),k}();l.default=v},"./src/controller/audio-stream-controller.ts":function(S,l,r){r.r(l);var R=r("./src/polyfills/number.ts"),T=r("./src/controller/base-stream-controller.ts"),O=r("./src/events.ts"),N=r("./src/utils/buffer-helper.ts"),U=r("./src/controller/fragment-tracker.ts"),I=r("./src/types/level.ts"),M=r("./src/types/loader.ts"),C=r("./src/loader/fragment.ts"),w=r("./src/demux/chunk-cache.ts"),v=r("./src/demux/transmuxer-interface.ts"),k=r("./src/types/transmuxer.ts"),F=r("./src/controller/fragment-finders.ts"),D=r("./src/utils/discontinuities.ts"),E=r("./src/errors.ts"),u=r("./src/utils/logger.ts");function y(){return y=Object.assign||function(t){for(var f=1;f<arguments.length;f++){var x=arguments[f];for(var m in x)Object.prototype.hasOwnProperty.call(x,m)&&(t[m]=x[m])}return t},y.apply(this,arguments)}function o(t,f){t.prototype=Object.create(f.prototype),t.prototype.constructor=t,P(t,f)}function P(t,f){return P=Object.setPrototypeOf||function(m,a){return m.__proto__=a,m},P(t,f)}var A=100,g=function(t){o(f,t);function f(m,a){var c;return c=t.call(this,m,a,"[audio-stream-controller]")||this,c.videoBuffer=null,c.videoTrackCC=-1,c.waitingVideoCC=-1,c.audioSwitch=!1,c.trackId=-1,c.waitingData=null,c.mainDetails=null,c.bufferFlushed=!1,c._registerListeners(),c}var x=f.prototype;return x.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},x._registerListeners=function(){var a=this.hls;a.on(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(O.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),a.on(O.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.on(O.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.on(O.Events.ERROR,this.onError,this),a.on(O.Events.BUFFER_RESET,this.onBufferReset,this),a.on(O.Events.BUFFER_CREATED,this.onBufferCreated,this),a.on(O.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.on(O.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),a.on(O.Events.FRAG_BUFFERED,this.onFragBuffered,this)},x._unregisterListeners=function(){var a=this.hls;a.off(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(O.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),a.off(O.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.off(O.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.off(O.Events.ERROR,this.onError,this),a.off(O.Events.BUFFER_RESET,this.onBufferReset,this),a.off(O.Events.BUFFER_CREATED,this.onBufferCreated,this),a.off(O.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.off(O.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),a.off(O.Events.FRAG_BUFFERED,this.onFragBuffered,this)},x.onInitPtsFound=function(a,c){var L=c.frag,_=c.id,B=c.initPTS;if(_==="main"){var $=L.cc;this.initPTS[L.cc]=B,this.log("InitPTS for cc: "+$+" found from main: "+B),this.videoTrackCC=$,this.state===T.State.WAITING_INIT_PTS&&this.tick()}},x.startLoad=function(a){if(!this.levels){this.startPosition=a,this.state=T.State.STOPPED;return}var c=this.lastCurrentTime;this.stopLoad(),this.setInterval(A),this.fragLoadError=0,c>0&&a===-1?(this.log("Override startPosition with lastCurrentTime @"+c.toFixed(3)),this.state=T.State.IDLE):(this.loadedmetadata=!1,this.state=T.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=a,this.tick()},x.doTick=function(){switch(this.state){case T.State.IDLE:this.doTickIdle();break;case T.State.WAITING_TRACK:{var a,c=this.levels,L=this.trackId,_=c==null||(a=c[L])===null||a===void 0?void 0:a.details;if(_){if(this.waitForCdnTuneIn(_))break;this.state=T.State.WAITING_INIT_PTS}break}case T.State.FRAG_LOADING_WAITING_RETRY:{var B,$=performance.now(),K=this.retryDate;(!K||$>=K||(B=this.media)!==null&&B!==void 0&&B.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=T.State.IDLE);break}case T.State.WAITING_INIT_PTS:{var H=this.waitingData;if(H){var j=H.frag,W=H.part,z=H.cache,Q=H.complete;if(this.initPTS[j.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=T.State.FRAG_LOADING;var V=z.flush(),J={frag:j,part:W,payload:V,networkDetails:null};this._handleFragmentLoadProgress(J),Q&&t.prototype._handleFragmentLoadComplete.call(this,J)}else if(this.videoTrackCC!==this.waitingVideoCC)u.logger.log("Waiting fragment cc ("+j.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var X=this.getLoadPosition(),q=N.BufferHelper.bufferInfo(this.mediaBuffer,X,this.config.maxBufferHole),ue=Object(F.fragmentWithinToleranceTest)(q.end,this.config.maxFragLookUpTolerance,j);ue<0&&(u.logger.log("Waiting fragment cc ("+j.cc+") @ "+j.start+" cancelled because another fragment at "+q.end+" is needed"),this.clearWaitingFragment())}}else this.state=T.State.IDLE}}this.onTickEnd()},x.clearWaitingFragment=function(){var a=this.waitingData;a&&(this.fragmentTracker.removeFragment(a.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=T.State.IDLE)},x.onTickEnd=function(){var a=this.media;if(!(!a||!a.readyState)){var c=this.mediaBuffer?this.mediaBuffer:a,L=c.buffered;!this.loadedmetadata&&L.length&&(this.loadedmetadata=!0),this.lastCurrentTime=a.currentTime}},x.doTickIdle=function(){var a,c,L=this.hls,_=this.levels,B=this.media,$=this.trackId,K=L.config;if(!(!_||!_[$])&&!(!B&&(this.startFragRequested||!K.startFragPrefetch))){var H=_[$],j=H.details;if(!j||j.live&&this.levelLastLoaded!==$||this.waitForCdnTuneIn(j)){this.state=T.State.WAITING_TRACK;return}this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,C.ElementaryStreamTypes.AUDIO,M.PlaylistLevelType.AUDIO));var W=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,M.PlaylistLevelType.AUDIO);if(W!==null){var z=W.len,Q=this.getMaxBufferLength(),V=this.audioSwitch;if(!(z>=Q&&!V)){if(!V&&this._streamEnded(W,j)){L.trigger(O.Events.BUFFER_EOS,{type:"audio"}),this.state=T.State.ENDED;return}var J=j.fragments,X=J[0].start,q=W.end;if(V){var ue=this.getLoadPosition();q=ue,j.PTSKnown&&ue<X&&(W.end>X||W.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),B.currentTime=X+.05)}var oe=this.getNextFragment(q,j);if(!oe){this.bufferFlushed=!0;return}((a=oe.decryptdata)===null||a===void 0?void 0:a.keyFormat)==="identity"&&!((c=oe.decryptdata)!==null&&c!==void 0&&c.key)?this.loadKey(oe,j):this.loadFragment(oe,j,q)}}}},x.getMaxBufferLength=function(){var a=t.prototype.getMaxBufferLength.call(this),c=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,M.PlaylistLevelType.MAIN);return c===null?a:Math.max(a,c.len)},x.onMediaDetaching=function(){this.videoBuffer=null,t.prototype.onMediaDetaching.call(this)},x.onAudioTracksUpdated=function(a,c){var L=c.audioTracks;this.resetTransmuxer(),this.levels=L.map(function(_){return new I.Level(_)})},x.onAudioTrackSwitching=function(a,c){var L=!!c.url;this.trackId=c.id;var _=this.fragCurrent;_!=null&&_.loader&&_.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),L?this.setInterval(A):this.resetTransmuxer(),L?(this.audioSwitch=!0,this.state=T.State.IDLE):this.state=T.State.STOPPED,this.tick()},x.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},x.onLevelLoaded=function(a,c){this.mainDetails=c.details},x.onAudioTrackLoaded=function(a,c){var L,_=this.levels,B=c.details,$=c.id;if(!_){this.warn("Audio tracks were reset while loading level "+$);return}this.log("Track "+$+" loaded ["+B.startSN+","+B.endSN+"],duration:"+B.totalduration);var K=_[$],H=0;if(B.live||(L=K.details)!==null&&L!==void 0&&L.live){var j=this.mainDetails;if(B.fragments[0]||(B.deltaUpdateFailed=!0),B.deltaUpdateFailed||!j)return;!K.details&&B.hasProgramDateTime&&j.hasProgramDateTime?(Object(D.alignMediaPlaylistByPDT)(B,j),H=B.fragments[0].start):H=this.alignPlaylists(B,K.details)}K.details=B,this.levelLastLoaded=$,!this.startFragRequested&&(this.mainDetails||!B.live)&&this.setStartPosition(K.details,H),this.state===T.State.WAITING_TRACK&&!this.waitForCdnTuneIn(B)&&(this.state=T.State.IDLE),this.tick()},x._handleFragmentLoadProgress=function(a){var c,L=a.frag,_=a.part,B=a.payload,$=this.config,K=this.trackId,H=this.levels;if(!H){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+L.sn+" of level "+L.level+" will not be buffered");return}var j=H[K];console.assert(j,"Audio track is defined on fragment load progress");var W=j.details;console.assert(W,"Audio track details are defined on fragment load progress");var z=$.defaultAudioCodec||j.audioCodec||"mp4a.40.2",Q=this.transmuxer;Q||(Q=this.transmuxer=new v.default(this.hls,M.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var V=this.initPTS[L.cc],J=(c=L.initSegment)===null||c===void 0?void 0:c.data;if(V!==void 0){var X=!1,q=_?_.index:-1,ue=q!==-1,oe=new k.ChunkMetadata(L.level,L.sn,L.stats.chunkCount,B.byteLength,q,ue);Q.push(B,J,z,"",L,_,W.totalduration,X,oe,V)}else{u.logger.log("Unknown video PTS for cc "+L.cc+", waiting for video PTS before demuxing audio frag "+L.sn+" of ["+W.startSN+" ,"+W.endSN+"],track "+K);var ce=this.waitingData=this.waitingData||{frag:L,part:_,cache:new w.default,complete:!1},le=ce.cache;le.push(new Uint8Array(B)),this.waitingVideoCC=this.videoTrackCC,this.state=T.State.WAITING_INIT_PTS}},x._handleFragmentLoadComplete=function(a){if(this.waitingData){this.waitingData.complete=!0;return}t.prototype._handleFragmentLoadComplete.call(this,a)},x.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},x.onBufferCreated=function(a,c){var L=c.tracks.audio;L&&(this.mediaBuffer=L.buffer),c.tracks.video&&(this.videoBuffer=c.tracks.video.buffer)},x.onFragBuffered=function(a,c){var L=c.frag,_=c.part;if(L.type===M.PlaylistLevelType.AUDIO){if(this.fragContextChanged(L)){this.warn("Fragment "+L.sn+(_?" p: "+_.index:"")+" of level "+L.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}L.sn!=="initSegment"&&(this.fragPrevious=L,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(O.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(L,_)}},x.onError=function(a,c){switch(c.details){case E.ErrorDetails.FRAG_LOAD_ERROR:case E.ErrorDetails.FRAG_LOAD_TIMEOUT:case E.ErrorDetails.KEY_LOAD_ERROR:case E.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(M.PlaylistLevelType.AUDIO,c);break;case E.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case E.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==T.State.ERROR&&this.state!==T.State.STOPPED&&(this.state=c.fatal?T.State.ERROR:T.State.IDLE,this.warn(c.details+" while loading frag, switching to "+this.state+" state"));break;case E.ErrorDetails.BUFFER_FULL_ERROR:if(c.parent==="audio"&&(this.state===T.State.PARSING||this.state===T.State.PARSED)){var L=!0,_=this.getFwdBufferInfo(this.mediaBuffer,M.PlaylistLevelType.AUDIO);_&&_.len>.5&&(L=!this.reduceMaxBufferLength(_.len)),L&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,t.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},x.onBufferFlushed=function(a,c){var L=c.type;L===C.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},x._handleTransmuxComplete=function(a){var c,L="audio",_=this.hls,B=a.remuxResult,$=a.chunkMeta,K=this.getCurrentContext($);if(!K){this.warn("The loading context changed while buffering fragment "+$.sn+" of level "+$.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded($.level);return}var H=K.frag,j=K.part,W=B.audio,z=B.text,Q=B.id3,V=B.initSegment;if(!this.fragContextChanged(H)){if(this.state=T.State.PARSING,this.audioSwitch&&W&&this.completeAudioSwitch(),V!=null&&V.tracks&&(this._bufferInitSegment(V.tracks,H,$),_.trigger(O.Events.FRAG_PARSING_INIT_SEGMENT,{frag:H,id:L,tracks:V.tracks})),W){var J=W.startPTS,X=W.endPTS,q=W.startDTS,ue=W.endDTS;j&&(j.elementaryStreams[C.ElementaryStreamTypes.AUDIO]={startPTS:J,endPTS:X,startDTS:q,endDTS:ue}),H.setElementaryStreamInfo(C.ElementaryStreamTypes.AUDIO,J,X,q,ue),this.bufferFragmentData(W,H,j,$)}if(Q!=null&&(c=Q.samples)!==null&&c!==void 0&&c.length){var oe=y({frag:H,id:L},Q);_.trigger(O.Events.FRAG_PARSING_METADATA,oe)}if(z){var ce=y({frag:H,id:L},z);_.trigger(O.Events.FRAG_PARSING_USERDATA,ce)}}},x._bufferInitSegment=function(a,c,L){if(this.state===T.State.PARSING){a.video&&delete a.video;var _=a.audio;if(!!_){_.levelCodec=_.codec,_.id="audio",this.log("Init audio buffer, container:"+_.container+", codecs[parsed]=["+_.codec+"]"),this.hls.trigger(O.Events.BUFFER_CODECS,a);var B=_.initSegment;if(B!=null&&B.byteLength){var $={type:"audio",frag:c,part:null,chunkMeta:L,parent:c.type,data:B};this.hls.trigger(O.Events.BUFFER_APPENDING,$)}this.tick()}}},x.loadFragment=function(a,c,L){var _=this.fragmentTracker.getState(a);this.fragCurrent=a,(this.audioSwitch||_===U.FragmentState.NOT_LOADED||_===U.FragmentState.PARTIAL)&&(a.sn==="initSegment"?this._loadInitSegment(a):c.live&&!Object(R.isFiniteNumber)(this.initPTS[a.cc])?(this.log("Waiting for video PTS in continuity counter "+a.cc+" of live stream before loading audio fragment "+a.sn+" of level "+this.trackId),this.state=T.State.WAITING_INIT_PTS):(this.startFragRequested=!0,t.prototype.loadFragment.call(this,a,c,L)))},x.completeAudioSwitch=function(){var a=this.hls,c=this.media,L=this.trackId;c&&(this.log("Switching audio track : flushing all audio"),t.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,a.trigger(O.Events.AUDIO_TRACK_SWITCHED,{id:L})},f}(T.default);l.default=g},"./src/controller/audio-track-controller.ts":function(S,l,r){r.r(l);var R=r("./src/events.ts"),T=r("./src/errors.ts"),O=r("./src/controller/base-playlist-controller.ts"),N=r("./src/types/loader.ts");function U(v,k){for(var F=0;F<k.length;F++){var D=k[F];D.enumerable=D.enumerable||!1,D.configurable=!0,"value"in D&&(D.writable=!0),Object.defineProperty(v,D.key,D)}}function I(v,k,F){return k&&U(v.prototype,k),F&&U(v,F),v}function M(v,k){v.prototype=Object.create(k.prototype),v.prototype.constructor=v,C(v,k)}function C(v,k){return C=Object.setPrototypeOf||function(D,E){return D.__proto__=E,D},C(v,k)}var w=function(v){M(k,v);function k(D){var E;return E=v.call(this,D,"[audio-track-controller]")||this,E.tracks=[],E.groupId=null,E.tracksInGroup=[],E.trackId=-1,E.trackName="",E.selectDefaultTrack=!0,E.registerListeners(),E}var F=k.prototype;return F.registerListeners=function(){var E=this.hls;E.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),E.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),E.on(R.Events.LEVEL_LOADING,this.onLevelLoading,this),E.on(R.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),E.on(R.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),E.on(R.Events.ERROR,this.onError,this)},F.unregisterListeners=function(){var E=this.hls;E.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),E.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),E.off(R.Events.LEVEL_LOADING,this.onLevelLoading,this),E.off(R.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),E.off(R.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),E.off(R.Events.ERROR,this.onError,this)},F.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,v.prototype.destroy.call(this)},F.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},F.onManifestParsed=function(E,u){this.tracks=u.audioTracks||[]},F.onAudioTrackLoaded=function(E,u){var y=u.id,o=u.details,P=this.tracksInGroup[y];if(!P){this.warn("Invalid audio track id "+y);return}var A=P.details;P.details=u.details,this.log("audioTrack "+y+" loaded ["+o.startSN+"-"+o.endSN+"]"),y===this.trackId&&(this.retryCount=0,this.playlistLoaded(y,u,A))},F.onLevelLoading=function(E,u){this.switchLevel(u.level)},F.onLevelSwitching=function(E,u){this.switchLevel(u.level)},F.switchLevel=function(E){var u=this.hls.levels[E];if(!!(u!=null&&u.audioGroupIds)){var y=u.audioGroupIds[u.urlId];if(this.groupId!==y){this.groupId=y;var o=this.tracks.filter(function(A){return!y||A.groupId===y});this.selectDefaultTrack&&!o.some(function(A){return A.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=o;var P={audioTracks:o};this.log("Updating audio tracks, "+o.length+' track(s) found in "'+y+'" group-id'),this.hls.trigger(R.Events.AUDIO_TRACKS_UPDATED,P),this.selectInitialTrack()}}},F.onError=function(E,u){v.prototype.onError.call(this,E,u),!(u.fatal||!u.context)&&u.context.type===N.PlaylistContextType.AUDIO_TRACK&&u.context.id===this.trackId&&u.context.groupId===this.groupId&&this.retryLoadingOrFail(u)},F.setAudioTrack=function(E){var u=this.tracksInGroup;if(E<0||E>=u.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var y=u[this.trackId];this.log("Now switching to audio-track index "+E);var o=u[E],P=o.id,A=o.groupId,g=A===void 0?"":A,t=o.name,f=o.type,x=o.url;if(this.trackId=E,this.trackName=t,this.selectDefaultTrack=!1,this.hls.trigger(R.Events.AUDIO_TRACK_SWITCHING,{id:P,groupId:g,name:t,type:f,url:x}),!(o.details&&!o.details.live)){var m=this.switchParams(o.url,y==null?void 0:y.details);this.loadPlaylist(m)}},F.selectInitialTrack=function(){var E=this.tracksInGroup;console.assert(E.length,"Initial audio track should be selected when tracks are known");var u=this.trackName,y=this.findTrackId(u)||this.findTrackId();y!==-1?this.setAudioTrack(y):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(R.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},F.findTrackId=function(E){for(var u=this.tracksInGroup,y=0;y<u.length;y++){var o=u[y];if((!this.selectDefaultTrack||o.default)&&(!E||E===o.name))return o.id}return-1},F.loadPlaylist=function(E){var u=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(u)){var y=u.id,o=u.groupId,P=u.url;if(E)try{P=E.addDirectives(P)}catch(A){this.warn("Could not construct new URL with HLS Delivery Directives: "+A)}this.log("loading audio-track playlist for id: "+y),this.clearTimer(),this.hls.trigger(R.Events.AUDIO_TRACK_LOADING,{url:P,id:y,groupId:o,deliveryDirectives:E||null})}},I(k,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(E){this.selectDefaultTrack=!1,this.setAudioTrack(E)}}]),k}(O.default);l.default=w},"./src/controller/base-playlist-controller.ts":function(S,l,r){r.r(l),r.d(l,"default",function(){return I});var R=r("./src/polyfills/number.ts"),T=r("./src/types/level.ts"),O=r("./src/controller/level-helper.ts"),N=r("./src/utils/logger.ts"),U=r("./src/errors.ts"),I=function(){function M(w,v){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=N.logger.log.bind(N.logger,v+":"),this.warn=N.logger.warn.bind(N.logger,v+":"),this.hls=w}var C=M.prototype;return C.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},C.onError=function(v,k){k.fatal&&k.type===U.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},C.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},C.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},C.stopLoad=function(){this.canLoad=!1,this.clearTimer()},C.switchParams=function(v,k){var F=k==null?void 0:k.renditionReports;if(F)for(var D=0;D<F.length;D++){var E=F[D],u=""+E.URI;if(u===v.substr(-u.length)){var y=parseInt(E["LAST-MSN"]),o=parseInt(E["LAST-PART"]);if(k&&this.hls.config.lowLatencyMode){var P=Math.min(k.age-k.partTarget,k.targetduration);o!==void 0&&P>k.partTarget&&(o+=1)}if(Object(R.isFiniteNumber)(y))return new T.HlsUrlParameters(y,Object(R.isFiniteNumber)(o)?o:void 0,T.HlsSkip.No)}}},C.loadPlaylist=function(v){},C.shouldLoadTrack=function(v){return this.canLoad&&v&&!!v.url&&(!v.details||v.details.live)},C.playlistLoaded=function(v,k,F){var D=this,E=k.details,u=k.stats,y=u.loading.end?Math.max(0,self.performance.now()-u.loading.end):0;if(E.advancedDateTime=Date.now()-y,E.live||F!=null&&F.live){if(E.reloaded(F),F&&this.log("live playlist "+v+" "+(E.advanced?"REFRESHED "+E.lastPartSn+"-"+E.lastPartIndex:"MISSED")),F&&E.fragments.length>0&&Object(O.mergeDetails)(F,E),!this.canLoad||!E.live)return;var o,P=void 0,A=void 0;if(E.canBlockReload&&E.endSN&&E.advanced){var g=this.hls.config.lowLatencyMode,t=E.lastPartSn,f=E.endSN,x=E.lastPartIndex,m=x!==-1,a=t===f,c=g?0:x;m?(P=a?f+1:t,A=a?c:x+1):P=f+1;var L=E.age,_=L+E.ageHeader,B=Math.min(_-E.partTarget,E.targetduration*1.5);if(B>0){if(F&&B>F.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+F.tuneInGoal+" to: "+B+" with playlist age: "+E.age),B=0;else{var $=Math.floor(B/E.targetduration);if(P+=$,A!==void 0){var K=Math.round(B%E.targetduration/E.partTarget);A+=K}this.log("CDN Tune-in age: "+E.ageHeader+"s last advanced "+L.toFixed(2)+"s goal: "+B+" skip sn "+$+" to part "+A)}E.tuneInGoal=B}if(o=this.getDeliveryDirectives(E,k.deliveryDirectives,P,A),g||!a){this.loadPlaylist(o);return}}else o=this.getDeliveryDirectives(E,k.deliveryDirectives,P,A);var H=Object(O.computeReloadInterval)(E,u);P!==void 0&&E.canBlockReload&&(H-=E.partTarget||1),this.log("reload live playlist "+v+" in "+Math.round(H)+" ms"),this.timer=self.setTimeout(function(){return D.loadPlaylist(o)},H)}else this.clearTimer()},C.getDeliveryDirectives=function(v,k,F,D){var E=Object(T.getSkipValue)(v,F);return k!=null&&k.skip&&v.deltaUpdateFailed&&(F=k.msn,D=k.part,E=T.HlsSkip.No),new T.HlsUrlParameters(F,D,E)},C.retryLoadingOrFail=function(v){var k=this,F=this.hls.config,D=this.retryCount<F.levelLoadingMaxRetry;if(D){var E;if(this.retryCount++,v.details.indexOf("LoadTimeOut")>-1&&(E=v.context)!==null&&E!==void 0&&E.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+v.details+'"'),this.loadPlaylist();else{var u=Math.min(Math.pow(2,this.retryCount)*F.levelLoadingRetryDelay,F.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return k.loadPlaylist()},u),this.warn("retry playlist loading #"+this.retryCount+" in "+u+' ms after "'+v.details+'"')}}else this.warn('cannot recover from error "'+v.details+'"'),this.clearTimer(),v.fatal=!0;return D},M}()},"./src/controller/base-stream-controller.ts":function(S,l,r){r.r(l),r.d(l,"State",function(){return f}),r.d(l,"default",function(){return x});var R=r("./src/polyfills/number.ts"),T=r("./src/task-loop.ts"),O=r("./src/controller/fragment-tracker.ts"),N=r("./src/utils/buffer-helper.ts"),U=r("./src/utils/logger.ts"),I=r("./src/events.ts"),M=r("./src/errors.ts"),C=r("./src/types/transmuxer.ts"),w=r("./src/utils/mp4-tools.ts"),v=r("./src/utils/discontinuities.ts"),k=r("./src/controller/fragment-finders.ts"),F=r("./src/controller/level-helper.ts"),D=r("./src/loader/fragment-loader.ts"),E=r("./src/crypt/decrypter.ts"),u=r("./src/utils/time-ranges.ts"),y=r("./src/types/loader.ts");function o(m,a){for(var c=0;c<a.length;c++){var L=a[c];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(m,L.key,L)}}function P(m,a,c){return a&&o(m.prototype,a),c&&o(m,c),m}function A(m){if(m===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return m}function g(m,a){m.prototype=Object.create(a.prototype),m.prototype.constructor=m,t(m,a)}function t(m,a){return t=Object.setPrototypeOf||function(L,_){return L.__proto__=_,L},t(m,a)}var f={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},x=function(m){g(a,m);function a(L,_,B){var $;return $=m.call(this)||this,$.hls=void 0,$.fragPrevious=null,$.fragCurrent=null,$.fragmentTracker=void 0,$.transmuxer=null,$._state=f.STOPPED,$.media=void 0,$.mediaBuffer=void 0,$.config=void 0,$.bitrateTest=!1,$.lastCurrentTime=0,$.nextLoadPosition=0,$.startPosition=0,$.loadedmetadata=!1,$.fragLoadError=0,$.retryDate=0,$.levels=null,$.fragmentLoader=void 0,$.levelLastLoaded=null,$.startFragRequested=!1,$.decrypter=void 0,$.initPTS=[],$.onvseeking=null,$.onvended=null,$.logPrefix="",$.log=void 0,$.warn=void 0,$.logPrefix=B,$.log=U.logger.log.bind(U.logger,B+":"),$.warn=U.logger.warn.bind(U.logger,B+":"),$.hls=L,$.fragmentLoader=new D.default(L.config),$.fragmentTracker=_,$.config=L.config,$.decrypter=new E.default(L,L.config),L.on(I.Events.KEY_LOADED,$.onKeyLoaded,A($)),$}var c=a.prototype;return c.doTick=function(){this.onTickEnd()},c.onTickEnd=function(){},c.startLoad=function(_){},c.stopLoad=function(){this.fragmentLoader.abort();var _=this.fragCurrent;_&&this.fragmentTracker.removeFragment(_),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=f.STOPPED},c._streamEnded=function(_,B){var $=this.fragCurrent,K=this.fragmentTracker;if(!B.live&&$&&$.sn>=B.endSN&&!_.nextStart){var H=B.partList;if(H!=null&&H.length){var j=H[H.length-1],W=N.BufferHelper.isBuffered(this.media,j.start+j.duration/2);return W}var z=K.getState($);return z===O.FragmentState.PARTIAL||z===O.FragmentState.OK}return!1},c.onMediaAttached=function(_,B){var $=this.media=this.mediaBuffer=B.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),$.addEventListener("seeking",this.onvseeking),$.addEventListener("ended",this.onvended);var K=this.config;this.levels&&K.autoStartLoad&&this.state===f.STOPPED&&this.startLoad(K.startPosition)},c.onMediaDetaching=function(){var _=this.media;_!=null&&_.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),_&&(_.removeEventListener("seeking",this.onvseeking),_.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},c.onMediaSeeking=function(){var _=this.config,B=this.fragCurrent,$=this.media,K=this.mediaBuffer,H=this.state,j=$?$.currentTime:0,W=N.BufferHelper.bufferInfo(K||$,j,_.maxBufferHole);if(this.log("media seeking to "+(Object(R.isFiniteNumber)(j)?j.toFixed(3):j)+", state: "+H),H===f.ENDED)this.resetLoadingState();else if(B&&!W.len){var z=_.maxFragLookUpTolerance,Q=B.start-z,V=B.start+B.duration+z,J=j>V;(j<Q||J)&&(J&&B.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),B.loader.abort()),this.resetLoadingState())}$&&(this.lastCurrentTime=j),!this.loadedmetadata&&!W.len&&(this.nextLoadPosition=this.startPosition=j),this.tickImmediate()},c.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},c.onKeyLoaded=function(_,B){if(!(this.state!==f.KEY_LOADING||B.frag!==this.fragCurrent||!this.levels)){this.state=f.IDLE;var $=this.levels[B.frag.level].details;$&&this.loadFragment(B.frag,$,B.frag.start)}},c.onHandlerDestroying=function(){this.stopLoad(),m.prototype.onHandlerDestroying.call(this)},c.onHandlerDestroyed=function(){this.state=f.STOPPED,this.hls.off(I.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,m.prototype.onHandlerDestroyed.call(this)},c.loadKey=function(_,B){this.log("Loading key for "+_.sn+" of ["+B.startSN+"-"+B.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+_.level),this.state=f.KEY_LOADING,this.fragCurrent=_,this.hls.trigger(I.Events.KEY_LOADING,{frag:_})},c.loadFragment=function(_,B,$){this._loadFragForPlayback(_,B,$)},c._loadFragForPlayback=function(_,B,$){var K=this,H=function(W){if(K.fragContextChanged(_)){K.warn("Fragment "+_.sn+(W.part?" p: "+W.part.index:"")+" of level "+_.level+" was dropped during download."),K.fragmentTracker.removeFragment(_);return}_.stats.chunkCount++,K._handleFragmentLoadProgress(W)};this._doFragLoad(_,B,$,H).then(function(j){if(!!j){K.fragLoadError=0;var W=K.state;if(K.fragContextChanged(_)){(W===f.FRAG_LOADING||W===f.BACKTRACKING||!K.fragCurrent&&W===f.PARSING)&&(K.fragmentTracker.removeFragment(_),K.state=f.IDLE);return}if("payload"in j&&(K.log("Loaded fragment "+_.sn+" of level "+_.level),K.hls.trigger(I.Events.FRAG_LOADED,j),K.state===f.BACKTRACKING)){K.fragmentTracker.backtrack(_,j),K.resetFragmentLoading(_);return}K._handleFragmentLoadComplete(j)}}).catch(function(j){K.warn(j),K.resetFragmentLoading(_)})},c.flushMainBuffer=function(_,B,$){if($===void 0&&($=null),!!(_-B)){var K={startOffset:_,endOffset:B,type:$};this.fragLoadError=0,this.hls.trigger(I.Events.BUFFER_FLUSHING,K)}},c._loadInitSegment=function(_){var B=this;this._doFragLoad(_).then(function($){if(!$||B.fragContextChanged(_)||!B.levels)throw new Error("init load aborted");return $}).then(function($){var K=B.hls,H=$.payload,j=_.decryptdata;if(H&&H.byteLength>0&&j&&j.key&&j.iv&&j.method==="AES-128"){var W=self.performance.now();return B.decrypter.webCryptoDecrypt(new Uint8Array(H),j.key.buffer,j.iv.buffer).then(function(z){var Q=self.performance.now();return K.trigger(I.Events.FRAG_DECRYPTED,{frag:_,payload:z,stats:{tstart:W,tdecrypt:Q}}),$.payload=z,$})}return $}).then(function($){var K=B.fragCurrent,H=B.hls,j=B.levels;if(!j)throw new Error("init load aborted, missing levels");var W=j[_.level].details;console.assert(W,"Level details are defined when init segment is loaded");var z=_.stats;B.state=f.IDLE,B.fragLoadError=0,_.data=new Uint8Array($.payload),z.parsing.start=z.buffering.start=self.performance.now(),z.parsing.end=z.buffering.end=self.performance.now(),$.frag===K&&H.trigger(I.Events.FRAG_BUFFERED,{stats:z,frag:K,part:null,id:_.type}),B.tick()}).catch(function($){B.warn($),B.resetFragmentLoading(_)})},c.fragContextChanged=function(_){var B=this.fragCurrent;return!_||!B||_.level!==B.level||_.sn!==B.sn||_.urlId!==B.urlId},c.fragBufferedComplete=function(_,B){var $=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+_.type+" sn: "+_.sn+(B?" part: "+B.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+_.level+" "+u.default.toString(N.BufferHelper.getBuffered($))),this.state=f.IDLE,this.tick()},c._handleFragmentLoadComplete=function(_){var B=this.transmuxer;if(!!B){var $=_.frag,K=_.part,H=_.partsLoaded,j=!H||H.length===0||H.some(function(z){return!z}),W=new C.ChunkMetadata($.level,$.sn,$.stats.chunkCount+1,0,K?K.index:-1,!j);B.flush(W)}},c._handleFragmentLoadProgress=function(_){},c._doFragLoad=function(_,B,$,K){var H=this;if($===void 0&&($=null),!this.levels)throw new Error("frag load aborted, missing levels");if($=Math.max(_.start,$||0),this.config.lowLatencyMode&&B){var j=B.partList;if(j&&K){$>_.end&&B.fragmentHint&&(_=B.fragmentHint);var W=this.getNextPart(j,_,$);if(W>-1){var z=j[W];return this.log("Loading part sn: "+_.sn+" p: "+z.index+" cc: "+_.cc+" of playlist ["+B.startSN+"-"+B.endSN+"] parts [0-"+W+"-"+(j.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+_.level+", target: "+parseFloat($.toFixed(3))),this.nextLoadPosition=z.start+z.duration,this.state=f.FRAG_LOADING,this.hls.trigger(I.Events.FRAG_LOADING,{frag:_,part:j[W],targetBufferTime:$}),this.doFragPartsLoad(_,j,W,K).catch(function(Q){return H.handleFragLoadError(Q)})}else if(!_.url||this.loadedEndOfParts(j,$))return Promise.resolve(null)}}return this.log("Loading fragment "+_.sn+" cc: "+_.cc+" "+(B?"of ["+B.startSN+"-"+B.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+_.level+", target: "+parseFloat($.toFixed(3))),Object(R.isFiniteNumber)(_.sn)&&!this.bitrateTest&&(this.nextLoadPosition=_.start+_.duration),this.state=f.FRAG_LOADING,this.hls.trigger(I.Events.FRAG_LOADING,{frag:_,targetBufferTime:$}),this.fragmentLoader.load(_,K).catch(function(Q){return H.handleFragLoadError(Q)})},c.doFragPartsLoad=function(_,B,$,K){var H=this;return new Promise(function(j,W){var z=[],Q=function V(J){var X=B[J];H.fragmentLoader.loadPart(_,X,K).then(function(q){z[X.index]=q;var ue=q.part;H.hls.trigger(I.Events.FRAG_LOADED,q);var oe=B[J+1];if(oe&&oe.fragment===_)V(J+1);else return j({frag:_,part:ue,partsLoaded:z})}).catch(W)};Q($)})},c.handleFragLoadError=function(_){var B=_.data;return B&&B.details===M.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(B.frag,B.part):this.hls.trigger(I.Events.ERROR,B),null},c._handleTransmuxerFlush=function(_){var B=this.getCurrentContext(_);if(!B||this.state!==f.PARSING){this.fragCurrent||(this.state=f.IDLE);return}var $=B.frag,K=B.part,H=B.level,j=self.performance.now();$.stats.parsing.end=j,K&&(K.stats.parsing.end=j),this.updateLevelTiming($,K,H,_.partial)},c.getCurrentContext=function(_){var B=this.levels,$=_.level,K=_.sn,H=_.part;if(!B||!B[$])return this.warn("Levels object was unset while buffering fragment "+K+" of level "+$+". The current chunk will not be buffered."),null;var j=B[$],W=H>-1?Object(F.getPartWith)(j,K,H):null,z=W?W.fragment:Object(F.getFragmentWithSN)(j,K,this.fragCurrent);return z?{frag:z,part:W,level:j}:null},c.bufferFragmentData=function(_,B,$,K){if(!(!_||this.state!==f.PARSING)){var H=_.data1,j=_.data2,W=H;if(H&&j&&(W=Object(w.appendUint8Array)(H,j)),!(!W||!W.length)){var z={type:_.type,frag:B,part:$,chunkMeta:K,parent:B.type,data:W};this.hls.trigger(I.Events.BUFFER_APPENDING,z),_.dropped&&_.independent&&!$&&this.flushBufferGap(B)}}},c.flushBufferGap=function(_){var B=this.media;if(!!B){if(!N.BufferHelper.isBuffered(B,B.currentTime)){this.flushMainBuffer(0,_.start);return}var $=B.currentTime,K=N.BufferHelper.bufferInfo(B,$,0),H=_.duration,j=Math.min(this.config.maxFragLookUpTolerance*2,H*.25),W=Math.max(Math.min(_.start-j,K.end-j),$+j);_.start-W>j&&this.flushMainBuffer(W,_.start)}},c.getFwdBufferInfo=function(_,B){var $=this.config,K=this.getLoadPosition();if(!Object(R.isFiniteNumber)(K))return null;var H=N.BufferHelper.bufferInfo(_,K,$.maxBufferHole);if(H.len===0&&H.nextStart!==void 0){var j=this.fragmentTracker.getBufferedFrag(K,B);if(j&&H.nextStart<j.end)return N.BufferHelper.bufferInfo(_,K,Math.max(H.nextStart,$.maxBufferHole))}return H},c.getMaxBufferLength=function(_){var B=this.config,$;return _?$=Math.max(8*B.maxBufferSize/_,B.maxBufferLength):$=B.maxBufferLength,Math.min($,B.maxMaxBufferLength)},c.reduceMaxBufferLength=function(_){var B=this.config,$=_||B.maxBufferLength;return B.maxMaxBufferLength>=$?(B.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+B.maxMaxBufferLength+"s"),!0):!1},c.getNextFragment=function(_,B){var $,K,H=B.fragments,j=H.length;if(!j)return null;var W=this.config,z=H[0].start,Q;if(B.live){var V=W.initialLiveManifestSize;if(j<V)return this.warn("Not enough fragments to start playback (have: "+j+", need: "+V+")"),null;!B.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(Q=this.getInitialLiveFragment(B,H),this.startPosition=Q?this.hls.liveSyncPosition||Q.start:_)}else _<=z&&(Q=H[0]);if(!Q){var J=W.lowLatencyMode?B.partEnd:B.fragmentEnd;Q=this.getFragmentAtPosition(_,J,B)}return($=Q)!==null&&$!==void 0&&$.initSegment&&!((K=Q)!==null&&K!==void 0&&K.initSegment.data)&&!this.bitrateTest&&(Q=Q.initSegment),Q},c.getNextPart=function(_,B,$){for(var K=-1,H=!1,j=!0,W=0,z=_.length;W<z;W++){var Q=_[W];if(j=j&&!Q.independent,K>-1&&$<Q.start)break;var V=Q.loaded;!V&&(H||Q.independent||j)&&Q.fragment===B&&(K=W),H=V}return K},c.loadedEndOfParts=function(_,B){var $=_[_.length-1];return $&&B>$.start&&$.loaded},c.getInitialLiveFragment=function(_,B){var $=this.fragPrevious,K=null;if($){if(_.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+$.programDateTime),K=Object(k.findFragmentByPDT)(B,$.endProgramDateTime,this.config.maxFragLookUpTolerance)),!K){var H=$.sn+1;if(H>=_.startSN&&H<=_.endSN){var j=B[H-_.startSN];$.cc===j.cc&&(K=j,this.log("Live playlist, switching playlist, load frag with next SN: "+K.sn))}K||(K=Object(k.findFragWithCC)(B,$.cc),K&&this.log("Live playlist, switching playlist, load frag with same CC: "+K.sn))}}else{var W=this.hls.liveSyncPosition;W!==null&&(K=this.getFragmentAtPosition(W,this.bitrateTest?_.fragmentEnd:_.edge,_))}return K},c.getFragmentAtPosition=function(_,B,$){var K=this.config,H=this.fragPrevious,j=$.fragments,W=$.endSN,z=$.fragmentHint,Q=K.maxFragLookUpTolerance,V=!!(K.lowLatencyMode&&$.partList&&z);V&&z&&!this.bitrateTest&&(j=j.concat(z),W=z.sn);var J;if(_<B){var X=_>B-Q?0:Q;J=Object(k.findFragmentByPTS)(H,j,_,X)}else J=j[j.length-1];if(J){var q=J.sn-$.startSN,ue=H&&J.level===H.level,oe=j[q+1],ce=this.fragmentTracker.getState(J);if(ce===O.FragmentState.BACKTRACKED){J=null;for(var le=q;j[le]&&this.fragmentTracker.getState(j[le])===O.FragmentState.BACKTRACKED;)H?J=j[le--]:J=j[--le];J||(J=oe)}else H&&J.sn===H.sn&&!V&&ue&&(J.sn<W&&this.fragmentTracker.getState(oe)!==O.FragmentState.OK?(this.log("SN "+J.sn+" just loaded, load next one: "+oe.sn),J=oe):J=null)}return J},c.synchronizeToLiveEdge=function(_){var B=this.config,$=this.media;if(!!$){var K=this.hls.liveSyncPosition,H=$.currentTime,j=_.fragments[0].start,W=_.edge,z=H>=j-B.maxFragLookUpTolerance&&H<=W;if(K!==null&&$.duration>K&&(H<K||!z)){var Q=B.liveMaxLatencyDuration!==void 0?B.liveMaxLatencyDuration:B.liveMaxLatencyDurationCount*_.targetduration;(!z&&$.readyState<4||H<W-Q)&&(this.loadedmetadata||(this.nextLoadPosition=K),$.readyState&&(this.warn("Playback: "+H.toFixed(3)+" is located too far from the end of live sliding playlist: "+W+", reset currentTime to : "+K.toFixed(3)),$.currentTime=K))}}},c.alignPlaylists=function(_,B){var $=this.levels,K=this.levelLastLoaded,H=this.fragPrevious,j=K!==null?$[K]:null,W=_.fragments.length;if(!W)return this.warn("No fragments in live playlist"),0;var z=_.fragments[0].start,Q=!B,V=_.alignedSliding&&Object(R.isFiniteNumber)(z);if(Q||!V&&!z){Object(v.alignStream)(H,j,_);var J=_.fragments[0].start;return this.log("Live playlist sliding: "+J.toFixed(2)+" start-sn: "+(B?B.startSN:"na")+"->"+_.startSN+" prev-sn: "+(H?H.sn:"na")+" fragments: "+W),J}return z},c.waitForCdnTuneIn=function(_){var B=3;return _.live&&_.canBlockReload&&_.tuneInGoal>Math.max(_.partHoldBack,_.partTarget*B)},c.setStartPosition=function(_,B){var $=this.startPosition;if($<B&&($=-1),$===-1||this.lastCurrentTime===-1){var K=_.startTimeOffset;Object(R.isFiniteNumber)(K)?($=B+K,K<0&&($+=_.totalduration),$=Math.min(Math.max(B,$),B+_.totalduration),this.log("Start time offset "+K+" found in playlist, adjust startPosition to "+$),this.startPosition=$):_.live?$=this.hls.liveSyncPosition||B:this.startPosition=$=0,this.lastCurrentTime=$}this.nextLoadPosition=$},c.getLoadPosition=function(){var _=this.media,B=0;return this.loadedmetadata&&_?B=_.currentTime:this.nextLoadPosition&&(B=this.nextLoadPosition),B},c.handleFragLoadAborted=function(_,B){this.transmuxer&&_.sn!=="initSegment"&&_.stats.aborted&&(this.warn("Fragment "+_.sn+(B?" part"+B.index:"")+" of level "+_.level+" was aborted"),this.resetFragmentLoading(_))},c.resetFragmentLoading=function(_){(!this.fragCurrent||!this.fragContextChanged(_))&&(this.state=f.IDLE)},c.onFragmentOrKeyLoadError=function(_,B){if(!B.fatal){var $=B.frag;if(!(!$||$.type!==_)){var K=this.fragCurrent;console.assert(K&&$.sn===K.sn&&$.level===K.level&&$.urlId===K.urlId,"Frag load error must match current frag to retry");var H=this.config;if(this.fragLoadError+1<=H.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded($.level))return;var j=Math.min(Math.pow(2,this.fragLoadError)*H.fragLoadingRetryDelay,H.fragLoadingMaxRetryTimeout);this.warn("Fragment "+$.sn+" of "+_+" "+$.level+" failed to load, retrying in "+j+"ms"),this.retryDate=self.performance.now()+j,this.fragLoadError++,this.state=f.FRAG_LOADING_WAITING_RETRY}else B.levelRetry?(_===y.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=f.IDLE):(U.logger.error(B.details+" reaches max retry, redispatch as fatal ..."),B.fatal=!0,this.hls.stopLoad(),this.state=f.ERROR)}}},c.afterBufferFlushed=function(_,B,$){if(!!_){var K=N.BufferHelper.getBuffered(_);this.fragmentTracker.detectEvictedFragments(B,K,$),this.state===f.ENDED&&this.resetLoadingState()}},c.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=f.IDLE},c.resetLiveStartWhenNotLoaded=function(_){if(!this.loadedmetadata){this.startFragRequested=!1;var B=this.levels?this.levels[_].details:null;if(B!=null&&B.live)return this.startPosition=-1,this.setStartPosition(B,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},c.updateLevelTiming=function(_,B,$,K){var H=this,j=$.details;console.assert(!!j,"level.details must be defined");var W=Object.keys(_.elementaryStreams).reduce(function(z,Q){var V=_.elementaryStreams[Q];if(V){var J=V.endPTS-V.startPTS;if(J<=0)return H.warn("Could not parse fragment "+_.sn+" "+Q+" duration reliably ("+J+") resetting transmuxer to fallback to playlist timing"),H.resetTransmuxer(),z||!1;var X=K?0:Object(F.updateFragPTSDTS)(j,_,V.startPTS,V.endPTS,V.startDTS,V.endDTS);return H.hls.trigger(I.Events.LEVEL_PTS_UPDATED,{details:j,level:$,drift:X,type:Q,frag:_,start:V.startPTS,end:V.endPTS}),!0}return z},!1);W?(this.state=f.PARSED,this.hls.trigger(I.Events.FRAG_PARSED,{frag:_,part:B})):this.resetLoadingState()},c.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},P(a,[{key:"state",get:function(){return this._state},set:function(_){var B=this._state;B!==_&&(this._state=_,this.log(B+"->"+_))}}]),a}(T.default)},"./src/controller/buffer-controller.ts":function(S,l,r){r.r(l),r.d(l,"default",function(){return k});var R=r("./src/polyfills/number.ts"),T=r("./src/events.ts"),O=r("./src/utils/logger.ts"),N=r("./src/errors.ts"),U=r("./src/utils/buffer-helper.ts"),I=r("./src/utils/mediasource-helper.ts"),M=r("./src/loader/fragment.ts"),C=r("./src/controller/buffer-operation-queue.ts"),w=Object(I.getMediaSource)(),v=/([ha]vc.)(?:\.[^.,]+)+/,k=function(){function F(E){var u=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var y=u.hls,o=u.media,P=u.mediaSource;O.logger.log("[buffer-controller]: Media source opened"),o&&(u.updateMediaElementDuration(),y.trigger(T.Events.MEDIA_ATTACHED,{media:o})),P&&P.removeEventListener("sourceopen",u._onMediaSourceOpen),u.checkPendingTracks()},this._onMediaSourceClose=function(){O.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){O.logger.log("[buffer-controller]: Media source ended")},this.hls=E,this._initSourceBuffer(),this.registerListeners()}var D=F.prototype;return D.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},D.destroy=function(){this.unregisterListeners(),this.details=null},D.registerListeners=function(){var u=this.hls;u.on(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),u.on(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.on(T.Events.MANIFEST_PARSED,this.onManifestParsed,this),u.on(T.Events.BUFFER_RESET,this.onBufferReset,this),u.on(T.Events.BUFFER_APPENDING,this.onBufferAppending,this),u.on(T.Events.BUFFER_CODECS,this.onBufferCodecs,this),u.on(T.Events.BUFFER_EOS,this.onBufferEos,this),u.on(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),u.on(T.Events.LEVEL_UPDATED,this.onLevelUpdated,this),u.on(T.Events.FRAG_PARSED,this.onFragParsed,this),u.on(T.Events.FRAG_CHANGED,this.onFragChanged,this)},D.unregisterListeners=function(){var u=this.hls;u.off(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),u.off(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.off(T.Events.MANIFEST_PARSED,this.onManifestParsed,this),u.off(T.Events.BUFFER_RESET,this.onBufferReset,this),u.off(T.Events.BUFFER_APPENDING,this.onBufferAppending,this),u.off(T.Events.BUFFER_CODECS,this.onBufferCodecs,this),u.off(T.Events.BUFFER_EOS,this.onBufferEos,this),u.off(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),u.off(T.Events.LEVEL_UPDATED,this.onLevelUpdated,this),u.off(T.Events.FRAG_PARSED,this.onFragParsed,this),u.off(T.Events.FRAG_CHANGED,this.onFragChanged,this)},D._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new C.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},D.onManifestParsed=function(u,y){var o=2;(y.audio&&!y.video||!y.altAudio)&&(o=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=o,this.details=null,O.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},D.onMediaAttaching=function(u,y){var o=this.media=y.media;if(o&&w){var P=this.mediaSource=new w;P.addEventListener("sourceopen",this._onMediaSourceOpen),P.addEventListener("sourceended",this._onMediaSourceEnded),P.addEventListener("sourceclose",this._onMediaSourceClose),o.src=self.URL.createObjectURL(P),this._objectUrl=o.src}},D.onMediaDetaching=function(){var u=this.media,y=this.mediaSource,o=this._objectUrl;if(y){if(O.logger.log("[buffer-controller]: media source detaching"),y.readyState==="open")try{y.endOfStream()}catch(P){O.logger.warn("[buffer-controller]: onMediaDetaching: "+P.message+" while calling endOfStream")}this.onBufferReset(),y.removeEventListener("sourceopen",this._onMediaSourceOpen),y.removeEventListener("sourceended",this._onMediaSourceEnded),y.removeEventListener("sourceclose",this._onMediaSourceClose),u&&(o&&self.URL.revokeObjectURL(o),u.src===o?(u.removeAttribute("src"),u.load()):O.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(T.Events.MEDIA_DETACHED,void 0)},D.onBufferReset=function(){var u=this;this.getSourceBufferTypes().forEach(function(y){var o=u.sourceBuffer[y];try{o&&(u.removeBufferListeners(y),u.mediaSource&&u.mediaSource.removeSourceBuffer(o),u.sourceBuffer[y]=void 0)}catch(P){O.logger.warn("[buffer-controller]: Failed to reset the "+y+" buffer",P)}}),this._initSourceBuffer()},D.onBufferCodecs=function(u,y){var o=this,P=this.getSourceBufferTypes().length;Object.keys(y).forEach(function(A){if(P){var g=o.tracks[A];if(g&&typeof g.buffer.changeType=="function"){var t=y[A],f=t.codec,x=t.levelCodec,m=t.container,a=(g.levelCodec||g.codec).replace(v,"$1"),c=(x||f).replace(v,"$1");if(a!==c){var L=m+";codecs="+(x||f);o.appendChangeType(A,L)}}}else o.pendingTracks[A]=y[A]}),!P&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},D.appendChangeType=function(u,y){var o=this,P=this.operationQueue,A={execute:function(){var t=o.sourceBuffer[u];t&&(O.logger.log("[buffer-controller]: changing "+u+" sourceBuffer type to "+y),t.changeType(y)),P.shiftAndExecuteNext(u)},onStart:function(){},onComplete:function(){},onError:function(t){O.logger.warn("[buffer-controller]: Failed to change "+u+" SourceBuffer type",t)}};P.append(A,u)},D.onBufferAppending=function(u,y){var o=this,P=this.hls,A=this.operationQueue,g=this.tracks,t=y.data,f=y.type,x=y.frag,m=y.part,a=y.chunkMeta,c=a.buffering[f],L=self.performance.now();c.start=L;var _=x.stats.buffering,B=m?m.stats.buffering:null;_.start===0&&(_.start=L),B&&B.start===0&&(B.start=L);var $=g.audio,K=f==="audio"&&a.id===1&&($==null?void 0:$.container)==="audio/mpeg",H={execute:function(){if(c.executeStart=self.performance.now(),K){var W=o.sourceBuffer[f];if(W){var z=x.start-W.timestampOffset;Math.abs(z)>=.1&&(O.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+x.start+" (delta: "+z+") sn: "+x.sn+")"),W.timestampOffset=x.start)}}o.appendExecutor(t,f)},onStart:function(){},onComplete:function(){var W=self.performance.now();c.executeEnd=c.end=W,_.first===0&&(_.first=W),B&&B.first===0&&(B.first=W);var z=o.sourceBuffer,Q={};for(var V in z)Q[V]=U.BufferHelper.getBuffered(z[V]);o.appendError=0,o.hls.trigger(T.Events.BUFFER_APPENDED,{type:f,frag:x,part:m,chunkMeta:a,parent:x.type,timeRanges:Q})},onError:function(W){O.logger.error("[buffer-controller]: Error encountered while trying to append to the "+f+" SourceBuffer",W);var z={type:N.ErrorTypes.MEDIA_ERROR,parent:x.type,details:N.ErrorDetails.BUFFER_APPEND_ERROR,err:W,fatal:!1};W.code===DOMException.QUOTA_EXCEEDED_ERR?z.details=N.ErrorDetails.BUFFER_FULL_ERROR:(o.appendError++,z.details=N.ErrorDetails.BUFFER_APPEND_ERROR,o.appendError>P.config.appendErrorMaxRetry&&(O.logger.error("[buffer-controller]: Failed "+P.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),z.fatal=!0)),P.trigger(T.Events.ERROR,z)}};A.append(H,f)},D.onBufferFlushing=function(u,y){var o=this,P=this.operationQueue,A=function(t){return{execute:o.removeExecutor.bind(o,t,y.startOffset,y.endOffset),onStart:function(){},onComplete:function(){o.hls.trigger(T.Events.BUFFER_FLUSHED,{type:t})},onError:function(x){O.logger.warn("[buffer-controller]: Failed to remove from "+t+" SourceBuffer",x)}}};y.type?P.append(A(y.type),y.type):this.getSourceBufferTypes().forEach(function(g){P.append(A(g),g)})},D.onFragParsed=function(u,y){var o=this,P=y.frag,A=y.part,g=[],t=A?A.elementaryStreams:P.elementaryStreams;t[M.ElementaryStreamTypes.AUDIOVIDEO]?g.push("audiovideo"):(t[M.ElementaryStreamTypes.AUDIO]&&g.push("audio"),t[M.ElementaryStreamTypes.VIDEO]&&g.push("video"));var f=function(){var m=self.performance.now();P.stats.buffering.end=m,A&&(A.stats.buffering.end=m);var a=A?A.stats:P.stats;o.hls.trigger(T.Events.FRAG_BUFFERED,{frag:P,part:A,stats:a,id:P.type})};g.length===0&&O.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+P.type+" level: "+P.level+" sn: "+P.sn),this.blockBuffers(f,g)},D.onFragChanged=function(u,y){this.flushBackBuffer()},D.onBufferEos=function(u,y){var o=this,P=this.getSourceBufferTypes().reduce(function(A,g){var t=o.sourceBuffer[g];return(!y.type||y.type===g)&&t&&!t.ended&&(t.ended=!0,O.logger.log("[buffer-controller]: "+g+" sourceBuffer now EOS")),A&&!!(!t||t.ended)},!0);P&&this.blockBuffers(function(){var A=o.mediaSource;!A||A.readyState!=="open"||A.endOfStream()})},D.onLevelUpdated=function(u,y){var o=y.details;!o.fragments.length||(this.details=o,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},D.flushBackBuffer=function(){var u=this.hls,y=this.details,o=this.media,P=this.sourceBuffer;if(!(!o||y===null)){var A=this.getSourceBufferTypes();if(!!A.length){var g=y.live&&u.config.liveBackBufferLength!==null?u.config.liveBackBufferLength:u.config.backBufferLength;if(!(!Object(R.isFiniteNumber)(g)||g<0)){var t=o.currentTime,f=y.levelTargetDuration,x=Math.max(g,f),m=Math.floor(t/f)*f-x;A.forEach(function(a){var c=P[a];if(c){var L=U.BufferHelper.getBuffered(c);L.length>0&&m>L.start(0)&&(u.trigger(T.Events.BACK_BUFFER_REACHED,{bufferEnd:m}),y.live&&u.trigger(T.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:m}),u.trigger(T.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:m,type:a}))}})}}}},D.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var u=this.details,y=this.hls,o=this.media,P=this.mediaSource,A=u.fragments[0].start+u.totalduration,g=o.duration,t=Object(R.isFiniteNumber)(P.duration)?P.duration:0;u.live&&y.config.liveDurationInfinity?(O.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),P.duration=1/0,this.updateSeekableRange(u)):(A>t&&A>g||!Object(R.isFiniteNumber)(g))&&(O.logger.log("[buffer-controller]: Updating Media Source duration to "+A.toFixed(3)),P.duration=A)}},D.updateSeekableRange=function(u){var y=this.mediaSource,o=u.fragments,P=o.length;if(P&&u.live&&y!==null&&y!==void 0&&y.setLiveSeekableRange){var A=Math.max(0,o[0].start),g=Math.max(A,A+u.totalduration);y.setLiveSeekableRange(A,g)}},D.checkPendingTracks=function(){var u=this.bufferCodecEventsExpected,y=this.operationQueue,o=this.pendingTracks,P=Object.keys(o).length;if(P&&!u||P===2){this.createSourceBuffers(o),this.pendingTracks={};var A=this.getSourceBufferTypes();if(A.length===0){this.hls.trigger(T.Events.ERROR,{type:N.ErrorTypes.MEDIA_ERROR,details:N.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}A.forEach(function(g){y.executeNext(g)})}},D.createSourceBuffers=function(u){var y=this.sourceBuffer,o=this.mediaSource;if(!o)throw Error("createSourceBuffers called when mediaSource was null");var P=0;for(var A in u)if(!y[A]){var g=u[A];if(!g)throw Error("source buffer exists for track "+A+", however track does not");var t=g.levelCodec||g.codec,f=g.container+";codecs="+t;O.logger.log("[buffer-controller]: creating sourceBuffer("+f+")");try{var x=y[A]=o.addSourceBuffer(f),m=A;this.addBufferListener(m,"updatestart",this._onSBUpdateStart),this.addBufferListener(m,"updateend",this._onSBUpdateEnd),this.addBufferListener(m,"error",this._onSBUpdateError),this.tracks[A]={buffer:x,codec:t,container:g.container,levelCodec:g.levelCodec,id:g.id},P++}catch(a){O.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+a.message),this.hls.trigger(T.Events.ERROR,{type:N.ErrorTypes.MEDIA_ERROR,details:N.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:a,mimeType:f})}}P&&this.hls.trigger(T.Events.BUFFER_CREATED,{tracks:this.tracks})},D._onSBUpdateStart=function(u){var y=this.operationQueue,o=y.current(u);o.onStart()},D._onSBUpdateEnd=function(u){var y=this.operationQueue,o=y.current(u);o.onComplete(),y.shiftAndExecuteNext(u)},D._onSBUpdateError=function(u,y){O.logger.error("[buffer-controller]: "+u+" SourceBuffer error",y),this.hls.trigger(T.Events.ERROR,{type:N.ErrorTypes.MEDIA_ERROR,details:N.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var o=this.operationQueue.current(u);o&&o.onError(y)},D.removeExecutor=function(u,y,o){var P=this.media,A=this.mediaSource,g=this.operationQueue,t=this.sourceBuffer,f=t[u];if(!P||!A||!f){O.logger.warn("[buffer-controller]: Attempting to remove from the "+u+" SourceBuffer, but it does not exist"),g.shiftAndExecuteNext(u);return}var x=Object(R.isFiniteNumber)(P.duration)?P.duration:1/0,m=Object(R.isFiniteNumber)(A.duration)?A.duration:1/0,a=Math.max(0,y),c=Math.min(o,x,m);c>a?(O.logger.log("[buffer-controller]: Removing ["+a+","+c+"] from the "+u+" SourceBuffer"),console.assert(!f.updating,u+" sourceBuffer must not be updating"),f.remove(a,c)):g.shiftAndExecuteNext(u)},D.appendExecutor=function(u,y){var o=this.operationQueue,P=this.sourceBuffer,A=P[y];if(!A){O.logger.warn("[buffer-controller]: Attempting to append to the "+y+" SourceBuffer, but it does not exist"),o.shiftAndExecuteNext(y);return}A.ended=!1,console.assert(!A.updating,y+" sourceBuffer must not be updating"),A.appendBuffer(u)},D.blockBuffers=function(u,y){var o=this;if(y===void 0&&(y=this.getSourceBufferTypes()),!y.length){O.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve(u);return}var P=this.operationQueue,A=y.map(function(g){return P.appendBlocker(g)});Promise.all(A).then(function(){u(),y.forEach(function(g){var t=o.sourceBuffer[g];(!t||!t.updating)&&P.shiftAndExecuteNext(g)})})},D.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},D.addBufferListener=function(u,y,o){var P=this.sourceBuffer[u];if(!!P){var A=o.bind(this,u);this.listeners[u].push({event:y,listener:A}),P.addEventListener(y,A)}},D.removeBufferListeners=function(u){var y=this.sourceBuffer[u];!y||this.listeners[u].forEach(function(o){y.removeEventListener(o.event,o.listener)})},F}()},"./src/controller/buffer-operation-queue.ts":function(S,l,r){r.r(l),r.d(l,"default",function(){return T});var R=r("./src/utils/logger.ts"),T=function(){function O(U){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=U}var N=O.prototype;return N.append=function(I,M){var C=this.queues[M];C.push(I),C.length===1&&this.buffers[M]&&this.executeNext(M)},N.insertAbort=function(I,M){var C=this.queues[M];C.unshift(I),this.executeNext(M)},N.appendBlocker=function(I){var M,C=new Promise(function(v){M=v}),w={execute:M,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(w,I),C},N.executeNext=function(I){var M=this.buffers,C=this.queues,w=M[I],v=C[I];if(v.length){var k=v[0];try{k.execute()}catch(F){R.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),k.onError(F),(!w||!w.updating)&&(v.shift(),this.executeNext(I))}}},N.shiftAndExecuteNext=function(I){this.queues[I].shift(),this.executeNext(I)},N.current=function(I){return this.queues[I][0]},O}()},"./src/controller/cap-level-controller.ts":function(S,l,r){r.r(l);var R=r("./src/events.ts");function T(U,I){for(var M=0;M<I.length;M++){var C=I[M];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(U,C.key,C)}}function O(U,I,M){return I&&T(U.prototype,I),M&&T(U,M),U}var N=function(){function U(M){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=M,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var I=U.prototype;return I.setStreamController=function(C){this.streamController=C},I.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},I.registerListeners=function(){var C=this.hls;C.on(R.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),C.on(R.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),C.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),C.on(R.Events.BUFFER_CODECS,this.onBufferCodecs,this),C.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},I.unregisterListener=function(){var C=this.hls;C.off(R.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),C.off(R.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),C.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),C.off(R.Events.BUFFER_CODECS,this.onBufferCodecs,this),C.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},I.onFpsDropLevelCapping=function(C,w){U.isLevelAllowed(w.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(w.droppedLevel)},I.onMediaAttaching=function(C,w){this.media=w.media instanceof HTMLVideoElement?w.media:null},I.onManifestParsed=function(C,w){var v=this.hls;this.restrictedLevels=[],this.firstLevel=w.firstLevel,v.config.capLevelToPlayerSize&&w.video&&this.startCapping()},I.onBufferCodecs=function(C,w){var v=this.hls;v.config.capLevelToPlayerSize&&w.video&&this.startCapping()},I.onMediaDetaching=function(){this.stopCapping()},I.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var C=this.hls.levels;if(C.length){var w=this.hls;w.autoLevelCapping=this.getMaxLevel(C.length-1),w.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=w.autoLevelCapping}}},I.getMaxLevel=function(C){var w=this,v=this.hls.levels;if(!v.length)return-1;var k=v.filter(function(F,D){return U.isLevelAllowed(D,w.restrictedLevels)&&D<=C});return this.clientRect=null,U.getMaxLevelByMediaSize(k,this.mediaWidth,this.mediaHeight)},I.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},I.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},I.getDimensions=function(){if(this.clientRect)return this.clientRect;var C=this.media,w={width:0,height:0};if(C){var v=C.getBoundingClientRect();w.width=v.width,w.height=v.height,!w.width&&!w.height&&(w.width=v.right-v.left||C.width||0,w.height=v.bottom-v.top||C.height||0)}return this.clientRect=w,w},U.isLevelAllowed=function(C,w){return w===void 0&&(w=[]),w.indexOf(C)===-1},U.getMaxLevelByMediaSize=function(C,w,v){if(!C||!C.length)return-1;for(var k=function(y,o){return o?y.width!==o.width||y.height!==o.height:!0},F=C.length-1,D=0;D<C.length;D+=1){var E=C[D];if((E.width>=w||E.height>=v)&&k(E,C[D+1])){F=D;break}}return F},O(U,[{key:"mediaWidth",get:function(){return this.getDimensions().width*U.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*U.contentScaleFactor}}],[{key:"contentScaleFactor",get:function(){var C=1;try{C=self.devicePixelRatio}catch{}return C}}]),U}();l.default=N},"./src/controller/cmcd-controller.ts":function(S,l,r){r.r(l),r.d(l,"default",function(){return k});var R=r("./src/events.ts"),T=r("./src/types/cmcd.ts"),O=r("./src/utils/buffer-helper.ts"),N=r("./src/utils/logger.ts");function U(F,D){for(var E=0;E<D.length;E++){var u=D[E];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(F,u.key,u)}}function I(F,D,E){return D&&U(F.prototype,D),E&&U(F,E),F}function M(F,D){var E=typeof Symbol!="undefined"&&F[Symbol.iterator]||F["@@iterator"];if(E)return(E=E.call(F)).next.bind(E);if(Array.isArray(F)||(E=C(F))||D&&F&&typeof F.length=="number"){E&&(F=E);var u=0;return function(){return u>=F.length?{done:!0}:{done:!1,value:F[u++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function C(F,D){if(!!F){if(typeof F=="string")return w(F,D);var E=Object.prototype.toString.call(F).slice(8,-1);if(E==="Object"&&F.constructor&&(E=F.constructor.name),E==="Map"||E==="Set")return Array.from(F);if(E==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(E))return w(F,D)}}function w(F,D){(D==null||D>F.length)&&(D=F.length);for(var E=0,u=new Array(D);E<D;E++)u[E]=F[E];return u}function v(){return v=Object.assign||function(F){for(var D=1;D<arguments.length;D++){var E=arguments[D];for(var u in E)Object.prototype.hasOwnProperty.call(E,u)&&(F[u]=E[u])}return F},v.apply(this,arguments)}var k=function(){function F(E){var u=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){u.initialized&&(u.starved=!0),u.buffering=!0},this.onPlaying=function(){u.initialized||(u.initialized=!0),u.buffering=!1},this.applyPlaylistData=function(P){try{u.apply(P,{ot:T.CMCDObjectType.MANIFEST,su:!u.initialized})}catch(A){N.logger.warn("Could not generate manifest CMCD data.",A)}},this.applyFragmentData=function(P){try{var A=P.frag,g=u.hls.levels[A.level],t=u.getObjectType(A),f={d:A.duration*1e3,ot:t};(t===T.CMCDObjectType.VIDEO||t===T.CMCDObjectType.AUDIO||t==T.CMCDObjectType.MUXED)&&(f.br=g.bitrate/1e3,f.tb=u.getTopBandwidth(t)/1e3,f.bl=u.getBufferLength(t)),u.apply(P,f)}catch(x){N.logger.warn("Could not generate segment CMCD data.",x)}},this.hls=E;var y=this.config=E.config,o=y.cmcd;o!=null&&(y.pLoader=this.createPlaylistLoader(),y.fLoader=this.createFragmentLoader(),this.sid=o.sessionId||F.uuid(),this.cid=o.contentId,this.useHeaders=o.useHeaders===!0,this.registerListeners())}var D=F.prototype;return D.registerListeners=function(){var u=this.hls;u.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.on(R.Events.MEDIA_DETACHED,this.onMediaDetached,this),u.on(R.Events.BUFFER_CREATED,this.onBufferCreated,this)},D.unregisterListeners=function(){var u=this.hls;u.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.off(R.Events.MEDIA_DETACHED,this.onMediaDetached,this),u.off(R.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},D.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},D.onMediaAttached=function(u,y){this.media=y.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},D.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},D.onBufferCreated=function(u,y){var o,P;this.audioBuffer=(o=y.tracks.audio)===null||o===void 0?void 0:o.buffer,this.videoBuffer=(P=y.tracks.video)===null||P===void 0?void 0:P.buffer},D.createData=function(){var u;return{v:T.CMCDVersion,sf:T.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(u=this.media)===null||u===void 0?void 0:u.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},D.apply=function(u,y){y===void 0&&(y={}),v(y,this.createData());var o=y.ot===T.CMCDObjectType.INIT||y.ot===T.CMCDObjectType.VIDEO||y.ot===T.CMCDObjectType.MUXED;if(this.starved&&o&&(y.bs=!0,y.su=!0,this.starved=!1),y.su==null&&(y.su=this.buffering),this.useHeaders){var P=F.toHeaders(y);if(!Object.keys(P).length)return;u.headers||(u.headers={}),v(u.headers,P)}else{var A=F.toQuery(y);if(!A)return;u.url=F.appendQueryToUri(u.url,A)}},D.getObjectType=function(u){var y=u.type;if(y==="subtitle")return T.CMCDObjectType.TIMED_TEXT;if(u.sn==="initSegment")return T.CMCDObjectType.INIT;if(y==="audio")return T.CMCDObjectType.AUDIO;if(y==="main")return this.hls.audioTracks.length?T.CMCDObjectType.VIDEO:T.CMCDObjectType.MUXED},D.getTopBandwidth=function(u){var y=0,o,P=this.hls;if(u===T.CMCDObjectType.AUDIO)o=P.audioTracks;else{var A=P.maxAutoLevel,g=A>-1?A+1:P.levels.length;o=P.levels.slice(0,g)}for(var t=M(o),f;!(f=t()).done;){var x=f.value;x.bitrate>y&&(y=x.bitrate)}return y>0?y:NaN},D.getBufferLength=function(u){var y=this.hls.media,o=u===T.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!o||!y)return NaN;var P=O.BufferHelper.bufferInfo(o,y.currentTime,this.config.maxBufferHole);return P.len*1e3},D.createPlaylistLoader=function(){var u=this.config.pLoader,y=this.applyPlaylistData,o=u||this.config.loader;return function(){function P(g){this.loader=void 0,this.loader=new o(g)}var A=P.prototype;return A.destroy=function(){this.loader.destroy()},A.abort=function(){this.loader.abort()},A.load=function(t,f,x){y(t),this.loader.load(t,f,x)},I(P,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),P}()},D.createFragmentLoader=function(){var u=this.config.fLoader,y=this.applyFragmentData,o=u||this.config.loader;return function(){function P(g){this.loader=void 0,this.loader=new o(g)}var A=P.prototype;return A.destroy=function(){this.loader.destroy()},A.abort=function(){this.loader.abort()},A.load=function(t,f,x){y(t),this.loader.load(t,f,x)},I(P,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),P}()},F.uuid=function(){var u=URL.createObjectURL(new Blob),y=u.toString();return URL.revokeObjectURL(u),y.substr(y.lastIndexOf("/")+1)},F.serialize=function(u){for(var y=[],o=function(K){return!Number.isNaN(K)&&K!=null&&K!==""&&K!==!1},P=function(K){return Math.round(K)},A=function(K){return P(K/100)*100},g=function(K){return encodeURIComponent(K)},t={br:P,d:P,bl:A,dl:A,mtp:A,nor:g,rtp:A,tb:P},f=Object.keys(u||{}).sort(),x=M(f),m;!(m=x()).done;){var a=m.value,c=u[a];if(!!o(c)&&!(a==="v"&&c===1)&&!(a=="pr"&&c===1)){var L=t[a];L&&(c=L(c));var _=typeof c,B=void 0;a==="ot"||a==="sf"||a==="st"?B=a+"="+c:_==="boolean"?B=a:_==="number"?B=a+"="+c:B=a+"="+JSON.stringify(c),y.push(B)}}return y.join(",")},F.toHeaders=function(u){for(var y=Object.keys(u),o={},P=["Object","Request","Session","Status"],A=[{},{},{},{}],g={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},t=0,f=y;t<f.length;t++){var x=f[t],m=g[x]!=null?g[x]:1;A[m][x]=u[x]}for(var a=0;a<A.length;a++){var c=F.serialize(A[a]);c&&(o["CMCD-"+P[a]]=c)}return o},F.toQuery=function(u){return"CMCD="+encodeURIComponent(F.serialize(u))},F.appendQueryToUri=function(u,y){if(!y)return u;var o=u.includes("?")?"&":"?";return""+u+o+y},F}()},"./src/controller/eme-controller.ts":function(S,l,r){r.r(l);var R=r("./src/events.ts"),T=r("./src/errors.ts"),O=r("./src/utils/logger.ts"),N=r("./src/utils/mediakeys-helper.ts");function U(k,F){for(var D=0;D<F.length;D++){var E=F[D];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(k,E.key,E)}}function I(k,F,D){return F&&U(k.prototype,F),D&&U(k,D),k}var M=3,C=function(F,D,E){var u={audioCapabilities:[],videoCapabilities:[]};return F.forEach(function(y){u.audioCapabilities.push({contentType:'audio/mp4; codecs="'+y+'"',robustness:E.audioRobustness||""})}),D.forEach(function(y){u.videoCapabilities.push({contentType:'video/mp4; codecs="'+y+'"',robustness:E.videoRobustness||""})}),[u]},w=function(F,D,E,u){switch(F){case N.KeySystems.WIDEVINE:return C(D,E,u);default:throw new Error("Unknown key-system: "+F)}},v=function(){function k(D){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=D,this._config=D.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var F=k.prototype;return F.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},F._registerListeners=function(){this.hls.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(R.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this)},F._unregisterListeners=function(){this.hls.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(R.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this)},F.getLicenseServerUrl=function(E){switch(E){case N.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+E+'"')},F._attemptKeySystemAccess=function(E,u,y){var o=this,P=w(E,u,y,this._drmSystemOptions);O.logger.log("Requesting encrypted media key-system access");var A=this.requestMediaKeySystemAccess(E,P);this.mediaKeysPromise=A.then(function(g){return o._onMediaKeySystemAccessObtained(E,g)}),A.catch(function(g){O.logger.error('Failed to obtain key-system "'+E+'" access:',g)})},F._onMediaKeySystemAccessObtained=function(E,u){var y=this;O.logger.log('Access for key-system "'+E+'" obtained');var o={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:u,mediaKeySystemDomain:E};this._mediaKeysList.push(o);var P=Promise.resolve().then(function(){return u.createMediaKeys()}).then(function(A){return o.mediaKeys=A,O.logger.log('Media-keys created for key-system "'+E+'"'),y._onMediaKeysCreated(),A});return P.catch(function(A){O.logger.error("Failed to create media-keys:",A)}),P},F._onMediaKeysCreated=function(){var E=this;this._mediaKeysList.forEach(function(u){u.mediaKeysSession||(u.mediaKeysSession=u.mediaKeys.createSession(),E._onNewMediaKeySession(u.mediaKeysSession))})},F._onNewMediaKeySession=function(E){var u=this;O.logger.log("New key-system session "+E.sessionId),E.addEventListener("message",function(y){u._onKeySessionMessage(E,y.message)},!1)},F._onKeySessionMessage=function(E,u){O.logger.log("Got EME message event, creating license request"),this._requestLicense(u,function(y){O.logger.log("Received license data (length: "+(y&&y.byteLength)+"), updating key-session"),E.update(y)})},F.onMediaEncrypted=function(E){var u=this;if(O.logger.log('Media is encrypted using "'+E.initDataType+'" init data type'),!this.mediaKeysPromise){O.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(R.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var y=function(P){!u._media||(u._attemptSetMediaKeys(P),u._generateRequestWithPreferredKeySession(E.initDataType,E.initData))};this.mediaKeysPromise.then(y).catch(y)},F._attemptSetMediaKeys=function(E){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var u=this._mediaKeysList[0];if(!u||!u.mediaKeys){O.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(R.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}O.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(u.mediaKeys),this._hasSetMediaKeys=!0}},F._generateRequestWithPreferredKeySession=function(E,u){var y=this,o=this._mediaKeysList[0];if(!o){O.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(R.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(o.mediaKeysSessionInitialized){O.logger.warn("Key-Session already initialized but requested again");return}var P=o.mediaKeysSession;if(!P){O.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(R.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!u){O.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(R.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}O.logger.log('Generating key-session request for "'+E+'" init data type'),o.mediaKeysSessionInitialized=!0,P.generateRequest(E,u).then(function(){O.logger.debug("Key-session generation succeeded")}).catch(function(A){O.logger.error("Error generating key-session request:",A),y.hls.trigger(R.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},F._createLicenseXhr=function(E,u,y){var o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,o,E,u,y);var P=this._licenseXhrSetup;if(P)try{P.call(this.hls,o,E),P=void 0}catch(A){O.logger.error(A)}try{o.readyState||o.open("POST",E,!0),P&&P.call(this.hls,o,E)}catch(A){throw new Error("issue setting up KeySystem license XHR "+A)}return o},F._onLicenseRequestReadyStageChange=function(E,u,y,o){switch(E.readyState){case 4:if(E.status===200){this._requestLicenseFailureCount=0,O.logger.log("License request succeeded");var P=E.response,A=this._licenseResponseCallback;if(A)try{P=A.call(this.hls,E,u)}catch(t){O.logger.error(t)}o(P)}else{if(O.logger.error("License Request XHR failed ("+u+"). Status: "+E.status+" ("+E.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>M){this.hls.trigger(R.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var g=M-this._requestLicenseFailureCount+1;O.logger.warn("Retrying license request, "+g+" attempts left"),this._requestLicense(y,o)}break}},F._generateLicenseRequestChallenge=function(E,u){switch(E.mediaKeySystemDomain){case N.KeySystems.WIDEVINE:return u}throw new Error("unsupported key-system: "+E.mediaKeySystemDomain)},F._requestLicense=function(E,u){O.logger.log("Requesting content license for key-system");var y=this._mediaKeysList[0];if(!y){O.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(R.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var o=this.getLicenseServerUrl(y.mediaKeySystemDomain),P=this._createLicenseXhr(o,E,u);O.logger.log("Sending license request to URL: "+o);var A=this._generateLicenseRequestChallenge(y,E);P.send(A)}catch(g){O.logger.error("Failure requesting DRM license: "+g),this.hls.trigger(R.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},F.onMediaAttached=function(E,u){if(!!this._emeEnabled){var y=u.media;this._media=y,y.addEventListener("encrypted",this._onMediaEncrypted)}},F.onMediaDetached=function(){var E=this._media,u=this._mediaKeysList;!E||(E.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(u.map(function(y){if(y.mediaKeysSession)return y.mediaKeysSession.close().catch(function(){})})).then(function(){return E.setMediaKeys(null)}).catch(function(){}))},F.onManifestParsed=function(E,u){if(!!this._emeEnabled){var y=u.levels.map(function(P){return P.audioCodec}).filter(function(P){return!!P}),o=u.levels.map(function(P){return P.videoCodec}).filter(function(P){return!!P});this._attemptKeySystemAccess(N.KeySystems.WIDEVINE,y,o)}},I(k,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),k}();l.default=v},"./src/controller/fps-controller.ts":function(S,l,r){r.r(l);var R=r("./src/events.ts"),T=r("./src/utils/logger.ts"),O=function(){function N(I){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=I,this.registerListeners()}var U=N.prototype;return U.setStreamController=function(M){this.streamController=M},U.registerListeners=function(){this.hls.on(R.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},U.unregisterListeners=function(){this.hls.off(R.Events.MEDIA_ATTACHING,this.onMediaAttaching)},U.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},U.onMediaAttaching=function(M,C){var w=this.hls.config;if(w.capLevelOnFPSDrop){var v=C.media instanceof self.HTMLVideoElement?C.media:null;this.media=v,v&&typeof v.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),w.fpsDroppedMonitoringPeriod)}},U.checkFPS=function(M,C,w){var v=performance.now();if(C){if(this.lastTime){var k=v-this.lastTime,F=w-this.lastDroppedFrames,D=C-this.lastDecodedFrames,E=1e3*F/k,u=this.hls;if(u.trigger(R.Events.FPS_DROP,{currentDropped:F,currentDecoded:D,totalDroppedFrames:w}),E>0&&F>u.config.fpsDroppedMonitoringThreshold*D){var y=u.currentLevel;T.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+y),y>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=y)&&(y=y-1,u.trigger(R.Events.FPS_DROP_LEVEL_CAPPING,{level:y,droppedLevel:u.currentLevel}),u.autoLevelCapping=y,this.streamController.nextLevelSwitch())}}this.lastTime=v,this.lastDroppedFrames=w,this.lastDecodedFrames=C}},U.checkFPSInterval=function(){var M=this.media;if(M)if(this.isVideoPlaybackQualityAvailable){var C=M.getVideoPlaybackQuality();this.checkFPS(M,C.totalVideoFrames,C.droppedVideoFrames)}else this.checkFPS(M,M.webkitDecodedFrameCount,M.webkitDroppedFrameCount)},N}();l.default=O},"./src/controller/fragment-finders.ts":function(S,l,r){r.r(l),r.d(l,"findFragmentByPDT",function(){return O}),r.d(l,"findFragmentByPTS",function(){return N}),r.d(l,"fragmentWithinToleranceTest",function(){return U}),r.d(l,"pdtWithinToleranceTest",function(){return I}),r.d(l,"findFragWithCC",function(){return M});var R=r("./src/polyfills/number.ts"),T=r("./src/utils/binary-search.ts");function O(C,w,v){if(w===null||!Array.isArray(C)||!C.length||!Object(R.isFiniteNumber)(w))return null;var k=C[0].programDateTime;if(w<(k||0))return null;var F=C[C.length-1].endProgramDateTime;if(w>=(F||0))return null;v=v||0;for(var D=0;D<C.length;++D){var E=C[D];if(I(w,v,E))return E}return null}function N(C,w,v,k){v===void 0&&(v=0),k===void 0&&(k=0);var F=null;if(C?F=w[C.sn-w[0].sn+1]||null:v===0&&w[0].start===0&&(F=w[0]),F&&U(v,k,F)===0)return F;var D=T.default.search(w,U.bind(null,v,k));return D||F}function U(C,w,v){C===void 0&&(C=0),w===void 0&&(w=0);var k=Math.min(w,v.duration+(v.deltaPTS?v.deltaPTS:0));return v.start+v.duration-k<=C?1:v.start-k>C&&v.start?-1:0}function I(C,w,v){var k=Math.min(w,v.duration+(v.deltaPTS?v.deltaPTS:0))*1e3,F=v.endProgramDateTime||0;return F-k>C}function M(C,w){return T.default.search(C,function(v){return v.cc<w?1:v.cc>w?-1:0})}},"./src/controller/fragment-tracker.ts":function(S,l,r){r.r(l),r.d(l,"FragmentState",function(){return O}),r.d(l,"FragmentTracker",function(){return N});var R=r("./src/events.ts"),T=r("./src/types/loader.ts"),O;(function(M){M.NOT_LOADED="NOT_LOADED",M.BACKTRACKED="BACKTRACKED",M.APPENDING="APPENDING",M.PARTIAL="PARTIAL",M.OK="OK"})(O||(O={}));var N=function(){function M(w){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=w,this._registerListeners()}var C=M.prototype;return C._registerListeners=function(){var v=this.hls;v.on(R.Events.BUFFER_APPENDED,this.onBufferAppended,this),v.on(R.Events.FRAG_BUFFERED,this.onFragBuffered,this),v.on(R.Events.FRAG_LOADED,this.onFragLoaded,this)},C._unregisterListeners=function(){var v=this.hls;v.off(R.Events.BUFFER_APPENDED,this.onBufferAppended,this),v.off(R.Events.FRAG_BUFFERED,this.onFragBuffered,this),v.off(R.Events.FRAG_LOADED,this.onFragLoaded,this)},C.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},C.getAppendedFrag=function(v,k){if(k===T.PlaylistLevelType.MAIN){var F=this.activeFragment,D=this.activeParts;if(!F)return null;if(D)for(var E=D.length;E--;){var u=D[E],y=u?u.end:F.appendedPTS;if(u.start<=v&&y!==void 0&&v<=y)return E>9&&(this.activeParts=D.slice(E-9)),u}else if(F.start<=v&&F.appendedPTS!==void 0&&v<=F.appendedPTS)return F}return this.getBufferedFrag(v,k)},C.getBufferedFrag=function(v,k){for(var F=this.fragments,D=Object.keys(F),E=D.length;E--;){var u=F[D[E]];if((u==null?void 0:u.body.type)===k&&u.buffered){var y=u.body;if(y.start<=v&&v<=y.end)return y}}return null},C.detectEvictedFragments=function(v,k,F){var D=this;Object.keys(this.fragments).forEach(function(E){var u=D.fragments[E];if(!!u){if(!u.buffered){u.body.type===F&&D.removeFragment(u.body);return}var y=u.range[v];!y||y.time.some(function(o){var P=!D.isTimeBuffered(o.startPTS,o.endPTS,k);return P&&D.removeFragment(u.body),P})}})},C.detectPartialFragments=function(v){var k=this,F=this.timeRanges,D=v.frag,E=v.part;if(!(!F||D.sn==="initSegment")){var u=I(D),y=this.fragments[u];!y||(Object.keys(F).forEach(function(o){var P=D.elementaryStreams[o];if(!!P){var A=F[o],g=E!==null||P.partial===!0;y.range[o]=k.getBufferedTimes(D,E,g,A)}}),y.backtrack=y.loaded=null,Object.keys(y.range).length?y.buffered=!0:this.removeFragment(y.body))}},C.fragBuffered=function(v){var k=I(v),F=this.fragments[k];F&&(F.backtrack=F.loaded=null,F.buffered=!0)},C.getBufferedTimes=function(v,k,F,D){for(var E={time:[],partial:F},u=k?k.start:v.start,y=k?k.end:v.end,o=v.minEndPTS||y,P=v.maxStartPTS||u,A=0;A<D.length;A++){var g=D.start(A)-this.bufferPadding,t=D.end(A)+this.bufferPadding;if(P>=g&&o<=t){E.time.push({startPTS:Math.max(u,D.start(A)),endPTS:Math.min(y,D.end(A))});break}else if(u<t&&y>g)E.partial=!0,E.time.push({startPTS:Math.max(u,D.start(A)),endPTS:Math.min(y,D.end(A))});else if(y<=g)break}return E},C.getPartialFragment=function(v){var k=null,F,D,E,u=0,y=this.bufferPadding,o=this.fragments;return Object.keys(o).forEach(function(P){var A=o[P];!A||U(A)&&(D=A.body.start-y,E=A.body.end+y,v>=D&&v<=E&&(F=Math.min(v-D,E-v),u<=F&&(k=A.body,u=F)))}),k},C.getState=function(v){var k=I(v),F=this.fragments[k];return F?F.buffered?U(F)?O.PARTIAL:O.OK:F.backtrack?O.BACKTRACKED:O.APPENDING:O.NOT_LOADED},C.backtrack=function(v,k){var F=I(v),D=this.fragments[F];if(!D||D.backtrack)return null;var E=D.backtrack=k||D.loaded;return D.loaded=null,E},C.getBacktrackData=function(v){var k=I(v),F=this.fragments[k];if(F){var D,E=F.backtrack;if(E!=null&&(D=E.payload)!==null&&D!==void 0&&D.byteLength)return E;this.removeFragment(v)}return null},C.isTimeBuffered=function(v,k,F){for(var D,E,u=0;u<F.length;u++){if(D=F.start(u)-this.bufferPadding,E=F.end(u)+this.bufferPadding,v>=D&&k<=E)return!0;if(k<=D)return!1}return!1},C.onFragLoaded=function(v,k){var F=k.frag,D=k.part;if(!(F.sn==="initSegment"||F.bitrateTest||D)){var E=I(F);this.fragments[E]={body:F,loaded:k,backtrack:null,buffered:!1,range:Object.create(null)}}},C.onBufferAppended=function(v,k){var F=this,D=k.frag,E=k.part,u=k.timeRanges;if(D.type===T.PlaylistLevelType.MAIN)if(this.activeFragment=D,E){var y=this.activeParts;y||(this.activeParts=y=[]),y.push(E)}else this.activeParts=null;this.timeRanges=u,Object.keys(u).forEach(function(o){var P=u[o];if(F.detectEvictedFragments(o,P),!E)for(var A=0;A<P.length;A++)D.appendedPTS=Math.max(P.end(A),D.appendedPTS||0)})},C.onFragBuffered=function(v,k){this.detectPartialFragments(k)},C.hasFragment=function(v){var k=I(v);return!!this.fragments[k]},C.removeFragmentsInRange=function(v,k,F){var D=this;Object.keys(this.fragments).forEach(function(E){var u=D.fragments[E];if(!!u&&u.buffered){var y=u.body;y.type===F&&y.start<k&&y.end>v&&D.removeFragment(y)}})},C.removeFragment=function(v){var k=I(v);v.stats.loaded=0,v.clearElementaryStreamInfo(),delete this.fragments[k]},C.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},M}();function U(M){var C,w;return M.buffered&&(((C=M.range.video)===null||C===void 0?void 0:C.partial)||((w=M.range.audio)===null||w===void 0?void 0:w.partial))}function I(M){return M.type+"_"+M.level+"_"+M.urlId+"_"+M.sn}},"./src/controller/gap-controller.ts":function(S,l,r){r.r(l),r.d(l,"STALL_MINIMUM_DURATION_MS",function(){return U}),r.d(l,"MAX_START_GAP_JUMP",function(){return I}),r.d(l,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return M}),r.d(l,"SKIP_BUFFER_RANGE_START",function(){return C}),r.d(l,"default",function(){return w});var R=r("./src/utils/buffer-helper.ts"),T=r("./src/errors.ts"),O=r("./src/events.ts"),N=r("./src/utils/logger.ts"),U=250,I=2,M=.1,C=.05,w=function(){function v(F,D,E,u){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=F,this.media=D,this.fragmentTracker=E,this.hls=u}var k=v.prototype;return k.destroy=function(){this.hls=this.fragmentTracker=this.media=null},k.poll=function(D){var E=this.config,u=this.media,y=this.stalled,o=u.currentTime,P=u.seeking,A=this.seeking&&!P,g=!this.seeking&&P;if(this.seeking=P,o!==D){if(this.moved=!0,y!==null){if(this.stallReported){var t=self.performance.now()-y;N.logger.warn("playback not stuck anymore @"+o+", after "+Math.round(t)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((g||A)&&(this.stalled=null),!(u.paused||u.ended||u.playbackRate===0||!R.BufferHelper.getBuffered(u).length)){var f=R.BufferHelper.bufferInfo(u,o,0),x=f.len>0,m=f.nextStart||0;if(!(!x&&!m)){if(P){var a=f.len>I,c=!m||m-o>I&&!this.fragmentTracker.getPartialFragment(o);if(a||c)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var L,_=Math.max(m,f.start||0)-o,B=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,$=B==null||(L=B.details)===null||L===void 0?void 0:L.live,K=$?B.details.targetduration*2:I;if(_>0&&_<=K){this._trySkipBufferHole(null);return}}var H=self.performance.now();if(y===null){this.stalled=H;return}var j=H-y;!P&&j>=U&&this._reportStall(f.len);var W=R.BufferHelper.bufferInfo(u,o,E.maxBufferHole);this._tryFixBufferStall(W,j)}}},k._tryFixBufferStall=function(D,E){var u=this.config,y=this.fragmentTracker,o=this.media,P=o.currentTime,A=y.getPartialFragment(P);if(A){var g=this._trySkipBufferHole(A);if(g)return}D.len>u.maxBufferHole&&E>u.highBufferWatchdogPeriod*1e3&&(N.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},k._reportStall=function(D){var E=this.hls,u=this.media,y=this.stallReported;y||(this.stallReported=!0,N.logger.warn("Playback stalling at @"+u.currentTime+" due to low buffer (buffer="+D+")"),E.trigger(O.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:D}))},k._trySkipBufferHole=function(D){for(var E=this.config,u=this.hls,y=this.media,o=y.currentTime,P=0,A=R.BufferHelper.getBuffered(y),g=0;g<A.length;g++){var t=A.start(g);if(o+E.maxBufferHole>=P&&o<t){var f=Math.max(t+C,y.currentTime+M);return N.logger.warn("skipping hole, adjusting currentTime from "+o+" to "+f),this.moved=!0,this.stalled=null,y.currentTime=f,D&&u.trigger(O.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+o+" to "+f,frag:D}),f}P=A.end(g)}return 0},k._tryNudgeBuffer=function(){var D=this.config,E=this.hls,u=this.media,y=u.currentTime,o=(this.nudgeRetry||0)+1;if(this.nudgeRetry=o,o<D.nudgeMaxRetry){var P=y+o*D.nudgeOffset;N.logger.warn("Nudging 'currentTime' from "+y+" to "+P),u.currentTime=P,E.trigger(O.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else N.logger.error("Playhead still not moving while enough data buffered @"+y+" after "+D.nudgeMaxRetry+" nudges"),E.trigger(O.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},v}()},"./src/controller/id3-track-controller.ts":function(S,l,r){r.r(l);var R=r("./src/events.ts"),T=r("./src/utils/texttrack-utils.ts"),O=r("./src/demux/id3.ts"),N=.25,U=function(){function I(C){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=C,this._registerListeners()}var M=I.prototype;return M.destroy=function(){this._unregisterListeners()},M._registerListeners=function(){var w=this.hls;w.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),w.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),w.on(R.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),w.on(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},M._unregisterListeners=function(){var w=this.hls;w.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),w.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),w.off(R.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),w.off(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},M.onMediaAttached=function(w,v){this.media=v.media},M.onMediaDetaching=function(){!this.id3Track||(Object(T.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},M.getID3Track=function(w){if(!!this.media){for(var v=0;v<w.length;v++){var k=w[v];if(k.kind==="metadata"&&k.label==="id3")return Object(T.sendAddTrackEvent)(k,this.media),k}return this.media.addTextTrack("metadata","id3")}},M.onFragParsingMetadata=function(w,v){if(!!this.media){var k=v.frag,F=v.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var D=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,E=0;E<F.length;E++){var u=O.getID3Frames(F[E].data);if(u){var y=F[E].pts,o=E<F.length-1?F[E+1].pts:k.end,P=o-y;P<=0&&(o=y+N);for(var A=0;A<u.length;A++){var g=u[A];if(!O.isTimeStampFrame(g)){var t=new D(y,o,"");t.value=g,this.id3Track.addCue(t)}}}}}},M.onBufferFlushing=function(w,v){var k=v.startOffset,F=v.endOffset,D=v.type;if(!D||D==="audio"){var E=this.id3Track;E&&Object(T.removeCuesInRange)(E,k,F)}},I}();l.default=U},"./src/controller/latency-controller.ts":function(S,l,r){r.r(l),r.d(l,"default",function(){return I});var R=r("./src/errors.ts"),T=r("./src/events.ts"),O=r("./src/utils/logger.ts");function N(M,C){for(var w=0;w<C.length;w++){var v=C[w];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(M,v.key,v)}}function U(M,C,w){return C&&N(M.prototype,C),w&&N(M,w),M}var I=function(){function M(w){var v=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return v.timeupdate()},this.hls=w,this.config=w.config,this.registerListeners()}var C=M.prototype;return C.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},C.registerListeners=function(){this.hls.on(T.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(T.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(T.Events.ERROR,this.onError,this)},C.unregisterListeners=function(){this.hls.off(T.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(T.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(T.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(T.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(T.Events.ERROR,this.onError)},C.onMediaAttached=function(v,k){this.media=k.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},C.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},C.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},C.onLevelUpdated=function(v,k){var F=k.details;this.levelDetails=F,F.advanced&&this.timeupdate(),!F.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},C.onError=function(v,k){k.details===R.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,O.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},C.timeupdate=function(){var v=this.media,k=this.levelDetails;if(!(!v||!k)){this.currentTime=v.currentTime;var F=this.computeLatency();if(F!==null){this._latency=F;var D=this.config,E=D.lowLatencyMode,u=D.maxLiveSyncPlaybackRate;if(!(!E||u===1)){var y=this.targetLatency;if(y!==null){var o=F-y,P=Math.min(this.maxLatency,y+k.targetduration),A=o<P;if(k.live&&A&&o>.05&&this.forwardBufferLength>1){var g=Math.min(2,Math.max(1,u)),t=Math.round(2/(1+Math.exp(-.75*o-this.edgeStalled))*20)/20;v.playbackRate=Math.min(g,Math.max(1,t))}else v.playbackRate!==1&&v.playbackRate!==0&&(v.playbackRate=1)}}}}},C.estimateLiveEdge=function(){var v=this.levelDetails;return v===null?null:v.edge+v.age},C.computeLatency=function(){var v=this.estimateLiveEdge();return v===null?null:v-this.currentTime},U(M,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var v=this.config,k=this.levelDetails;return v.liveMaxLatencyDuration!==void 0?v.liveMaxLatencyDuration:k?v.liveMaxLatencyDurationCount*k.targetduration:0}},{key:"targetLatency",get:function(){var v=this.levelDetails;if(v===null)return null;var k=v.holdBack,F=v.partHoldBack,D=v.targetduration,E=this.config,u=E.liveSyncDuration,y=E.liveSyncDurationCount,o=E.lowLatencyMode,P=this.hls.userConfig,A=o&&F||k;(P.liveSyncDuration||P.liveSyncDurationCount||A===0)&&(A=u!==void 0?u:y*D);var g=D,t=1;return A+Math.min(this.stallCount*t,g)}},{key:"liveSyncPosition",get:function(){var v=this.estimateLiveEdge(),k=this.targetLatency,F=this.levelDetails;if(v===null||k===null||F===null)return null;var D=F.edge,E=v-k-this.edgeStalled,u=D-F.totalduration,y=D-(this.config.lowLatencyMode&&F.partTarget||F.targetduration);return Math.min(Math.max(u,E),y)}},{key:"drift",get:function(){var v=this.levelDetails;return v===null?1:v.drift}},{key:"edgeStalled",get:function(){var v=this.levelDetails;if(v===null)return 0;var k=(this.config.lowLatencyMode&&v.partTarget||v.targetduration)*3;return Math.max(v.age-k,0)}},{key:"forwardBufferLength",get:function(){var v=this.media,k=this.levelDetails;if(!v||!k)return 0;var F=v.buffered.length;return F?v.buffered.end(F-1):k.edge-this.currentTime}}]),M}()},"./src/controller/level-controller.ts":function(S,l,r){r.r(l),r.d(l,"default",function(){return E});var R=r("./src/types/level.ts"),T=r("./src/events.ts"),O=r("./src/errors.ts"),N=r("./src/utils/codecs.ts"),U=r("./src/controller/level-helper.ts"),I=r("./src/controller/base-playlist-controller.ts"),M=r("./src/types/loader.ts");function C(){return C=Object.assign||function(u){for(var y=1;y<arguments.length;y++){var o=arguments[y];for(var P in o)Object.prototype.hasOwnProperty.call(o,P)&&(u[P]=o[P])}return u},C.apply(this,arguments)}function w(u,y){for(var o=0;o<y.length;o++){var P=y[o];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(u,P.key,P)}}function v(u,y,o){return y&&w(u.prototype,y),o&&w(u,o),u}function k(u,y){u.prototype=Object.create(y.prototype),u.prototype.constructor=u,F(u,y)}function F(u,y){return F=Object.setPrototypeOf||function(P,A){return P.__proto__=A,P},F(u,y)}var D=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),E=function(u){k(y,u);function y(P){var A;return A=u.call(this,P,"[level-controller]")||this,A._levels=[],A._firstLevel=-1,A._startLevel=void 0,A.currentLevelIndex=-1,A.manualLevelIndex=-1,A.onParsedComplete=void 0,A._registerListeners(),A}var o=y.prototype;return o._registerListeners=function(){var A=this.hls;A.on(T.Events.MANIFEST_LOADED,this.onManifestLoaded,this),A.on(T.Events.LEVEL_LOADED,this.onLevelLoaded,this),A.on(T.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),A.on(T.Events.FRAG_LOADED,this.onFragLoaded,this),A.on(T.Events.ERROR,this.onError,this)},o._unregisterListeners=function(){var A=this.hls;A.off(T.Events.MANIFEST_LOADED,this.onManifestLoaded,this),A.off(T.Events.LEVEL_LOADED,this.onLevelLoaded,this),A.off(T.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),A.off(T.Events.FRAG_LOADED,this.onFragLoaded,this),A.off(T.Events.ERROR,this.onError,this)},o.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,u.prototype.destroy.call(this)},o.startLoad=function(){var A=this._levels;A.forEach(function(g){g.loadError=0}),u.prototype.startLoad.call(this)},o.onManifestLoaded=function(A,g){var t=[],f=[],x=[],m,a={},c,L=!1,_=!1,B=!1;if(g.levels.forEach(function(j){var W=j.attrs;L=L||!!(j.width&&j.height),_=_||!!j.videoCodec,B=B||!!j.audioCodec,D&&j.audioCodec&&j.audioCodec.indexOf("mp4a.40.34")!==-1&&(j.audioCodec=void 0);var z=j.bitrate+"-"+j.attrs.RESOLUTION+"-"+j.attrs.CODECS;c=a[z],c?c.url.push(j.url):(c=new R.Level(j),a[z]=c,t.push(c)),W&&(W.AUDIO&&Object(U.addGroupId)(c,"audio",W.AUDIO),W.SUBTITLES&&Object(U.addGroupId)(c,"text",W.SUBTITLES))}),(L||_)&&B&&(t=t.filter(function(j){var W=j.videoCodec,z=j.width,Q=j.height;return!!W||!!(z&&Q)})),t=t.filter(function(j){var W=j.audioCodec,z=j.videoCodec;return(!W||Object(N.isCodecSupportedInMp4)(W,"audio"))&&(!z||Object(N.isCodecSupportedInMp4)(z,"video"))}),g.audioTracks&&(f=g.audioTracks.filter(function(j){return!j.audioCodec||Object(N.isCodecSupportedInMp4)(j.audioCodec,"audio")}),Object(U.assignTrackIdsByGroup)(f)),g.subtitles&&(x=g.subtitles,Object(U.assignTrackIdsByGroup)(x)),t.length>0){m=t[0].bitrate,t.sort(function(j,W){return j.bitrate-W.bitrate}),this._levels=t;for(var $=0;$<t.length;$++)if(t[$].bitrate===m){this._firstLevel=$,this.log("manifest loaded, "+t.length+" level(s) found, first bitrate: "+m);break}var K=B&&!_,H={levels:t,audioTracks:f,subtitleTracks:x,firstLevel:this._firstLevel,stats:g.stats,audio:B,video:_,altAudio:!K&&f.some(function(j){return!!j.url})};this.hls.trigger(T.Events.MANIFEST_PARSED,H),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(T.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:g.url,reason:"no level with compatible codecs found in manifest"})},o.onError=function(A,g){if(u.prototype.onError.call(this,A,g),!g.fatal){var t=g.context,f=this._levels[this.currentLevelIndex];if(t&&(t.type===M.PlaylistContextType.AUDIO_TRACK&&f.audioGroupIds&&t.groupId===f.audioGroupIds[f.urlId]||t.type===M.PlaylistContextType.SUBTITLE_TRACK&&f.textGroupIds&&t.groupId===f.textGroupIds[f.urlId])){this.redundantFailover(this.currentLevelIndex);return}var x=!1,m=!0,a;switch(g.details){case O.ErrorDetails.FRAG_LOAD_ERROR:case O.ErrorDetails.FRAG_LOAD_TIMEOUT:case O.ErrorDetails.KEY_LOAD_ERROR:case O.ErrorDetails.KEY_LOAD_TIMEOUT:if(g.frag){var c=this._levels[g.frag.level];c?(c.fragmentError++,c.fragmentError>this.hls.config.fragLoadingMaxRetry&&(a=g.frag.level)):a=g.frag.level}break;case O.ErrorDetails.LEVEL_LOAD_ERROR:case O.ErrorDetails.LEVEL_LOAD_TIMEOUT:t&&(t.deliveryDirectives&&(m=!1),a=t.level),x=!0;break;case O.ErrorDetails.REMUX_ALLOC_ERROR:a=g.level,x=!0;break}a!==void 0&&this.recoverLevel(g,a,x,m)}},o.recoverLevel=function(A,g,t,f){var x=A.details,m=this._levels[g];if(m.loadError++,t){var a=this.retryLoadingOrFail(A);if(a)A.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(f){var c=m.url.length;if(c>1&&m.loadError<c)A.levelRetry=!0,this.redundantFailover(g);else if(this.manualLevelIndex===-1){var L=g===0?this._levels.length-1:g-1;this.currentLevelIndex!==L&&this._levels[L].loadError===0&&(this.warn(x+": switch to "+L),A.levelRetry=!0,this.hls.nextAutoLevel=L)}}},o.redundantFailover=function(A){var g=this._levels[A],t=g.url.length;if(t>1){var f=(g.urlId+1)%t;this.warn("Switching to redundant URL-id "+f),this._levels.forEach(function(x){x.urlId=f}),this.level=A}},o.onFragLoaded=function(A,g){var t=g.frag;if(t!==void 0&&t.type===M.PlaylistLevelType.MAIN){var f=this._levels[t.level];f!==void 0&&(f.fragmentError=0,f.loadError=0)}},o.onLevelLoaded=function(A,g){var t,f=g.level,x=g.details,m=this._levels[f];if(!m){var a;this.warn("Invalid level index "+f),(a=g.deliveryDirectives)!==null&&a!==void 0&&a.skip&&(x.deltaUpdateFailed=!0);return}f===this.currentLevelIndex?(m.fragmentError===0&&(m.loadError=0,this.retryCount=0),this.playlistLoaded(f,g,m.details)):(t=g.deliveryDirectives)!==null&&t!==void 0&&t.skip&&(x.deltaUpdateFailed=!0)},o.onAudioTrackSwitched=function(A,g){var t=this.hls.levels[this.currentLevelIndex];if(!!t&&t.audioGroupIds){for(var f=-1,x=this.hls.audioTracks[g.id].groupId,m=0;m<t.audioGroupIds.length;m++)if(t.audioGroupIds[m]===x){f=m;break}f!==t.urlId&&(t.urlId=f,this.startLoad())}},o.loadPlaylist=function(A){var g=this.currentLevelIndex,t=this._levels[g];if(this.canLoad&&t&&t.url.length>0){var f=t.urlId,x=t.url[f];if(A)try{x=A.addDirectives(x)}catch(m){this.warn("Could not construct new URL with HLS Delivery Directives: "+m)}this.log("Attempt loading level index "+g+(A?" at sn "+A.msn+" part "+A.part:"")+" with URL-id "+f+" "+x),this.clearTimer(),this.hls.trigger(T.Events.LEVEL_LOADING,{url:x,level:g,id:f,deliveryDirectives:A||null})}},o.removeLevel=function(A,g){var t=function(m,a){return a!==g},f=this._levels.filter(function(x,m){return m!==A?!0:x.url.length>1&&g!==void 0?(x.url=x.url.filter(t),x.audioGroupIds&&(x.audioGroupIds=x.audioGroupIds.filter(t)),x.textGroupIds&&(x.textGroupIds=x.textGroupIds.filter(t)),x.urlId=0,!0):!1}).map(function(x,m){var a=x.details;return a!=null&&a.fragments&&a.fragments.forEach(function(c){c.level=m}),x});this._levels=f,this.hls.trigger(T.Events.LEVELS_UPDATED,{levels:f})},v(y,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(A){var g,t=this._levels;if(t.length!==0&&!(this.currentLevelIndex===A&&(g=t[A])!==null&&g!==void 0&&g.details)){if(A<0||A>=t.length){var f=A<0;if(this.hls.trigger(T.Events.ERROR,{type:O.ErrorTypes.OTHER_ERROR,details:O.ErrorDetails.LEVEL_SWITCH_ERROR,level:A,fatal:f,reason:"invalid level idx"}),f)return;A=Math.min(A,t.length-1)}this.clearTimer();var x=this.currentLevelIndex,m=t[x],a=t[A];this.log("switching to level "+A+" from "+x),this.currentLevelIndex=A;var c=C({},a,{level:A,maxBitrate:a.maxBitrate,uri:a.uri,urlId:a.urlId});delete c._urlId,this.hls.trigger(T.Events.LEVEL_SWITCHING,c);var L=a.details;if(!L||L.live){var _=this.switchParams(a.uri,m==null?void 0:m.details);this.loadPlaylist(_)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(A){this.manualLevelIndex=A,this._startLevel===void 0&&(this._startLevel=A),A!==-1&&(this.level=A)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(A){this._firstLevel=A}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var A=this.hls.config.startLevel;return A!==void 0?A:this._firstLevel}else return this._startLevel},set:function(A){this._startLevel=A}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(A){this.level=A,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=A)}}]),y}(I.default)},"./src/controller/level-helper.ts":function(S,l,r){r.r(l),r.d(l,"addGroupId",function(){return O}),r.d(l,"assignTrackIdsByGroup",function(){return N}),r.d(l,"updatePTS",function(){return U}),r.d(l,"updateFragPTSDTS",function(){return M}),r.d(l,"mergeDetails",function(){return C}),r.d(l,"mapPartIntersection",function(){return w}),r.d(l,"mapFragmentIntersection",function(){return v}),r.d(l,"adjustSliding",function(){return k}),r.d(l,"addSliding",function(){return F}),r.d(l,"computeReloadInterval",function(){return D}),r.d(l,"getFragmentWithSN",function(){return E}),r.d(l,"getPartWith",function(){return u});var R=r("./src/polyfills/number.ts"),T=r("./src/utils/logger.ts");function O(y,o,P){switch(o){case"audio":y.audioGroupIds||(y.audioGroupIds=[]),y.audioGroupIds.push(P);break;case"text":y.textGroupIds||(y.textGroupIds=[]),y.textGroupIds.push(P);break}}function N(y){var o={};y.forEach(function(P){var A=P.groupId||"";P.id=o[A]=o[A]||0,o[A]++})}function U(y,o,P){var A=y[o],g=y[P];I(A,g)}function I(y,o){var P=o.startPTS;if(Object(R.isFiniteNumber)(P)){var A=0,g;o.sn>y.sn?(A=P-y.start,g=y):(A=y.start-P,g=o),g.duration!==A&&(g.duration=A)}else if(o.sn>y.sn){var t=y.cc===o.cc;t&&y.minEndPTS?o.start=y.start+(y.minEndPTS-y.start):o.start=y.start+y.duration}else o.start=Math.max(y.start-o.duration,0)}function M(y,o,P,A,g,t){var f=A-P;f<=0&&(T.logger.warn("Fragment should have a positive duration",o),A=P+o.duration,t=g+o.duration);var x=P,m=A,a=o.startPTS,c=o.endPTS;if(Object(R.isFiniteNumber)(a)){var L=Math.abs(a-P);Object(R.isFiniteNumber)(o.deltaPTS)?o.deltaPTS=Math.max(L,o.deltaPTS):o.deltaPTS=L,x=Math.max(P,a),P=Math.min(P,a),g=Math.min(g,o.startDTS),m=Math.min(A,c),A=Math.max(A,c),t=Math.max(t,o.endDTS)}o.duration=A-P;var _=P-o.start;o.appendedPTS=A,o.start=o.startPTS=P,o.maxStartPTS=x,o.startDTS=g,o.endPTS=A,o.minEndPTS=m,o.endDTS=t;var B=o.sn;if(!y||B<y.startSN||B>y.endSN)return 0;var $,K=B-y.startSN,H=y.fragments;for(H[K]=o,$=K;$>0;$--)I(H[$],H[$-1]);for($=K;$<H.length-1;$++)I(H[$],H[$+1]);return y.fragmentHint&&I(H[H.length-1],y.fragmentHint),y.PTSKnown=y.alignedSliding=!0,_}function C(y,o){for(var P=null,A=y.fragments,g=A.length-1;g>=0;g--){var t=A[g].initSegment;if(t){P=t;break}}y.fragmentHint&&delete y.fragmentHint.endPTS;var f=0,x;if(v(y,o,function($,K){$.relurl&&(f=$.cc-K.cc),Object(R.isFiniteNumber)($.startPTS)&&Object(R.isFiniteNumber)($.endPTS)&&(K.start=K.startPTS=$.startPTS,K.startDTS=$.startDTS,K.appendedPTS=$.appendedPTS,K.maxStartPTS=$.maxStartPTS,K.endPTS=$.endPTS,K.endDTS=$.endDTS,K.minEndPTS=$.minEndPTS,K.duration=$.endPTS-$.startPTS,K.duration&&(x=K),o.PTSKnown=o.alignedSliding=!0),K.elementaryStreams=$.elementaryStreams,K.loader=$.loader,K.stats=$.stats,K.urlId=$.urlId,$.initSegment&&(K.initSegment=$.initSegment,P=$.initSegment)}),P){var m=o.fragmentHint?o.fragments.concat(o.fragmentHint):o.fragments;m.forEach(function($){var K;(!$.initSegment||$.initSegment.relurl===((K=P)===null||K===void 0?void 0:K.relurl))&&($.initSegment=P)})}if(o.skippedSegments&&(o.deltaUpdateFailed=o.fragments.some(function($){return!$}),o.deltaUpdateFailed)){T.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var a=o.skippedSegments;a--;)o.fragments.shift();o.startSN=o.fragments[0].sn,o.startCC=o.fragments[0].cc}var c=o.fragments;if(f){T.logger.warn("discontinuity sliding from playlist, take drift into account");for(var L=0;L<c.length;L++)c[L].cc+=f}o.skippedSegments&&(o.startCC=o.fragments[0].cc),w(y.partList,o.partList,function($,K){K.elementaryStreams=$.elementaryStreams,K.stats=$.stats}),x?M(o,x,x.startPTS,x.endPTS,x.startDTS,x.endDTS):k(y,o),c.length&&(o.totalduration=o.edge-c[0].start),o.driftStartTime=y.driftStartTime,o.driftStart=y.driftStart;var _=o.advancedDateTime;if(o.advanced&&_){var B=o.edge;o.driftStart||(o.driftStartTime=_,o.driftStart=B),o.driftEndTime=_,o.driftEnd=B}else o.driftEndTime=y.driftEndTime,o.driftEnd=y.driftEnd,o.advancedDateTime=y.advancedDateTime}function w(y,o,P){if(y&&o)for(var A=0,g=0,t=y.length;g<=t;g++){var f=y[g],x=o[g+A];f&&x&&f.index===x.index&&f.fragment.sn===x.fragment.sn?P(f,x):A--}}function v(y,o,P){for(var A=o.skippedSegments,g=Math.max(y.startSN,o.startSN)-o.startSN,t=(y.fragmentHint?1:0)+(A?o.endSN:Math.min(y.endSN,o.endSN))-o.startSN,f=o.startSN-y.startSN,x=o.fragmentHint?o.fragments.concat(o.fragmentHint):o.fragments,m=y.fragmentHint?y.fragments.concat(y.fragmentHint):y.fragments,a=g;a<=t;a++){var c=m[f+a],L=x[a];A&&!L&&a<A&&(L=o.fragments[a]=c),c&&L&&P(c,L)}}function k(y,o){var P=o.startSN+o.skippedSegments-y.startSN,A=y.fragments;P<0||P>=A.length||F(o,A[P].start)}function F(y,o){if(o){for(var P=y.fragments,A=y.skippedSegments;A<P.length;A++)P[A].start+=o;y.fragmentHint&&(y.fragmentHint.start+=o)}}function D(y,o){var P=1e3*y.levelTargetDuration,A=P/2,g=y.age,t=g>0&&g<P*3,f=o.loading.end-o.loading.start,x,m=y.availabilityDelay;if(y.updated===!1)if(t){var a=333*y.misses;x=Math.max(Math.min(A,f*2),a),y.availabilityDelay=(y.availabilityDelay||0)+x}else x=A;else t?(m=Math.min(m||P/2,g),y.availabilityDelay=m,x=m+P-g):x=P-f;return Math.round(x)}function E(y,o,P){if(!y||!y.details)return null;var A=y.details,g=A.fragments[o-A.startSN];return g||(g=A.fragmentHint,g&&g.sn===o)?g:o<A.startSN&&P&&P.sn===o?P:null}function u(y,o,P){if(!y||!y.details)return null;var A=y.details.partList;if(A)for(var g=A.length;g--;){var t=A[g];if(t.index===P&&t.fragment.sn===o)return t}return null}},"./src/controller/stream-controller.ts":function(S,l,r){r.r(l),r.d(l,"default",function(){return A});var R=r("./src/polyfills/number.ts"),T=r("./src/controller/base-stream-controller.ts"),O=r("./src/is-supported.ts"),N=r("./src/events.ts"),U=r("./src/utils/buffer-helper.ts"),I=r("./src/controller/fragment-tracker.ts"),M=r("./src/types/loader.ts"),C=r("./src/loader/fragment.ts"),w=r("./src/demux/transmuxer-interface.ts"),v=r("./src/types/transmuxer.ts"),k=r("./src/controller/gap-controller.ts"),F=r("./src/errors.ts"),D=r("./src/utils/logger.ts");function E(g,t){for(var f=0;f<t.length;f++){var x=t[f];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(g,x.key,x)}}function u(g,t,f){return t&&E(g.prototype,t),f&&E(g,f),g}function y(g,t){g.prototype=Object.create(t.prototype),g.prototype.constructor=g,o(g,t)}function o(g,t){return o=Object.setPrototypeOf||function(x,m){return x.__proto__=m,x},o(g,t)}var P=100,A=function(g){y(t,g);function t(x,m){var a;return a=g.call(this,x,m,"[stream-controller]")||this,a.audioCodecSwap=!1,a.gapController=null,a.level=-1,a._forceStartLoad=!1,a.altAudio=!1,a.audioOnly=!1,a.fragPlaying=null,a.onvplaying=null,a.onvseeked=null,a.fragLastKbps=0,a.stalled=!1,a.couldBacktrack=!1,a.audioCodecSwitch=!1,a.videoBuffer=null,a._registerListeners(),a}var f=t.prototype;return f._registerListeners=function(){var m=this.hls;m.on(N.Events.MEDIA_ATTACHED,this.onMediaAttached,this),m.on(N.Events.MEDIA_DETACHING,this.onMediaDetaching,this),m.on(N.Events.MANIFEST_LOADING,this.onManifestLoading,this),m.on(N.Events.MANIFEST_PARSED,this.onManifestParsed,this),m.on(N.Events.LEVEL_LOADING,this.onLevelLoading,this),m.on(N.Events.LEVEL_LOADED,this.onLevelLoaded,this),m.on(N.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),m.on(N.Events.ERROR,this.onError,this),m.on(N.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),m.on(N.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),m.on(N.Events.BUFFER_CREATED,this.onBufferCreated,this),m.on(N.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),m.on(N.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),m.on(N.Events.FRAG_BUFFERED,this.onFragBuffered,this)},f._unregisterListeners=function(){var m=this.hls;m.off(N.Events.MEDIA_ATTACHED,this.onMediaAttached,this),m.off(N.Events.MEDIA_DETACHING,this.onMediaDetaching,this),m.off(N.Events.MANIFEST_LOADING,this.onManifestLoading,this),m.off(N.Events.MANIFEST_PARSED,this.onManifestParsed,this),m.off(N.Events.LEVEL_LOADED,this.onLevelLoaded,this),m.off(N.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),m.off(N.Events.ERROR,this.onError,this),m.off(N.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),m.off(N.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),m.off(N.Events.BUFFER_CREATED,this.onBufferCreated,this),m.off(N.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),m.off(N.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),m.off(N.Events.FRAG_BUFFERED,this.onFragBuffered,this)},f.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},f.startLoad=function(m){if(this.levels){var a=this.lastCurrentTime,c=this.hls;if(this.stopLoad(),this.setInterval(P),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var L=c.startLevel;L===-1&&(c.config.testBandwidth?(L=0,this.bitrateTest=!0):L=c.nextAutoLevel),this.level=c.nextLoadLevel=L,this.loadedmetadata=!1}a>0&&m===-1&&(this.log("Override startPosition with lastCurrentTime @"+a.toFixed(3)),m=a),this.state=T.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=m,this.tick()}else this._forceStartLoad=!0,this.state=T.State.STOPPED},f.stopLoad=function(){this._forceStartLoad=!1,g.prototype.stopLoad.call(this)},f.doTick=function(){switch(this.state){case T.State.IDLE:this.doTickIdle();break;case T.State.WAITING_LEVEL:{var m,a=this.levels,c=this.level,L=a==null||(m=a[c])===null||m===void 0?void 0:m.details;if(L&&(!L.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(L))break;this.state=T.State.IDLE;break}break}case T.State.FRAG_LOADING_WAITING_RETRY:{var _,B=self.performance.now(),$=this.retryDate;(!$||B>=$||(_=this.media)!==null&&_!==void 0&&_.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=T.State.IDLE)}break}this.onTickEnd()},f.onTickEnd=function(){g.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},f.doTickIdle=function(){var m,a,c=this.hls,L=this.levelLastLoaded,_=this.levels,B=this.media,$=c.config,K=c.nextLoadLevel;if(!(L===null||!B&&(this.startFragRequested||!$.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!_||!_[K])){var H=_[K];this.level=c.nextLoadLevel=K;var j=H.details;if(!j||this.state===T.State.WAITING_LEVEL||j.live&&this.levelLastLoaded!==K){this.state=T.State.WAITING_LEVEL;return}var W=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:B,M.PlaylistLevelType.MAIN);if(W!==null){var z=W.len,Q=this.getMaxBufferLength(H.maxBitrate);if(!(z>=Q)){if(this._streamEnded(W,j)){var V={};this.altAudio&&(V.type="video"),this.hls.trigger(N.Events.BUFFER_EOS,V),this.state=T.State.ENDED;return}var J=W.end,X=this.getNextFragment(J,j);if(this.couldBacktrack&&!this.fragPrevious&&X&&X.sn!=="initSegment"){var q=X.sn-j.startSN;q>1&&(X=j.fragments[q-1],this.fragmentTracker.removeFragment(X))}if(X&&this.fragmentTracker.getState(X)===I.FragmentState.OK&&this.nextLoadPosition>J){var ue=this.audioOnly&&!this.altAudio?C.ElementaryStreamTypes.AUDIO:C.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(B,ue,M.PlaylistLevelType.MAIN),X=this.getNextFragment(this.nextLoadPosition,j)}!X||(X.initSegment&&!X.initSegment.data&&!this.bitrateTest&&(X=X.initSegment),((m=X.decryptdata)===null||m===void 0?void 0:m.keyFormat)==="identity"&&!((a=X.decryptdata)!==null&&a!==void 0&&a.key)?this.loadKey(X,j):this.loadFragment(X,j,J))}}}},f.loadFragment=function(m,a,c){var L,_=this.fragmentTracker.getState(m);if(this.fragCurrent=m,_===I.FragmentState.BACKTRACKED){var B=this.fragmentTracker.getBacktrackData(m);if(B){this._handleFragmentLoadProgress(B),this._handleFragmentLoadComplete(B);return}else _=I.FragmentState.NOT_LOADED}_===I.FragmentState.NOT_LOADED||_===I.FragmentState.PARTIAL?m.sn==="initSegment"?this._loadInitSegment(m):this.bitrateTest?(m.bitrateTest=!0,this.log("Fragment "+m.sn+" of level "+m.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(m)):(this.startFragRequested=!0,g.prototype.loadFragment.call(this,m,a,c)):_===I.FragmentState.APPENDING?this.reduceMaxBufferLength(m.duration)&&this.fragmentTracker.removeFragment(m):((L=this.media)===null||L===void 0?void 0:L.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},f.getAppendedFrag=function(m){var a=this.fragmentTracker.getAppendedFrag(m,M.PlaylistLevelType.MAIN);return a&&"fragment"in a?a.fragment:a},f.getBufferedFrag=function(m){return this.fragmentTracker.getBufferedFrag(m,M.PlaylistLevelType.MAIN)},f.followingBufferedFrag=function(m){return m?this.getBufferedFrag(m.end+.5):null},f.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},f.nextLevelSwitch=function(){var m=this.levels,a=this.media;if(a!=null&&a.readyState){var c,L=this.getAppendedFrag(a.currentTime);if(L&&L.start>1&&this.flushMainBuffer(0,L.start-1),!a.paused&&m){var _=this.hls.nextLoadLevel,B=m[_],$=this.fragLastKbps;$&&this.fragCurrent?c=this.fragCurrent.duration*B.maxBitrate/(1e3*$)+1:c=0}else c=0;var K=this.getBufferedFrag(a.currentTime+c);if(K){var H=this.followingBufferedFrag(K);if(H){this.abortCurrentFrag();var j=H.maxStartPTS?H.maxStartPTS:H.start,W=H.duration,z=Math.max(K.end,j+Math.min(Math.max(W-this.config.maxFragLookUpTolerance,W*.5),W*.75));this.flushMainBuffer(z,Number.POSITIVE_INFINITY)}}}},f.abortCurrentFrag=function(){var m=this.fragCurrent;this.fragCurrent=null,m!=null&&m.loader&&m.loader.abort(),this.state===T.State.KEY_LOADING&&(this.state=T.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},f.flushMainBuffer=function(m,a){g.prototype.flushMainBuffer.call(this,m,a,this.altAudio?"video":null)},f.onMediaAttached=function(m,a){g.prototype.onMediaAttached.call(this,m,a);var c=a.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),c.addEventListener("playing",this.onvplaying),c.addEventListener("seeked",this.onvseeked),this.gapController=new k.default(this.config,c,this.fragmentTracker,this.hls)},f.onMediaDetaching=function(){var m=this.media;m&&(m.removeEventListener("playing",this.onvplaying),m.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),g.prototype.onMediaDetaching.call(this)},f.onMediaPlaying=function(){this.tick()},f.onMediaSeeked=function(){var m=this.media,a=m?m.currentTime:null;Object(R.isFiniteNumber)(a)&&this.log("Media seeked to "+a.toFixed(3)),this.tick()},f.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(N.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},f.onManifestParsed=function(m,a){var c=!1,L=!1,_;a.levels.forEach(function(B){_=B.audioCodec,_&&(_.indexOf("mp4a.40.2")!==-1&&(c=!0),_.indexOf("mp4a.40.5")!==-1&&(L=!0))}),this.audioCodecSwitch=c&&L&&!Object(O.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=a.levels,this.startFragRequested=!1},f.onLevelLoading=function(m,a){var c=this.levels;if(!(!c||this.state!==T.State.IDLE)){var L=c[a.level];(!L.details||L.details.live&&this.levelLastLoaded!==a.level||this.waitForCdnTuneIn(L.details))&&(this.state=T.State.WAITING_LEVEL)}},f.onLevelLoaded=function(m,a){var c,L=this.levels,_=a.level,B=a.details,$=B.totalduration;if(!L){this.warn("Levels were reset while loading level "+_);return}this.log("Level "+_+" loaded ["+B.startSN+","+B.endSN+"], cc ["+B.startCC+", "+B.endCC+"] duration:"+$);var K=this.fragCurrent;K&&(this.state===T.State.FRAG_LOADING||this.state===T.State.FRAG_LOADING_WAITING_RETRY)&&K.level!==a.level&&K.loader&&(this.state=T.State.IDLE,K.loader.abort());var H=L[_],j=0;if(B.live||(c=H.details)!==null&&c!==void 0&&c.live){if(B.fragments[0]||(B.deltaUpdateFailed=!0),B.deltaUpdateFailed)return;j=this.alignPlaylists(B,H.details)}if(H.details=B,this.levelLastLoaded=_,this.hls.trigger(N.Events.LEVEL_UPDATED,{details:B,level:_}),this.state===T.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(B))return;this.state=T.State.IDLE}this.startFragRequested?B.live&&this.synchronizeToLiveEdge(B):this.setStartPosition(B,j),this.tick()},f._handleFragmentLoadProgress=function(m){var a,c=m.frag,L=m.part,_=m.payload,B=this.levels;if(!B){this.warn("Levels were reset while fragment load was in progress. Fragment "+c.sn+" of level "+c.level+" will not be buffered");return}var $=B[c.level],K=$.details;if(!K){this.warn("Dropping fragment "+c.sn+" of level "+c.level+" after level details were reset");return}var H=$.videoCodec,j=K.PTSKnown||!K.live,W=(a=c.initSegment)===null||a===void 0?void 0:a.data,z=this._getAudioCodec($),Q=this.transmuxer=this.transmuxer||new w.default(this.hls,M.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),V=L?L.index:-1,J=V!==-1,X=new v.ChunkMetadata(c.level,c.sn,c.stats.chunkCount,_.byteLength,V,J),q=this.initPTS[c.cc];Q.push(_,W,z,H,c,L,K.totalduration,j,X,q)},f.onAudioTrackSwitching=function(m,a){var c=this.altAudio,L=!!a.url,_=a.id;if(!L){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var B=this.fragCurrent;B!=null&&B.loader&&(this.log("Switching to main audio track, cancel main fragment load"),B.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var $=this.hls;c&&$.trigger(N.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),$.trigger(N.Events.AUDIO_TRACK_SWITCHED,{id:_})}},f.onAudioTrackSwitched=function(m,a){var c=a.id,L=!!this.hls.audioTracks[c].url;if(L){var _=this.videoBuffer;_&&this.mediaBuffer!==_&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=_)}this.altAudio=L,this.tick()},f.onBufferCreated=function(m,a){var c=a.tracks,L,_,B=!1;for(var $ in c){var K=c[$];if(K.id==="main"){if(_=$,L=K,$==="video"){var H=c[$];H&&(this.videoBuffer=H.buffer)}}else B=!0}B&&L?(this.log("Alternate track found, use "+_+".buffered to schedule main fragment loading"),this.mediaBuffer=L.buffer):this.mediaBuffer=this.media},f.onFragBuffered=function(m,a){var c=a.frag,L=a.part;if(!(c&&c.type!==M.PlaylistLevelType.MAIN)){if(this.fragContextChanged(c)){this.warn("Fragment "+c.sn+(L?" p: "+L.index:"")+" of level "+c.level+" finished buffering, but was aborted. state: "+this.state),this.state===T.State.PARSED&&(this.state=T.State.IDLE);return}var _=L?L.stats:c.stats;this.fragLastKbps=Math.round(8*_.total/(_.buffering.end-_.loading.first)),c.sn!=="initSegment"&&(this.fragPrevious=c),this.fragBufferedComplete(c,L)}},f.onError=function(m,a){switch(a.details){case F.ErrorDetails.FRAG_LOAD_ERROR:case F.ErrorDetails.FRAG_LOAD_TIMEOUT:case F.ErrorDetails.KEY_LOAD_ERROR:case F.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(M.PlaylistLevelType.MAIN,a);break;case F.ErrorDetails.LEVEL_LOAD_ERROR:case F.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==T.State.ERROR&&(a.fatal?(this.warn(""+a.details),this.state=T.State.ERROR):!a.levelRetry&&this.state===T.State.WAITING_LEVEL&&(this.state=T.State.IDLE));break;case F.ErrorDetails.BUFFER_FULL_ERROR:if(a.parent==="main"&&(this.state===T.State.PARSING||this.state===T.State.PARSED)){var c=!0,L=this.getFwdBufferInfo(this.media,M.PlaylistLevelType.MAIN);L&&L.len>.5&&(c=!this.reduceMaxBufferLength(L.len)),c&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},f.checkBuffer=function(){var m=this.media,a=this.gapController;if(!(!m||!a||!m.readyState)){var c=U.BufferHelper.getBuffered(m);!this.loadedmetadata&&c.length?(this.loadedmetadata=!0,this.seekToStartPos()):a.poll(this.lastCurrentTime),this.lastCurrentTime=m.currentTime}},f.onFragLoadEmergencyAborted=function(){this.state=T.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},f.onBufferFlushed=function(m,a){var c=a.type;if(c!==C.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var L=(c===C.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(L,c,M.PlaylistLevelType.MAIN)}},f.onLevelsUpdated=function(m,a){this.levels=a.levels},f.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},f.seekToStartPos=function(){var m=this.media,a=m.currentTime,c=this.startPosition;if(c>=0&&a<c){if(m.seeking){D.logger.log("could not seek to "+c+", already seeking at "+a);return}var L=U.BufferHelper.getBuffered(m),_=L.length?L.start(0):0,B=_-c;B>0&&(B<this.config.maxBufferHole||B<this.config.maxFragLookUpTolerance)&&(D.logger.log("adjusting start position by "+B+" to match buffer start"),c+=B,this.startPosition=c),this.log("seek to target start position "+c+" from current time "+a),m.currentTime=c}},f._getAudioCodec=function(m){var a=this.config.defaultAudioCodec||m.audioCodec;return this.audioCodecSwap&&a&&(this.log("Swapping audio codec"),a.indexOf("mp4a.40.5")!==-1?a="mp4a.40.2":a="mp4a.40.5"),a},f._loadBitrateTestFrag=function(m){var a=this;this._doFragLoad(m).then(function(c){var L=a.hls;if(!(!c||L.nextLoadLevel||a.fragContextChanged(m))){a.fragLoadError=0,a.state=T.State.IDLE,a.startFragRequested=!1,a.bitrateTest=!1;var _=m.stats;_.parsing.start=_.parsing.end=_.buffering.start=_.buffering.end=self.performance.now(),L.trigger(N.Events.FRAG_LOADED,c)}})},f._handleTransmuxComplete=function(m){var a,c="main",L=this.hls,_=m.remuxResult,B=m.chunkMeta,$=this.getCurrentContext(B);if(!$){this.warn("The loading context changed while buffering fragment "+B.sn+" of level "+B.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(B.level);return}var K=$.frag,H=$.part,j=$.level,W=_.video,z=_.text,Q=_.id3,V=_.initSegment,J=this.altAudio?void 0:_.audio;if(!this.fragContextChanged(K)){if(this.state=T.State.PARSING,V){V.tracks&&(this._bufferInitSegment(j,V.tracks,K,B),L.trigger(N.Events.FRAG_PARSING_INIT_SEGMENT,{frag:K,id:c,tracks:V.tracks}));var X=V.initPTS,q=V.timescale;Object(R.isFiniteNumber)(X)&&(this.initPTS[K.cc]=X,L.trigger(N.Events.INIT_PTS_FOUND,{frag:K,id:c,initPTS:X,timescale:q}))}if(W&&_.independent!==!1){if(j.details){var ue=W.startPTS,oe=W.endPTS,ce=W.startDTS,le=W.endDTS;if(H)H.elementaryStreams[W.type]={startPTS:ue,endPTS:oe,startDTS:ce,endDTS:le};else if(W.firstKeyFrame&&W.independent&&(this.couldBacktrack=!0),W.dropped&&W.independent){var G=this.getLoadPosition()+this.config.maxBufferHole;if(G<ue){this.backtrack(K);return}K.setElementaryStreamInfo(W.type,K.start,oe,K.start,le,!0)}K.setElementaryStreamInfo(W.type,ue,oe,ce,le),this.bufferFragmentData(W,K,H,B)}}else if(_.independent===!1){this.backtrack(K);return}if(J){var Y=J.startPTS,Z=J.endPTS,ee=J.startDTS,te=J.endDTS;H&&(H.elementaryStreams[C.ElementaryStreamTypes.AUDIO]={startPTS:Y,endPTS:Z,startDTS:ee,endDTS:te}),K.setElementaryStreamInfo(C.ElementaryStreamTypes.AUDIO,Y,Z,ee,te),this.bufferFragmentData(J,K,H,B)}if(Q!=null&&(a=Q.samples)!==null&&a!==void 0&&a.length){var ie={frag:K,id:c,samples:Q.samples};L.trigger(N.Events.FRAG_PARSING_METADATA,ie)}if(z){var se={frag:K,id:c,samples:z.samples};L.trigger(N.Events.FRAG_PARSING_USERDATA,se)}}},f._bufferInitSegment=function(m,a,c,L){var _=this;if(this.state===T.State.PARSING){this.audioOnly=!!a.audio&&!a.video,this.altAudio&&!this.audioOnly&&delete a.audio;var B=a.audio,$=a.video,K=a.audiovideo;if(B){var H=m.audioCodec,j=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(H&&(H.indexOf("mp4a.40.5")!==-1?H="mp4a.40.2":H="mp4a.40.5"),B.metadata.channelCount!==1&&j.indexOf("firefox")===-1&&(H="mp4a.40.5")),j.indexOf("android")!==-1&&B.container!=="audio/mpeg"&&(H="mp4a.40.2",this.log("Android: force audio codec to "+H)),m.audioCodec&&m.audioCodec!==H&&this.log('Swapping manifest audio codec "'+m.audioCodec+'" for "'+H+'"'),B.levelCodec=H,B.id="main",this.log("Init audio buffer, container:"+B.container+", codecs[selected/level/parsed]=["+(H||"")+"/"+(m.audioCodec||"")+"/"+B.codec+"]")}$&&($.levelCodec=m.videoCodec,$.id="main",this.log("Init video buffer, container:"+$.container+", codecs[level/parsed]=["+(m.videoCodec||"")+"/"+$.codec+"]")),K&&this.log("Init audiovideo buffer, container:"+K.container+", codecs[level/parsed]=["+(m.attrs.CODECS||"")+"/"+K.codec+"]"),this.hls.trigger(N.Events.BUFFER_CODECS,a),Object.keys(a).forEach(function(W){var z=a[W],Q=z.initSegment;Q!=null&&Q.byteLength&&_.hls.trigger(N.Events.BUFFER_APPENDING,{type:W,data:Q,frag:c,part:null,chunkMeta:L,parent:c.type})}),this.tick()}},f.backtrack=function(m){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(m);var a=this.fragmentTracker.backtrack(m);this.fragPrevious=null,this.nextLoadPosition=m.start,a?this.resetFragmentLoading(m):this.state=T.State.BACKTRACKING},f.checkFragmentChanged=function(){var m=this.media,a=null;if(m&&m.readyState>1&&m.seeking===!1){var c=m.currentTime;if(U.BufferHelper.isBuffered(m,c)?a=this.getAppendedFrag(c):U.BufferHelper.isBuffered(m,c+.1)&&(a=this.getAppendedFrag(c+.1)),a){var L=this.fragPlaying,_=a.level;(!L||a.sn!==L.sn||L.level!==_||a.urlId!==L.urlId)&&(this.hls.trigger(N.Events.FRAG_CHANGED,{frag:a}),(!L||L.level!==_)&&this.hls.trigger(N.Events.LEVEL_SWITCHED,{level:_}),this.fragPlaying=a)}}},u(t,[{key:"nextLevel",get:function(){var m=this.nextBufferedFrag;return m?m.level:-1}},{key:"currentLevel",get:function(){var m=this.media;if(m){var a=this.getAppendedFrag(m.currentTime);if(a)return a.level}return-1}},{key:"nextBufferedFrag",get:function(){var m=this.media;if(m){var a=this.getAppendedFrag(m.currentTime);return this.followingBufferedFrag(a)}else return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),t}(T.default)},"./src/controller/subtitle-stream-controller.ts":function(S,l,r){r.r(l),r.d(l,"SubtitleStreamController",function(){return u});var R=r("./src/events.ts"),T=r("./src/utils/buffer-helper.ts"),O=r("./src/controller/fragment-finders.ts"),N=r("./src/utils/discontinuities.ts"),U=r("./src/controller/level-helper.ts"),I=r("./src/controller/fragment-tracker.ts"),M=r("./src/controller/base-stream-controller.ts"),C=r("./src/types/loader.ts"),w=r("./src/types/level.ts");function v(y,o){for(var P=0;P<o.length;P++){var A=o[P];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(y,A.key,A)}}function k(y,o,P){return o&&v(y.prototype,o),P&&v(y,P),y}function F(y,o){y.prototype=Object.create(o.prototype),y.prototype.constructor=y,D(y,o)}function D(y,o){return D=Object.setPrototypeOf||function(A,g){return A.__proto__=g,A},D(y,o)}var E=500,u=function(y){F(o,y);function o(A,g){var t;return t=y.call(this,A,g,"[subtitle-stream-controller]")||this,t.levels=[],t.currentTrackId=-1,t.tracksBuffered=[],t.mainDetails=null,t._registerListeners(),t}var P=o.prototype;return P.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},P._registerListeners=function(){var g=this.hls;g.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),g.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),g.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),g.on(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),g.on(R.Events.ERROR,this.onError,this),g.on(R.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),g.on(R.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),g.on(R.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),g.on(R.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),g.on(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},P._unregisterListeners=function(){var g=this.hls;g.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),g.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),g.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),g.off(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),g.off(R.Events.ERROR,this.onError,this),g.off(R.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),g.off(R.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),g.off(R.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),g.off(R.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),g.off(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},P.startLoad=function(){this.stopLoad(),this.state=M.State.IDLE,this.setInterval(E),this.tick()},P.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},P.onLevelLoaded=function(g,t){this.mainDetails=t.details},P.onSubtitleFragProcessed=function(g,t){var f=t.frag,x=t.success;if(this.fragPrevious=f,this.state=M.State.IDLE,!!x){var m=this.tracksBuffered[this.currentTrackId];if(!!m){for(var a,c=f.start,L=0;L<m.length;L++)if(c>=m[L].start&&c<=m[L].end){a=m[L];break}var _=f.start+f.duration;a?a.end=_:(a={start:c,end:_},m.push(a)),this.fragmentTracker.fragBuffered(f)}}},P.onBufferFlushing=function(g,t){var f=t.startOffset,x=t.endOffset;if(f===0&&x!==Number.POSITIVE_INFINITY){var m=this.currentTrackId,a=this.levels;if(!a.length||!a[m]||!a[m].details)return;var c=a[m].details,L=c.targetduration,_=x-L;if(_<=0)return;t.endOffsetSubtitles=Math.max(0,_),this.tracksBuffered.forEach(function(B){for(var $=0;$<B.length;){if(B[$].end<=_){B.shift();continue}else if(B[$].start<_)B[$].start=_;else break;$++}}),this.fragmentTracker.removeFragmentsInRange(f,_,C.PlaylistLevelType.SUBTITLE)}},P.onError=function(g,t){var f,x=t.frag;!x||x.type!==C.PlaylistLevelType.SUBTITLE||((f=this.fragCurrent)!==null&&f!==void 0&&f.loader&&this.fragCurrent.loader.abort(),this.state=M.State.IDLE)},P.onSubtitleTracksUpdated=function(g,t){var f=this,x=t.subtitleTracks;this.tracksBuffered=[],this.levels=x.map(function(m){return new w.Level(m)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(m){f.tracksBuffered[m.id]=[]}),this.mediaBuffer=null},P.onSubtitleTrackSwitch=function(g,t){if(this.currentTrackId=t.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var f=this.levels[this.currentTrackId];f!=null&&f.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,f&&this.setInterval(E)},P.onSubtitleTrackLoaded=function(g,t){var f,x=t.details,m=t.id,a=this.currentTrackId,c=this.levels;if(!!c.length){var L=c[a];if(!(m>=c.length||m!==a||!L)){if(this.mediaBuffer=this.mediaBufferTimeRanges,x.live||(f=L.details)!==null&&f!==void 0&&f.live){var _=this.mainDetails;if(x.deltaUpdateFailed||!_)return;var B=_.fragments[0];if(!L.details)x.hasProgramDateTime&&_.hasProgramDateTime?Object(N.alignMediaPlaylistByPDT)(x,_):B&&Object(U.addSliding)(x,B.start);else{var $=this.alignPlaylists(x,L.details);$===0&&B&&Object(U.addSliding)(x,B.start)}}if(L.details=x,this.levelLastLoaded=m,this.tick(),x.live&&!this.fragCurrent&&this.media&&this.state===M.State.IDLE){var K=Object(O.findFragmentByPTS)(null,x.fragments,this.media.currentTime,0);K||(this.warn("Subtitle playlist not aligned with playback"),L.details=void 0)}}}},P._handleFragmentLoadComplete=function(g){var t=g.frag,f=g.payload,x=t.decryptdata,m=this.hls;if(!this.fragContextChanged(t)&&f&&f.byteLength>0&&x&&x.key&&x.iv&&x.method==="AES-128"){var a=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(f),x.key.buffer,x.iv.buffer).then(function(c){var L=performance.now();m.trigger(R.Events.FRAG_DECRYPTED,{frag:t,payload:c,stats:{tstart:a,tdecrypt:L}})})}},P.doTick=function(){if(!this.media){this.state=M.State.IDLE;return}if(this.state===M.State.IDLE){var g,t=this.currentTrackId,f=this.levels;if(!f.length||!f[t]||!f[t].details)return;var x=f[t].details,m=x.targetduration,a=this.config,c=this.media,L=T.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,c.currentTime-m,a.maxBufferHole),_=L.end,B=L.len,$=this.getMaxBufferLength()+m;if(B>$)return;console.assert(x,"Subtitle track details are defined on idle subtitle stream controller tick");var K=x.fragments,H=K.length,j=x.edge,W,z=this.fragPrevious;if(_<j){var Q=a.maxFragLookUpTolerance;W=Object(O.findFragmentByPTS)(z,K,_,Q),!W&&z&&z.start<K[0].start&&(W=K[0])}else W=K[H-1];(g=W)!==null&&g!==void 0&&g.encrypted?this.loadKey(W,x):W&&this.fragmentTracker.getState(W)===I.FragmentState.NOT_LOADED&&this.loadFragment(W,x,_)}},P.loadFragment=function(g,t,f){this.fragCurrent=g,y.prototype.loadFragment.call(this,g,t,f)},k(o,[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}]),o}(M.default)},"./src/controller/subtitle-track-controller.ts":function(S,l,r){r.r(l);var R=r("./src/events.ts"),T=r("./src/utils/texttrack-utils.ts"),O=r("./src/controller/base-playlist-controller.ts"),N=r("./src/types/loader.ts");function U(k,F){for(var D=0;D<F.length;D++){var E=F[D];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(k,E.key,E)}}function I(k,F,D){return F&&U(k.prototype,F),D&&U(k,D),k}function M(k,F){k.prototype=Object.create(F.prototype),k.prototype.constructor=k,C(k,F)}function C(k,F){return C=Object.setPrototypeOf||function(E,u){return E.__proto__=u,E},C(k,F)}var w=function(k){M(F,k);function F(E){var u;return u=k.call(this,E,"[subtitle-track-controller]")||this,u.media=null,u.tracks=[],u.groupId=null,u.tracksInGroup=[],u.trackId=-1,u.selectDefaultTrack=!0,u.queuedDefaultTrack=-1,u.trackChangeListener=function(){return u.onTextTracksChanged()},u.asyncPollTrackChange=function(){return u.pollTrackChange(0)},u.useTextTrackPolling=!1,u.subtitlePollingInterval=-1,u.subtitleDisplay=!0,u.registerListeners(),u}var D=F.prototype;return D.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,k.prototype.destroy.call(this)},D.registerListeners=function(){var u=this.hls;u.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),u.on(R.Events.LEVEL_LOADING,this.onLevelLoading,this),u.on(R.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),u.on(R.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),u.on(R.Events.ERROR,this.onError,this)},D.unregisterListeners=function(){var u=this.hls;u.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),u.off(R.Events.LEVEL_LOADING,this.onLevelLoading,this),u.off(R.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),u.off(R.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),u.off(R.Events.ERROR,this.onError,this)},D.onMediaAttached=function(u,y){this.media=y.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},D.pollTrackChange=function(u){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,u)},D.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var u=v(this.media.textTracks);u.forEach(function(y){Object(T.clearCurrentCues)(y)}),this.subtitleTrack=-1,this.media=null}},D.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},D.onManifestParsed=function(u,y){this.tracks=y.subtitleTracks},D.onSubtitleTrackLoaded=function(u,y){var o=y.id,P=y.details,A=this.trackId,g=this.tracksInGroup[A];if(!g){this.warn("Invalid subtitle track id "+o);return}var t=g.details;g.details=y.details,this.log("subtitle track "+o+" loaded ["+P.startSN+"-"+P.endSN+"]"),o===this.trackId&&(this.retryCount=0,this.playlistLoaded(o,y,t))},D.onLevelLoading=function(u,y){this.switchLevel(y.level)},D.onLevelSwitching=function(u,y){this.switchLevel(y.level)},D.switchLevel=function(u){var y=this.hls.levels[u];if(!!(y!=null&&y.textGroupIds)){var o=y.textGroupIds[y.urlId];if(this.groupId!==o){var P=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,A=this.tracks.filter(function(f){return!o||f.groupId===o});this.tracksInGroup=A;var g=this.findTrackId(P==null?void 0:P.name)||this.findTrackId();this.groupId=o;var t={subtitleTracks:A};this.log("Updating subtitle tracks, "+A.length+' track(s) found in "'+o+'" group-id'),this.hls.trigger(R.Events.SUBTITLE_TRACKS_UPDATED,t),g!==-1&&this.setSubtitleTrack(g,P)}}},D.findTrackId=function(u){for(var y=this.tracksInGroup,o=0;o<y.length;o++){var P=y[o];if((!this.selectDefaultTrack||P.default)&&(!u||u===P.name))return P.id}return-1},D.onError=function(u,y){k.prototype.onError.call(this,u,y),!(y.fatal||!y.context)&&y.context.type===N.PlaylistContextType.SUBTITLE_TRACK&&y.context.id===this.trackId&&y.context.groupId===this.groupId&&this.retryLoadingOrFail(y)},D.loadPlaylist=function(u){var y=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(y)){var o=y.id,P=y.groupId,A=y.url;if(u)try{A=u.addDirectives(A)}catch(g){this.warn("Could not construct new URL with HLS Delivery Directives: "+g)}this.log("Loading subtitle playlist for id "+o),this.hls.trigger(R.Events.SUBTITLE_TRACK_LOADING,{url:A,id:o,groupId:P,deliveryDirectives:u||null})}},D.toggleTrackModes=function(u){var y=this,o=this.media,P=this.subtitleDisplay,A=this.trackId;if(!!o){var g=v(o.textTracks),t=g.filter(function(m){return m.groupId===y.groupId});if(u===-1)[].slice.call(g).forEach(function(m){m.mode="disabled"});else{var f=t[A];f&&(f.mode="disabled")}var x=t[u];x&&(x.mode=P?"showing":"hidden")}},D.setSubtitleTrack=function(u,y){var o,P=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=u;return}if(this.trackId!==u&&this.toggleTrackModes(u),!(this.trackId===u&&(u===-1||(o=P[u])!==null&&o!==void 0&&o.details)||u<-1||u>=P.length)){this.clearTimer();var A=P[u];if(this.log("Switching to subtitle track "+u),this.trackId=u,A){var g=A.id,t=A.groupId,f=t===void 0?"":t,x=A.name,m=A.type,a=A.url;this.hls.trigger(R.Events.SUBTITLE_TRACK_SWITCH,{id:g,groupId:f,name:x,type:m,url:a});var c=this.switchParams(A.url,y==null?void 0:y.details);this.loadPlaylist(c)}else this.hls.trigger(R.Events.SUBTITLE_TRACK_SWITCH,{id:u})}},D.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var u=-1,y=v(this.media.textTracks),o=0;o<y.length;o++)if(y[o].mode==="hidden")u=o;else if(y[o].mode==="showing"){u=o;break}this.subtitleTrack!==u&&(this.subtitleTrack=u)}},I(F,[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(u){this.selectDefaultTrack=!1;var y=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(u,y)}}]),F}(O.default);function v(k){for(var F=[],D=0;D<k.length;D++){var E=k[D];E.kind==="subtitles"&&E.label&&F.push(k[D])}return F}l.default=w},"./src/controller/timeline-controller.ts":function(S,l,r){r.r(l),r.d(l,"TimelineController",function(){return v});var R=r("./src/polyfills/number.ts"),T=r("./src/events.ts"),O=r("./src/utils/cea-608-parser.ts"),N=r("./src/utils/output-filter.ts"),U=r("./src/utils/webvtt-parser.ts"),I=r("./src/utils/texttrack-utils.ts"),M=r("./src/utils/imsc1-ttml-parser.ts"),C=r("./src/types/loader.ts"),w=r("./src/utils/logger.ts"),v=function(){function E(y){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=D(),this.captionsProperties=void 0,this.hls=y,this.config=y.config,this.Cues=y.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var o=new N.default(this,"textTrack1"),P=new N.default(this,"textTrack2"),A=new N.default(this,"textTrack3"),g=new N.default(this,"textTrack4");this.cea608Parser1=new O.default(1,o,P),this.cea608Parser2=new O.default(3,A,g)}y.on(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),y.on(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),y.on(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),y.on(T.Events.MANIFEST_LOADED,this.onManifestLoaded,this),y.on(T.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),y.on(T.Events.FRAG_LOADING,this.onFragLoading,this),y.on(T.Events.FRAG_LOADED,this.onFragLoaded,this),y.on(T.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),y.on(T.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),y.on(T.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),y.on(T.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),y.on(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var u=E.prototype;return u.destroy=function(){var o=this.hls;o.off(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),o.off(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.off(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.off(T.Events.MANIFEST_LOADED,this.onManifestLoaded,this),o.off(T.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),o.off(T.Events.FRAG_LOADING,this.onFragLoading,this),o.off(T.Events.FRAG_LOADED,this.onFragLoaded,this),o.off(T.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),o.off(T.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),o.off(T.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),o.off(T.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),o.off(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},u.addCues=function(o,P,A,g,t){for(var f=!1,x=t.length;x--;){var m=t[x],a=F(m[0],m[1],P,A);if(a>=0&&(m[0]=Math.min(m[0],P),m[1]=Math.max(m[1],A),f=!0,a/(A-P)>.5))return}if(f||t.push([P,A]),this.config.renderTextTracksNatively){var c=this.captionsTracks[o];this.Cues.newCue(c,P,A,g)}else{var L=this.Cues.newCue(null,P,A,g);this.hls.trigger(T.Events.CUES_PARSED,{type:"captions",cues:L,track:o})}},u.onInitPtsFound=function(o,P){var A=this,g=P.frag,t=P.id,f=P.initPTS,x=P.timescale,m=this.unparsedVttFrags;t==="main"&&(this.initPTS[g.cc]=f,this.timescale[g.cc]=x),m.length&&(this.unparsedVttFrags=[],m.forEach(function(a){A.onFragLoaded(T.Events.FRAG_LOADED,a)}))},u.getExistingTrack=function(o){var P=this.media;if(P)for(var A=0;A<P.textTracks.length;A++){var g=P.textTracks[A];if(g[o])return g}return null},u.createCaptionsTrack=function(o){this.config.renderTextTracksNatively?this.createNativeTrack(o):this.createNonNativeTrack(o)},u.createNativeTrack=function(o){if(!this.captionsTracks[o]){var P=this.captionsProperties,A=this.captionsTracks,g=this.media,t=P[o],f=t.label,x=t.languageCode,m=this.getExistingTrack(o);if(m)A[o]=m,Object(I.clearCurrentCues)(A[o]),Object(I.sendAddTrackEvent)(A[o],g);else{var a=this.createTextTrack("captions",f,x);a&&(a[o]=!0,A[o]=a)}}},u.createNonNativeTrack=function(o){if(!this.nonNativeCaptionsTracks[o]){var P=this.captionsProperties[o];if(!!P){var A=P.label,g={_id:o,label:A,kind:"captions",default:P.media?!!P.media.default:!1,closedCaptions:P.media};this.nonNativeCaptionsTracks[o]=g,this.hls.trigger(T.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[g]})}}},u.createTextTrack=function(o,P,A){var g=this.media;if(!!g)return g.addTextTrack(o,P,A)},u.onMediaAttaching=function(o,P){this.media=P.media,this._cleanTracks()},u.onMediaDetaching=function(){var o=this.captionsTracks;Object.keys(o).forEach(function(P){Object(I.clearCurrentCues)(o[P]),delete o[P]}),this.nonNativeCaptionsTracks={}},u.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=D(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},u._cleanTracks=function(){var o=this.media;if(!!o){var P=o.textTracks;if(P)for(var A=0;A<P.length;A++)Object(I.clearCurrentCues)(P[A])}},u.onSubtitleTracksUpdated=function(o,P){var A=this;this.textTracks=[];var g=P.subtitleTracks||[],t=g.some(function(a){return a.textCodec===M.IMSC1_CODEC});if(this.config.enableWebVTT||t&&this.config.enableIMSC1){var f=this.tracks&&g&&this.tracks.length===g.length;if(this.tracks=g||[],this.config.renderTextTracksNatively){var x=this.media?this.media.textTracks:[];this.tracks.forEach(function(a,c){var L;if(c<x.length){for(var _=null,B=0;B<x.length;B++)if(k(x[B],a)){_=x[B];break}_&&(L=_)}L?Object(I.clearCurrentCues)(L):(L=A.createTextTrack("subtitles",a.name,a.lang),L&&(L.mode="disabled")),L&&(L.groupId=a.groupId,A.textTracks.push(L))})}else if(!f&&this.tracks&&this.tracks.length){var m=this.tracks.map(function(a){return{label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}});this.hls.trigger(T.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:m})}}},u.onManifestLoaded=function(o,P){var A=this;this.config.enableCEA708Captions&&P.captions&&P.captions.forEach(function(g){var t=/(?:CC|SERVICE)([1-4])/.exec(g.instreamId);if(!!t){var f="textTrack"+t[1],x=A.captionsProperties[f];!x||(x.label=g.name,g.lang&&(x.languageCode=g.lang),x.media=g)}})},u.onFragLoading=function(o,P){var A=this.cea608Parser1,g=this.cea608Parser2,t=this.lastSn,f=this.lastPartIndex;if(!(!this.enabled||!(A&&g))&&P.frag.type===C.PlaylistLevelType.MAIN){var x,m,a=P.frag.sn,c=(x=P==null||(m=P.part)===null||m===void 0?void 0:m.index)!=null?x:-1;a===t+1||a===t&&c===f+1||(A.reset(),g.reset()),this.lastSn=a,this.lastPartIndex=c}},u.onFragLoaded=function(o,P){var A=P.frag,g=P.payload,t=this.initPTS,f=this.unparsedVttFrags;if(A.type===C.PlaylistLevelType.SUBTITLE)if(g.byteLength){if(!Object(R.isFiniteNumber)(t[A.cc])){f.push(P),t.length&&this.hls.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:A,error:new Error("Missing initial subtitle PTS")});return}var x=A.decryptdata,m="stats"in P;if(x==null||x.key==null||x.method!=="AES-128"||m){var a=this.tracks[A.level],c=this.vttCCs;c[A.cc]||(c[A.cc]={start:A.start,prevCC:this.prevCC,new:!0},this.prevCC=A.cc),a&&a.textCodec===M.IMSC1_CODEC?this._parseIMSC1(A,g):this._parseVTTs(A,g,c)}}else this.hls.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:A,error:new Error("Empty subtitle payload")})},u._parseIMSC1=function(o,P){var A=this,g=this.hls;Object(M.parseIMSC1)(P,this.initPTS[o.cc],this.timescale[o.cc],function(t){A._appendCues(t,o.level),g.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:o})},function(t){w.logger.log("Failed to parse IMSC1: "+t),g.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:o,error:t})})},u._parseVTTs=function(o,P,A){var g=this,t=this.hls;Object(U.parseWebVTT)(P,this.initPTS[o.cc],this.timescale[o.cc],A,o.cc,o.start,function(f){g._appendCues(f,o.level),t.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:o})},function(f){g._fallbackToIMSC1(o,P),w.logger.log("Failed to parse VTT cue: "+f),t.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:o,error:f})})},u._fallbackToIMSC1=function(o,P){var A=this,g=this.tracks[o.level];g.textCodec||Object(M.parseIMSC1)(P,this.initPTS[o.cc],this.timescale[o.cc],function(){g.textCodec=M.IMSC1_CODEC,A._parseIMSC1(o,P)},function(){g.textCodec="wvtt"})},u._appendCues=function(o,P){var A=this.hls;if(this.config.renderTextTracksNatively){var g=this.textTracks[P];if(g.mode==="disabled")return;o.forEach(function(x){return Object(I.addCueToTrack)(g,x)})}else{var t=this.tracks[P],f=t.default?"default":"subtitles"+P;A.trigger(T.Events.CUES_PARSED,{type:"subtitles",cues:o,track:f})}},u.onFragDecrypted=function(o,P){var A=P.frag;if(A.type===C.PlaylistLevelType.SUBTITLE){if(!Object(R.isFiniteNumber)(this.initPTS[A.cc])){this.unparsedVttFrags.push(P);return}this.onFragLoaded(T.Events.FRAG_LOADED,P)}},u.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},u.onFragParsingUserdata=function(o,P){var A=this.cea608Parser1,g=this.cea608Parser2;if(!(!this.enabled||!(A&&g)))for(var t=0;t<P.samples.length;t++){var f=P.samples[t].bytes;if(f){var x=this.extractCea608Data(f);A.addData(P.samples[t].pts,x[0]),g.addData(P.samples[t].pts,x[1])}}},u.onBufferFlushing=function(o,P){var A=P.startOffset,g=P.endOffset,t=P.endOffsetSubtitles,f=P.type,x=this.media;if(!(!x||x.currentTime<g)){if(!f||f==="video"){var m=this.captionsTracks;Object.keys(m).forEach(function(c){return Object(I.removeCuesInRange)(m[c],A,g)})}if(this.config.renderTextTracksNatively&&A===0&&t!==void 0){var a=this.textTracks;Object.keys(a).forEach(function(c){return Object(I.removeCuesInRange)(a[c],A,t)})}}},u.extractCea608Data=function(o){for(var P=o[0]&31,A=2,g=[[],[]],t=0;t<P;t++){var f=o[A++],x=127&o[A++],m=127&o[A++],a=(4&f)!==0,c=3&f;x===0&&m===0||a&&(c===0||c===1)&&(g[c].push(x),g[c].push(m))}return g},E}();function k(E,u){return E&&E.label===u.name&&!(E.textTrack1||E.textTrack2)}function F(E,u,y,o){return Math.min(u,o)-Math.max(E,y)}function D(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}},"./src/crypt/aes-crypto.ts":function(S,l,r){r.r(l),r.d(l,"default",function(){return R});var R=function(){function T(N,U){this.subtle=void 0,this.aesIV=void 0,this.subtle=N,this.aesIV=U}var O=T.prototype;return O.decrypt=function(U,I){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},I,U)},T}()},"./src/crypt/aes-decryptor.ts":function(S,l,r){r.r(l),r.d(l,"removePadding",function(){return T}),r.d(l,"default",function(){return O});var R=r("./src/utils/typed-array.ts");function T(N){var U=N.byteLength,I=U&&new DataView(N.buffer).getUint8(U-1);return I?Object(R.sliceUint8)(N,0,U-I):N}var O=function(){function N(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var U=N.prototype;return U.uint8ArrayToUint32Array_=function(M){for(var C=new DataView(M),w=new Uint32Array(4),v=0;v<4;v++)w[v]=C.getUint32(v*4);return w},U.initTable=function(){var M=this.sBox,C=this.invSBox,w=this.subMix,v=w[0],k=w[1],F=w[2],D=w[3],E=this.invSubMix,u=E[0],y=E[1],o=E[2],P=E[3],A=new Uint32Array(256),g=0,t=0,f=0;for(f=0;f<256;f++)f<128?A[f]=f<<1:A[f]=f<<1^283;for(f=0;f<256;f++){var x=t^t<<1^t<<2^t<<3^t<<4;x=x>>>8^x&255^99,M[g]=x,C[x]=g;var m=A[g],a=A[m],c=A[a],L=A[x]*257^x*16843008;v[g]=L<<24|L>>>8,k[g]=L<<16|L>>>16,F[g]=L<<8|L>>>24,D[g]=L,L=c*16843009^a*65537^m*257^g*16843008,u[x]=L<<24|L>>>8,y[x]=L<<16|L>>>16,o[x]=L<<8|L>>>24,P[x]=L,g?(g=m^A[A[A[c^m]]],t^=A[A[t]]):g=t=1}},U.expandKey=function(M){for(var C=this.uint8ArrayToUint32Array_(M),w=!0,v=0;v<C.length&&w;)w=C[v]===this.key[v],v++;if(!w){this.key=C;var k=this.keySize=C.length;if(k!==4&&k!==6&&k!==8)throw new Error("Invalid aes key size="+k);var F=this.ksRows=(k+6+1)*4,D,E,u=this.keySchedule=new Uint32Array(F),y=this.invKeySchedule=new Uint32Array(F),o=this.sBox,P=this.rcon,A=this.invSubMix,g=A[0],t=A[1],f=A[2],x=A[3],m,a;for(D=0;D<F;D++){if(D<k){m=u[D]=C[D];continue}a=m,D%k===0?(a=a<<8|a>>>24,a=o[a>>>24]<<24|o[a>>>16&255]<<16|o[a>>>8&255]<<8|o[a&255],a^=P[D/k|0]<<24):k>6&&D%k===4&&(a=o[a>>>24]<<24|o[a>>>16&255]<<16|o[a>>>8&255]<<8|o[a&255]),u[D]=m=(u[D-k]^a)>>>0}for(E=0;E<F;E++)D=F-E,E&3?a=u[D]:a=u[D-4],E<4||D<=4?y[E]=a:y[E]=g[o[a>>>24]]^t[o[a>>>16&255]]^f[o[a>>>8&255]]^x[o[a&255]],y[E]=y[E]>>>0}},U.networkToHostOrderSwap=function(M){return M<<24|(M&65280)<<8|(M&16711680)>>8|M>>>24},U.decrypt=function(M,C,w){for(var v=this.keySize+6,k=this.invKeySchedule,F=this.invSBox,D=this.invSubMix,E=D[0],u=D[1],y=D[2],o=D[3],P=this.uint8ArrayToUint32Array_(w),A=P[0],g=P[1],t=P[2],f=P[3],x=new Int32Array(M),m=new Int32Array(x.length),a,c,L,_,B,$,K,H,j,W,z,Q,V,J,X=this.networkToHostOrderSwap;C<x.length;){for(j=X(x[C]),W=X(x[C+1]),z=X(x[C+2]),Q=X(x[C+3]),B=j^k[0],$=Q^k[1],K=z^k[2],H=W^k[3],V=4,J=1;J<v;J++)a=E[B>>>24]^u[$>>16&255]^y[K>>8&255]^o[H&255]^k[V],c=E[$>>>24]^u[K>>16&255]^y[H>>8&255]^o[B&255]^k[V+1],L=E[K>>>24]^u[H>>16&255]^y[B>>8&255]^o[$&255]^k[V+2],_=E[H>>>24]^u[B>>16&255]^y[$>>8&255]^o[K&255]^k[V+3],B=a,$=c,K=L,H=_,V=V+4;a=F[B>>>24]<<24^F[$>>16&255]<<16^F[K>>8&255]<<8^F[H&255]^k[V],c=F[$>>>24]<<24^F[K>>16&255]<<16^F[H>>8&255]<<8^F[B&255]^k[V+1],L=F[K>>>24]<<24^F[H>>16&255]<<16^F[B>>8&255]<<8^F[$&255]^k[V+2],_=F[H>>>24]<<24^F[B>>16&255]<<16^F[$>>8&255]<<8^F[K&255]^k[V+3],m[C]=X(a^A),m[C+1]=X(_^g),m[C+2]=X(L^t),m[C+3]=X(c^f),A=j,g=W,t=z,f=Q,C=C+4}return m.buffer},N}()},"./src/crypt/decrypter.ts":function(S,l,r){r.r(l),r.d(l,"default",function(){return C});var R=r("./src/crypt/aes-crypto.ts"),T=r("./src/crypt/fast-aes-key.ts"),O=r("./src/crypt/aes-decryptor.ts"),N=r("./src/utils/logger.ts"),U=r("./src/utils/mp4-tools.ts"),I=r("./src/utils/typed-array.ts"),M=16,C=function(){function w(k,F,D){var E=D===void 0?{}:D,u=E.removePKCS7Padding,y=u===void 0?!0:u;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=k,this.config=F,this.removePKCS7Padding=y,y)try{var o=self.crypto;o&&(this.subtle=o.subtle||o.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var v=w.prototype;return v.destroy=function(){this.observer=null},v.isSync=function(){return this.config.enableSoftwareAES},v.flush=function(){var F=this.currentResult;if(!F){this.reset();return}var D=new Uint8Array(F);return this.reset(),this.removePKCS7Padding?Object(O.removePadding)(D):D},v.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},v.decrypt=function(F,D,E,u){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(F),D,E);var y=this.flush();y&&u(y.buffer)}else this.webCryptoDecrypt(new Uint8Array(F),D,E).then(u)},v.softwareDecrypt=function(F,D,E){var u=this.currentIV,y=this.currentResult,o=this.remainderData;this.logOnce("JS AES decrypt"),o&&(F=Object(U.appendUint8Array)(o,F),this.remainderData=null);var P=this.getValidChunk(F);if(!P.length)return null;u&&(E=u);var A=this.softwareDecrypter;A||(A=this.softwareDecrypter=new O.default),A.expandKey(D);var g=y;return this.currentResult=A.decrypt(P.buffer,0,E),this.currentIV=Object(I.sliceUint8)(P,-16).buffer,g||null},v.webCryptoDecrypt=function(F,D,E){var u=this,y=this.subtle;return(this.key!==D||!this.fastAesKey)&&(this.key=D,this.fastAesKey=new T.default(y,D)),this.fastAesKey.expandKey().then(function(o){if(!y)return Promise.reject(new Error("web crypto not initialized"));var P=new R.default(y,E);return P.decrypt(F.buffer,o)}).catch(function(o){return u.onWebCryptoError(o,F,D,E)})},v.onWebCryptoError=function(F,D,E,u){return N.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",F),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(D,E,u)},v.getValidChunk=function(F){var D=F,E=F.length-F.length%M;return E!==F.length&&(D=Object(I.sliceUint8)(F,0,E),this.remainderData=Object(I.sliceUint8)(F,E)),D},v.logOnce=function(F){!this.logEnabled||(N.logger.log("[decrypter.ts]: "+F),this.logEnabled=!1)},w}()},"./src/crypt/fast-aes-key.ts":function(S,l,r){r.r(l),r.d(l,"default",function(){return R});var R=function(){function T(N,U){this.subtle=void 0,this.key=void 0,this.subtle=N,this.key=U}var O=T.prototype;return O.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},T}()},"./src/demux/aacdemuxer.ts":function(S,l,r){r.r(l);var R=r("./src/demux/base-audio-demuxer.ts"),T=r("./src/demux/adts.ts"),O=r("./src/utils/logger.ts"),N=r("./src/demux/id3.ts");function U(C,w){C.prototype=Object.create(w.prototype),C.prototype.constructor=C,I(C,w)}function I(C,w){return I=Object.setPrototypeOf||function(k,F){return k.__proto__=F,k},I(C,w)}var M=function(C){U(w,C);function w(k,F){var D;return D=C.call(this)||this,D.observer=void 0,D.config=void 0,D.observer=k,D.config=F,D}var v=w.prototype;return v.resetInitSegment=function(F,D,E){C.prototype.resetInitSegment.call(this,F,D,E),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:F,duration:E,inputTimeScale:9e4,dropped:0}},w.probe=function(F){if(!F)return!1;for(var D=N.getID3Data(F,0)||[],E=D.length,u=F.length;E<u;E++)if(T.probe(F,E))return O.logger.log("ADTS sync word found !"),!0;return!1},v.canParse=function(F,D){return T.canParse(F,D)},v.appendFrame=function(F,D,E){T.initTrackConfig(F,this.observer,D,E,F.manifestCodec);var u=T.appendFrame(F,D,E,this.initPTS,this.frameIndex);if(u&&u.missing===0)return u},w}(R.default);M.minProbeByteLength=9,l.default=M},"./src/demux/adts.ts":function(S,l,r){r.r(l),r.d(l,"getAudioConfig",function(){return N}),r.d(l,"isHeaderPattern",function(){return U}),r.d(l,"getHeaderLength",function(){return I}),r.d(l,"getFullFrameLength",function(){return M}),r.d(l,"canGetFrameLength",function(){return C}),r.d(l,"isHeader",function(){return w}),r.d(l,"canParse",function(){return v}),r.d(l,"probe",function(){return k}),r.d(l,"initTrackConfig",function(){return F}),r.d(l,"getFrameDuration",function(){return D}),r.d(l,"parseFrameHeader",function(){return E}),r.d(l,"appendFrame",function(){return u});var R=r("./src/utils/logger.ts"),T=r("./src/errors.ts"),O=r("./src/events.ts");function N(y,o,P,A){var g,t,f,x,m=navigator.userAgent.toLowerCase(),a=A,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];g=((o[P+2]&192)>>>6)+1;var L=(o[P+2]&60)>>>2;if(L>c.length-1){y.trigger(O.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+L});return}return f=(o[P+2]&1)<<2,f|=(o[P+3]&192)>>>6,R.logger.log("manifest codec:"+A+", ADTS type:"+g+", samplingIndex:"+L),/firefox/i.test(m)?L>=6?(g=5,x=new Array(4),t=L-3):(g=2,x=new Array(2),t=L):m.indexOf("android")!==-1?(g=2,x=new Array(2),t=L):(g=5,x=new Array(4),A&&(A.indexOf("mp4a.40.29")!==-1||A.indexOf("mp4a.40.5")!==-1)||!A&&L>=6?t=L-3:((A&&A.indexOf("mp4a.40.2")!==-1&&(L>=6&&f===1||/vivaldi/i.test(m))||!A&&f===1)&&(g=2,x=new Array(2)),t=L)),x[0]=g<<3,x[0]|=(L&14)>>1,x[1]|=(L&1)<<7,x[1]|=f<<3,g===5&&(x[1]|=(t&14)>>1,x[2]=(t&1)<<7,x[2]|=2<<2,x[3]=0),{config:x,samplerate:c[L],channelCount:f,codec:"mp4a.40."+g,manifestCodec:a}}function U(y,o){return y[o]===255&&(y[o+1]&246)===240}function I(y,o){return y[o+1]&1?7:9}function M(y,o){return(y[o+3]&3)<<11|y[o+4]<<3|(y[o+5]&224)>>>5}function C(y,o){return o+5<y.length}function w(y,o){return o+1<y.length&&U(y,o)}function v(y,o){return C(y,o)&&U(y,o)&&M(y,o)<=y.length-o}function k(y,o){if(w(y,o)){var P=I(y,o);if(o+P>=y.length)return!1;var A=M(y,o);if(A<=P)return!1;var g=o+A;return g===y.length||w(y,g)}return!1}function F(y,o,P,A,g){if(!y.samplerate){var t=N(o,P,A,g);if(!t)return;y.config=t.config,y.samplerate=t.samplerate,y.channelCount=t.channelCount,y.codec=t.codec,y.manifestCodec=t.manifestCodec,R.logger.log("parsed codec:"+y.codec+", rate:"+t.samplerate+", channels:"+t.channelCount)}}function D(y){return 1024*9e4/y}function E(y,o,P,A,g){var t=I(y,o),f=M(y,o);if(f-=t,f>0){var x=P+A*g;return{headerLength:t,frameLength:f,stamp:x}}}function u(y,o,P,A,g){var t=D(y.samplerate),f=E(o,P,A,g,t);if(f){var x=f.frameLength,m=f.headerLength,a=f.stamp,c=m+x,L=Math.max(0,P+c-o.length),_;L?(_=new Uint8Array(c-m),_.set(o.subarray(P+m,o.length),0)):_=o.subarray(P+m,P+c);var B={unit:_,pts:a};return L||y.samples.push(B),{sample:B,length:c,missing:L}}}},"./src/demux/base-audio-demuxer.ts":function(S,l,r){r.r(l),r.d(l,"initPTSFn",function(){return M});var R=r("./src/polyfills/number.ts"),T=r("./src/demux/id3.ts"),O=r("./src/demux/dummy-demuxed-track.ts"),N=r("./src/utils/mp4-tools.ts"),U=r("./src/utils/typed-array.ts"),I=function(){function C(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var w=C.prototype;return w.resetInitSegment=function(k,F,D){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},w.resetTimeStamp=function(){},w.resetContiguity=function(){},w.canParse=function(k,F){return!1},w.appendFrame=function(k,F,D){},w.demux=function(k,F){this.cachedData&&(k=Object(N.appendUint8Array)(this.cachedData,k),this.cachedData=null);var D=T.getID3Data(k,0),E=D?D.length:0,u,y,o=this._audioTrack,P=this._id3Track,A=D?T.getTimeStamp(D):void 0,g=k.length;for((this.frameIndex===0||this.initPTS===null)&&(this.initPTS=M(A,F)),D&&D.length>0&&P.samples.push({pts:this.initPTS,dts:this.initPTS,data:D}),y=this.initPTS;E<g;){if(this.canParse(k,E)){var t=this.appendFrame(o,k,E);t?(this.frameIndex++,y=t.sample.pts,E+=t.length,u=E):E=g}else T.canParse(k,E)?(D=T.getID3Data(k,E),P.samples.push({pts:y,dts:y,data:D}),E+=D.length,u=E):E++;if(E===g&&u!==g){var f=Object(U.sliceUint8)(k,u);this.cachedData?this.cachedData=Object(N.appendUint8Array)(this.cachedData,f):this.cachedData=f}}return{audioTrack:o,avcTrack:Object(O.dummyTrack)(),id3Track:P,textTrack:Object(O.dummyTrack)()}},w.demuxSampleAes=function(k,F,D){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},w.flush=function(k){var F=this.cachedData;return F&&(this.cachedData=null,this.demux(F,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(O.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(O.dummyTrack)()}},w.destroy=function(){},C}(),M=function(w,v){return Object(R.isFiniteNumber)(w)?w*90:v*9e4};l.default=I},"./src/demux/chunk-cache.ts":function(S,l,r){r.r(l),r.d(l,"default",function(){return R});var R=function(){function O(){this.chunks=[],this.dataLength=0}var N=O.prototype;return N.push=function(I){this.chunks.push(I),this.dataLength+=I.length},N.flush=function(){var I=this.chunks,M=this.dataLength,C;if(I.length)I.length===1?C=I[0]:C=T(I,M);else return new Uint8Array(0);return this.reset(),C},N.reset=function(){this.chunks.length=0,this.dataLength=0},O}();function T(O,N){for(var U=new Uint8Array(N),I=0,M=0;M<O.length;M++){var C=O[M];U.set(C,I),I+=C.length}return U}},"./src/demux/dummy-demuxed-track.ts":function(S,l,r){r.r(l),r.d(l,"dummyTrack",function(){return R});function R(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(S,l,r){r.r(l);var R=r("./src/utils/logger.ts"),T=function(){function O(U){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=U,this.bytesAvailable=U.byteLength,this.word=0,this.bitsAvailable=0}var N=O.prototype;return N.loadWord=function(){var I=this.data,M=this.bytesAvailable,C=I.byteLength-M,w=new Uint8Array(4),v=Math.min(4,M);if(v===0)throw new Error("no bytes available");w.set(I.subarray(C,C+v)),this.word=new DataView(w.buffer).getUint32(0),this.bitsAvailable=v*8,this.bytesAvailable-=v},N.skipBits=function(I){var M;this.bitsAvailable>I?(this.word<<=I,this.bitsAvailable-=I):(I-=this.bitsAvailable,M=I>>3,I-=M>>3,this.bytesAvailable-=M,this.loadWord(),this.word<<=I,this.bitsAvailable-=I)},N.readBits=function(I){var M=Math.min(this.bitsAvailable,I),C=this.word>>>32-M;return I>32&&R.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=M,this.bitsAvailable>0?this.word<<=M:this.bytesAvailable>0&&this.loadWord(),M=I-M,M>0&&this.bitsAvailable?C<<M|this.readBits(M):C},N.skipLZ=function(){var I;for(I=0;I<this.bitsAvailable;++I)if((this.word&2147483648>>>I)!==0)return this.word<<=I,this.bitsAvailable-=I,I;return this.loadWord(),I+this.skipLZ()},N.skipUEG=function(){this.skipBits(1+this.skipLZ())},N.skipEG=function(){this.skipBits(1+this.skipLZ())},N.readUEG=function(){var I=this.skipLZ();return this.readBits(I+1)-1},N.readEG=function(){var I=this.readUEG();return 1&I?1+I>>>1:-1*(I>>>1)},N.readBoolean=function(){return this.readBits(1)===1},N.readUByte=function(){return this.readBits(8)},N.readUShort=function(){return this.readBits(16)},N.readUInt=function(){return this.readBits(32)},N.skipScalingList=function(I){for(var M=8,C=8,w,v=0;v<I;v++)C!==0&&(w=this.readEG(),C=(M+w+256)%256),M=C===0?M:C},N.readSPS=function(){var I=0,M=0,C=0,w=0,v,k,F,D=this.readUByte.bind(this),E=this.readBits.bind(this),u=this.readUEG.bind(this),y=this.readBoolean.bind(this),o=this.skipBits.bind(this),P=this.skipEG.bind(this),A=this.skipUEG.bind(this),g=this.skipScalingList.bind(this);D();var t=D();if(E(5),o(3),D(),A(),t===100||t===110||t===122||t===244||t===44||t===83||t===86||t===118||t===128){var f=u();if(f===3&&o(1),A(),A(),o(1),y())for(k=f!==3?8:12,F=0;F<k;F++)y()&&(F<6?g(16):g(64))}A();var x=u();if(x===0)u();else if(x===1)for(o(1),P(),P(),v=u(),F=0;F<v;F++)P();A(),o(1);var m=u(),a=u(),c=E(1);c===0&&o(1),o(1),y()&&(I=u(),M=u(),C=u(),w=u());var L=[1,1];if(y()&&y()){var _=D();switch(_){case 1:L=[1,1];break;case 2:L=[12,11];break;case 3:L=[10,11];break;case 4:L=[16,11];break;case 5:L=[40,33];break;case 6:L=[24,11];break;case 7:L=[20,11];break;case 8:L=[32,11];break;case 9:L=[80,33];break;case 10:L=[18,11];break;case 11:L=[15,11];break;case 12:L=[64,33];break;case 13:L=[160,99];break;case 14:L=[4,3];break;case 15:L=[3,2];break;case 16:L=[2,1];break;case 255:{L=[D()<<8|D(),D()<<8|D()];break}}}return{width:Math.ceil((m+1)*16-I*2-M*2),height:(2-c)*(a+1)*16-(c?2:4)*(C+w),pixelRatio:L}},N.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},O}();l.default=T},"./src/demux/id3.ts":function(S,l,r){r.r(l),r.d(l,"isHeader",function(){return R}),r.d(l,"isFooter",function(){return T}),r.d(l,"getID3Data",function(){return O}),r.d(l,"canParse",function(){return U}),r.d(l,"getTimeStamp",function(){return I}),r.d(l,"isTimeStampFrame",function(){return M}),r.d(l,"getID3Frames",function(){return w}),r.d(l,"decodeFrame",function(){return v}),r.d(l,"utf8ArrayToStr",function(){return u}),r.d(l,"testables",function(){return y});var R=function(g,t){return t+10<=g.length&&g[t]===73&&g[t+1]===68&&g[t+2]===51&&g[t+3]<255&&g[t+4]<255&&g[t+6]<128&&g[t+7]<128&&g[t+8]<128&&g[t+9]<128},T=function(g,t){return t+10<=g.length&&g[t]===51&&g[t+1]===68&&g[t+2]===73&&g[t+3]<255&&g[t+4]<255&&g[t+6]<128&&g[t+7]<128&&g[t+8]<128&&g[t+9]<128},O=function(g,t){for(var f=t,x=0;R(g,t);){x+=10;var m=N(g,t+6);x+=m,T(g,t+10)&&(x+=10),t+=x}if(x>0)return g.subarray(f,f+x)},N=function(g,t){var f=0;return f=(g[t]&127)<<21,f|=(g[t+1]&127)<<14,f|=(g[t+2]&127)<<7,f|=g[t+3]&127,f},U=function(g,t){return R(g,t)&&N(g,t+6)+10<=g.length-t},I=function(g){for(var t=w(g),f=0;f<t.length;f++){var x=t[f];if(M(x))return E(x)}},M=function(g){return g&&g.key==="PRIV"&&g.info==="com.apple.streaming.transportStreamTimestamp"},C=function(g){var t=String.fromCharCode(g[0],g[1],g[2],g[3]),f=N(g,4),x=10;return{type:t,size:f,data:g.subarray(x,x+f)}},w=function(g){for(var t=0,f=[];R(g,t);){var x=N(g,t+6);t+=10;for(var m=t+x;t+8<m;){var a=C(g.subarray(t)),c=v(a);c&&f.push(c),t+=a.size+10}T(g,t)&&(t+=10)}return f},v=function(g){return g.type==="PRIV"?k(g):g.type[0]==="W"?D(g):F(g)},k=function(g){if(!(g.size<2)){var t=u(g.data,!0),f=new Uint8Array(g.data.subarray(t.length+1));return{key:g.type,info:t,data:f.buffer}}},F=function(g){if(!(g.size<2)){if(g.type==="TXXX"){var t=1,f=u(g.data.subarray(t),!0);t+=f.length+1;var x=u(g.data.subarray(t));return{key:g.type,info:f,data:x}}var m=u(g.data.subarray(1));return{key:g.type,data:m}}},D=function(g){if(g.type==="WXXX"){if(g.size<2)return;var t=1,f=u(g.data.subarray(t),!0);t+=f.length+1;var x=u(g.data.subarray(t));return{key:g.type,info:f,data:x}}var m=u(g.data);return{key:g.type,data:m}},E=function(g){if(g.data.byteLength===8){var t=new Uint8Array(g.data),f=t[3]&1,x=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return x/=45,f&&(x+=4772185884e-2),Math.round(x)}},u=function(g,t){t===void 0&&(t=!1);var f=P();if(f){var x=f.decode(g);if(t){var m=x.indexOf("\0");return m!==-1?x.substring(0,m):x}return x.replace(/\0/g,"")}for(var a=g.length,c,L,_,B="",$=0;$<a;){if(c=g[$++],c===0&&t)return B;if(c===0||c===3)continue;switch(c>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:B+=String.fromCharCode(c);break;case 12:case 13:L=g[$++],B+=String.fromCharCode((c&31)<<6|L&63);break;case 14:L=g[$++],_=g[$++],B+=String.fromCharCode((c&15)<<12|(L&63)<<6|(_&63)<<0);break}}return B},y={decodeTextFrame:F},o;function P(){return!o&&typeof self.TextDecoder!="undefined"&&(o=new self.TextDecoder("utf-8")),o}},"./src/demux/mp3demuxer.ts":function(S,l,r){r.r(l);var R=r("./src/demux/base-audio-demuxer.ts"),T=r("./src/demux/id3.ts"),O=r("./src/utils/logger.ts"),N=r("./src/demux/mpegaudio.ts");function U(C,w){C.prototype=Object.create(w.prototype),C.prototype.constructor=C,I(C,w)}function I(C,w){return I=Object.setPrototypeOf||function(k,F){return k.__proto__=F,k},I(C,w)}var M=function(C){U(w,C);function w(){return C.apply(this,arguments)||this}var v=w.prototype;return v.resetInitSegment=function(F,D,E){C.prototype.resetInitSegment.call(this,F,D,E),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:F,duration:E,inputTimeScale:9e4,dropped:0}},w.probe=function(F){if(!F)return!1;for(var D=T.getID3Data(F,0)||[],E=D.length,u=F.length;E<u;E++)if(N.probe(F,E))return O.logger.log("MPEG Audio sync word found !"),!0;return!1},v.canParse=function(F,D){return N.canParse(F,D)},v.appendFrame=function(F,D,E){if(this.initPTS!==null)return N.appendFrame(F,D,E,this.initPTS,this.frameIndex)},w}(R.default);M.minProbeByteLength=4,l.default=M},"./src/demux/mp4demuxer.ts":function(S,l,r){r.r(l);var R=r("./src/utils/mp4-tools.ts"),T=r("./src/demux/dummy-demuxed-track.ts"),O=function(){function N(I,M){this.remainderData=null,this.config=void 0,this.config=M}var U=N.prototype;return U.resetTimeStamp=function(){},U.resetInitSegment=function(){},U.resetContiguity=function(){},N.probe=function(M){return Object(R.findBox)({data:M,start:0,end:Math.min(M.length,16384)},["moof"]).length>0},U.demux=function(M){var C=M,w=Object(T.dummyTrack)();if(this.config.progressive){this.remainderData&&(C=Object(R.appendUint8Array)(this.remainderData,M));var v=Object(R.segmentValidRange)(C);this.remainderData=v.remainder,w.samples=v.valid||new Uint8Array}else w.samples=C;return{audioTrack:Object(T.dummyTrack)(),avcTrack:w,id3Track:Object(T.dummyTrack)(),textTrack:Object(T.dummyTrack)()}},U.flush=function(){var M=Object(T.dummyTrack)();return M.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(T.dummyTrack)(),avcTrack:M,id3Track:Object(T.dummyTrack)(),textTrack:Object(T.dummyTrack)()}},U.demuxSampleAes=function(M,C,w){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},U.destroy=function(){},N}();O.minProbeByteLength=1024,l.default=O},"./src/demux/mpegaudio.ts":function(S,l,r){r.r(l),r.d(l,"appendFrame",function(){return I}),r.d(l,"parseHeader",function(){return M}),r.d(l,"isHeaderPattern",function(){return C}),r.d(l,"isHeader",function(){return w}),r.d(l,"canParse",function(){return v}),r.d(l,"probe",function(){return k});var R=null,T=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],O=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],N=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],U=[0,1,1,4];function I(F,D,E,u,y){if(!(E+24>D.length)){var o=M(D,E);if(o&&E+o.frameLength<=D.length){var P=o.samplesPerFrame*9e4/o.sampleRate,A=u+y*P,g={unit:D.subarray(E,E+o.frameLength),pts:A,dts:A};return F.config=[],F.channelCount=o.channelCount,F.samplerate=o.sampleRate,F.samples.push(g),{sample:g,length:o.frameLength,missing:0}}}}function M(F,D){var E=F[D+1]>>3&3,u=F[D+1]>>1&3,y=F[D+2]>>4&15,o=F[D+2]>>2&3;if(E!==1&&y!==0&&y!==15&&o!==3){var P=F[D+2]>>1&1,A=F[D+3]>>6,g=E===3?3-u:u===3?3:4,t=T[g*14+y-1]*1e3,f=E===3?0:E===2?1:2,x=O[f*3+o],m=A===3?1:2,a=N[E][u],c=U[u],L=a*8*c,_=Math.floor(a*t/x+P)*c;if(R===null){var B=navigator.userAgent||"",$=B.match(/Chrome\/(\d+)/i);R=$?parseInt($[1]):0}var K=!!R&&R<=87;return K&&u===2&&t>=224e3&&A===0&&(F[D+3]=F[D+3]|128),{sampleRate:x,channelCount:m,frameLength:_,samplesPerFrame:L}}}function C(F,D){return F[D]===255&&(F[D+1]&224)===224&&(F[D+1]&6)!==0}function w(F,D){return D+1<F.length&&C(F,D)}function v(F,D){var E=4;return C(F,D)&&E<=F.length-D}function k(F,D){if(D+1<F.length&&C(F,D)){var E=4,u=M(F,D),y=E;u!=null&&u.frameLength&&(y=u.frameLength);var o=D+y;return o===F.length||w(F,o)}return!1}},"./src/demux/sample-aes.ts":function(S,l,r){r.r(l);var R=r("./src/crypt/decrypter.ts"),T=r("./src/demux/tsdemuxer.ts"),O=function(){function N(I,M,C){this.keyData=void 0,this.decrypter=void 0,this.keyData=C,this.decrypter=new R.default(I,M,{removePKCS7Padding:!1})}var U=N.prototype;return U.decryptBuffer=function(M,C){this.decrypter.decrypt(M,this.keyData.key.buffer,this.keyData.iv.buffer,C)},U.decryptAacSample=function(M,C,w,v){var k=M[C].unit,F=k.subarray(16,k.length-k.length%16),D=F.buffer.slice(F.byteOffset,F.byteOffset+F.length),E=this;this.decryptBuffer(D,function(u){var y=new Uint8Array(u);k.set(y,16),v||E.decryptAacSamples(M,C+1,w)})},U.decryptAacSamples=function(M,C,w){for(;;C++){if(C>=M.length){w();return}if(!(M[C].unit.length<32)){var v=this.decrypter.isSync();if(this.decryptAacSample(M,C,w,v),!v)return}}},U.getAvcEncryptedData=function(M){for(var C=Math.floor((M.length-48)/160)*16+16,w=new Int8Array(C),v=0,k=32;k<M.length-16;k+=160,v+=16)w.set(M.subarray(k,k+16),v);return w},U.getAvcDecryptedUnit=function(M,C){for(var w=new Uint8Array(C),v=0,k=32;k<M.length-16;k+=160,v+=16)M.set(w.subarray(v,v+16),k);return M},U.decryptAvcSample=function(M,C,w,v,k,F){var D=Object(T.discardEPB)(k.data),E=this.getAvcEncryptedData(D),u=this;this.decryptBuffer(E.buffer,function(y){k.data=u.getAvcDecryptedUnit(D,y),F||u.decryptAvcSamples(M,C,w+1,v)})},U.decryptAvcSamples=function(M,C,w,v){if(M instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;C++,w=0){if(C>=M.length){v();return}for(var k=M[C].units;!(w>=k.length);w++){var F=k[w];if(!(F.data.length<=48||F.type!==1&&F.type!==5)){var D=this.decrypter.isSync();if(this.decryptAvcSample(M,C,w,v,F,D),!D)return}}}},N}();l.default=O},"./src/demux/transmuxer-interface.ts":function(S,l,r){r.r(l),r.d(l,"default",function(){return w});var R=r("./node_modules/webworkify-webpack/index.js"),T=r("./src/events.ts"),O=r("./src/demux/transmuxer.ts"),N=r("./src/utils/logger.ts"),U=r("./src/errors.ts"),I=r("./src/utils/mediasource-helper.ts"),M=r("./node_modules/eventemitter3/index.js"),C=Object(I.getMediaSource)()||{isTypeSupported:function(){return!1}},w=function(){function v(F,D,E,u){var y=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=F,this.id=D,this.onTransmuxComplete=E,this.onFlush=u;var o=F.config,P=function(x,m){m=m||{},m.frag=y.frag,m.id=y.id,F.trigger(x,m)};this.observer=new M.EventEmitter,this.observer.on(T.Events.FRAG_DECRYPTED,P),this.observer.on(T.Events.ERROR,P);var A={mp4:C.isTypeSupported("video/mp4"),mpeg:C.isTypeSupported("audio/mpeg"),mp3:C.isTypeSupported('audio/mp4; codecs="mp3"')},g=navigator.vendor;if(o.enableWorker&&typeof Worker!="undefined"){N.logger.log("demuxing in webworker");var t;try{t=this.worker=R("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),t.addEventListener("message",this.onwmsg),t.onerror=function(f){F.trigger(T.Events.ERROR,{type:U.ErrorTypes.OTHER_ERROR,details:U.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(f.message+"  ("+f.filename+":"+f.lineno+")")})},t.postMessage({cmd:"init",typeSupported:A,vendor:g,id:D,config:JSON.stringify(o)})}catch(f){N.logger.warn("Error in worker:",f),N.logger.error("Error while initializing DemuxerWorker, fallback to inline"),t&&self.URL.revokeObjectURL(t.objectURL),this.transmuxer=new O.default(this.observer,A,o,g,D),this.worker=null}}else this.transmuxer=new O.default(this.observer,A,o,g,D)}var k=v.prototype;return k.destroy=function(){var D=this.worker;if(D)D.removeEventListener("message",this.onwmsg),D.terminate(),this.worker=null;else{var E=this.transmuxer;E&&(E.destroy(),this.transmuxer=null)}var u=this.observer;u&&u.removeAllListeners(),this.observer=null},k.push=function(D,E,u,y,o,P,A,g,t,f){var x,m,a=this;t.transmuxing.start=self.performance.now();var c=this.transmuxer,L=this.worker,_=P?P.start:o.start,B=o.decryptdata,$=this.frag,K=!($&&o.cc===$.cc),H=!($&&t.level===$.level),j=$?t.sn-$.sn:-1,W=this.part?t.part-this.part.index:1,z=!H&&(j===1||j===0&&W===1),Q=self.performance.now();(H||j||o.stats.parsing.start===0)&&(o.stats.parsing.start=Q),P&&(W||!z)&&(P.stats.parsing.start=Q);var V=!($&&((x=o.initSegment)===null||x===void 0?void 0:x.url)===((m=$.initSegment)===null||m===void 0?void 0:m.url)),J=new O.TransmuxState(K,z,g,H,_,V);if(!z||K||V){N.logger.log("[transmuxer-interface, "+o.type+"]: Starting new transmux session for sn: "+t.sn+" p: "+t.part+" level: "+t.level+" id: "+t.id+`
        discontinuity: `+K+`
        trackSwitch: `+H+`
        contiguous: `+z+`
        accurateTimeOffset: `+g+`
        timeOffset: `+_+`
        initSegmentChange: `+V);var X=new O.TransmuxConfig(u,y,E,A,f);this.configureTransmuxer(X)}if(this.frag=o,this.part=P,L)L.postMessage({cmd:"demux",data:D,decryptdata:B,chunkMeta:t,state:J},D instanceof ArrayBuffer?[D]:[]);else if(c){var q=c.push(D,B,t,J);Object(O.isPromise)(q)?q.then(function(ue){a.handleTransmuxComplete(ue)}):this.handleTransmuxComplete(q)}},k.flush=function(D){var E=this;D.transmuxing.start=self.performance.now();var u=this.transmuxer,y=this.worker;if(y)y.postMessage({cmd:"flush",chunkMeta:D});else if(u){var o=u.flush(D);Object(O.isPromise)(o)?o.then(function(P){E.handleFlushResult(P,D)}):this.handleFlushResult(o,D)}},k.handleFlushResult=function(D,E){var u=this;D.forEach(function(y){u.handleTransmuxComplete(y)}),this.onFlush(E)},k.onWorkerMessage=function(D){var E=D.data,u=this.hls;switch(E.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(E.data);break}case"flush":{this.onFlush(E.data);break}default:{E.data=E.data||{},E.data.frag=this.frag,E.data.id=this.id,u.trigger(E.event,E.data);break}}},k.configureTransmuxer=function(D){var E=this.worker,u=this.transmuxer;E?E.postMessage({cmd:"configure",config:D}):u&&u.configure(D)},k.handleTransmuxComplete=function(D){D.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(D)},v}()},"./src/demux/transmuxer-worker.ts":function(S,l,r){r.r(l),r.d(l,"default",function(){return U});var R=r("./src/demux/transmuxer.ts"),T=r("./src/events.ts"),O=r("./src/utils/logger.ts"),N=r("./node_modules/eventemitter3/index.js");function U(v){var k=new N.EventEmitter,F=function(E,u){v.postMessage({event:E,data:u})};k.on(T.Events.FRAG_DECRYPTED,F),k.on(T.Events.ERROR,F),v.addEventListener("message",function(D){var E=D.data;switch(E.cmd){case"init":{var u=JSON.parse(E.config);v.transmuxer=new R.default(k,E.typeSupported,u,E.vendor,E.id),Object(O.enableLogs)(u.debug),F("init",null);break}case"configure":{v.transmuxer.configure(E.config);break}case"demux":{var y=v.transmuxer.push(E.data,E.decryptdata,E.chunkMeta,E.state);Object(R.isPromise)(y)?y.then(function(A){I(v,A)}):I(v,y);break}case"flush":{var o=E.chunkMeta,P=v.transmuxer.flush(o);Object(R.isPromise)(P)?P.then(function(A){C(v,A,o)}):C(v,P,o);break}}})}function I(v,k){if(!w(k.remuxResult)){var F=[],D=k.remuxResult,E=D.audio,u=D.video;E&&M(F,E),u&&M(F,u),v.postMessage({event:"transmuxComplete",data:k},F)}}function M(v,k){k.data1&&v.push(k.data1.buffer),k.data2&&v.push(k.data2.buffer)}function C(v,k,F){k.forEach(function(D){I(v,D)}),v.postMessage({event:"flush",data:F})}function w(v){return!v.audio&&!v.video&&!v.text&&!v.id3&&!v.initSegment}},"./src/demux/transmuxer.ts":function(S,l,r){r.r(l),r.d(l,"default",function(){return y}),r.d(l,"isPromise",function(){return A}),r.d(l,"TransmuxConfig",function(){return g}),r.d(l,"TransmuxState",function(){return t});var R=r("./src/events.ts"),T=r("./src/errors.ts"),O=r("./src/crypt/decrypter.ts"),N=r("./src/demux/aacdemuxer.ts"),U=r("./src/demux/mp4demuxer.ts"),I=r("./src/demux/tsdemuxer.ts"),M=r("./src/demux/mp3demuxer.ts"),C=r("./src/remux/mp4-remuxer.ts"),w=r("./src/remux/passthrough-remuxer.ts"),v=r("./src/demux/chunk-cache.ts"),k=r("./src/utils/mp4-tools.ts"),F=r("./src/utils/logger.ts"),D;try{D=self.performance.now.bind(self.performance)}catch{F.logger.debug("Unable to use Performance API on this environment"),D=self.Date.now}var E=[{demux:I.default,remux:C.default},{demux:U.default,remux:w.default},{demux:N.default,remux:C.default},{demux:M.default,remux:C.default}],u=1024;E.forEach(function(f){var x=f.demux;u=Math.max(u,x.minProbeByteLength)});var y=function(){function f(m,a,c,L,_){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new v.default,this.observer=m,this.typeSupported=a,this.config=c,this.vendor=L,this.id=_}var x=f.prototype;return x.configure=function(a){this.transmuxConfig=a,this.decrypter&&this.decrypter.reset()},x.push=function(a,c,L,_){var B=this,$=L.transmuxing;$.executeStart=D();var K=new Uint8Array(a),H=this.cache,j=this.config,W=this.currentTransmuxState,z=this.transmuxConfig;_&&(this.currentTransmuxState=_);var Q=o(K,c);if(Q&&Q.method==="AES-128"){var V=this.getDecrypter();if(j.enableSoftwareAES){var J=V.softwareDecrypt(K,Q.key.buffer,Q.iv.buffer);if(!J)return $.executeEnd=D(),P(L);K=new Uint8Array(J)}else return this.decryptionPromise=V.webCryptoDecrypt(K,Q.key.buffer,Q.iv.buffer).then(function(re){var de=B.push(re,null,L);return B.decryptionPromise=null,de}),this.decryptionPromise}var X=_||W,q=X.contiguous,ue=X.discontinuity,oe=X.trackSwitch,ce=X.accurateTimeOffset,le=X.timeOffset,G=X.initSegmentChange,Y=z.audioCodec,Z=z.videoCodec,ee=z.defaultInitPts,te=z.duration,ie=z.initSegmentData;if((ue||oe||G)&&this.resetInitSegment(ie,Y,Z,te),(ue||G)&&this.resetInitialTimestamp(ee),q||this.resetContiguity(),this.needsProbing(K,ue,oe)){if(H.dataLength){var se=H.flush();K=Object(k.appendUint8Array)(se,K)}this.configureTransmuxer(K,z)}var ne=this.transmux(K,Q,le,ce,L),ae=this.currentTransmuxState;return ae.contiguous=!0,ae.discontinuity=!1,ae.trackSwitch=!1,$.executeEnd=D(),ne},x.flush=function(a){var c=this,L=a.transmuxing;L.executeStart=D();var _=this.decrypter,B=this.cache,$=this.currentTransmuxState,K=this.decryptionPromise;if(K)return K.then(function(){return c.flush(a)});var H=[],j=$.timeOffset;if(_){var W=_.flush();W&&H.push(this.push(W,null,a))}var z=B.dataLength;B.reset();var Q=this.demuxer,V=this.remuxer;if(!Q||!V)return z>=u&&this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),L.executeEnd=D(),[P(a)];var J=Q.flush(j);return A(J)?J.then(function(X){return c.flushRemux(H,X,a),H}):(this.flushRemux(H,J,a),H)},x.flushRemux=function(a,c,L){var _=c.audioTrack,B=c.avcTrack,$=c.id3Track,K=c.textTrack,H=this.currentTransmuxState,j=H.accurateTimeOffset,W=H.timeOffset;F.logger.log("[transmuxer.ts]: Flushed fragment "+L.sn+(L.part>-1?" p: "+L.part:"")+" of level "+L.level);var z=this.remuxer.remux(_,B,$,K,W,j,!0,this.id);a.push({remuxResult:z,chunkMeta:L}),L.transmuxing.executeEnd=D()},x.resetInitialTimestamp=function(a){var c=this.demuxer,L=this.remuxer;!c||!L||(c.resetTimeStamp(a),L.resetTimeStamp(a))},x.resetContiguity=function(){var a=this.demuxer,c=this.remuxer;!a||!c||(a.resetContiguity(),c.resetNextTimestamp())},x.resetInitSegment=function(a,c,L,_){var B=this.demuxer,$=this.remuxer;!B||!$||(B.resetInitSegment(c,L,_),$.resetInitSegment(a,c,L))},x.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},x.transmux=function(a,c,L,_,B){var $;return c&&c.method==="SAMPLE-AES"?$=this.transmuxSampleAes(a,c,L,_,B):$=this.transmuxUnencrypted(a,L,_,B),$},x.transmuxUnencrypted=function(a,c,L,_){var B=this.demuxer.demux(a,c,!1,!this.config.progressive),$=B.audioTrack,K=B.avcTrack,H=B.id3Track,j=B.textTrack,W=this.remuxer.remux($,K,H,j,c,L,!1,this.id);return{remuxResult:W,chunkMeta:_}},x.transmuxSampleAes=function(a,c,L,_,B){var $=this;return this.demuxer.demuxSampleAes(a,c,L).then(function(K){var H=$.remuxer.remux(K.audioTrack,K.avcTrack,K.id3Track,K.textTrack,L,_,!1,$.id);return{remuxResult:H,chunkMeta:B}})},x.configureTransmuxer=function(a,c){for(var L=this.config,_=this.observer,B=this.typeSupported,$=this.vendor,K=c.audioCodec,H=c.defaultInitPts,j=c.duration,W=c.initSegmentData,z=c.videoCodec,Q,V=0,J=E.length;V<J;V++)if(E[V].demux.probe(a)){Q=E[V];break}Q||(F.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),Q={demux:U.default,remux:w.default});var X=this.demuxer,q=this.remuxer,ue=Q.remux,oe=Q.demux;(!q||!(q instanceof ue))&&(this.remuxer=new ue(_,L,B,$)),(!X||!(X instanceof oe))&&(this.demuxer=new oe(_,L,B),this.probe=oe.probe),this.resetInitSegment(W,K,z,j),this.resetInitialTimestamp(H)},x.needsProbing=function(a,c,L){return!this.demuxer||!this.remuxer||c||L},x.getDecrypter=function(){var a=this.decrypter;return a||(a=this.decrypter=new O.default(this.observer,this.config)),a},f}();function o(f,x){var m=null;return f.byteLength>0&&x!=null&&x.key!=null&&x.iv!==null&&x.method!=null&&(m=x),m}var P=function(x){return{remuxResult:{},chunkMeta:x}};function A(f){return"then"in f&&f.then instanceof Function}var g=function(x,m,a,c,L){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=x,this.videoCodec=m,this.initSegmentData=a,this.duration=c,this.defaultInitPts=L},t=function(x,m,a,c,L,_){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=x,this.contiguous=m,this.accurateTimeOffset=a,this.trackSwitch=c,this.timeOffset=L,this.initSegmentChange=_}},"./src/demux/tsdemuxer.ts":function(S,l,r){r.r(l),r.d(l,"discardEPB",function(){return P});var R=r("./src/demux/adts.ts"),T=r("./src/demux/mpegaudio.ts"),O=r("./src/demux/exp-golomb.ts"),N=r("./src/demux/id3.ts"),U=r("./src/demux/sample-aes.ts"),I=r("./src/events.ts"),M=r("./src/utils/mp4-tools.ts"),C=r("./src/utils/logger.ts"),w=r("./src/errors.ts"),v={video:1,audio:2,id3:3,text:4},k=function(){function A(t,f,x){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=t,this.config=f,this.typeSupported=x}A.probe=function(f){var x=A.syncOffset(f);return x<0?!1:(x&&C.logger.warn("MPEG2-TS detected but first sync word found @ offset "+x+", junk ahead ?"),!0)},A.syncOffset=function(f){for(var x=Math.min(1e3,f.length-564),m=0;m<x;){if(f[m]===71&&f[m+188]===71&&f[m+2*188]===71)return m;m++}return-1},A.createTrack=function(f,x){return{container:f==="video"||f==="audio"?"video/mp2t":void 0,type:f,id:v[f],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:f==="audio"?x:void 0}};var g=A.prototype;return g.resetInitSegment=function(f,x,m){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=A.createTrack("video",m),this._audioTrack=A.createTrack("audio",m),this._id3Track=A.createTrack("id3",m),this._txtTrack=A.createTrack("text",m),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=f,this.videoCodec=x,this._duration=m},g.resetTimeStamp=function(){},g.resetContiguity=function(){var f=this._audioTrack,x=this._avcTrack,m=this._id3Track;f&&(f.pesData=null),x&&(x.pesData=null),m&&(m.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},g.demux=function(f,x,m,a){m===void 0&&(m=!1),a===void 0&&(a=!1),m||(this.sampleAes=null);var c,L=this._avcTrack,_=this._audioTrack,B=this._id3Track,$=L.pid,K=L.pesData,H=_.pid,j=B.pid,W=_.pesData,z=B.pesData,Q=!1,V=this.pmtParsed,J=this._pmtId,X=f.length;if(this.remainderData&&(f=Object(M.appendUint8Array)(this.remainderData,f),X=f.length,this.remainderData=null),X<188&&!a)return this.remainderData=f,{audioTrack:_,avcTrack:L,id3Track:B,textTrack:this._txtTrack};var q=Math.max(0,A.syncOffset(f));X-=(X+q)%188,X<f.byteLength&&!a&&(this.remainderData=new Uint8Array(f.buffer,X,f.buffer.byteLength-X));for(var ue=0,oe=q;oe<X;oe+=188)if(f[oe]===71){var ce=!!(f[oe+1]&64),le=((f[oe+1]&31)<<8)+f[oe+2],G=(f[oe+3]&48)>>4,Y=void 0;if(G>1){if(Y=oe+5+f[oe+4],Y===oe+188)continue}else Y=oe+4;switch(le){case $:ce&&(K&&(c=u(K))&&this.parseAVCPES(c,!1),K={data:[],size:0}),K&&(K.data.push(f.subarray(Y,oe+188)),K.size+=oe+188-Y);break;case H:ce&&(W&&(c=u(W))&&(_.isAAC?this.parseAACPES(c):this.parseMPEGPES(c)),W={data:[],size:0}),W&&(W.data.push(f.subarray(Y,oe+188)),W.size+=oe+188-Y);break;case j:ce&&(z&&(c=u(z))&&this.parseID3PES(c),z={data:[],size:0}),z&&(z.data.push(f.subarray(Y,oe+188)),z.size+=oe+188-Y);break;case 0:ce&&(Y+=f[Y]+1),J=this._pmtId=D(f,Y);break;case J:{ce&&(Y+=f[Y]+1);var Z=E(f,Y,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,m);$=Z.avc,$>0&&(L.pid=$),H=Z.audio,H>0&&(_.pid=H,_.isAAC=Z.isAAC),j=Z.id3,j>0&&(B.pid=j),Q&&!V&&(C.logger.log("reparse from beginning"),Q=!1,oe=q-188),V=this.pmtParsed=!0;break}case 17:case 8191:break;default:Q=!0;break}}else ue++;ue>0&&this.observer.emit(I.Events.ERROR,I.Events.ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+ue+" TS packet/s that do not start with 0x47"}),L.pesData=K,_.pesData=W,B.pesData=z;var ee={audioTrack:_,avcTrack:L,id3Track:B,textTrack:this._txtTrack};return a&&this.extractRemainingSamples(ee),ee},g.flush=function(){var f=this.remainderData;this.remainderData=null;var x;return f?x=this.demux(f,-1,!1,!0):x={audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(x),this.sampleAes?this.decrypt(x,this.sampleAes):x},g.extractRemainingSamples=function(f){var x=f.audioTrack,m=f.avcTrack,a=f.id3Track,c=m.pesData,L=x.pesData,_=a.pesData,B;c&&(B=u(c))?(this.parseAVCPES(B,!0),m.pesData=null):m.pesData=c,L&&(B=u(L))?(x.isAAC?this.parseAACPES(B):this.parseMPEGPES(B),x.pesData=null):(L!=null&&L.size&&C.logger.log("last AAC PES packet truncated,might overlap between fragments"),x.pesData=L),_&&(B=u(_))?(this.parseID3PES(B),a.pesData=null):a.pesData=_},g.demuxSampleAes=function(f,x,m){var a=this.demux(f,m,!0,!this.config.progressive),c=this.sampleAes=new U.default(this.observer,this.config,x);return this.decrypt(a,c)},g.decrypt=function(f,x){return new Promise(function(m){var a=f.audioTrack,c=f.avcTrack;a.samples&&a.isAAC?x.decryptAacSamples(a.samples,0,function(){c.samples?x.decryptAvcSamples(c.samples,0,0,function(){m(f)}):m(f)}):c.samples&&x.decryptAvcSamples(c.samples,0,0,function(){m(f)})})},g.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},g.parseAVCPES=function(f,x){var m=this,a=this._avcTrack,c=this.parseAVCNALu(f.data),L=this.avcSample,_,B=!1;f.data=null,L&&c.length&&!a.audFound&&(y(L,a),L=this.avcSample=F(!1,f.pts,f.dts,"")),c.forEach(function($){switch($.type){case 1:{_=!0,L||(L=m.avcSample=F(!0,f.pts,f.dts,"")),L.frame=!0;var K=$.data;if(B&&K.length>4){var H=new O.default(K).readSliceType();(H===2||H===4||H===7||H===9)&&(L.key=!0)}break}case 5:_=!0,L||(L=m.avcSample=F(!0,f.pts,f.dts,"")),L.key=!0,L.frame=!0;break;case 6:{_=!0;var j=new O.default(P($.data));j.readUByte();for(var W=0,z=0,Q=!1,V=0;!Q&&j.bytesAvailable>1;){W=0;do V=j.readUByte(),W+=V;while(V===255);z=0;do V=j.readUByte(),z+=V;while(V===255);if(W===4&&j.bytesAvailable!==0){Q=!0;var J=j.readUByte();if(J===181){var X=j.readUShort();if(X===49){var q=j.readUInt();if(q===1195456820){var ue=j.readUByte();if(ue===3){for(var oe=j.readUByte(),ce=j.readUByte(),le=31&oe,G=[oe,ce],Y=0;Y<le;Y++)G.push(j.readUByte()),G.push(j.readUByte()),G.push(j.readUByte());o(m._txtTrack.samples,{type:3,pts:f.pts,bytes:G})}}}}}else if(W===5&&j.bytesAvailable!==0){if(Q=!0,z>16){for(var Z=[],ee=0;ee<16;ee++)Z.push(j.readUByte().toString(16)),(ee===3||ee===5||ee===7||ee===9)&&Z.push("-");for(var te=z-16,ie=new Uint8Array(te),se=0;se<te;se++)ie[se]=j.readUByte();o(m._txtTrack.samples,{pts:f.pts,payloadType:W,uuid:Z.join(""),userData:Object(N.utf8ArrayToStr)(ie),userDataBytes:ie})}}else if(z<j.bytesAvailable)for(var ne=0;ne<z;ne++)j.readUByte()}break}case 7:if(_=!0,B=!0,!a.sps){var ae=new O.default($.data),re=ae.readSPS();a.width=re.width,a.height=re.height,a.pixelRatio=re.pixelRatio,a.sps=[$.data],a.duration=m._duration;for(var de=$.data.subarray(1,4),fe="avc1.",ge=0;ge<3;ge++){var he=de[ge].toString(16);he.length<2&&(he="0"+he),fe+=he}a.codec=fe}break;case 8:_=!0,a.pps||(a.pps=[$.data]);break;case 9:_=!1,a.audFound=!0,L&&y(L,a),L=m.avcSample=F(!1,f.pts,f.dts,"");break;case 12:_=!1;break;default:_=!1,L&&(L.debug+="unknown NAL "+$.type+" ");break}if(L&&_){var ve=L.units;ve.push($)}}),x&&L&&(y(L,a),this.avcSample=null)},g.getLastNalUnit=function(){var f,x=this.avcSample,m;if(!x||x.units.length===0){var a=this._avcTrack.samples;x=a[a.length-1]}if((f=x)!==null&&f!==void 0&&f.units){var c=x.units;m=c[c.length-1]}return m},g.parseAVCNALu=function(f){var x=f.byteLength,m=this._avcTrack,a=m.naluState||0,c=a,L=[],_=0,B,$,K,H=-1,j=0;for(a===-1&&(H=0,j=f[0]&31,a=0,_=1);_<x;){if(B=f[_++],!a){a=B?0:1;continue}if(a===1){a=B?0:2;continue}if(!B)a=3;else if(B===1){if(H>=0){var W={data:f.subarray(H,_-a-1),type:j};L.push(W)}else{var z=this.getLastNalUnit();if(z&&(c&&_<=4-c&&z.state&&(z.data=z.data.subarray(0,z.data.byteLength-c)),$=_-a-1,$>0)){var Q=new Uint8Array(z.data.byteLength+$);Q.set(z.data,0),Q.set(f.subarray(0,$),z.data.byteLength),z.data=Q,z.state=0}}_<x?(K=f[_]&31,H=_,j=K,a=0):a=-1}else a=0}if(H>=0&&a>=0){var V={data:f.subarray(H,x),type:j,state:a};L.push(V)}if(L.length===0){var J=this.getLastNalUnit();if(J){var X=new Uint8Array(J.data.byteLength+f.byteLength);X.set(J.data,0),X.set(f,J.data.byteLength),J.data=X}}return m.naluState=a,L},g.parseAACPES=function(f){var x=0,m=this._audioTrack,a=this.aacOverFlow,c=f.data;if(a){this.aacOverFlow=null;var L=a.sample.unit.byteLength,_=Math.min(a.missing,L),B=L-_;a.sample.unit.set(c.subarray(0,_),B),m.samples.push(a.sample),x=a.missing}var $,K;for($=x,K=c.length;$<K-1&&!R.isHeader(c,$);$++);if($!==x){var H,j;if($<K-1?(H="AAC PES did not start with ADTS header,offset:"+$,j=!1):(H="no ADTS header found in AAC PES",j=!0),C.logger.warn("parsing error:"+H),this.observer.emit(I.Events.ERROR,I.Events.ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.FRAG_PARSING_ERROR,fatal:j,reason:H}),j)return}R.initTrackConfig(m,this.observer,c,$,this.audioCodec);var W;if(f.pts!==void 0)W=f.pts;else if(a){var z=R.getFrameDuration(m.samplerate);W=a.sample.pts+z}else{C.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var Q=0;$<K;)if(R.isHeader(c,$)){if($+5<K){var V=R.appendFrame(m,c,$,W,Q);if(V)if(V.missing)this.aacOverFlow=V;else{$+=V.length,Q++;continue}}break}else $++},g.parseMPEGPES=function(f){var x=f.data,m=x.length,a=0,c=0,L=f.pts;if(L===void 0){C.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;c<m;)if(T.isHeader(x,c)){var _=T.appendFrame(this._audioTrack,x,c,L,a);if(_)c+=_.length,a++;else break}else c++},g.parseID3PES=function(f){if(f.pts===void 0){C.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}this._id3Track.samples.push(f)},A}();k.minProbeByteLength=188;function F(A,g,t,f){return{key:A,frame:!1,pts:g,dts:t,units:[],debug:f,length:0}}function D(A,g){return(A[g+10]&31)<<8|A[g+11]}function E(A,g,t,f){var x={audio:-1,avc:-1,id3:-1,isAAC:!0},m=(A[g+1]&15)<<8|A[g+2],a=g+3+m-4,c=(A[g+10]&15)<<8|A[g+11];for(g+=12+c;g<a;){var L=(A[g+1]&31)<<8|A[g+2];switch(A[g]){case 207:if(!f){C.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:x.audio===-1&&(x.audio=L);break;case 21:x.id3===-1&&(x.id3=L);break;case 219:if(!f){C.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:x.avc===-1&&(x.avc=L);break;case 3:case 4:t?x.audio===-1&&(x.audio=L,x.isAAC=!1):C.logger.log("MPEG audio found, not supported in this browser");break;case 36:C.logger.warn("Unsupported HEVC stream type found");break}g+=((A[g+3]&15)<<8|A[g+4])+5}return x}function u(A){var g=0,t,f,x,m,a,c=A.data;if(!A||A.size===0)return null;for(;c[0].length<19&&c.length>1;){var L=new Uint8Array(c[0].length+c[1].length);L.set(c[0]),L.set(c[1],c[0].length),c[0]=L,c.splice(1,1)}t=c[0];var _=(t[0]<<16)+(t[1]<<8)+t[2];if(_===1){if(f=(t[4]<<8)+t[5],f&&f>A.size-6)return null;var B=t[7];B&192&&(m=(t[9]&14)*536870912+(t[10]&255)*4194304+(t[11]&254)*16384+(t[12]&255)*128+(t[13]&254)/2,B&64?(a=(t[14]&14)*536870912+(t[15]&255)*4194304+(t[16]&254)*16384+(t[17]&255)*128+(t[18]&254)/2,m-a>60*9e4&&(C.logger.warn(Math.round((m-a)/9e4)+"s delta between PTS and DTS, align them"),m=a)):a=m),x=t[8];var $=x+9;if(A.size<=$)return null;A.size-=$;for(var K=new Uint8Array(A.size),H=0,j=c.length;H<j;H++){t=c[H];var W=t.byteLength;if($)if($>W){$-=W;continue}else t=t.subarray($),W-=$,$=0;K.set(t,g),g+=W}return f&&(f-=x+3),{data:K,pts:m,dts:a,len:f}}return null}function y(A,g){if(A.units.length&&A.frame){if(A.pts===void 0){var t=g.samples,f=t.length;if(f){var x=t[f-1];A.pts=x.pts,A.dts=x.dts}else{g.dropped++;return}}g.samples.push(A)}A.debug.length&&C.logger.log(A.pts+"/"+A.dts+":"+A.debug)}function o(A,g){var t=A.length;if(t>0){if(g.pts>=A[t-1].pts)A.push(g);else for(var f=t-1;f>=0;f--)if(g.pts<A[f].pts){A.splice(f,0,g);break}}else A.push(g)}function P(A){for(var g=A.byteLength,t=[],f=1;f<g-2;)A[f]===0&&A[f+1]===0&&A[f+2]===3?(t.push(f+2),f+=2):f++;if(t.length===0)return A;var x=g-t.length,m=new Uint8Array(x),a=0;for(f=0;f<x;a++,f++)a===t[0]&&(a++,t.shift()),m[f]=A[a];return m}l.default=k},"./src/errors.ts":function(S,l,r){r.r(l),r.d(l,"ErrorTypes",function(){return R}),r.d(l,"ErrorDetails",function(){return T});var R;(function(O){O.NETWORK_ERROR="networkError",O.MEDIA_ERROR="mediaError",O.KEY_SYSTEM_ERROR="keySystemError",O.MUX_ERROR="muxError",O.OTHER_ERROR="otherError"})(R||(R={}));var T;(function(O){O.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",O.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",O.KEY_SYSTEM_NO_SESSION="keySystemNoSession",O.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",O.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",O.MANIFEST_LOAD_ERROR="manifestLoadError",O.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",O.MANIFEST_PARSING_ERROR="manifestParsingError",O.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",O.LEVEL_EMPTY_ERROR="levelEmptyError",O.LEVEL_LOAD_ERROR="levelLoadError",O.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",O.LEVEL_SWITCH_ERROR="levelSwitchError",O.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",O.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",O.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",O.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",O.FRAG_LOAD_ERROR="fragLoadError",O.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",O.FRAG_DECRYPT_ERROR="fragDecryptError",O.FRAG_PARSING_ERROR="fragParsingError",O.REMUX_ALLOC_ERROR="remuxAllocError",O.KEY_LOAD_ERROR="keyLoadError",O.KEY_LOAD_TIMEOUT="keyLoadTimeOut",O.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",O.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",O.BUFFER_APPEND_ERROR="bufferAppendError",O.BUFFER_APPENDING_ERROR="bufferAppendingError",O.BUFFER_STALLED_ERROR="bufferStalledError",O.BUFFER_FULL_ERROR="bufferFullError",O.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",O.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",O.INTERNAL_EXCEPTION="internalException",O.INTERNAL_ABORTED="aborted",O.UNKNOWN="unknown"})(T||(T={}))},"./src/events.ts":function(S,l,r){r.r(l),r.d(l,"Events",function(){return R});var R;(function(T){T.MEDIA_ATTACHING="hlsMediaAttaching",T.MEDIA_ATTACHED="hlsMediaAttached",T.MEDIA_DETACHING="hlsMediaDetaching",T.MEDIA_DETACHED="hlsMediaDetached",T.BUFFER_RESET="hlsBufferReset",T.BUFFER_CODECS="hlsBufferCodecs",T.BUFFER_CREATED="hlsBufferCreated",T.BUFFER_APPENDING="hlsBufferAppending",T.BUFFER_APPENDED="hlsBufferAppended",T.BUFFER_EOS="hlsBufferEos",T.BUFFER_FLUSHING="hlsBufferFlushing",T.BUFFER_FLUSHED="hlsBufferFlushed",T.MANIFEST_LOADING="hlsManifestLoading",T.MANIFEST_LOADED="hlsManifestLoaded",T.MANIFEST_PARSED="hlsManifestParsed",T.LEVEL_SWITCHING="hlsLevelSwitching",T.LEVEL_SWITCHED="hlsLevelSwitched",T.LEVEL_LOADING="hlsLevelLoading",T.LEVEL_LOADED="hlsLevelLoaded",T.LEVEL_UPDATED="hlsLevelUpdated",T.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",T.LEVELS_UPDATED="hlsLevelsUpdated",T.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",T.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",T.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",T.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",T.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",T.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",T.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",T.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",T.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",T.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",T.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",T.CUES_PARSED="hlsCuesParsed",T.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",T.INIT_PTS_FOUND="hlsInitPtsFound",T.FRAG_LOADING="hlsFragLoading",T.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",T.FRAG_LOADED="hlsFragLoaded",T.FRAG_DECRYPTED="hlsFragDecrypted",T.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",T.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",T.FRAG_PARSING_METADATA="hlsFragParsingMetadata",T.FRAG_PARSED="hlsFragParsed",T.FRAG_BUFFERED="hlsFragBuffered",T.FRAG_CHANGED="hlsFragChanged",T.FPS_DROP="hlsFpsDrop",T.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",T.ERROR="hlsError",T.DESTROYING="hlsDestroying",T.KEY_LOADING="hlsKeyLoading",T.KEY_LOADED="hlsKeyLoaded",T.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",T.BACK_BUFFER_REACHED="hlsBackBufferReached"})(R||(R={}))},"./src/hls.ts":function(S,l,r){r.r(l),r.d(l,"default",function(){return o});var R=r("./node_modules/url-toolkit/src/url-toolkit.js"),T=r("./src/loader/playlist-loader.ts"),O=r("./src/loader/key-loader.ts"),N=r("./src/controller/id3-track-controller.ts"),U=r("./src/controller/latency-controller.ts"),I=r("./src/controller/level-controller.ts"),M=r("./src/controller/fragment-tracker.ts"),C=r("./src/controller/stream-controller.ts"),w=r("./src/is-supported.ts"),v=r("./src/utils/logger.ts"),k=r("./src/config.ts"),F=r("./node_modules/eventemitter3/index.js"),D=r("./src/events.ts"),E=r("./src/errors.ts");function u(P,A){for(var g=0;g<A.length;g++){var t=A[g];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(P,t.key,t)}}function y(P,A,g){return A&&u(P.prototype,A),g&&u(P,g),P}var o=function(){P.isSupported=function(){return Object(w.isSupported)()};function P(g){g===void 0&&(g={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new F.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var t=this.config=Object(k.mergeConfig)(P.DefaultConfig,g);this.userConfig=g,Object(v.enableLogs)(t.debug),this._autoLevelCapping=-1,t.progressive&&Object(k.enableStreamingMode)(t);var f=t.abrController,x=t.bufferController,m=t.capLevelController,a=t.fpsController,c=this.abrController=new f(this),L=this.bufferController=new x(this),_=this.capLevelController=new m(this),B=new a(this),$=new T.default(this),K=new O.default(this),H=new N.default(this),j=this.levelController=new I.default(this),W=new M.FragmentTracker(this),z=this.streamController=new C.default(this,W);_.setStreamController(z),B.setStreamController(z);var Q=[j,z];this.networkControllers=Q;var V=[$,K,c,L,_,B,H,W];this.audioTrackController=this.createController(t.audioTrackController,null,Q),this.createController(t.audioStreamController,W,Q),this.subtitleTrackController=this.createController(t.subtitleTrackController,null,Q),this.createController(t.subtitleStreamController,W,Q),this.createController(t.timelineController,null,V),this.emeController=this.createController(t.emeController,null,V),this.cmcdController=this.createController(t.cmcdController,null,V),this.latencyController=this.createController(U.default,null,V),this.coreComponents=V}var A=P.prototype;return A.createController=function(t,f,x){if(t){var m=f?new t(this,f):new t(this);return x&&x.push(m),m}return null},A.on=function(t,f,x){x===void 0&&(x=this),this._emitter.on(t,f,x)},A.once=function(t,f,x){x===void 0&&(x=this),this._emitter.once(t,f,x)},A.removeAllListeners=function(t){this._emitter.removeAllListeners(t)},A.off=function(t,f,x,m){x===void 0&&(x=this),this._emitter.off(t,f,x,m)},A.listeners=function(t){return this._emitter.listeners(t)},A.emit=function(t,f,x){return this._emitter.emit(t,f,x)},A.trigger=function(t,f){if(this.config.debug)return this.emit(t,t,f);try{return this.emit(t,t,f)}catch(x){v.logger.error("An internal error happened while handling event "+t+'. Error message: "'+x.message+'". Here is a stacktrace:',x),this.trigger(D.Events.ERROR,{type:E.ErrorTypes.OTHER_ERROR,details:E.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:t,error:x})}return!1},A.listenerCount=function(t){return this._emitter.listenerCount(t)},A.destroy=function(){v.logger.log("destroy"),this.trigger(D.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(t){return t.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(t){return t.destroy()}),this.coreComponents.length=0},A.attachMedia=function(t){v.logger.log("attachMedia"),this._media=t,this.trigger(D.Events.MEDIA_ATTACHING,{media:t})},A.detachMedia=function(){v.logger.log("detachMedia"),this.trigger(D.Events.MEDIA_DETACHING,void 0),this._media=null},A.loadSource=function(t){this.stopLoad();var f=this.media,x=this.url,m=this.url=R.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});v.logger.log("loadSource:"+m),f&&x&&x!==m&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(f)),this.trigger(D.Events.MANIFEST_LOADING,{url:t})},A.startLoad=function(t){t===void 0&&(t=-1),v.logger.log("startLoad("+t+")"),this.networkControllers.forEach(function(f){f.startLoad(t)})},A.stopLoad=function(){v.logger.log("stopLoad"),this.networkControllers.forEach(function(t){t.stopLoad()})},A.swapAudioCodec=function(){v.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},A.recoverMediaError=function(){v.logger.log("recoverMediaError");var t=this._media;this.detachMedia(),t&&this.attachMedia(t)},A.removeLevel=function(t,f){f===void 0&&(f=0),this.levelController.removeLevel(t,f)},y(P,[{key:"levels",get:function(){var t=this.levelController.levels;return t||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(t){v.logger.log("set currentLevel:"+t),this.loadLevel=t,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){v.logger.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){v.logger.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){v.logger.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(t){v.logger.log("set startLevel:"+t),t!==-1&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(t){var f=!!t;f!==this.config.capLevelToPlayerSize&&(f?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=f)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(t){this._autoLevelCapping!==t&&(v.logger.log("set autoLevelCapping:"+t),this._autoLevelCapping=t)}},{key:"bandwidthEstimate",get:function(){var t=this.abrController.bwEstimator;return t?t.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var t=this.levels,f=this.config.minAutoBitrate;if(!t)return 0;for(var x=t.length,m=0;m<x;m++)if(t[m].maxBitrate>f)return m;return 0}},{key:"maxAutoLevel",get:function(){var t=this.levels,f=this.autoLevelCapping,x;return f===-1&&t&&t.length?x=t.length-1:x=f,x}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}},{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var f=this.audioTrackController;f&&(f.audioTrack=t)}},{key:"subtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var f=this.subtitleTrackController;f&&(f.subtitleTrack=t)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var t=this.subtitleTrackController;return t?t.subtitleDisplay:!1},set:function(t){var f=this.subtitleTrackController;f&&(f.subtitleDisplay=t)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(t){this.config.lowLatencyMode=t}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.1.5"}},{key:"Events",get:function(){return D.Events}},{key:"ErrorTypes",get:function(){return E.ErrorTypes}},{key:"ErrorDetails",get:function(){return E.ErrorDetails}},{key:"DefaultConfig",get:function(){return P.defaultConfig?P.defaultConfig:k.hlsDefaultConfig},set:function(t){P.defaultConfig=t}}]),P}();o.defaultConfig=void 0},"./src/is-supported.ts":function(S,l,r){r.r(l),r.d(l,"isSupported",function(){return O}),r.d(l,"changeTypeSupported",function(){return N});var R=r("./src/utils/mediasource-helper.ts");function T(){return self.SourceBuffer||self.WebKitSourceBuffer}function O(){var U=Object(R.getMediaSource)();if(!U)return!1;var I=T(),M=U&&typeof U.isTypeSupported=="function"&&U.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),C=!I||I.prototype&&typeof I.prototype.appendBuffer=="function"&&typeof I.prototype.remove=="function";return!!M&&!!C}function N(){var U,I=T();return typeof(I==null||(U=I.prototype)===null||U===void 0?void 0:U.changeType)=="function"}},"./src/loader/fragment-loader.ts":function(S,l,r){r.r(l),r.d(l,"default",function(){return k}),r.d(l,"LoadError",function(){return D});var R=r("./src/polyfills/number.ts"),T=r("./src/errors.ts");function O(E,u){E.prototype=Object.create(u.prototype),E.prototype.constructor=E,C(E,u)}function N(E){var u=typeof Map=="function"?new Map:void 0;return N=function(o){if(o===null||!M(o))return o;if(typeof o!="function")throw new TypeError("Super expression must either be null or a function");if(typeof u!="undefined"){if(u.has(o))return u.get(o);u.set(o,P)}function P(){return U(o,arguments,w(this).constructor)}return P.prototype=Object.create(o.prototype,{constructor:{value:P,enumerable:!1,writable:!0,configurable:!0}}),C(P,o)},N(E)}function U(E,u,y){return I()?U=Reflect.construct:U=function(P,A,g){var t=[null];t.push.apply(t,A);var f=Function.bind.apply(P,t),x=new f;return g&&C(x,g.prototype),x},U.apply(null,arguments)}function I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function M(E){return Function.toString.call(E).indexOf("[native code]")!==-1}function C(E,u){return C=Object.setPrototypeOf||function(o,P){return o.__proto__=P,o},C(E,u)}function w(E){return w=Object.setPrototypeOf?Object.getPrototypeOf:function(y){return y.__proto__||Object.getPrototypeOf(y)},w(E)}var v=Math.pow(2,17),k=function(){function E(y){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=y}var u=E.prototype;return u.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},u.abort=function(){this.loader&&this.loader.abort()},u.load=function(o,P){var A=this,g=o.url;if(!g)return Promise.reject(new D({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:o,networkDetails:null},"Fragment does not have a "+(g?"part list":"url")));this.abort();var t=this.config,f=t.fLoader,x=t.loader;return new Promise(function(m,a){A.loader&&A.loader.destroy();var c=A.loader=o.loader=f?new f(t):new x(t),L=F(o),_={timeout:t.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:t.fragLoadingMaxRetryTimeout,highWaterMark:v};o.stats=c.stats,c.load(L,_,{onSuccess:function($,K,H,j){A.resetLoader(o,c),m({frag:o,part:null,payload:$.data,networkDetails:j})},onError:function($,K,H){A.resetLoader(o,c),a(new D({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:o,response:$,networkDetails:H}))},onAbort:function($,K,H){A.resetLoader(o,c),a(new D({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:o,networkDetails:H}))},onTimeout:function($,K,H){A.resetLoader(o,c),a(new D({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:o,networkDetails:H}))},onProgress:function($,K,H,j){P&&P({frag:o,part:null,payload:H,networkDetails:j})}})})},u.loadPart=function(o,P,A){var g=this;this.abort();var t=this.config,f=t.fLoader,x=t.loader;return new Promise(function(m,a){g.loader&&g.loader.destroy();var c=g.loader=o.loader=f?new f(t):new x(t),L=F(o,P),_={timeout:t.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:t.fragLoadingMaxRetryTimeout,highWaterMark:v};P.stats=c.stats,c.load(L,_,{onSuccess:function($,K,H,j){g.resetLoader(o,c),g.updateStatsFromPart(o,P);var W={frag:o,part:P,payload:$.data,networkDetails:j};A(W),m(W)},onError:function($,K,H){g.resetLoader(o,c),a(new D({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:o,part:P,response:$,networkDetails:H}))},onAbort:function($,K,H){o.stats.aborted=P.stats.aborted,g.resetLoader(o,c),a(new D({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:o,part:P,networkDetails:H}))},onTimeout:function($,K,H){g.resetLoader(o,c),a(new D({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:o,part:P,networkDetails:H}))}})})},u.updateStatsFromPart=function(o,P){var A=o.stats,g=P.stats,t=g.total;if(A.loaded+=g.loaded,t){var f=Math.round(o.duration/P.duration),x=Math.min(Math.round(A.loaded/t),f),m=f-x,a=m*Math.round(A.loaded/x);A.total=A.loaded+a}else A.total=Math.max(A.loaded,A.total);var c=A.loading,L=g.loading;c.start?c.first+=L.first-L.start:(c.start=L.start,c.first=L.first),c.end=L.end},u.resetLoader=function(o,P){o.loader=null,this.loader===P&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),P.destroy()},E}();function F(E,u){u===void 0&&(u=null);var y=u||E,o={frag:E,part:u,responseType:"arraybuffer",url:y.url,headers:{},rangeStart:0,rangeEnd:0},P=y.byteRangeStartOffset,A=y.byteRangeEndOffset;return Object(R.isFiniteNumber)(P)&&Object(R.isFiniteNumber)(A)&&(o.rangeStart=P,o.rangeEnd=A),o}var D=function(E){O(u,E);function u(y){for(var o,P=arguments.length,A=new Array(P>1?P-1:0),g=1;g<P;g++)A[g-1]=arguments[g];return o=E.call.apply(E,[this].concat(A))||this,o.data=void 0,o.data=y,o}return u}(N(Error))},"./src/loader/fragment.ts":function(S,l,r){r.r(l),r.d(l,"ElementaryStreamTypes",function(){return v}),r.d(l,"BaseSegment",function(){return k}),r.d(l,"Fragment",function(){return F}),r.d(l,"Part",function(){return D});var R=r("./src/polyfills/number.ts"),T=r("./node_modules/url-toolkit/src/url-toolkit.js"),O=r("./src/utils/logger.ts"),N=r("./src/loader/level-key.ts"),U=r("./src/loader/load-stats.ts");function I(E,u){E.prototype=Object.create(u.prototype),E.prototype.constructor=E,M(E,u)}function M(E,u){return M=Object.setPrototypeOf||function(o,P){return o.__proto__=P,o},M(E,u)}function C(E,u){for(var y=0;y<u.length;y++){var o=u[y];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(E,o.key,o)}}function w(E,u,y){return u&&C(E.prototype,u),y&&C(E,y),E}var v;(function(E){E.AUDIO="audio",E.VIDEO="video",E.AUDIOVIDEO="audiovideo"})(v||(v={}));var k=function(){function E(y){var o;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(o={},o[v.AUDIO]=null,o[v.VIDEO]=null,o[v.AUDIOVIDEO]=null,o),this.baseurl=y}var u=E.prototype;return u.setByteRange=function(o,P){var A=o.split("@",2),g=[];A.length===1?g[0]=P?P.byteRangeEndOffset:0:g[0]=parseInt(A[1]),g[1]=parseInt(A[0])+g[0],this._byteRange=g},w(E,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(T.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(o){this._url=o}}]),E}(),F=function(E){I(u,E);function u(o,P){var A;return A=E.call(this,P)||this,A._decryptdata=null,A.rawProgramDateTime=null,A.programDateTime=null,A.tagList=[],A.duration=0,A.sn=0,A.levelkey=void 0,A.type=void 0,A.loader=null,A.level=-1,A.cc=0,A.startPTS=void 0,A.endPTS=void 0,A.appendedPTS=void 0,A.startDTS=void 0,A.endDTS=void 0,A.start=0,A.deltaPTS=void 0,A.maxStartPTS=void 0,A.minEndPTS=void 0,A.stats=new U.LoadStats,A.urlId=0,A.data=void 0,A.bitrateTest=!1,A.title=null,A.initSegment=null,A.type=o,A}var y=u.prototype;return y.createInitializationVector=function(P){for(var A=new Uint8Array(16),g=12;g<16;g++)A[g]=P>>8*(15-g)&255;return A},y.setDecryptDataFromLevelKey=function(P,A){var g=P;return(P==null?void 0:P.method)==="AES-128"&&P.uri&&!P.iv&&(g=N.LevelKey.fromURI(P.uri),g.method=P.method,g.iv=this.createInitializationVector(A),g.keyFormat="identity"),g},y.setElementaryStreamInfo=function(P,A,g,t,f,x){x===void 0&&(x=!1);var m=this.elementaryStreams,a=m[P];if(!a){m[P]={startPTS:A,endPTS:g,startDTS:t,endDTS:f,partial:x};return}a.startPTS=Math.min(a.startPTS,A),a.endPTS=Math.max(a.endPTS,g),a.startDTS=Math.min(a.startDTS,t),a.endDTS=Math.max(a.endDTS,f)},y.clearElementaryStreamInfo=function(){var P=this.elementaryStreams;P[v.AUDIO]=null,P[v.VIDEO]=null,P[v.AUDIOVIDEO]=null},w(u,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var P=this.sn;typeof P!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&O.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),P=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,P)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(R.isFiniteNumber)(this.programDateTime))return null;var P=Object(R.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+P*1e3}},{key:"encrypted",get:function(){var P;return!!((P=this.decryptdata)!==null&&P!==void 0&&P.keyFormat&&this.decryptdata.uri)}}]),u}(k),D=function(E){I(u,E);function u(y,o,P,A,g){var t;t=E.call(this,P)||this,t.fragOffset=0,t.duration=0,t.gap=!1,t.independent=!1,t.relurl=void 0,t.fragment=void 0,t.index=void 0,t.stats=new U.LoadStats,t.duration=y.decimalFloatingPoint("DURATION"),t.gap=y.bool("GAP"),t.independent=y.bool("INDEPENDENT"),t.relurl=y.enumeratedString("URI"),t.fragment=o,t.index=A;var f=y.enumeratedString("BYTERANGE");return f&&t.setByteRange(f,g),g&&(t.fragOffset=g.fragOffset+g.duration),t}return w(u,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var o=this.elementaryStreams;return!!(o.audio||o.video||o.audiovideo)}}]),u}(k)},"./src/loader/key-loader.ts":function(S,l,r){r.r(l),r.d(l,"default",function(){return N});var R=r("./src/events.ts"),T=r("./src/errors.ts"),O=r("./src/utils/logger.ts"),N=function(){function U(M){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=M,this._registerListeners()}var I=U.prototype;return I._registerListeners=function(){this.hls.on(R.Events.KEY_LOADING,this.onKeyLoading,this)},I._unregisterListeners=function(){this.hls.off(R.Events.KEY_LOADING,this.onKeyLoading)},I.destroy=function(){this._unregisterListeners();for(var C in this.loaders){var w=this.loaders[C];w&&w.destroy()}this.loaders={}},I.onKeyLoading=function(C,w){var v=w.frag,k=v.type,F=this.loaders[k];if(!v.decryptdata){O.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var D=v.decryptdata.uri;if(D!==this.decrypturl||this.decryptkey===null){var E=this.hls.config;if(F&&(O.logger.warn("abort previous key loader for type:"+k),F.abort()),!D){O.logger.warn("key uri is falsy");return}var u=E.loader,y=v.loader=this.loaders[k]=new u(E);this.decrypturl=D,this.decryptkey=null;var o={url:D,frag:v,responseType:"arraybuffer"},P={timeout:E.fragLoadingTimeOut,maxRetry:0,retryDelay:E.fragLoadingRetryDelay,maxRetryDelay:E.fragLoadingMaxRetryTimeout,highWaterMark:0},A={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};y.load(o,P,A)}else this.decryptkey&&(v.decryptdata.key=this.decryptkey,this.hls.trigger(R.Events.KEY_LOADED,{frag:v}))},I.loadsuccess=function(C,w,v){var k=v.frag;if(!k.decryptdata){O.logger.error("after key load, decryptdata unset");return}this.decryptkey=k.decryptdata.key=new Uint8Array(C.data),k.loader=null,delete this.loaders[k.type],this.hls.trigger(R.Events.KEY_LOADED,{frag:k})},I.loaderror=function(C,w){var v=w.frag,k=v.loader;k&&k.abort(),delete this.loaders[v.type],this.hls.trigger(R.Events.ERROR,{type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:v,response:C})},I.loadtimeout=function(C,w){var v=w.frag,k=v.loader;k&&k.abort(),delete this.loaders[v.type],this.hls.trigger(R.Events.ERROR,{type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:v})},U}()},"./src/loader/level-details.ts":function(S,l,r){r.r(l),r.d(l,"LevelDetails",function(){return U});var R=r("./src/polyfills/number.ts");function T(I,M){for(var C=0;C<M.length;C++){var w=M[C];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(I,w.key,w)}}function O(I,M,C){return M&&T(I.prototype,M),C&&T(I,C),I}var N=10,U=function(){function I(C){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=C}var M=I.prototype;return M.reloaded=function(w){if(!w){this.advanced=!0,this.updated=!0;return}var v=this.lastPartSn-w.lastPartSn,k=this.lastPartIndex-w.lastPartIndex;this.updated=this.endSN!==w.endSN||!!k||!!v,this.advanced=this.endSN>w.endSN||v>0||v===0&&k>0,this.updated||this.advanced?this.misses=Math.floor(w.misses*.6):this.misses=w.misses+1,this.availabilityDelay=w.availabilityDelay},O(I,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Object(R.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||N}},{key:"drift",get:function(){var w=this.driftEndTime-this.driftStartTime;if(w>0){var v=this.driftEnd-this.driftStart;return v*1e3/w}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var w;return(w=this.partList)!==null&&w!==void 0&&w.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var w;return(w=this.fragments)!==null&&w!==void 0&&w.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var w;return(w=this.partList)!==null&&w!==void 0&&w.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var w;return(w=this.partList)!==null&&w!==void 0&&w.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),I}()},"./src/loader/level-key.ts":function(S,l,r){r.r(l),r.d(l,"LevelKey",function(){return N});var R=r("./node_modules/url-toolkit/src/url-toolkit.js");function T(U,I){for(var M=0;M<I.length;M++){var C=I[M];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(U,C.key,C)}}function O(U,I,M){return I&&T(U.prototype,I),M&&T(U,M),U}var N=function(){U.fromURL=function(M,C){return new U(M,C)},U.fromURI=function(M){return new U(M)};function U(I,M){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,M?this._uri=Object(R.buildAbsoluteURL)(I,M,{alwaysNormalize:!0}):this._uri=I}return O(U,[{key:"uri",get:function(){return this._uri}}]),U}()},"./src/loader/load-stats.ts":function(S,l,r){r.r(l),r.d(l,"LoadStats",function(){return R});var R=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(S,l,r){r.r(l),r.d(l,"default",function(){return u});var R=r("./src/polyfills/number.ts"),T=r("./node_modules/url-toolkit/src/url-toolkit.js"),O=r("./src/loader/fragment.ts"),N=r("./src/loader/level-details.ts"),U=r("./src/loader/level-key.ts"),I=r("./src/utils/attr-list.ts"),M=r("./src/utils/logger.ts"),C=r("./src/utils/codecs.ts"),w=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,v=/#EXT-X-MEDIA:(.*)/g,k=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),F=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),D=/\.(mp4|m4s|m4v|m4a)$/i;function E(g){var t,f;return D.test((t=(f=T.parseURL(g))===null||f===void 0?void 0:f.path)!=null?t:"")}var u=function(){function g(){}return g.findGroup=function(f,x){for(var m=0;m<f.length;m++){var a=f[m];if(a.id===x)return a}},g.convertAVC1ToAVCOTI=function(f){var x=f.split(".");if(x.length>2){var m=x.shift()+".";return m+=parseInt(x.shift()).toString(16),m+=("000"+parseInt(x.shift()).toString(16)).substr(-4),m}return f},g.resolve=function(f,x){return T.buildAbsoluteURL(x,f,{alwaysNormalize:!0})},g.parseMasterPlaylist=function(f,x){var m=[],a={},c=!1;w.lastIndex=0;for(var L;(L=w.exec(f))!=null;)if(L[1]){var _=new I.AttrList(L[1]),B={attrs:_,bitrate:_.decimalInteger("AVERAGE-BANDWIDTH")||_.decimalInteger("BANDWIDTH"),name:_.NAME,url:g.resolve(L[2],x)},$=_.decimalResolution("RESOLUTION");$&&(B.width=$.width,B.height=$.height),y((_.CODECS||"").split(/[ ,]+/).filter(function(H){return H}),B),B.videoCodec&&B.videoCodec.indexOf("avc1")!==-1&&(B.videoCodec=g.convertAVC1ToAVCOTI(B.videoCodec)),m.push(B)}else if(L[3]){var K=new I.AttrList(L[3]);K["DATA-ID"]&&(c=!0,a[K["DATA-ID"]]=K)}return{levels:m,sessionData:c?a:null}},g.parseMasterPlaylistMedia=function(f,x,m,a){a===void 0&&(a=[]);var c,L=[],_=0;for(v.lastIndex=0;(c=v.exec(f))!==null;){var B=new I.AttrList(c[1]);if(B.TYPE===m){var $={attrs:B,bitrate:0,id:_++,groupId:B["GROUP-ID"],instreamId:B["INSTREAM-ID"],name:B.NAME||B.LANGUAGE||"",type:m,default:B.bool("DEFAULT"),autoselect:B.bool("AUTOSELECT"),forced:B.bool("FORCED"),lang:B.LANGUAGE,url:B.URI?g.resolve(B.URI,x):""};if(a.length){var K=g.findGroup(a,$.groupId)||a[0];o($,K,"audioCodec"),o($,K,"textCodec")}L.push($)}}return L},g.parseLevelPlaylist=function(f,x,m,a,c){var L=new N.LevelDetails(x),_=L.fragments,B=null,$=0,K=0,H=0,j=0,W=null,z=new O.Fragment(a,x),Q,V,J,X=-1,q=!1;for(k.lastIndex=0,L.m3u8=f;(Q=k.exec(f))!==null;){q&&(q=!1,z=new O.Fragment(a,x),z.start=H,z.sn=$,z.cc=j,z.level=m,B&&(z.initSegment=B,z.rawProgramDateTime=B.rawProgramDateTime));var ue=Q[1];if(ue){z.duration=parseFloat(ue);var oe=(" "+Q[2]).slice(1);z.title=oe||null,z.tagList.push(oe?["INF",ue,oe]:["INF",ue])}else if(Q[3])Object(R.isFiniteNumber)(z.duration)&&(z.start=H,J&&(z.levelkey=J),z.sn=$,z.level=m,z.cc=j,z.urlId=c,_.push(z),z.relurl=(" "+Q[3]).slice(1),A(z,W),W=z,H+=z.duration,$++,K=0,q=!0);else if(Q[4]){var ce=(" "+Q[4]).slice(1);W?z.setByteRange(ce,W):z.setByteRange(ce)}else if(Q[5])z.rawProgramDateTime=(" "+Q[5]).slice(1),z.tagList.push(["PROGRAM-DATE-TIME",z.rawProgramDateTime]),X===-1&&(X=_.length);else{if(Q=Q[0].match(F),!Q){M.logger.warn("No matches on slow regex match for level playlist!");continue}for(V=1;V<Q.length&&typeof Q[V]=="undefined";V++);var le=(" "+Q[V]).slice(1),G=(" "+Q[V+1]).slice(1),Y=Q[V+2]?(" "+Q[V+2]).slice(1):"";switch(le){case"PLAYLIST-TYPE":L.type=G.toUpperCase();break;case"MEDIA-SEQUENCE":$=L.startSN=parseInt(G);break;case"SKIP":{var Z=new I.AttrList(G),ee=Z.decimalInteger("SKIPPED-SEGMENTS");if(Object(R.isFiniteNumber)(ee)){L.skippedSegments=ee;for(var te=ee;te--;)_.unshift(null);$+=ee}var ie=Z.enumeratedString("RECENTLY-REMOVED-DATERANGES");ie&&(L.recentlyRemovedDateranges=ie.split("	"));break}case"TARGETDURATION":L.targetduration=parseFloat(G);break;case"VERSION":L.version=parseInt(G);break;case"EXTM3U":break;case"ENDLIST":L.live=!1;break;case"#":(G||Y)&&z.tagList.push(Y?[G,Y]:[G]);break;case"DIS":j++;case"GAP":z.tagList.push([le]);break;case"BITRATE":z.tagList.push([le,G]);break;case"DISCONTINUITY-SEQ":j=parseInt(G);break;case"KEY":{var se,ne=new I.AttrList(G),ae=ne.enumeratedString("METHOD"),re=ne.URI,de=ne.hexadecimalInteger("IV"),fe=ne.enumeratedString("KEYFORMATVERSIONS"),ge=ne.enumeratedString("KEYID"),he=(se=ne.enumeratedString("KEYFORMAT"))!=null?se:"identity",ve=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(ve.indexOf(he)>-1){M.logger.warn("Keyformat "+he+" is not supported from the manifest");continue}else if(he!=="identity")continue;ae&&(J=U.LevelKey.fromURL(x,re),re&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(ae)>=0&&(J.method=ae,J.keyFormat=he,ge&&(J.keyID=ge),fe&&(J.keyFormatVersions=fe),J.iv=de));break}case"START":{var ye=new I.AttrList(G),pe=ye.decimalFloatingPoint("TIME-OFFSET");Object(R.isFiniteNumber)(pe)&&(L.startTimeOffset=pe);break}case"MAP":{var me=new I.AttrList(G);z.relurl=me.URI,me.BYTERANGE&&z.setByteRange(me.BYTERANGE),z.level=m,z.sn="initSegment",J&&(z.levelkey=J),z.initSegment=null,B=z,q=!0;break}case"SERVER-CONTROL":{var Ee=new I.AttrList(G);L.canBlockReload=Ee.bool("CAN-BLOCK-RELOAD"),L.canSkipUntil=Ee.optionalFloat("CAN-SKIP-UNTIL",0),L.canSkipDateRanges=L.canSkipUntil>0&&Ee.bool("CAN-SKIP-DATERANGES"),L.partHoldBack=Ee.optionalFloat("PART-HOLD-BACK",0),L.holdBack=Ee.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var Ae=new I.AttrList(G);L.partTarget=Ae.decimalFloatingPoint("PART-TARGET");break}case"PART":{var Le=L.partList;Le||(Le=L.partList=[]);var Se=K>0?Le[Le.length-1]:void 0,Pe=K++,Te=new O.Part(new I.AttrList(G),z,x,Pe,Se);Le.push(Te),z.duration+=Te.duration;break}case"PRELOAD-HINT":{var xe=new I.AttrList(G);L.preloadHint=xe;break}case"RENDITION-REPORT":{var be=new I.AttrList(G);L.renditionReports=L.renditionReports||[],L.renditionReports.push(be);break}default:M.logger.warn("line parsed but not handled: "+Q);break}}}W&&!W.relurl?(_.pop(),H-=W.duration,L.partList&&(L.fragmentHint=W)):L.partList&&(A(z,W),z.cc=j,L.fragmentHint=z);var Oe=_.length,Re=_[0],Ce=_[Oe-1];if(H+=L.skippedSegments*L.targetduration,H>0&&Oe&&Ce){L.averagetargetduration=H/Oe;var De=Ce.sn;L.endSN=De!=="initSegment"?De:0,Re&&(L.startCC=Re.cc,Re.initSegment||L.fragments.every(function(Ie){return Ie.relurl&&E(Ie.relurl)})&&(M.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),z=new O.Fragment(a,x),z.relurl=Ce.relurl,z.level=m,z.sn="initSegment",Re.initSegment=z,L.needSidxRanges=!0))}else L.endSN=0,L.startCC=0;return L.fragmentHint&&(H+=L.fragmentHint.duration),L.totalduration=H,L.endCC=j,X>0&&P(_,X),L},g}();function y(g,t){["video","audio","text"].forEach(function(f){var x=g.filter(function(a){return Object(C.isCodecType)(a,f)});if(x.length){var m=x.filter(function(a){return a.lastIndexOf("avc1",0)===0||a.lastIndexOf("mp4a",0)===0});t[f+"Codec"]=m.length>0?m[0]:x[0],g=g.filter(function(a){return x.indexOf(a)===-1})}}),t.unknownCodecs=g}function o(g,t,f){var x=t[f];x&&(g[f]=x)}function P(g,t){for(var f=g[t],x=t;x--;){var m=g[x];if(!m)return;m.programDateTime=f.programDateTime-m.duration*1e3,f=m}}function A(g,t){g.rawProgramDateTime?g.programDateTime=Date.parse(g.rawProgramDateTime):t!=null&&t.programDateTime&&(g.programDateTime=t.endProgramDateTime),Object(R.isFiniteNumber)(g.programDateTime)||(g.programDateTime=null,g.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(S,l,r){r.r(l);var R=r("./src/polyfills/number.ts"),T=r("./src/events.ts"),O=r("./src/errors.ts"),N=r("./src/utils/logger.ts"),U=r("./src/utils/mp4-tools.ts"),I=r("./src/loader/m3u8-parser.ts"),M=r("./src/types/loader.ts"),C=r("./src/utils/attr-list.ts");function w(F){var D=F.type;switch(D){case M.PlaylistContextType.AUDIO_TRACK:return M.PlaylistLevelType.AUDIO;case M.PlaylistContextType.SUBTITLE_TRACK:return M.PlaylistLevelType.SUBTITLE;default:return M.PlaylistLevelType.MAIN}}function v(F,D){var E=F.url;return(E===void 0||E.indexOf("data:")===0)&&(E=D.url),E}var k=function(){function F(E){this.hls=void 0,this.loaders=Object.create(null),this.hls=E,this.registerListeners()}var D=F.prototype;return D.registerListeners=function(){var u=this.hls;u.on(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(T.Events.LEVEL_LOADING,this.onLevelLoading,this),u.on(T.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),u.on(T.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},D.unregisterListeners=function(){var u=this.hls;u.off(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.off(T.Events.LEVEL_LOADING,this.onLevelLoading,this),u.off(T.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),u.off(T.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},D.createInternalLoader=function(u){var y=this.hls.config,o=y.pLoader,P=y.loader,A=o||P,g=new A(y);return u.loader=g,this.loaders[u.type]=g,g},D.getInternalLoader=function(u){return this.loaders[u.type]},D.resetInternalLoader=function(u){this.loaders[u]&&delete this.loaders[u]},D.destroyInternalLoaders=function(){for(var u in this.loaders){var y=this.loaders[u];y&&y.destroy(),this.resetInternalLoader(u)}},D.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},D.onManifestLoading=function(u,y){var o=y.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:M.PlaylistContextType.MANIFEST,url:o,deliveryDirectives:null})},D.onLevelLoading=function(u,y){var o=y.id,P=y.level,A=y.url,g=y.deliveryDirectives;this.load({id:o,groupId:null,level:P,responseType:"text",type:M.PlaylistContextType.LEVEL,url:A,deliveryDirectives:g})},D.onAudioTrackLoading=function(u,y){var o=y.id,P=y.groupId,A=y.url,g=y.deliveryDirectives;this.load({id:o,groupId:P,level:null,responseType:"text",type:M.PlaylistContextType.AUDIO_TRACK,url:A,deliveryDirectives:g})},D.onSubtitleTrackLoading=function(u,y){var o=y.id,P=y.groupId,A=y.url,g=y.deliveryDirectives;this.load({id:o,groupId:P,level:null,responseType:"text",type:M.PlaylistContextType.SUBTITLE_TRACK,url:A,deliveryDirectives:g})},D.load=function(u){var y,o=this.hls.config,P=this.getInternalLoader(u);if(P){var A=P.context;if(A&&A.url===u.url){N.logger.trace("[playlist-loader]: playlist request ongoing");return}N.logger.log("[playlist-loader]: aborting previous loader for type: "+u.type),P.abort()}var g,t,f,x;switch(u.type){case M.PlaylistContextType.MANIFEST:g=o.manifestLoadingMaxRetry,t=o.manifestLoadingTimeOut,f=o.manifestLoadingRetryDelay,x=o.manifestLoadingMaxRetryTimeout;break;case M.PlaylistContextType.LEVEL:case M.PlaylistContextType.AUDIO_TRACK:case M.PlaylistContextType.SUBTITLE_TRACK:g=0,t=o.levelLoadingTimeOut;break;default:g=o.levelLoadingMaxRetry,t=o.levelLoadingTimeOut,f=o.levelLoadingRetryDelay,x=o.levelLoadingMaxRetryTimeout;break}if(P=this.createInternalLoader(u),(y=u.deliveryDirectives)!==null&&y!==void 0&&y.part){var m;if(u.type===M.PlaylistContextType.LEVEL&&u.level!==null?m=this.hls.levels[u.level].details:u.type===M.PlaylistContextType.AUDIO_TRACK&&u.id!==null?m=this.hls.audioTracks[u.id].details:u.type===M.PlaylistContextType.SUBTITLE_TRACK&&u.id!==null&&(m=this.hls.subtitleTracks[u.id].details),m){var a=m.partTarget,c=m.targetduration;a&&c&&(t=Math.min(Math.max(a*3,c*.8)*1e3,t))}}var L={timeout:t,maxRetry:g,retryDelay:f,maxRetryDelay:x,highWaterMark:0},_={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};P.load(u,L,_)},D.loadsuccess=function(u,y,o,P){if(P===void 0&&(P=null),o.isSidxRequest){this.handleSidxRequest(u,o),this.handlePlaylistLoaded(u,y,o,P);return}this.resetInternalLoader(o.type);var A=u.data;if(A.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(u,o,"no EXTM3U delimiter",P);return}y.parsing.start=performance.now(),A.indexOf("#EXTINF:")>0||A.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(u,y,o,P):this.handleMasterPlaylist(u,y,o,P)},D.loaderror=function(u,y,o){o===void 0&&(o=null),this.handleNetworkError(y,o,!1,u)},D.loadtimeout=function(u,y,o){o===void 0&&(o=null),this.handleNetworkError(y,o,!0)},D.handleMasterPlaylist=function(u,y,o,P){var A=this.hls,g=u.data,t=v(u,o),f=I.default.parseMasterPlaylist(g,t),x=f.levels,m=f.sessionData;if(!x.length){this.handleManifestParsingError(u,o,"no level found in manifest",P);return}var a=x.map(function(K){return{id:K.attrs.AUDIO,audioCodec:K.audioCodec}}),c=x.map(function(K){return{id:K.attrs.SUBTITLES,textCodec:K.textCodec}}),L=I.default.parseMasterPlaylistMedia(g,t,"AUDIO",a),_=I.default.parseMasterPlaylistMedia(g,t,"SUBTITLES",c),B=I.default.parseMasterPlaylistMedia(g,t,"CLOSED-CAPTIONS");if(L.length){var $=L.some(function(K){return!K.url});!$&&x[0].audioCodec&&!x[0].attrs.AUDIO&&(N.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),L.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new C.AttrList({}),bitrate:0,url:""}))}A.trigger(T.Events.MANIFEST_LOADED,{levels:x,audioTracks:L,subtitles:_,captions:B,url:t,stats:y,networkDetails:P,sessionData:m})},D.handleTrackOrLevelPlaylist=function(u,y,o,P){var A=this.hls,g=o.id,t=o.level,f=o.type,x=v(u,o),m=Object(R.isFiniteNumber)(g)?g:0,a=Object(R.isFiniteNumber)(t)?t:m,c=w(o),L=I.default.parseLevelPlaylist(u.data,x,a,c,m);if(!L.fragments.length){A.trigger(T.Events.ERROR,{type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:x,reason:"no fragments found in level",level:typeof o.level=="number"?o.level:void 0});return}if(f===M.PlaylistContextType.MANIFEST){var _={attrs:new C.AttrList({}),bitrate:0,details:L,name:"",url:x};A.trigger(T.Events.MANIFEST_LOADED,{levels:[_],audioTracks:[],url:x,stats:y,networkDetails:P,sessionData:null})}if(y.parsing.end=performance.now(),L.needSidxRanges){var B,$=(B=L.fragments[0].initSegment)===null||B===void 0?void 0:B.url;this.load({url:$,isSidxRequest:!0,type:f,level:t,levelDetails:L,id:g,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}o.levelDetails=L,this.handlePlaylistLoaded(u,y,o,P)},D.handleSidxRequest=function(u,y){var o=Object(U.parseSegmentIndex)(new Uint8Array(u.data));if(!!o){var P=o.references,A=y.levelDetails;P.forEach(function(g,t){var f=g.info,x=A.fragments[t];x.byteRange.length===0&&x.setByteRange(String(1+f.end-f.start)+"@"+String(f.start)),x.initSegment&&x.initSegment.setByteRange(String(o.moovEndOffset)+"@0")})}},D.handleManifestParsingError=function(u,y,o,P){this.hls.trigger(T.Events.ERROR,{type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:y.type===M.PlaylistContextType.MANIFEST,url:u.url,reason:o,response:u,context:y,networkDetails:P})},D.handleNetworkError=function(u,y,o,P){o===void 0&&(o=!1),N.logger.warn("[playlist-loader]: A network "+(o?"timeout":"error")+" occurred while loading "+u.type+" level: "+u.level+" id: "+u.id+' group-id: "'+u.groupId+'"');var A=O.ErrorDetails.UNKNOWN,g=!1,t=this.getInternalLoader(u);switch(u.type){case M.PlaylistContextType.MANIFEST:A=o?O.ErrorDetails.MANIFEST_LOAD_TIMEOUT:O.ErrorDetails.MANIFEST_LOAD_ERROR,g=!0;break;case M.PlaylistContextType.LEVEL:A=o?O.ErrorDetails.LEVEL_LOAD_TIMEOUT:O.ErrorDetails.LEVEL_LOAD_ERROR,g=!1;break;case M.PlaylistContextType.AUDIO_TRACK:A=o?O.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:O.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,g=!1;break;case M.PlaylistContextType.SUBTITLE_TRACK:A=o?O.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:O.ErrorDetails.SUBTITLE_LOAD_ERROR,g=!1;break}t&&this.resetInternalLoader(u.type);var f={type:O.ErrorTypes.NETWORK_ERROR,details:A,fatal:g,url:u.url,loader:t,context:u,networkDetails:y};P&&(f.response=P),this.hls.trigger(T.Events.ERROR,f)},D.handlePlaylistLoaded=function(u,y,o,P){var A=o.type,g=o.level,t=o.id,f=o.groupId,x=o.loader,m=o.levelDetails,a=o.deliveryDirectives;if(!(m!=null&&m.targetduration)){this.handleManifestParsingError(u,o,"invalid target duration",P);return}if(!!x)switch(m.live&&(x.getCacheAge&&(m.ageHeader=x.getCacheAge()||0),(!x.getCacheAge||isNaN(m.ageHeader))&&(m.ageHeader=0)),A){case M.PlaylistContextType.MANIFEST:case M.PlaylistContextType.LEVEL:this.hls.trigger(T.Events.LEVEL_LOADED,{details:m,level:g||0,id:t||0,stats:y,networkDetails:P,deliveryDirectives:a});break;case M.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(T.Events.AUDIO_TRACK_LOADED,{details:m,id:t||0,groupId:f||"",stats:y,networkDetails:P,deliveryDirectives:a});break;case M.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(T.Events.SUBTITLE_TRACK_LOADED,{details:m,id:t||0,groupId:f||"",stats:y,networkDetails:P,deliveryDirectives:a});break}},F}();l.default=k},"./src/polyfills/number.ts":function(S,l,r){r.r(l),r.d(l,"isFiniteNumber",function(){return R}),r.d(l,"MAX_SAFE_INTEGER",function(){return T});var R=Number.isFinite||function(O){return typeof O=="number"&&isFinite(O)},T=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(S,l,r){r.r(l);var R=function(){function T(){}return T.getSilentFrame=function(N,U){switch(N){case"mp4a.40.2":if(U===1)return new Uint8Array([0,200,0,128,35,128]);if(U===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(U===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(U===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(U===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(U===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(U===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(U===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(U===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},T}();l.default=R},"./src/remux/mp4-generator.ts":function(S,l,r){r.r(l);var R=Math.pow(2,32)-1,T=function(){function O(){}return O.init=function(){O.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var U;for(U in O.types)O.types.hasOwnProperty(U)&&(O.types[U]=[U.charCodeAt(0),U.charCodeAt(1),U.charCodeAt(2),U.charCodeAt(3)]);var I=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),M=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);O.HDLR_TYPES={video:I,audio:M};var C=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),w=new Uint8Array([0,0,0,0,0,0,0,0]);O.STTS=O.STSC=O.STCO=w,O.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),O.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),O.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),O.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var v=new Uint8Array([105,115,111,109]),k=new Uint8Array([97,118,99,49]),F=new Uint8Array([0,0,0,1]);O.FTYP=O.box(O.types.ftyp,v,F,v,k),O.DINF=O.box(O.types.dinf,O.box(O.types.dref,C))},O.box=function(U){for(var I=8,M=arguments.length,C=new Array(M>1?M-1:0),w=1;w<M;w++)C[w-1]=arguments[w];for(var v=C.length,k=v;v--;)I+=C[v].byteLength;var F=new Uint8Array(I);for(F[0]=I>>24&255,F[1]=I>>16&255,F[2]=I>>8&255,F[3]=I&255,F.set(U,4),v=0,I=8;v<k;v++)F.set(C[v],I),I+=C[v].byteLength;return F},O.hdlr=function(U){return O.box(O.types.hdlr,O.HDLR_TYPES[U])},O.mdat=function(U){return O.box(O.types.mdat,U)},O.mdhd=function(U,I){I*=U;var M=Math.floor(I/(R+1)),C=Math.floor(I%(R+1));return O.box(O.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,U>>24&255,U>>16&255,U>>8&255,U&255,M>>24,M>>16&255,M>>8&255,M&255,C>>24,C>>16&255,C>>8&255,C&255,85,196,0,0]))},O.mdia=function(U){return O.box(O.types.mdia,O.mdhd(U.timescale,U.duration),O.hdlr(U.type),O.minf(U))},O.mfhd=function(U){return O.box(O.types.mfhd,new Uint8Array([0,0,0,0,U>>24,U>>16&255,U>>8&255,U&255]))},O.minf=function(U){return U.type==="audio"?O.box(O.types.minf,O.box(O.types.smhd,O.SMHD),O.DINF,O.stbl(U)):O.box(O.types.minf,O.box(O.types.vmhd,O.VMHD),O.DINF,O.stbl(U))},O.moof=function(U,I,M){return O.box(O.types.moof,O.mfhd(U),O.traf(M,I))},O.moov=function(U){for(var I=U.length,M=[];I--;)M[I]=O.trak(U[I]);return O.box.apply(null,[O.types.moov,O.mvhd(U[0].timescale,U[0].duration)].concat(M).concat(O.mvex(U)))},O.mvex=function(U){for(var I=U.length,M=[];I--;)M[I]=O.trex(U[I]);return O.box.apply(null,[O.types.mvex].concat(M))},O.mvhd=function(U,I){I*=U;var M=Math.floor(I/(R+1)),C=Math.floor(I%(R+1)),w=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,U>>24&255,U>>16&255,U>>8&255,U&255,M>>24,M>>16&255,M>>8&255,M&255,C>>24,C>>16&255,C>>8&255,C&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return O.box(O.types.mvhd,w)},O.sdtp=function(U){var I=U.samples||[],M=new Uint8Array(4+I.length),C,w;for(C=0;C<I.length;C++)w=I[C].flags,M[C+4]=w.dependsOn<<4|w.isDependedOn<<2|w.hasRedundancy;return O.box(O.types.sdtp,M)},O.stbl=function(U){return O.box(O.types.stbl,O.stsd(U),O.box(O.types.stts,O.STTS),O.box(O.types.stsc,O.STSC),O.box(O.types.stsz,O.STSZ),O.box(O.types.stco,O.STCO))},O.avc1=function(U){var I=[],M=[],C,w,v;for(C=0;C<U.sps.length;C++)w=U.sps[C],v=w.byteLength,I.push(v>>>8&255),I.push(v&255),I=I.concat(Array.prototype.slice.call(w));for(C=0;C<U.pps.length;C++)w=U.pps[C],v=w.byteLength,M.push(v>>>8&255),M.push(v&255),M=M.concat(Array.prototype.slice.call(w));var k=O.box(O.types.avcC,new Uint8Array([1,I[3],I[4],I[5],255,224|U.sps.length].concat(I).concat([U.pps.length]).concat(M))),F=U.width,D=U.height,E=U.pixelRatio[0],u=U.pixelRatio[1];return O.box(O.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,F>>8&255,F&255,D>>8&255,D&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),k,O.box(O.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),O.box(O.types.pasp,new Uint8Array([E>>24,E>>16&255,E>>8&255,E&255,u>>24,u>>16&255,u>>8&255,u&255])))},O.esds=function(U){var I=U.config.length;return new Uint8Array([0,0,0,0,3,23+I,0,1,0,4,15+I,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([I]).concat(U.config).concat([6,1,2]))},O.mp4a=function(U){var I=U.samplerate;return O.box(O.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,U.channelCount,0,16,0,0,0,0,I>>8&255,I&255,0,0]),O.box(O.types.esds,O.esds(U)))},O.mp3=function(U){var I=U.samplerate;return O.box(O.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,U.channelCount,0,16,0,0,0,0,I>>8&255,I&255,0,0]))},O.stsd=function(U){return U.type==="audio"?!U.isAAC&&U.codec==="mp3"?O.box(O.types.stsd,O.STSD,O.mp3(U)):O.box(O.types.stsd,O.STSD,O.mp4a(U)):O.box(O.types.stsd,O.STSD,O.avc1(U))},O.tkhd=function(U){var I=U.id,M=U.duration*U.timescale,C=U.width,w=U.height,v=Math.floor(M/(R+1)),k=Math.floor(M%(R+1));return O.box(O.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,I>>24&255,I>>16&255,I>>8&255,I&255,0,0,0,0,v>>24,v>>16&255,v>>8&255,v&255,k>>24,k>>16&255,k>>8&255,k&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,C>>8&255,C&255,0,0,w>>8&255,w&255,0,0]))},O.traf=function(U,I){var M=O.sdtp(U),C=U.id,w=Math.floor(I/(R+1)),v=Math.floor(I%(R+1));return O.box(O.types.traf,O.box(O.types.tfhd,new Uint8Array([0,0,0,0,C>>24,C>>16&255,C>>8&255,C&255])),O.box(O.types.tfdt,new Uint8Array([1,0,0,0,w>>24,w>>16&255,w>>8&255,w&255,v>>24,v>>16&255,v>>8&255,v&255])),O.trun(U,M.length+16+20+8+16+8+8),M)},O.trak=function(U){return U.duration=U.duration||4294967295,O.box(O.types.trak,O.tkhd(U),O.mdia(U))},O.trex=function(U){var I=U.id;return O.box(O.types.trex,new Uint8Array([0,0,0,0,I>>24,I>>16&255,I>>8&255,I&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},O.trun=function(U,I){var M=U.samples||[],C=M.length,w=12+16*C,v=new Uint8Array(w),k,F,D,E,u,y;for(I+=8+w,v.set([0,0,15,1,C>>>24&255,C>>>16&255,C>>>8&255,C&255,I>>>24&255,I>>>16&255,I>>>8&255,I&255],0),k=0;k<C;k++)F=M[k],D=F.duration,E=F.size,u=F.flags,y=F.cts,v.set([D>>>24&255,D>>>16&255,D>>>8&255,D&255,E>>>24&255,E>>>16&255,E>>>8&255,E&255,u.isLeading<<2|u.dependsOn,u.isDependedOn<<6|u.hasRedundancy<<4|u.paddingValue<<1|u.isNonSync,u.degradPrio&240<<8,u.degradPrio&15,y>>>24&255,y>>>16&255,y>>>8&255,y&255],12+16*k);return O.box(O.types.trun,v)},O.initSegment=function(U){O.types||O.init();var I=O.moov(U),M=new Uint8Array(O.FTYP.byteLength+I.byteLength);return M.set(O.FTYP),M.set(I,O.FTYP.byteLength),M},O}();T.types=void 0,T.HDLR_TYPES=void 0,T.STTS=void 0,T.STSC=void 0,T.STCO=void 0,T.STSZ=void 0,T.VMHD=void 0,T.SMHD=void 0,T.STSD=void 0,T.FTYP=void 0,T.DINF=void 0,l.default=T},"./src/remux/mp4-remuxer.ts":function(S,l,r){r.r(l),r.d(l,"default",function(){return y}),r.d(l,"normalizePts",function(){return o});var R=r("./src/polyfills/number.ts"),T=r("./src/remux/aac-helper.ts"),O=r("./src/remux/mp4-generator.ts"),N=r("./src/events.ts"),U=r("./src/errors.ts"),I=r("./src/utils/logger.ts"),M=r("./src/types/loader.ts"),C=r("./src/utils/timescale-conversion.ts");function w(){return w=Object.assign||function(t){for(var f=1;f<arguments.length;f++){var x=arguments[f];for(var m in x)Object.prototype.hasOwnProperty.call(x,m)&&(t[m]=x[m])}return t},w.apply(this,arguments)}var v=10*1e3,k=1024,F=1152,D=null,E=null,u=!1,y=function(){function t(x,m,a,c){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=x,this.config=m,this.typeSupported=a,this.ISGenerated=!1,D===null){var L=navigator.userAgent||"",_=L.match(/Chrome\/(\d+)/i);D=_?parseInt(_[1]):0}if(E===null){var B=navigator.userAgent.match(/Safari\/(\d+)/i);E=B?parseInt(B[1]):0}u=!!D&&D<75||!!E&&E<600}var f=t.prototype;return f.destroy=function(){},f.resetTimeStamp=function(m){I.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=m},f.resetNextTimestamp=function(){I.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},f.resetInitSegment=function(){I.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},f.getVideoStartPts=function(m){var a=!1,c=m.reduce(function(L,_){var B=_.pts-L;return B<-4294967296?(a=!0,o(L,_.pts)):B>0?L:_.pts},m[0].pts);return a&&I.logger.debug("PTS rollover detected"),c},f.remux=function(m,a,c,L,_,B,$,K){var H,j,W,z,Q,V,J=_,X=_,q=m.pid>-1,ue=a.pid>-1,oe=a.samples.length,ce=m.samples.length>0,le=oe>1,G=(!q||ce)&&(!ue||le)||this.ISGenerated||$;if(G){this.ISGenerated||(W=this.generateIS(m,a,_));var Y=this.isVideoContiguous,Z=-1;if(le&&(Z=P(a.samples),!Y&&this.config.forceKeyFrameOnDiscontinuity))if(V=!0,Z>0){I.logger.warn("[mp4-remuxer]: Dropped "+Z+" out of "+oe+" video samples due to a missing keyframe");var ee=this.getVideoStartPts(a.samples);a.samples=a.samples.slice(Z),a.dropped+=Z,X+=(a.samples[0].pts-ee)/(a.timescale||9e4)}else Z===-1&&(I.logger.warn("[mp4-remuxer]: No keyframe found out of "+oe+" video samples"),V=!1);if(this.ISGenerated){if(ce&&le){var te=this.getVideoStartPts(a.samples),ie=o(m.samples[0].pts,te)-te,se=ie/a.inputTimeScale;J+=Math.max(0,se),X+=Math.max(0,-se)}if(ce){if(m.samplerate||(I.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),W=this.generateIS(m,a,_)),j=this.remuxAudio(m,J,this.isAudioContiguous,B,ue||le||K===M.PlaylistLevelType.AUDIO?X:void 0),le){var ne=j?j.endPTS-j.startPTS:0;a.inputTimeScale||(I.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),W=this.generateIS(m,a,_)),H=this.remuxVideo(a,X,Y,ne)}}else le&&(H=this.remuxVideo(a,X,Y,0));H&&(H.firstKeyFrame=Z,H.independent=Z!==-1)}}return this.ISGenerated&&(c.samples.length&&(Q=this.remuxID3(c,_)),L.samples.length&&(z=this.remuxText(L,_))),{audio:j,video:H,initSegment:W,independent:V,text:z,id3:Q}},f.generateIS=function(m,a,c){var L=m.samples,_=a.samples,B=this.typeSupported,$={},K=!Object(R.isFiniteNumber)(this._initPTS),H="audio/mp4",j,W,z;if(K&&(j=W=1/0),m.config&&L.length&&(m.timescale=m.samplerate,m.isAAC||(B.mpeg?(H="audio/mpeg",m.codec=""):B.mp3&&(m.codec="mp3")),$.audio={id:"audio",container:H,codec:m.codec,initSegment:!m.isAAC&&B.mpeg?new Uint8Array(0):O.default.initSegment([m]),metadata:{channelCount:m.channelCount}},K&&(z=m.inputTimeScale,j=W=L[0].pts-Math.round(z*c))),a.sps&&a.pps&&_.length&&(a.timescale=a.inputTimeScale,$.video={id:"main",container:"video/mp4",codec:a.codec,initSegment:O.default.initSegment([a]),metadata:{width:a.width,height:a.height}},K)){z=a.inputTimeScale;var Q=this.getVideoStartPts(_),V=Math.round(z*c);W=Math.min(W,o(_[0].dts,Q)-V),j=Math.min(j,Q-V)}if(Object.keys($).length)return this.ISGenerated=!0,K&&(this._initPTS=j,this._initDTS=W),{tracks:$,initPTS:j,timescale:z}},f.remuxVideo=function(m,a,c,L){var _=m.inputTimeScale,B=m.samples,$=[],K=B.length,H=this._initPTS,j=this.nextAvcDts,W=8,z,Q,V,J=Number.POSITIVE_INFINITY,X=Number.NEGATIVE_INFINITY,q=0,ue=!1;if(!c||j===null){var oe=a*_,ce=B[0].pts-o(B[0].dts,B[0].pts);j=oe-ce}for(var le=0;le<K;le++){var G=B[le];if(G.pts=o(G.pts-H,j),G.dts=o(G.dts-H,j),G.dts>G.pts){var Y=18e3;q=Math.max(Math.min(q,G.pts-G.dts),-1*Y)}G.dts<B[le>0?le-1:le].dts&&(ue=!0)}ue&&B.sort(function(Fe,Be){var He=Fe.dts-Be.dts,je=Fe.pts-Be.pts;return He||je}),Q=B[0].dts,V=B[B.length-1].dts;var Z=Math.round((V-Q)/(K-1));if(q<0){if(q<Z*-2){I.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(C.toMsFromMpegTsClock)(-Z,!0)+" ms");for(var ee=q,te=0;te<K;te++)B[te].dts=ee=Math.max(ee,B[te].pts-Z),B[te].pts=Math.max(ee,B[te].pts)}else{I.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(C.toMsFromMpegTsClock)(q,!0)+" ms to overcome this issue");for(var ie=0;ie<K;ie++)B[ie].dts=B[ie].dts+q}Q=B[0].dts}if(c){var se=Q-j,ne=se>Z,ae=se<-1;if(ne||ae){ne?I.logger.warn("AVC: "+Object(C.toMsFromMpegTsClock)(se,!0)+" ms ("+se+"dts) hole between fragments detected, filling it"):I.logger.warn("AVC: "+Object(C.toMsFromMpegTsClock)(-se,!0)+" ms ("+se+"dts) overlapping between fragments detected"),Q=j;var re=B[0].pts-se;B[0].dts=Q,B[0].pts=re,I.logger.log("Video: First PTS/DTS adjusted: "+Object(C.toMsFromMpegTsClock)(re,!0)+"/"+Object(C.toMsFromMpegTsClock)(Q,!0)+", delta: "+Object(C.toMsFromMpegTsClock)(se,!0)+" ms")}}u&&(Q=Math.max(0,Q));for(var de=0,fe=0,ge=0;ge<K;ge++){for(var he=B[ge],ve=he.units,ye=ve.length,pe=0,me=0;me<ye;me++)pe+=ve[me].data.length;fe+=pe,de+=ye,he.length=pe,he.dts=Math.max(he.dts,Q),he.pts=Math.max(he.pts,he.dts,0),J=Math.min(he.pts,J),X=Math.max(he.pts,X)}V=B[K-1].dts;var Ee=fe+4*de+8,Ae;try{Ae=new Uint8Array(Ee)}catch{this.observer.emit(N.Events.ERROR,N.Events.ERROR,{type:U.ErrorTypes.MUX_ERROR,details:U.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Ee,reason:"fail allocating video mdat "+Ee});return}var Le=new DataView(Ae.buffer);Le.setUint32(0,Ee),Ae.set(O.default.types.mdat,4);for(var Se=0;Se<K;Se++){for(var Pe=B[Se],Te=Pe.units,xe=0,be=0,Oe=Te.length;be<Oe;be++){var Re=Te[be],Ce=Re.data,De=Re.data.byteLength;Le.setUint32(W,De),W+=4,Ae.set(Ce,W),W+=De,xe+=4+De}if(Se<K-1)z=B[Se+1].dts-Pe.dts;else{var Ie=this.config,_e=Pe.dts-B[Se>0?Se-1:Se].dts;if(Ie.stretchShortVideoTrack&&this.nextAudioPts!==null){var ke=Math.floor(Ie.maxBufferHole*_),Me=(L?J+L*_:this.nextAudioPts)-Pe.pts;Me>ke?(z=Me-_e,z<0&&(z=_e),I.logger.log("[mp4-remuxer]: It is approximately "+Me/90+" ms to the next segment; using duration "+z/90+" ms for the last video frame.")):z=_e}else z=_e}var Ne=Math.round(Pe.pts-Pe.dts);$.push(new A(Pe.key,z,xe,Ne))}if($.length&&D&&D<70){var we=$[0].flags;we.dependsOn=2,we.isNonSync=0}console.assert(z!==void 0,"mp4SampleDuration must be computed"),this.nextAvcDts=j=V+z,this.isVideoContiguous=!0;var Ue=O.default.moof(m.sequenceNumber++,Q,w({},m,{samples:$})),$e="video",Ke={data1:Ue,data2:Ae,startPTS:J/_,endPTS:(X+z)/_,startDTS:Q/_,endDTS:j/_,type:$e,hasAudio:!1,hasVideo:!0,nb:$.length,dropped:m.dropped};return m.samples=[],m.dropped=0,console.assert(Ae.length,"MDAT length must not be zero"),Ke},f.remuxAudio=function(m,a,c,L,_){var B=m.inputTimeScale,$=m.samplerate?m.samplerate:B,K=B/$,H=m.isAAC?k:F,j=H*K,W=this._initPTS,z=!m.isAAC&&this.typeSupported.mpeg,Q=[],V=m.samples,J=z?0:8,X=this.nextAudioPts||-1,q=a*B;if(this.isAudioContiguous=c=c||V.length&&X>0&&(L&&Math.abs(q-X)<9e3||Math.abs(o(V[0].pts-W,q)-X)<20*j),V.forEach(function(Ce){Ce.pts=o(Ce.pts-W,q)}),!c||X<0){if(V=V.filter(function(Ce){return Ce.pts>=0}),!V.length)return;_===0?X=0:L?X=Math.max(0,q):X=V[0].pts}if(m.isAAC)for(var ue=_!==void 0,oe=this.config.maxAudioFramesDrift,ce=0,le=X;ce<V.length;ce++){var G=V[ce],Y=G.pts,Z=Y-le,ee=Math.abs(1e3*Z/B);if(Z<=-oe*j&&ue)ce===0&&(I.logger.warn("Audio frame @ "+(Y/B).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*Z/B)+" ms."),this.nextAudioPts=X=le=Y);else if(Z>=oe*j&&ee<v&&ue){var te=Math.round(Z/j);le=Y-te*j,le<0&&(te--,le+=j),ce===0&&(this.nextAudioPts=X=le),I.logger.warn("[mp4-remuxer]: Injecting "+te+" audio frame @ "+(le/B).toFixed(3)+"s due to "+Math.round(1e3*Z/B)+" ms gap.");for(var ie=0;ie<te;ie++){var se=Math.max(le,0),ne=T.default.getSilentFrame(m.manifestCodec||m.codec,m.channelCount);ne||(I.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ne=G.unit.subarray()),V.splice(ce,0,{unit:ne,pts:se}),le+=j,ce++}}G.pts=le,le+=j}for(var ae=null,re=null,de,fe=0,ge=V.length;ge--;)fe+=V[ge].unit.byteLength;for(var he=0,ve=V.length;he<ve;he++){var ye=V[he],pe=ye.unit,me=ye.pts;if(re!==null){var Ee=Q[he-1];Ee.duration=Math.round((me-re)/K)}else if(c&&m.isAAC&&(me=X),ae=me,fe>0){fe+=J;try{de=new Uint8Array(fe)}catch{this.observer.emit(N.Events.ERROR,N.Events.ERROR,{type:U.ErrorTypes.MUX_ERROR,details:U.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:fe,reason:"fail allocating audio mdat "+fe});return}if(!z){var Ae=new DataView(de.buffer);Ae.setUint32(0,fe),de.set(O.default.types.mdat,4)}}else return;de.set(pe,J);var Le=pe.byteLength;J+=Le,Q.push(new A(!0,H,Le,0)),re=me}var Se=Q.length;if(!!Se){var Pe=Q[Q.length-1];this.nextAudioPts=X=re+K*Pe.duration;var Te=z?new Uint8Array(0):O.default.moof(m.sequenceNumber++,ae/K,w({},m,{samples:Q}));m.samples=[];var xe=ae/B,be=X/B,Oe="audio",Re={data1:Te,data2:de,startPTS:xe,endPTS:be,startDTS:xe,endDTS:be,type:Oe,hasAudio:!0,hasVideo:!1,nb:Se};return this.isAudioContiguous=!0,console.assert(de.length,"MDAT length must not be zero"),Re}},f.remuxEmptyAudio=function(m,a,c,L){var _=m.inputTimeScale,B=m.samplerate?m.samplerate:_,$=_/B,K=this.nextAudioPts,H=(K!==null?K:L.startDTS*_)+this._initDTS,j=L.endDTS*_+this._initDTS,W=$*k,z=Math.ceil((j-H)/W),Q=T.default.getSilentFrame(m.manifestCodec||m.codec,m.channelCount);if(I.logger.warn("[mp4-remuxer]: remux empty Audio"),!Q){I.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var V=[],J=0;J<z;J++){var X=H+J*W;V.push({unit:Q,pts:X,dts:X})}return m.samples=V,this.remuxAudio(m,a,c,!1)},f.remuxID3=function(m,a){var c=m.samples.length;if(!!c){for(var L=m.inputTimeScale,_=this._initPTS,B=this._initDTS,$=0;$<c;$++){var K=m.samples[$];K.pts=o(K.pts-_,a*L)/L,K.dts=o(K.dts-B,a*L)/L}var H=m.samples;return m.samples=[],{samples:H}}},f.remuxText=function(m,a){var c=m.samples.length;if(!!c){for(var L=m.inputTimeScale,_=this._initPTS,B=0;B<c;B++){var $=m.samples[B];$.pts=o($.pts-_,a*L)/L}m.samples.sort(function(H,j){return H.pts-j.pts});var K=m.samples;return m.samples=[],{samples:K}}},t}();function o(t,f){var x;if(f===null)return t;for(f<t?x=-8589934592:x=8589934592;Math.abs(t-f)>4294967296;)t+=x;return t}function P(t){for(var f=0;f<t.length;f++)if(t[f].key)return f;return-1}var A=function(f,x,m,a){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=x,this.size=m,this.cts=a,this.flags=new g(f)},g=function(f){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=f?2:1,this.isNonSync=f?0:1}},"./src/remux/passthrough-remuxer.ts":function(S,l,r){r.r(l);var R=r("./src/polyfills/number.ts"),T=r("./src/utils/mp4-tools.ts"),O=r("./src/loader/fragment.ts"),N=r("./src/utils/logger.ts"),U=function(){function C(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var w=C.prototype;return w.destroy=function(){},w.resetTimeStamp=function(k){this.initPTS=k,this.lastEndDTS=null},w.resetNextTimestamp=function(){this.lastEndDTS=null},w.resetInitSegment=function(k,F,D){this.audioCodec=F,this.videoCodec=D,this.generateInitSegment(k),this.emitInitSegment=!0},w.generateInitSegment=function(k){var F=this.audioCodec,D=this.videoCodec;if(!k||!k.byteLength){this.initTracks=void 0,this.initData=void 0;return}var E=this.initData=Object(T.parseInitSegment)(k);F||(F=M(E.audio,O.ElementaryStreamTypes.AUDIO)),D||(D=M(E.video,O.ElementaryStreamTypes.VIDEO));var u={};E.audio&&E.video?u.audiovideo={container:"video/mp4",codec:F+","+D,initSegment:k,id:"main"}:E.audio?u.audio={container:"audio/mp4",codec:F,initSegment:k,id:"audio"}:E.video?u.video={container:"video/mp4",codec:D,initSegment:k,id:"main"}:N.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=u},w.remux=function(k,F,D,E,u){var y=this.initPTS,o=this.lastEndDTS,P={audio:void 0,video:void 0,text:E,id3:D,initSegment:void 0};Object(R.isFiniteNumber)(o)||(o=this.lastEndDTS=u||0);var A=F.samples;if(!A||!A.length)return P;var g={initPTS:void 0,timescale:1},t=this.initData;if((!t||!t.length)&&(this.generateInitSegment(A),t=this.initData),!t||!t.length)return N.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),P;this.emitInitSegment&&(g.tracks=this.initTracks,this.emitInitSegment=!1),Object(R.isFiniteNumber)(y)||(this.initPTS=g.initPTS=y=I(t,A,o));var f=Object(T.getDuration)(A,t),x=o,m=f+x;Object(T.offsetStartDTS)(t,A,y),f>0?this.lastEndDTS=m:(N.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var a=!!t.audio,c=!!t.video,L="";a&&(L+="audio"),c&&(L+="video");var _={data1:A,startPTS:x,startDTS:x,endPTS:m,endDTS:m,type:L,hasAudio:a,hasVideo:c,nb:1,dropped:0};return P.audio=_.type==="audio"?_:void 0,P.video=_.type!=="audio"?_:void 0,P.text=E,P.id3=D,P.initSegment=g,P},C}(),I=function(w,v,k){return Object(T.getStartDTS)(w,v)-k};function M(C,w){var v=C==null?void 0:C.codec;return v&&v.length>4?v:v==="hvc1"?"hvc1.1.c.L120.90":v==="av01"?"av01.0.04M.08":v==="avc1"||w===O.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}l.default=U},"./src/task-loop.ts":function(S,l,r){r.r(l),r.d(l,"default",function(){return R});var R=function(){function T(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var O=T.prototype;return O.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},O.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},O.onHandlerDestroyed=function(){},O.hasInterval=function(){return!!this._tickInterval},O.hasNextTick=function(){return!!this._tickTimer},O.setInterval=function(U){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,U),!0)},O.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},O.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},O.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},O.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},O.doTick=function(){},T}()},"./src/types/cmcd.ts":function(S,l,r){r.r(l),r.d(l,"CMCDVersion",function(){return R}),r.d(l,"CMCDObjectType",function(){return T}),r.d(l,"CMCDStreamingFormat",function(){return O}),r.d(l,"CMCDStreamType",function(){return N});var R=1,T;(function(U){U.MANIFEST="m",U.AUDIO="a",U.VIDEO="v",U.MUXED="av",U.INIT="i",U.CAPTION="c",U.TIMED_TEXT="tt",U.KEY="k",U.OTHER="o"})(T||(T={}));var O;(function(U){U.DASH="d",U.HLS="h",U.SMOOTH="s",U.OTHER="o"})(O||(O={}));var N;(function(U){U.VOD="v",U.LIVE="l"})(N||(N={}))},"./src/types/level.ts":function(S,l,r){r.r(l),r.d(l,"HlsSkip",function(){return O}),r.d(l,"getSkipValue",function(){return N}),r.d(l,"HlsUrlParameters",function(){return U}),r.d(l,"Level",function(){return I});function R(M,C){for(var w=0;w<C.length;w++){var v=C[w];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(M,v.key,v)}}function T(M,C,w){return C&&R(M.prototype,C),w&&R(M,w),M}var O;(function(M){M.No="",M.Yes="YES",M.v2="v2"})(O||(O={}));function N(M,C){var w=M.canSkipUntil,v=M.canSkipDateRanges,k=M.endSN,F=C!==void 0?C-k:0;return w&&F<w?v?O.v2:O.Yes:O.No}var U=function(){function M(w,v,k){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=w,this.part=v,this.skip=k}var C=M.prototype;return C.addDirectives=function(v){var k=new self.URL(v);return this.msn!==void 0&&k.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&k.searchParams.set("_HLS_part",this.part.toString()),this.skip&&k.searchParams.set("_HLS_skip",this.skip),k.toString()},M}(),I=function(){function M(C){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[C.url],this.attrs=C.attrs,this.bitrate=C.bitrate,C.details&&(this.details=C.details),this.id=C.id||0,this.name=C.name,this.width=C.width||0,this.height=C.height||0,this.audioCodec=C.audioCodec,this.videoCodec=C.videoCodec,this.unknownCodecs=C.unknownCodecs,this.codecSet=[C.videoCodec,C.audioCodec].filter(function(w){return w}).join(",").replace(/\.[^.,]+/g,"")}return T(M,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(w){var v=w%this.url.length;this._urlId!==v&&(this.details=void 0,this._urlId=v)}}]),M}()},"./src/types/loader.ts":function(S,l,r){r.r(l),r.d(l,"PlaylistContextType",function(){return R}),r.d(l,"PlaylistLevelType",function(){return T});var R;(function(O){O.MANIFEST="manifest",O.LEVEL="level",O.AUDIO_TRACK="audioTrack",O.SUBTITLE_TRACK="subtitleTrack"})(R||(R={}));var T;(function(O){O.MAIN="main",O.AUDIO="audio",O.SUBTITLE="subtitle"})(T||(T={}))},"./src/types/transmuxer.ts":function(S,l,r){r.r(l),r.d(l,"ChunkMetadata",function(){return R});var R=function(N,U,I,M,C,w){M===void 0&&(M=0),C===void 0&&(C=-1),w===void 0&&(w=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=T(),this.buffering={audio:T(),video:T(),audiovideo:T()},this.level=N,this.sn=U,this.id=I,this.size=M,this.part=C,this.partial=w};function T(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(S,l,r){r.r(l),r.d(l,"AttrList",function(){return O});var R=/^(\d+)x(\d+)$/,T=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,O=function(){function N(I){typeof I=="string"&&(I=N.parseAttrList(I));for(var M in I)I.hasOwnProperty(M)&&(this[M]=I[M])}var U=N.prototype;return U.decimalInteger=function(M){var C=parseInt(this[M],10);return C>Number.MAX_SAFE_INTEGER?1/0:C},U.hexadecimalInteger=function(M){if(this[M]){var C=(this[M]||"0x").slice(2);C=(C.length&1?"0":"")+C;for(var w=new Uint8Array(C.length/2),v=0;v<C.length/2;v++)w[v]=parseInt(C.slice(v*2,v*2+2),16);return w}else return null},U.hexadecimalIntegerAsNumber=function(M){var C=parseInt(this[M],16);return C>Number.MAX_SAFE_INTEGER?1/0:C},U.decimalFloatingPoint=function(M){return parseFloat(this[M])},U.optionalFloat=function(M,C){var w=this[M];return w?parseFloat(w):C},U.enumeratedString=function(M){return this[M]},U.bool=function(M){return this[M]==="YES"},U.decimalResolution=function(M){var C=R.exec(this[M]);if(C!==null)return{width:parseInt(C[1],10),height:parseInt(C[2],10)}},N.parseAttrList=function(M){var C,w={},v='"';for(T.lastIndex=0;(C=T.exec(M))!==null;){var k=C[2];k.indexOf(v)===0&&k.lastIndexOf(v)===k.length-1&&(k=k.slice(1,-1)),w[C[1]]=k}return w},N}()},"./src/utils/binary-search.ts":function(S,l,r){r.r(l);var R={search:function(O,N){for(var U=0,I=O.length-1,M=null,C=null;U<=I;){M=(U+I)/2|0,C=O[M];var w=N(C);if(w>0)U=M+1;else if(w<0)I=M-1;else return C}return null}};l.default=R},"./src/utils/buffer-helper.ts":function(S,l,r){r.r(l),r.d(l,"BufferHelper",function(){return O});var R=r("./src/utils/logger.ts"),T={length:0,start:function(){return 0},end:function(){return 0}},O=function(){function N(){}return N.isBuffered=function(I,M){try{if(I){for(var C=N.getBuffered(I),w=0;w<C.length;w++)if(M>=C.start(w)&&M<=C.end(w))return!0}}catch{}return!1},N.bufferInfo=function(I,M,C){try{if(I){var w=N.getBuffered(I),v=[],k;for(k=0;k<w.length;k++)v.push({start:w.start(k),end:w.end(k)});return this.bufferedInfo(v,M,C)}}catch{}return{len:0,start:M,end:M,nextStart:void 0}},N.bufferedInfo=function(I,M,C){M=Math.max(0,M),I.sort(function(g,t){var f=g.start-t.start;return f||t.end-g.end});var w=[];if(C)for(var v=0;v<I.length;v++){var k=w.length;if(k){var F=w[k-1].end;I[v].start-F<C?I[v].end>F&&(w[k-1].end=I[v].end):w.push(I[v])}else w.push(I[v])}else w=I;for(var D=0,E,u=M,y=M,o=0;o<w.length;o++){var P=w[o].start,A=w[o].end;if(M+C>=P&&M<A)u=P,y=A,D=y-M;else if(M+C<P){E=P;break}}return{len:D,start:u||0,end:y||0,nextStart:E}},N.getBuffered=function(I){try{return I.buffered}catch(M){return R.logger.log("failed to get media.buffered",M),T}},N}()},"./src/utils/cea-608-parser.ts":function(S,l,r){r.r(l),r.d(l,"Row",function(){return y}),r.d(l,"CaptionScreen",function(){return o});var R=r("./src/utils/logger.ts"),T={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},O=function(m){var a=m;return T.hasOwnProperty(m)&&(a=T[m]),String.fromCharCode(a)},N=15,U=100,I={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},M={17:2,18:4,21:6,22:8,23:10,19:13,20:15},C={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},w={25:2,26:4,29:6,30:8,31:10,27:13,28:15},v=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],k;(function(x){x[x.ERROR=0]="ERROR",x[x.TEXT=1]="TEXT",x[x.WARNING=2]="WARNING",x[x.INFO=2]="INFO",x[x.DEBUG=3]="DEBUG",x[x.DATA=3]="DATA"})(k||(k={}));var F=function(){function x(){this.time=null,this.verboseLevel=k.ERROR}var m=x.prototype;return m.log=function(c,L){this.verboseLevel>=c&&R.logger.log(this.time+" ["+c+"] "+L)},x}(),D=function(m){for(var a=[],c=0;c<m.length;c++)a.push(m[c].toString(16));return a},E=function(){function x(a,c,L,_,B){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=a||"white",this.underline=c||!1,this.italics=L||!1,this.background=_||"black",this.flash=B||!1}var m=x.prototype;return m.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},m.setStyles=function(c){for(var L=["foreground","underline","italics","background","flash"],_=0;_<L.length;_++){var B=L[_];c.hasOwnProperty(B)&&(this[B]=c[B])}},m.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},m.equals=function(c){return this.foreground===c.foreground&&this.underline===c.underline&&this.italics===c.italics&&this.background===c.background&&this.flash===c.flash},m.copy=function(c){this.foreground=c.foreground,this.underline=c.underline,this.italics=c.italics,this.background=c.background,this.flash=c.flash},m.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},x}(),u=function(){function x(a,c,L,_,B,$){this.uchar=void 0,this.penState=void 0,this.uchar=a||" ",this.penState=new E(c,L,_,B,$)}var m=x.prototype;return m.reset=function(){this.uchar=" ",this.penState.reset()},m.setChar=function(c,L){this.uchar=c,this.penState.copy(L)},m.setPenState=function(c){this.penState.copy(c)},m.equals=function(c){return this.uchar===c.uchar&&this.penState.equals(c.penState)},m.copy=function(c){this.uchar=c.uchar,this.penState.copy(c.penState)},m.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},x}(),y=function(){function x(a){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var c=0;c<U;c++)this.chars.push(new u);this.logger=a,this.pos=0,this.currPenState=new E}var m=x.prototype;return m.equals=function(c){for(var L=!0,_=0;_<U;_++)if(!this.chars[_].equals(c.chars[_])){L=!1;break}return L},m.copy=function(c){for(var L=0;L<U;L++)this.chars[L].copy(c.chars[L])},m.isEmpty=function(){for(var c=!0,L=0;L<U;L++)if(!this.chars[L].isEmpty()){c=!1;break}return c},m.setCursor=function(c){this.pos!==c&&(this.pos=c),this.pos<0?(this.logger.log(k.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>U&&(this.logger.log(k.DEBUG,"Too large cursor position "+this.pos),this.pos=U)},m.moveCursor=function(c){var L=this.pos+c;if(c>1)for(var _=this.pos+1;_<L+1;_++)this.chars[_].setPenState(this.currPenState);this.setCursor(L)},m.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},m.insertChar=function(c){c>=144&&this.backSpace();var L=O(c);if(this.pos>=U){this.logger.log(k.ERROR,"Cannot insert "+c.toString(16)+" ("+L+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(L,this.currPenState),this.moveCursor(1)},m.clearFromPos=function(c){var L;for(L=c;L<U;L++)this.chars[L].reset()},m.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},m.clearToEndOfRow=function(){this.clearFromPos(this.pos)},m.getTextString=function(){for(var c=[],L=!0,_=0;_<U;_++){var B=this.chars[_].uchar;B!==" "&&(L=!1),c.push(B)}return L?"":c.join("")},m.setPenStyles=function(c){this.currPenState.setStyles(c);var L=this.chars[this.pos];L.setPenState(this.currPenState)},x}(),o=function(){function x(a){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var c=0;c<N;c++)this.rows.push(new y(a));this.logger=a,this.currRow=N-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var m=x.prototype;return m.reset=function(){for(var c=0;c<N;c++)this.rows[c].clear();this.currRow=N-1},m.equals=function(c){for(var L=!0,_=0;_<N;_++)if(!this.rows[_].equals(c.rows[_])){L=!1;break}return L},m.copy=function(c){for(var L=0;L<N;L++)this.rows[L].copy(c.rows[L])},m.isEmpty=function(){for(var c=!0,L=0;L<N;L++)if(!this.rows[L].isEmpty()){c=!1;break}return c},m.backSpace=function(){var c=this.rows[this.currRow];c.backSpace()},m.clearToEndOfRow=function(){var c=this.rows[this.currRow];c.clearToEndOfRow()},m.insertChar=function(c){var L=this.rows[this.currRow];L.insertChar(c)},m.setPen=function(c){var L=this.rows[this.currRow];L.setPenStyles(c)},m.moveCursor=function(c){var L=this.rows[this.currRow];L.moveCursor(c)},m.setCursor=function(c){this.logger.log(k.INFO,"setCursor: "+c);var L=this.rows[this.currRow];L.setCursor(c)},m.setPAC=function(c){this.logger.log(k.INFO,"pacData = "+JSON.stringify(c));var L=c.row-1;if(this.nrRollUpRows&&L<this.nrRollUpRows-1&&(L=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==L){for(var _=0;_<N;_++)this.rows[_].clear();var B=this.currRow+1-this.nrRollUpRows,$=this.lastOutputScreen;if($){var K=$.rows[B].cueStartTime,H=this.logger.time;if(K&&H!==null&&K<H)for(var j=0;j<this.nrRollUpRows;j++)this.rows[L-this.nrRollUpRows+j+1].copy($.rows[B+j])}}this.currRow=L;var W=this.rows[this.currRow];if(c.indent!==null){var z=c.indent,Q=Math.max(z-1,0);W.setCursor(c.indent),c.color=W.chars[Q].penState.foreground}var V={foreground:c.color,underline:c.underline,italics:c.italics,background:"black",flash:!1};this.setPen(V)},m.setBkgData=function(c){this.logger.log(k.INFO,"bkgData = "+JSON.stringify(c)),this.backSpace(),this.setPen(c),this.insertChar(32)},m.setRollUpRows=function(c){this.nrRollUpRows=c},m.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(k.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(k.TEXT,this.getDisplayText());var c=this.currRow+1-this.nrRollUpRows,L=this.rows.splice(c,1)[0];L.clear(),this.rows.splice(this.currRow,0,L),this.logger.log(k.INFO,"Rolling up")},m.getDisplayText=function(c){c=c||!1;for(var L=[],_="",B=-1,$=0;$<N;$++){var K=this.rows[$].getTextString();K&&(B=$+1,c?L.push("Row "+B+": '"+K+"'"):L.push(K.trim()))}return L.length>0&&(c?_="["+L.join(" | ")+"]":_=L.join(`
`)),_},m.getTextAndFormat=function(){return this.rows},x}(),P=function(){function x(a,c,L){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=a,this.outputFilter=c,this.mode=null,this.verbose=0,this.displayedMemory=new o(L),this.nonDisplayedMemory=new o(L),this.lastOutputScreen=new o(L),this.currRollUpRow=this.displayedMemory.rows[N-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=L}var m=x.prototype;return m.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[N-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},m.getHandler=function(){return this.outputFilter},m.setHandler=function(c){this.outputFilter=c},m.setPAC=function(c){this.writeScreen.setPAC(c)},m.setBkgData=function(c){this.writeScreen.setBkgData(c)},m.setMode=function(c){c!==this.mode&&(this.mode=c,this.logger.log(k.INFO,"MODE="+c),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=c)},m.insertChars=function(c){for(var L=0;L<c.length;L++)this.writeScreen.insertChar(c[L]);var _=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(k.INFO,_+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(k.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},m.ccRCL=function(){this.logger.log(k.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},m.ccBS=function(){this.logger.log(k.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},m.ccAOF=function(){},m.ccAON=function(){},m.ccDER=function(){this.logger.log(k.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},m.ccRU=function(c){this.logger.log(k.INFO,"RU("+c+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(c)},m.ccFON=function(){this.logger.log(k.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},m.ccRDC=function(){this.logger.log(k.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},m.ccTR=function(){this.logger.log(k.INFO,"TR"),this.setMode("MODE_TEXT")},m.ccRTD=function(){this.logger.log(k.INFO,"RTD"),this.setMode("MODE_TEXT")},m.ccEDM=function(){this.logger.log(k.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},m.ccCR=function(){this.logger.log(k.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},m.ccENM=function(){this.logger.log(k.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},m.ccEOC=function(){if(this.logger.log(k.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var c=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=c,this.writeScreen=this.nonDisplayedMemory,this.logger.log(k.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},m.ccTO=function(c){this.logger.log(k.INFO,"TO("+c+") - Tab Offset"),this.writeScreen.moveCursor(c)},m.ccMIDROW=function(c){var L={flash:!1};if(L.underline=c%2===1,L.italics=c>=46,L.italics)L.foreground="white";else{var _=Math.floor(c/2)-16,B=["white","green","blue","cyan","red","yellow","magenta"];L.foreground=B[_]}this.logger.log(k.INFO,"MIDROW: "+JSON.stringify(L)),this.writeScreen.setPen(L)},m.outputDataUpdate=function(c){c===void 0&&(c=!1);var L=this.logger.time;L!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=L:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,L,this.lastOutputScreen),c&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:L),this.lastOutputScreen.copy(this.displayedMemory))},m.cueSplitAtTime=function(c){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,c,this.displayedMemory),this.cueStartTime=c))},x}(),A=function(){function x(a,c,L){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var _=new F;this.channels=[null,new P(a,c,_),new P(a+1,L,_)],this.cmdHistory=f(),this.logger=_}var m=x.prototype;return m.getHandler=function(c){return this.channels[c].getHandler()},m.setHandler=function(c,L){this.channels[c].setHandler(L)},m.addData=function(c,L){var _,B,$,K=!1;this.logger.time=c;for(var H=0;H<L.length;H+=2)if(B=L[H]&127,$=L[H+1]&127,!(B===0&&$===0)){if(this.logger.log(k.DATA,"["+D([L[H],L[H+1]])+"] -> ("+D([B,$])+")"),_=this.parseCmd(B,$),_||(_=this.parseMidrow(B,$)),_||(_=this.parsePAC(B,$)),_||(_=this.parseBackgroundAttributes(B,$)),!_&&(K=this.parseChars(B,$),K)){var j=this.currentChannel;if(j&&j>0){var W=this.channels[j];W.insertChars(K)}else this.logger.log(k.WARNING,"No channel found yet. TEXT-MODE?")}!_&&!K&&this.logger.log(k.WARNING,"Couldn't parse cleaned data "+D([B,$])+" orig: "+D([L[H],L[H+1]]))}},m.parseCmd=function(c,L){var _=this.cmdHistory,B=(c===20||c===28||c===21||c===29)&&L>=32&&L<=47,$=(c===23||c===31)&&L>=33&&L<=35;if(!(B||$))return!1;if(t(c,L,_))return g(null,null,_),this.logger.log(k.DEBUG,"Repeated command ("+D([c,L])+") is dropped"),!0;var K=c===20||c===21||c===23?1:2,H=this.channels[K];return c===20||c===21||c===28||c===29?L===32?H.ccRCL():L===33?H.ccBS():L===34?H.ccAOF():L===35?H.ccAON():L===36?H.ccDER():L===37?H.ccRU(2):L===38?H.ccRU(3):L===39?H.ccRU(4):L===40?H.ccFON():L===41?H.ccRDC():L===42?H.ccTR():L===43?H.ccRTD():L===44?H.ccEDM():L===45?H.ccCR():L===46?H.ccENM():L===47&&H.ccEOC():H.ccTO(L-32),g(c,L,_),this.currentChannel=K,!0},m.parseMidrow=function(c,L){var _=0;if((c===17||c===25)&&L>=32&&L<=47){if(c===17?_=1:_=2,_!==this.currentChannel)return this.logger.log(k.ERROR,"Mismatch channel in midrow parsing"),!1;var B=this.channels[_];return B?(B.ccMIDROW(L),this.logger.log(k.DEBUG,"MIDROW ("+D([c,L])+")"),!0):!1}return!1},m.parsePAC=function(c,L){var _,B=this.cmdHistory,$=(c>=17&&c<=23||c>=25&&c<=31)&&L>=64&&L<=127,K=(c===16||c===24)&&L>=64&&L<=95;if(!($||K))return!1;if(t(c,L,B))return g(null,null,B),!0;var H=c<=23?1:2;L>=64&&L<=95?_=H===1?I[c]:C[c]:_=H===1?M[c]:w[c];var j=this.channels[H];return j?(j.setPAC(this.interpretPAC(_,L)),g(c,L,B),this.currentChannel=H,!0):!1},m.interpretPAC=function(c,L){var _,B={color:null,italics:!1,indent:null,underline:!1,row:c};return L>95?_=L-96:_=L-64,B.underline=(_&1)===1,_<=13?B.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(_/2)]:_<=15?(B.italics=!0,B.color="white"):B.indent=Math.floor((_-16)/2)*4,B},m.parseChars=function(c,L){var _,B=null,$=null;if(c>=25?(_=2,$=c-8):(_=1,$=c),$>=17&&$<=19){var K;$===17?K=L+80:$===18?K=L+112:K=L+144,this.logger.log(k.INFO,"Special char '"+O(K)+"' in channel "+_),B=[K]}else c>=32&&c<=127&&(B=L===0?[c]:[c,L]);if(B){var H=D(B);this.logger.log(k.DEBUG,"Char codes =  "+H.join(",")),g(c,L,this.cmdHistory)}return B},m.parseBackgroundAttributes=function(c,L){var _=(c===16||c===24)&&L>=32&&L<=47,B=(c===23||c===31)&&L>=45&&L<=47;if(!(_||B))return!1;var $,K={};c===16||c===24?($=Math.floor((L-32)/2),K.background=v[$],L%2===1&&(K.background=K.background+"_semi")):L===45?K.background="transparent":(K.foreground="black",L===47&&(K.underline=!0));var H=c<=23?1:2,j=this.channels[H];return j.setBkgData(K),g(c,L,this.cmdHistory),!0},m.reset=function(){for(var c=0;c<Object.keys(this.channels).length;c++){var L=this.channels[c];L&&L.reset()}this.cmdHistory=f()},m.cueSplitAtTime=function(c){for(var L=0;L<this.channels.length;L++){var _=this.channels[L];_&&_.cueSplitAtTime(c)}},x}();function g(x,m,a){a.a=x,a.b=m}function t(x,m,a){return a.a===x&&a.b===m}function f(){return{a:null,b:null}}l.default=A},"./src/utils/codecs.ts":function(S,l,r){r.r(l),r.d(l,"isCodecType",function(){return T}),r.d(l,"isCodecSupportedInMp4",function(){return O});var R={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function T(N,U){var I=R[U];return!!I&&I[N.slice(0,4)]===!0}function O(N,U){return MediaSource.isTypeSupported((U||"video")+'/mp4;codecs="'+N+'"')}},"./src/utils/cues.ts":function(S,l,r){r.r(l);var R=r("./src/utils/vttparser.ts"),T=r("./src/utils/webvtt-parser.ts"),O=r("./src/utils/texttrack-utils.ts"),N=/\s/,U={newCue:function(M,C,w,v){for(var k=[],F,D,E,u,y,o=self.VTTCue||self.TextTrackCue,P=0;P<v.rows.length;P++)if(F=v.rows[P],E=!0,u=0,y="",!F.isEmpty()){for(var A=0;A<F.chars.length;A++)N.test(F.chars[A].uchar)&&E?u++:(y+=F.chars[A].uchar,E=!1);F.cueStartTime=C,C===w&&(w+=1e-4),u>=16?u--:u++;var g=Object(R.fixLineBreaks)(y.trim()),t=Object(T.generateCueId)(C,w,g);(!M||!M.cues||!M.cues.getCueById(t))&&(D=new o(C,w,g),D.id=t,D.line=P+1,D.align="left",D.position=10+Math.min(80,Math.floor(u*8/32)*10),k.push(D))}return M&&k.length&&(k.sort(function(f,x){return f.line==="auto"||x.line==="auto"?0:f.line>8&&x.line>8?x.line-f.line:f.line-x.line}),k.forEach(function(f){return Object(O.addCueToTrack)(M,f)})),k}};l.default=U},"./src/utils/discontinuities.ts":function(S,l,r){r.r(l),r.d(l,"findFirstFragWithCC",function(){return N}),r.d(l,"shouldAlignOnDiscontinuities",function(){return U}),r.d(l,"findDiscontinuousReferenceFrag",function(){return I}),r.d(l,"adjustSlidingStart",function(){return C}),r.d(l,"alignStream",function(){return w}),r.d(l,"alignPDT",function(){return k}),r.d(l,"alignFragmentByPDTDelta",function(){return F}),r.d(l,"alignMediaPlaylistByPDT",function(){return D});var R=r("./src/polyfills/number.ts"),T=r("./src/utils/logger.ts"),O=r("./src/controller/level-helper.ts");function N(E,u){for(var y=null,o=0,P=E.length;o<P;o++){var A=E[o];if(A&&A.cc===u){y=A;break}}return y}function U(E,u,y){return!!(u.details&&(y.endCC>y.startCC||E&&E.cc<y.startCC))}function I(E,u){var y=E.fragments,o=u.fragments;if(!o.length||!y.length){T.logger.log("No fragments to align");return}var P=N(y,o[0].cc);if(!P||P&&!P.startPTS){T.logger.log("No frag in previous level to align on");return}return P}function M(E,u){if(E){var y=E.start+u;E.start=E.startPTS=y,E.endPTS=y+E.duration}}function C(E,u){for(var y=u.fragments,o=0,P=y.length;o<P;o++)M(y[o],E);u.fragmentHint&&M(u.fragmentHint,E),u.alignedSliding=!0}function w(E,u,y){!u||(v(E,y,u),!y.alignedSliding&&u.details&&k(y,u.details),!y.alignedSliding&&u.details&&!y.skippedSegments&&Object(O.adjustSliding)(u.details,y))}function v(E,u,y){if(U(E,y,u)){var o=I(y.details,u);o&&Object(R.isFiniteNumber)(o.start)&&(T.logger.log("Adjusting PTS using last level due to CC increase within current level "+u.url),C(o.start,u))}}function k(E,u){if(!(!u.fragments.length||!E.hasProgramDateTime||!u.hasProgramDateTime)){var y=u.fragments[0].programDateTime,o=E.fragments[0].programDateTime,P=(o-y)/1e3+u.fragments[0].start;P&&Object(R.isFiniteNumber)(P)&&(T.logger.log("Adjusting PTS using programDateTime delta "+(o-y)+"ms, sliding:"+P.toFixed(3)+" "+E.url+" "),C(P,E))}}function F(E,u){var y=E.programDateTime;if(!!y){var o=(y-u)/1e3;E.start=E.startPTS=o,E.endPTS=o+E.duration}}function D(E,u){if(!(!u.fragments.length||!E.hasProgramDateTime||!u.hasProgramDateTime)){var y=u.fragments[0].programDateTime,o=u.fragments[0].start,P=y-o*1e3;E.fragments.forEach(function(A){F(A,P)}),E.fragmentHint&&F(E.fragmentHint,P),E.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(S,l,r){r.r(l);var R=r("./src/utils/ewma.ts"),T=function(){function O(U,I,M){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=M,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new R.default(U),this.fast_=new R.default(I)}var N=O.prototype;return N.update=function(I,M){var C=this.slow_,w=this.fast_;this.slow_.halfLife!==I&&(this.slow_=new R.default(I,C.getEstimate(),C.getTotalWeight())),this.fast_.halfLife!==M&&(this.fast_=new R.default(M,w.getEstimate(),w.getTotalWeight()))},N.sample=function(I,M){I=Math.max(I,this.minDelayMs_);var C=8*M,w=I/1e3,v=C/w;this.fast_.sample(w,v),this.slow_.sample(w,v)},N.canEstimate=function(){var I=this.fast_;return I&&I.getTotalWeight()>=this.minWeight_},N.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},N.destroy=function(){},O}();l.default=T},"./src/utils/ewma.ts":function(S,l,r){r.r(l);var R=function(){function T(N,U,I){U===void 0&&(U=0),I===void 0&&(I=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=N,this.alpha_=N?Math.exp(Math.log(.5)/N):0,this.estimate_=U,this.totalWeight_=I}var O=T.prototype;return O.sample=function(U,I){var M=Math.pow(this.alpha_,U);this.estimate_=I*(1-M)+M*this.estimate_,this.totalWeight_+=U},O.getTotalWeight=function(){return this.totalWeight_},O.getEstimate=function(){if(this.alpha_){var U=1-Math.pow(this.alpha_,this.totalWeight_);if(U)return this.estimate_/U}return this.estimate_},T}();l.default=R},"./src/utils/fetch-loader.ts":function(S,l,r){r.r(l),r.d(l,"fetchSupported",function(){return F});var R=r("./src/polyfills/number.ts"),T=r("./src/loader/load-stats.ts"),O=r("./src/demux/chunk-cache.ts");function N(o,P){o.prototype=Object.create(P.prototype),o.prototype.constructor=o,w(o,P)}function U(o){var P=typeof Map=="function"?new Map:void 0;return U=function(g){if(g===null||!C(g))return g;if(typeof g!="function")throw new TypeError("Super expression must either be null or a function");if(typeof P!="undefined"){if(P.has(g))return P.get(g);P.set(g,t)}function t(){return I(g,arguments,v(this).constructor)}return t.prototype=Object.create(g.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),w(t,g)},U(o)}function I(o,P,A){return M()?I=Reflect.construct:I=function(t,f,x){var m=[null];m.push.apply(m,f);var a=Function.bind.apply(t,m),c=new a;return x&&w(c,x.prototype),c},I.apply(null,arguments)}function M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function C(o){return Function.toString.call(o).indexOf("[native code]")!==-1}function w(o,P){return w=Object.setPrototypeOf||function(g,t){return g.__proto__=t,g},w(o,P)}function v(o){return v=Object.setPrototypeOf?Object.getPrototypeOf:function(A){return A.__proto__||Object.getPrototypeOf(A)},v(o)}function k(){return k=Object.assign||function(o){for(var P=1;P<arguments.length;P++){var A=arguments[P];for(var g in A)Object.prototype.hasOwnProperty.call(A,g)&&(o[g]=A[g])}return o},k.apply(this,arguments)}function F(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var D=function(){function o(A){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=A.fetchSetup||u,this.controller=new self.AbortController,this.stats=new T.LoadStats}var P=o.prototype;return P.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},P.abortInternal=function(){var g=this.response;(!g||!g.ok)&&(this.stats.aborted=!0,this.controller.abort())},P.abort=function(){var g;this.abortInternal(),(g=this.callbacks)!==null&&g!==void 0&&g.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},P.load=function(g,t,f){var x=this,m=this.stats;if(m.loading.start)throw new Error("Loader can only be used once.");m.loading.start=self.performance.now();var a=E(g,this.controller.signal),c=f.onProgress,L=g.responseType==="arraybuffer",_=L?"byteLength":"length";this.context=g,this.config=t,this.callbacks=f,this.request=this.fetchSetup(g,a),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){x.abortInternal(),f.onTimeout(m,g,x.response)},t.timeout),self.fetch(this.request).then(function(B){if(x.response=x.loader=B,!B.ok){var $=B.status,K=B.statusText;throw new y(K||"fetch, bad network response",$,B)}return m.loading.first=Math.max(self.performance.now(),m.loading.start),m.total=parseInt(B.headers.get("Content-Length")||"0"),c&&Object(R.isFiniteNumber)(t.highWaterMark)?x.loadProgressively(B,m,g,t.highWaterMark,c):L?B.arrayBuffer():B.text()}).then(function(B){var $=x.response;self.clearTimeout(x.requestTimeout),m.loading.end=Math.max(self.performance.now(),m.loading.first),m.loaded=m.total=B[_];var K={url:$.url,data:B};c&&!Object(R.isFiniteNumber)(t.highWaterMark)&&c(m,g,B,$),f.onSuccess(K,m,g,$)}).catch(function(B){if(self.clearTimeout(x.requestTimeout),!m.aborted){var $=B.code||0;f.onError({code:$,text:B.message},g,B.details)}})},P.getCacheAge=function(){var g=null;if(this.response){var t=this.response.headers.get("age");g=t?parseFloat(t):null}return g},P.loadProgressively=function(g,t,f,x,m){x===void 0&&(x=0);var a=new O.default,c=g.body.getReader(),L=function _(){return c.read().then(function(B){if(B.done)return a.dataLength&&m(t,f,a.flush(),g),Promise.resolve(new ArrayBuffer(0));var $=B.value,K=$.length;return t.loaded+=K,K<x||a.dataLength?(a.push($),a.dataLength>=x&&m(t,f,a.flush(),g)):m(t,f,$,g),_()}).catch(function(){return Promise.reject()})};return L()},o}();function E(o,P){var A={method:"GET",mode:"cors",credentials:"same-origin",signal:P,headers:new self.Headers(k({},o.headers))};return o.rangeEnd&&A.headers.set("Range","bytes="+o.rangeStart+"-"+String(o.rangeEnd-1)),A}function u(o,P){return new self.Request(o.url,P)}var y=function(o){N(P,o);function P(A,g,t){var f;return f=o.call(this,A)||this,f.code=void 0,f.details=void 0,f.code=g,f.details=t,f}return P}(U(Error));l.default=D},"./src/utils/imsc1-ttml-parser.ts":function(S,l,r){r.r(l),r.d(l,"IMSC1_CODEC",function(){return C}),r.d(l,"parseIMSC1",function(){return F});var R=r("./src/utils/mp4-tools.ts"),T=r("./src/utils/vttparser.ts"),O=r("./src/utils/vttcue.ts"),N=r("./src/demux/id3.ts"),U=r("./src/utils/timescale-conversion.ts"),I=r("./src/utils/webvtt-parser.ts");function M(){return M=Object.assign||function(x){for(var m=1;m<arguments.length;m++){var a=arguments[m];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(x[c]=a[c])}return x},M.apply(this,arguments)}var C="stpp.ttml.im1t",w=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,v=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,k={left:"start",center:"center",right:"end",start:"start",end:"end"};function F(x,m,a,c,L){var _=Object(R.findBox)(new Uint8Array(x),["mdat"]);if(_.length===0){L(new Error("Could not parse IMSC1 mdat"));return}var B=_[0],$=Object(N.utf8ArrayToStr)(new Uint8Array(x,B.start,B.end-B.start)),K=Object(U.toTimescaleFromScale)(m,1,a);try{c(D($,K))}catch(H){L(H)}}function D(x,m){var a=new DOMParser,c=a.parseFromString(x,"text/xml"),L=c.getElementsByTagName("tt")[0];if(!L)throw new Error("Invalid ttml");var _={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},B=Object.keys(_).reduce(function(W,z){return W[z]=L.getAttribute("ttp:"+z)||_[z],W},{}),$=L.getAttribute("xml:space")!=="preserve",K=u(E(L,"styling","style")),H=u(E(L,"layout","region")),j=E(L,"body","[begin]");return[].map.call(j,function(W){var z=y(W,$);if(!z||!W.hasAttribute("begin"))return null;var Q=g(W.getAttribute("begin"),B),V=g(W.getAttribute("dur"),B),J=g(W.getAttribute("end"),B);if(Q===null)throw A(W);if(J===null){if(V===null)throw A(W);J=Q+V}var X=new O.default(Q-m,J-m,z);X.id=Object(I.generateCueId)(X.startTime,X.endTime,X.text);var q=H[W.getAttribute("region")],ue=K[W.getAttribute("style")];X.position=10,X.size=80;var oe=o(q,ue),ce=oe.textAlign;if(ce){var le=k[ce];le&&(X.lineAlign=le),X.align=ce}return M(X,oe),X}).filter(function(W){return W!==null})}function E(x,m,a){var c=x.getElementsByTagName(m)[0];return c?[].slice.call(c.querySelectorAll(a)):[]}function u(x){return x.reduce(function(m,a){var c=a.getAttribute("xml:id");return c&&(m[c]=a),m},{})}function y(x,m){return[].slice.call(x.childNodes).reduce(function(a,c,L){var _;return c.nodeName==="br"&&L?a+`
`:(_=c.childNodes)!==null&&_!==void 0&&_.length?y(c,m):m?a+c.textContent.trim().replace(/\s+/g," "):a+c.textContent},"")}function o(x,m){var a="http://www.w3.org/ns/ttml#styling",c=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"];return c.reduce(function(L,_){var B=P(m,a,_)||P(x,a,_);return B&&(L[_]=B),L},{})}function P(x,m,a){return x.hasAttributeNS(m,a)?x.getAttributeNS(m,a):null}function A(x){return new Error("Could not parse ttml timestamp "+x)}function g(x,m){if(!x)return null;var a=Object(T.parseTimeStamp)(x);return a===null&&(w.test(x)?a=t(x,m):v.test(x)&&(a=f(x,m))),a}function t(x,m){var a=w.exec(x),c=(a[4]|0)+(a[5]|0)/m.subFrameRate;return(a[1]|0)*3600+(a[2]|0)*60+(a[3]|0)+c/m.frameRate}function f(x,m){var a=v.exec(x),c=Number(a[1]),L=a[2];switch(L){case"h":return c*3600;case"m":return c*60;case"ms":return c*1e3;case"f":return c/m.frameRate;case"t":return c/m.tickRate}return c}},"./src/utils/logger.ts":function(S,l,r){r.r(l),r.d(l,"enableLogs",function(){return I}),r.d(l,"logger",function(){return M});var R=function(){},T={trace:R,debug:R,log:R,warn:R,info:R,error:R},O=T;function N(C){var w=self.console[C];return w?w.bind(self.console,"["+C+"] >"):R}function U(C){for(var w=arguments.length,v=new Array(w>1?w-1:0),k=1;k<w;k++)v[k-1]=arguments[k];v.forEach(function(F){O[F]=C[F]?C[F].bind(C):N(F)})}function I(C){if(self.console&&C===!0||typeof C=="object"){U(C,"debug","log","info","warn","error");try{O.log()}catch{O=T}}else O=T}var M=O},"./src/utils/mediakeys-helper.ts":function(S,l,r){r.r(l),r.d(l,"KeySystems",function(){return R}),r.d(l,"requestMediaKeySystemAccess",function(){return T});var R;(function(O){O.WIDEVINE="com.widevine.alpha",O.PLAYREADY="com.microsoft.playready"})(R||(R={}));var T=function(){return typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(S,l,r){r.r(l),r.d(l,"getMediaSource",function(){return R});function R(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(S,l,r){r.r(l),r.d(l,"bin2str",function(){return U}),r.d(l,"readUint16",function(){return I}),r.d(l,"readUint32",function(){return M}),r.d(l,"writeUint32",function(){return C}),r.d(l,"findBox",function(){return w}),r.d(l,"parseSegmentIndex",function(){return v}),r.d(l,"parseInitSegment",function(){return k}),r.d(l,"getStartDTS",function(){return F}),r.d(l,"getDuration",function(){return D}),r.d(l,"computeRawDurationFromSamples",function(){return E}),r.d(l,"offsetStartDTS",function(){return u}),r.d(l,"segmentValidRange",function(){return y}),r.d(l,"appendUint8Array",function(){return o});var R=r("./src/utils/typed-array.ts"),T=r("./src/loader/fragment.ts"),O=Math.pow(2,32)-1,N=[].push;function U(P){return String.fromCharCode.apply(null,P)}function I(P,A){"data"in P&&(A+=P.start,P=P.data);var g=P[A]<<8|P[A+1];return g<0?65536+g:g}function M(P,A){"data"in P&&(A+=P.start,P=P.data);var g=P[A]<<24|P[A+1]<<16|P[A+2]<<8|P[A+3];return g<0?4294967296+g:g}function C(P,A,g){"data"in P&&(A+=P.start,P=P.data),P[A]=g>>24,P[A+1]=g>>16&255,P[A+2]=g>>8&255,P[A+3]=g&255}function w(P,A){var g=[];if(!A.length)return g;var t,f,x;"data"in P?(t=P.data,f=P.start,x=P.end):(t=P,f=0,x=t.byteLength);for(var m=f;m<x;){var a=M(t,m),c=U(t.subarray(m+4,m+8)),L=a>1?m+a:x;if(c===A[0])if(A.length===1)g.push({data:t,start:m+8,end:L});else{var _=w({data:t,start:m+8,end:L},A.slice(1));_.length&&N.apply(g,_)}m=L}return g}function v(P){var A=w(P,["moov"]),g=A[0],t=g?g.end:null,f=w(P,["sidx"]);if(!f||!f[0])return null;var x=[],m=f[0],a=m.data[0],c=a===0?8:16,L=M(m,c);c+=4;var _=0,B=0;a===0?c+=8:c+=16,c+=2;var $=m.end+B,K=I(m,c);c+=2;for(var H=0;H<K;H++){var j=c,W=M(m,j);j+=4;var z=W&2147483647,Q=(W&2147483648)>>>31;if(Q===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var V=M(m,j);j+=4,x.push({referenceSize:z,subsegmentDuration:V,info:{duration:V/L,start:$,end:$+z-1}}),$+=z,j+=4,c=j}return{earliestPresentationTime:_,timescale:L,version:a,referencesCount:K,references:x,moovEndOffset:t}}function k(P){for(var A=[],g=w(P,["moov","trak"]),t=0;t<g.length;t++){var f=g[t],x=w(f,["tkhd"])[0];if(x){var m=x.data[x.start],a=m===0?12:20,c=M(x,a),L=w(f,["mdia","mdhd"])[0];if(L){m=L.data[L.start],a=m===0?12:20;var _=M(L,a),B=w(f,["mdia","hdlr"])[0];if(B){var $=U(B.data.subarray(B.start+8,B.start+12)),K={soun:T.ElementaryStreamTypes.AUDIO,vide:T.ElementaryStreamTypes.VIDEO}[$];if(K){var H=w(f,["mdia","minf","stbl","stsd"])[0],j=void 0;H&&(j=U(H.data.subarray(H.start+12,H.start+16))),A[c]={timescale:_,type:K},A[K]={timescale:_,id:c,codec:j}}}}}}var W=w(P,["moov","mvex","trex"]);return W.forEach(function(z){var Q=M(z,4),V=A[Q];V&&(V.default={duration:M(z,12),flags:M(z,20)})}),A}function F(P,A){return w(A,["moof","traf"]).reduce(function(g,t){var f=w(t,["tfdt"])[0],x=f.data[f.start],m=w(t,["tfhd"]).reduce(function(a,c){var L=M(c,4),_=P[L];if(_){var B=M(f,4);x===1&&(B*=Math.pow(2,32),B+=M(f,8));var $=_.timescale||9e4,K=B/$;if(isFinite(K)&&(a===null||K<a))return K}return a},null);return m!==null&&isFinite(m)&&(g===null||m<g)?m:g},null)||0}function D(P,A){for(var g=0,t=0,f=0,x=w(P,["moof","traf"]),m=0;m<x.length;m++){var a=x[m],c=w(a,["tfhd"])[0],L=M(c,4),_=A[L];if(!!_){var B=_.default,$=M(c,0)|(B==null?void 0:B.flags),K=B==null?void 0:B.duration;$&8&&($&2?K=M(c,12):K=M(c,8));for(var H=_.timescale||9e4,j=w(a,["trun"]),W=0;W<j.length;W++){if(g=E(j[W]),!g&&K){var z=M(j[W],4);g=K*z}_.type===T.ElementaryStreamTypes.VIDEO?t+=g/H:_.type===T.ElementaryStreamTypes.AUDIO&&(f+=g/H)}}}if(t===0&&f===0){var Q=v(P);if(Q!=null&&Q.references)return Q.references.reduce(function(V,J){return V+J.info.duration||0},0)}return t||f}function E(P){var A=M(P,0),g=8;A&1&&(g+=4),A&4&&(g+=4);for(var t=0,f=M(P,4),x=0;x<f;x++){if(A&256){var m=M(P,g);t+=m,g+=4}A&512&&(g+=4),A&1024&&(g+=4),A&2048&&(g+=4)}return t}function u(P,A,g){w(A,["moof","traf"]).forEach(function(t){w(t,["tfhd"]).forEach(function(f){var x=M(f,4),m=P[x];if(!!m){var a=m.timescale||9e4;w(t,["tfdt"]).forEach(function(c){var L=c.data[c.start],_=M(c,4);if(L===0)C(c,4,_-g*a);else{_*=Math.pow(2,32),_+=M(c,8),_-=g*a,_=Math.max(_,0);var B=Math.floor(_/(O+1)),$=Math.floor(_%(O+1));C(c,4,B),C(c,8,$)}})}})})}function y(P){var A={valid:null,remainder:null},g=w(P,["moof"]);if(g){if(g.length<2)return A.remainder=P,A}else return A;var t=g[g.length-1];return A.valid=Object(R.sliceUint8)(P,0,t.start-8),A.remainder=Object(R.sliceUint8)(P,t.start-8),A}function o(P,A){var g=new Uint8Array(P.length+A.length);return g.set(P),g.set(A,P.length),g}},"./src/utils/output-filter.ts":function(S,l,r){r.r(l),r.d(l,"default",function(){return R});var R=function(){function T(N,U){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=N,this.trackName=U}var O=T.prototype;return O.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},O.newCue=function(U,I,M){(this.startTime===null||this.startTime>U)&&(this.startTime=U),this.endTime=I,this.screen=M,this.timelineController.createCaptionsTrack(this.trackName)},O.reset=function(){this.cueRanges=[],this.startTime=null},T}()},"./src/utils/texttrack-utils.ts":function(S,l,r){r.r(l),r.d(l,"sendAddTrackEvent",function(){return T}),r.d(l,"addCueToTrack",function(){return O}),r.d(l,"clearCurrentCues",function(){return N}),r.d(l,"removeCuesInRange",function(){return U}),r.d(l,"getCuesInRange",function(){return M});var R=r("./src/utils/logger.ts");function T(C,w){var v;try{v=new Event("addtrack")}catch{v=document.createEvent("Event"),v.initEvent("addtrack",!1,!1)}v.track=C,w.dispatchEvent(v)}function O(C,w){var v=C.mode;if(v==="disabled"&&(C.mode="hidden"),C.cues&&!C.cues.getCueById(w.id))try{if(C.addCue(w),!C.cues.getCueById(w.id))throw new Error("addCue is failed for: "+w)}catch(F){R.logger.debug("[texttrack-utils]: "+F);var k=new self.TextTrackCue(w.startTime,w.endTime,w.text);k.id=w.id,C.addCue(k)}v==="disabled"&&(C.mode=v)}function N(C){var w=C.mode;if(w==="disabled"&&(C.mode="hidden"),C.cues)for(var v=C.cues.length;v--;)C.removeCue(C.cues[v]);w==="disabled"&&(C.mode=w)}function U(C,w,v){var k=C.mode;if(k==="disabled"&&(C.mode="hidden"),C.cues&&C.cues.length>0)for(var F=M(C.cues,w,v),D=0;D<F.length;D++)C.removeCue(F[D]);k==="disabled"&&(C.mode=k)}function I(C,w){if(w<C[0].startTime)return 0;var v=C.length-1;if(w>C[v].endTime)return-1;for(var k=0,F=v;k<=F;){var D=Math.floor((F+k)/2);if(w<C[D].startTime)F=D-1;else if(w>C[D].startTime&&k<v)k=D+1;else return D}return C[k].startTime-w<w-C[F].startTime?k:F}function M(C,w,v){var k=[],F=I(C,w);if(F>-1)for(var D=F,E=C.length;D<E;D++){var u=C[D];if(u.startTime>=w&&u.endTime<=v)k.push(u);else if(u.startTime>v)return k}return k}},"./src/utils/time-ranges.ts":function(S,l,r){r.r(l);var R={toString:function(O){for(var N="",U=O.length,I=0;I<U;I++)N+="["+O.start(I).toFixed(3)+","+O.end(I).toFixed(3)+"]";return N}};l.default=R},"./src/utils/timescale-conversion.ts":function(S,l,r){r.r(l),r.d(l,"toTimescaleFromBase",function(){return T}),r.d(l,"toTimescaleFromScale",function(){return O}),r.d(l,"toMsFromMpegTsClock",function(){return N}),r.d(l,"toMpegTsClockFromTimescale",function(){return U});var R=9e4;function T(I,M,C,w){C===void 0&&(C=1),w===void 0&&(w=!1);var v=I*M*C;return w?Math.round(v):v}function O(I,M,C,w){return C===void 0&&(C=1),w===void 0&&(w=!1),T(I,M,1/C,w)}function N(I,M){return M===void 0&&(M=!1),T(I,1e3,1/R,M)}function U(I,M){return M===void 0&&(M=1),T(I,R,1/M)}},"./src/utils/typed-array.ts":function(S,l,r){r.r(l),r.d(l,"sliceUint8",function(){return R});function R(T,O,N){return Uint8Array.prototype.slice?T.slice(O,N):new Uint8Array(Array.prototype.slice.call(T,O,N))}},"./src/utils/vttcue.ts":function(S,l,r){r.r(l),l.default=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var R=["","lr","rl"],T=["start","middle","end","left","right"];function O(C,w){if(typeof w!="string"||!Array.isArray(C))return!1;var v=w.toLowerCase();return~C.indexOf(v)?v:!1}function N(C){return O(R,C)}function U(C){return O(T,C)}function I(C){for(var w=arguments.length,v=new Array(w>1?w-1:0),k=1;k<w;k++)v[k-1]=arguments[k];for(var F=1;F<arguments.length;F++){var D=arguments[F];for(var E in D)C[E]=D[E]}return C}function M(C,w,v){var k=this,F={enumerable:!0};k.hasBeenReset=!1;var D="",E=!1,u=C,y=w,o=v,P=null,A="",g=!0,t="auto",f="start",x=50,m="middle",a=50,c="middle";Object.defineProperty(k,"id",I({},F,{get:function(){return D},set:function(_){D=""+_}})),Object.defineProperty(k,"pauseOnExit",I({},F,{get:function(){return E},set:function(_){E=!!_}})),Object.defineProperty(k,"startTime",I({},F,{get:function(){return u},set:function(_){if(typeof _!="number")throw new TypeError("Start time must be set to a number.");u=_,this.hasBeenReset=!0}})),Object.defineProperty(k,"endTime",I({},F,{get:function(){return y},set:function(_){if(typeof _!="number")throw new TypeError("End time must be set to a number.");y=_,this.hasBeenReset=!0}})),Object.defineProperty(k,"text",I({},F,{get:function(){return o},set:function(_){o=""+_,this.hasBeenReset=!0}})),Object.defineProperty(k,"region",I({},F,{get:function(){return P},set:function(_){P=_,this.hasBeenReset=!0}})),Object.defineProperty(k,"vertical",I({},F,{get:function(){return A},set:function(_){var B=N(_);if(B===!1)throw new SyntaxError("An invalid or illegal string was specified.");A=B,this.hasBeenReset=!0}})),Object.defineProperty(k,"snapToLines",I({},F,{get:function(){return g},set:function(_){g=!!_,this.hasBeenReset=!0}})),Object.defineProperty(k,"line",I({},F,{get:function(){return t},set:function(_){if(typeof _!="number"&&_!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");t=_,this.hasBeenReset=!0}})),Object.defineProperty(k,"lineAlign",I({},F,{get:function(){return f},set:function(_){var B=U(_);if(!B)throw new SyntaxError("An invalid or illegal string was specified.");f=B,this.hasBeenReset=!0}})),Object.defineProperty(k,"position",I({},F,{get:function(){return x},set:function(_){if(_<0||_>100)throw new Error("Position must be between 0 and 100.");x=_,this.hasBeenReset=!0}})),Object.defineProperty(k,"positionAlign",I({},F,{get:function(){return m},set:function(_){var B=U(_);if(!B)throw new SyntaxError("An invalid or illegal string was specified.");m=B,this.hasBeenReset=!0}})),Object.defineProperty(k,"size",I({},F,{get:function(){return a},set:function(_){if(_<0||_>100)throw new Error("Size must be between 0 and 100.");a=_,this.hasBeenReset=!0}})),Object.defineProperty(k,"align",I({},F,{get:function(){return c},set:function(_){var B=U(_);if(!B)throw new SyntaxError("An invalid or illegal string was specified.");c=B,this.hasBeenReset=!0}})),k.displayState=void 0}return M.prototype.getCueAsHTML=function(){var C=self.WebVTT;return C.convertCueToDOMTree(self,this.text)},M}()},"./src/utils/vttparser.ts":function(S,l,r){r.r(l),r.d(l,"parseTimeStamp",function(){return O}),r.d(l,"fixLineBreaks",function(){return w}),r.d(l,"VTTParser",function(){return v});var R=r("./src/utils/vttcue.ts"),T=function(){function k(){}var F=k.prototype;return F.decode=function(E,u){if(!E)return"";if(typeof E!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(E))},k}();function O(k){function F(E,u,y,o){return(E|0)*3600+(u|0)*60+(y|0)+parseFloat(o||0)}var D=k.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return D?parseFloat(D[2])>59?F(D[2],D[3],0,D[4]):F(D[1],D[2],D[3],D[4]):null}var N=function(){function k(){this.values=Object.create(null)}var F=k.prototype;return F.set=function(E,u){!this.get(E)&&u!==""&&(this.values[E]=u)},F.get=function(E,u,y){return y?this.has(E)?this.values[E]:u[y]:this.has(E)?this.values[E]:u},F.has=function(E){return E in this.values},F.alt=function(E,u,y){for(var o=0;o<y.length;++o)if(u===y[o]){this.set(E,u);break}},F.integer=function(E,u){/^-?\d+$/.test(u)&&this.set(E,parseInt(u,10))},F.percent=function(E,u){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(u)){var y=parseFloat(u);if(y>=0&&y<=100)return this.set(E,y),!0}return!1},k}();function U(k,F,D,E){var u=E?k.split(E):[k];for(var y in u)if(typeof u[y]=="string"){var o=u[y].split(D);if(o.length===2){var P=o[0],A=o[1];F(P,A)}}}var I=new R.default(0,0,""),M=I.align==="middle"?"middle":"center";function C(k,F,D){var E=k;function u(){var P=O(k);if(P===null)throw new Error("Malformed timestamp: "+E);return k=k.replace(/^[^\sa-zA-Z-]+/,""),P}function y(P,A){var g=new N;U(P,function(x,m){var a;switch(x){case"region":for(var c=D.length-1;c>=0;c--)if(D[c].id===m){g.set(x,D[c].region);break}break;case"vertical":g.alt(x,m,["rl","lr"]);break;case"line":a=m.split(","),g.integer(x,a[0]),g.percent(x,a[0])&&g.set("snapToLines",!1),g.alt(x,a[0],["auto"]),a.length===2&&g.alt("lineAlign",a[1],["start",M,"end"]);break;case"position":a=m.split(","),g.percent(x,a[0]),a.length===2&&g.alt("positionAlign",a[1],["start",M,"end","line-left","line-right","auto"]);break;case"size":g.percent(x,m);break;case"align":g.alt(x,m,["start",M,"end","left","right"]);break}},/:/,/\s/),A.region=g.get("region",null),A.vertical=g.get("vertical","");var t=g.get("line","auto");t==="auto"&&I.line===-1&&(t=-1),A.line=t,A.lineAlign=g.get("lineAlign","start"),A.snapToLines=g.get("snapToLines",!0),A.size=g.get("size",100),A.align=g.get("align",M);var f=g.get("position","auto");f==="auto"&&I.position===50&&(f=A.align==="start"||A.align==="left"?0:A.align==="end"||A.align==="right"?100:50),A.position=f}function o(){k=k.replace(/^\s+/,"")}if(o(),F.startTime=u(),o(),k.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+E);k=k.substr(3),o(),F.endTime=u(),o(),y(k,F)}function w(k){return k.replace(/<br(?: \/)?>/gi,`
`)}var v=function(){function k(){this.state="INITIAL",this.buffer="",this.decoder=new T,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var F=k.prototype;return F.parse=function(E){var u=this;E&&(u.buffer+=u.decoder.decode(E,{stream:!0}));function y(){var f=u.buffer,x=0;for(f=w(f);x<f.length&&f[x]!=="\r"&&f[x]!==`
`;)++x;var m=f.substr(0,x);return f[x]==="\r"&&++x,f[x]===`
`&&++x,u.buffer=f.substr(x),m}function o(f){U(f,function(x,m){},/:/)}try{var P="";if(u.state==="INITIAL"){if(!/\r\n|\n/.test(u.buffer))return this;P=y();var A=P.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!A||!A[0])throw new Error("Malformed WebVTT signature.");u.state="HEADER"}for(var g=!1;u.buffer;){if(!/\r\n|\n/.test(u.buffer))return this;switch(g?g=!1:P=y(),u.state){case"HEADER":/:/.test(P)?o(P):P||(u.state="ID");continue;case"NOTE":P||(u.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(P)){u.state="NOTE";break}if(!P)continue;if(u.cue=new R.default(0,0,""),u.state="CUE",P.indexOf("-->")===-1){u.cue.id=P;continue}case"CUE":if(!u.cue){u.state="BADCUE";continue}try{C(P,u.cue,u.regionList)}catch{u.cue=null,u.state="BADCUE";continue}u.state="CUETEXT";continue;case"CUETEXT":{var t=P.indexOf("-->")!==-1;if(!P||t&&(g=!0)){u.oncue&&u.cue&&u.oncue(u.cue),u.cue=null,u.state="ID";continue}if(u.cue===null)continue;u.cue.text&&(u.cue.text+=`
`),u.cue.text+=P}continue;case"BADCUE":P||(u.state="ID")}}}catch{u.state==="CUETEXT"&&u.cue&&u.oncue&&u.oncue(u.cue),u.cue=null,u.state=u.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},F.flush=function(){var E=this;try{if((E.cue||E.state==="HEADER")&&(E.buffer+=`

`,E.parse()),E.state==="INITIAL"||E.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(u){E.onparsingerror&&E.onparsingerror(u)}return E.onflush&&E.onflush(),this},k}()},"./src/utils/webvtt-parser.ts":function(S,l,r){r.r(l),r.d(l,"generateCueId",function(){return v}),r.d(l,"parseWebVTT",function(){return F});var R=r("./src/polyfills/number.ts"),T=r("./src/utils/vttparser.ts"),O=r("./src/demux/id3.ts"),N=r("./src/utils/timescale-conversion.ts"),U=r("./src/remux/mp4-remuxer.ts"),I=/\r\n|\n\r|\n|\r/g,M=function(E,u,y){return y===void 0&&(y=0),E.substr(y,u.length)===u},C=function(E){var u=parseInt(E.substr(-3)),y=parseInt(E.substr(-6,2)),o=parseInt(E.substr(-9,2)),P=E.length>9?parseInt(E.substr(0,E.indexOf(":"))):0;if(!Object(R.isFiniteNumber)(u)||!Object(R.isFiniteNumber)(y)||!Object(R.isFiniteNumber)(o)||!Object(R.isFiniteNumber)(P))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+E);return u+=1e3*y,u+=60*1e3*o,u+=60*60*1e3*P,u},w=function(E){for(var u=5381,y=E.length;y;)u=u*33^E.charCodeAt(--y);return(u>>>0).toString()};function v(D,E,u){return w(D.toString())+w(E.toString())+w(u)}var k=function(E,u,y){var o=E[u],P=E[o.prevCC];if(!P||!P.new&&o.new){E.ccOffset=E.presentationOffset=o.start,o.new=!1;return}for(;(A=P)!==null&&A!==void 0&&A.new;){var A;E.ccOffset+=o.start-P.start,o.new=!1,o=P,P=E[o.prevCC]}E.presentationOffset=y};function F(D,E,u,y,o,P,A,g){var t=new T.VTTParser,f=Object(O.utf8ArrayToStr)(new Uint8Array(D)).trim().replace(I,`
`).split(`
`),x=[],m=Object(N.toMpegTsClockFromTimescale)(E,u),a="00:00.000",c=0,L=0,_,B=!0,$=!1;t.oncue=function(K){var H=y[o],j=y.ccOffset,W=(c-m)/9e4;if(H!=null&&H.new&&(L!==void 0?j=y.ccOffset=H.start:k(y,o,W)),W&&(j=W-y.presentationOffset),$){var z=K.endTime-K.startTime,Q=Object(U.normalizePts)((K.startTime+j-L)*9e4,P*9e4)/9e4;K.startTime=Q,K.endTime=Q+z}var V=K.text.trim();K.text=decodeURIComponent(encodeURIComponent(V)),K.id||(K.id=v(K.startTime,K.endTime,V)),K.endTime>0&&x.push(K)},t.onparsingerror=function(K){_=K},t.onflush=function(){if(_){g(_);return}A(x)},f.forEach(function(K){if(B)if(M(K,"X-TIMESTAMP-MAP=")){B=!1,$=!0,K.substr(16).split(",").forEach(function(H){M(H,"LOCAL:")?a=H.substr(6):M(H,"MPEGTS:")&&(c=parseInt(H.substr(7)))});try{L=C(a)/1e3}catch(H){$=!1,_=H}return}else K===""&&(B=!1);t.parse(K+`
`)}),t.flush()}},"./src/utils/xhr-loader.ts":function(S,l,r){r.r(l);var R=r("./src/utils/logger.ts"),T=r("./src/loader/load-stats.ts"),O=/^age:\s*[\d.]+\s*$/m,N=function(){function U(M){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=M?M.xhrSetup:null,this.stats=new T.LoadStats,this.retryDelay=0}var I=U.prototype;return I.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},I.abortInternal=function(){var C=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),C&&(C.onreadystatechange=null,C.onprogress=null,C.readyState!==4&&(this.stats.aborted=!0,C.abort()))},I.abort=function(){var C;this.abortInternal(),(C=this.callbacks)!==null&&C!==void 0&&C.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},I.load=function(C,w,v){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=C,this.config=w,this.callbacks=v,this.retryDelay=w.retryDelay,this.loadInternal()},I.loadInternal=function(){var C=this.config,w=this.context;if(!!C){var v=this.loader=new self.XMLHttpRequest,k=this.stats;k.loading.first=0,k.loaded=0;var F=this.xhrSetup;try{if(F)try{F(v,w.url)}catch{v.open("GET",w.url,!0),F(v,w.url)}v.readyState||v.open("GET",w.url,!0);var D=this.context.headers;if(D)for(var E in D)v.setRequestHeader(E,D[E])}catch(u){this.callbacks.onError({code:v.status,text:u.message},w,v);return}w.rangeEnd&&v.setRequestHeader("Range","bytes="+w.rangeStart+"-"+(w.rangeEnd-1)),v.onreadystatechange=this.readystatechange.bind(this),v.onprogress=this.loadprogress.bind(this),v.responseType=w.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),C.timeout),v.send()}},I.readystatechange=function(){var C=this.context,w=this.loader,v=this.stats;if(!(!C||!w)){var k=w.readyState,F=this.config;if(!v.aborted&&k>=2)if(self.clearTimeout(this.requestTimeout),v.loading.first===0&&(v.loading.first=Math.max(self.performance.now(),v.loading.start)),k===4){w.onreadystatechange=null,w.onprogress=null;var D=w.status;if(D>=200&&D<300){v.loading.end=Math.max(self.performance.now(),v.loading.first);var E,u;if(C.responseType==="arraybuffer"?(E=w.response,u=E.byteLength):(E=w.responseText,u=E.length),v.loaded=v.total=u,!this.callbacks)return;var y=this.callbacks.onProgress;if(y&&y(v,C,E,w),!this.callbacks)return;var o={url:w.responseURL,data:E};this.callbacks.onSuccess(o,v,C,w)}else v.retry>=F.maxRetry||D>=400&&D<499?(R.logger.error(D+" while loading "+C.url),this.callbacks.onError({code:D,text:w.statusText},C,w)):(R.logger.warn(D+" while loading "+C.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,F.maxRetryDelay),v.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),F.timeout)}},I.loadtimeout=function(){R.logger.warn("timeout while loading "+this.context.url);var C=this.callbacks;C&&(this.abortInternal(),C.onTimeout(this.stats,this.context,this.loader))},I.loadprogress=function(C){var w=this.stats;w.loaded=C.loaded,C.lengthComputable&&(w.total=C.total)},I.getCacheAge=function(){var C=null;if(this.loader&&O.test(this.loader.getAllResponseHeaders())){var w=this.loader.getResponseHeader("age");C=w?parseFloat(w):null}return C},U}();l.default=N}}).default})})(hls);var Hls=getDefaultExportFromCjs(hls.exports),muiPlayerDesktopPlugin_min={exports:{}};/*!
* Mui Player Desktop Plugin Javascript Library v1.4.2
* Date：2022-01-24
* Released under GPL-3.0 license
* https://muiplayer.js.org/
*/(function(e,n){function S(I){return R(I)||r(I)||O(I)||l()}function l(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function r(I){if(typeof Symbol!="undefined"&&I[Symbol.iterator]!=null||I["@@iterator"]!=null)return Array.from(I)}function R(I){if(Array.isArray(I))return N(I)}function T(I,M){var C=typeof Symbol!="undefined"&&I[Symbol.iterator]||I["@@iterator"];if(!C){if(Array.isArray(I)||(C=O(I))||M&&I&&typeof I.length=="number"){C&&(I=C);var w=0,M=function(){};return{s:M,n:function(){return w>=I.length?{done:!0}:{done:!1,value:I[w++]}},e:function(E){throw E},f:M}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var v,k=!0,F=!1;return{s:function(){C=C.call(I)},n:function(){var D=C.next();return k=D.done,D},e:function(D){F=!0,v=D},f:function(){try{k||C.return==null||C.return()}finally{if(F)throw v}}}}function O(I,M){if(I){if(typeof I=="string")return N(I,M);var C=Object.prototype.toString.call(I).slice(8,-1);return(C=C==="Object"&&I.constructor?I.constructor.name:C)==="Map"||C==="Set"?Array.from(I):C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C)?N(I,M):void 0}}function N(I,M){(M==null||M>I.length)&&(M=I.length);for(var C=0,w=new Array(M);C<M;C++)w[C]=I[C];return w}function U(I){return(U=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M})(I)}(function(I,M){U(n)=="object"&&U(e)=="object"?e.exports=M():I.MuiPlayerDesktopPlugin=M()})(window,function(){return function(I){function M(){return{defaults:[{functions:"\u5FAA\u73AF\u64AD\u653E",name:"loopPlay",show:!0,model:"switch",selected:!1,onToggle:function(t,f,x){f(),t.event.currentTarget.querySelector(".toogle-switch").classList.contains("open")?v.$el.videoObject.loop=!0:v.$el.videoObject.loop=!1}},{functions:"\u64AD\u653E\u901F\u5EA6",name:"playbackRate",show:!0,model:"select",childConfig:[{functions:"0.25"},{functions:"0.5"},{functions:"0.75"},{functions:"\u6B63\u5E38",selected:!0},{functions:"1.25"},{functions:"1.5"},{functions:"1.75"},{functions:"2"}],onToggle:function(t,f,x){f(),x(),x=v.$method.getLangObject(),t=t.functions,isNaN(parseFloat(t))?(v.$el.videoObject.playbackRate=1,E.rst(x.dsps)):(v.$el.videoObject.playbackRate=parseFloat(t),E.rst(x.tsps.replace("?",t)))}}],subtitle:{functions:"\u5B57\u5E55",name:"subtitle",childConfig:[{functions:"\u6253\u5F00",name:"loopPlay",model:"switch",selected:!0},{functions:"\u9009\u62E9\u8BED\u8A00",childConfig:[],onToggle:function(t,f,x){var m=t.getPanelOption(t.panelIndex,"parent").panelIndex,a=v.$el.videoObject.textTracks;a&&a instanceof TextTrackList?function(){for(var c=0;c<a.length;c++){var L=a[c];t.functions==L.label?(L.mode="showing",t.getPanelOption(m,"parent").childConfig[0].selected=!0,f()):L.mode=="showing"&&(L.mode="hidden")}}():E.rst("the textTracks api is not supported by the browser.")}}],onToggle:function(t,f,x){var m=t.event.currentTarget.querySelector(".toogle-switch").classList.contains("open"),a=v.$el.videoObject.textTracks;a&&a instanceof TextTrackList?function(){if(m)for(var c=0;c<a.length;c++){var L=a[c];L.mode=="showing"&&(L.mode="hidden")}else for(var _=t.getPanelOption(t.panelIndex,"parent").childConfig[1].childConfig,c=0;c<a.length;c++){var B,$=a[c],K=T(_);try{for(K.s();!(B=K.n()).done;){var H=B.value;if($.label==H.functions&&H.selected==1){$.mode="showing";break}}}catch(W){K.e(W)}finally{K.f()}}f()}():E.rst("the textTracks api is not supported by the browser.")}}}}function C(t){t=="statics"&&(D=new M().defaults,P.initSubtitleOption()&&D.push(P.initSubtitleOption())),!D.map(function(K){return K.name}).includes("subtitle")&&t!="statics"&&P.initSubtitleOption()&&D.push(P.initSubtitleOption());var f,x=v.$method.getLangObject();for(f in D){var m=D[f].name;m!="loopPlay"?m!="playbackRate"?m!="subtitle"||(D[f].functions=x.subtitles,D[f].childConfig[0].functions=x.open,D[f].childConfig[1].functions=x.selectLangage):(D[f].functions=x.playbackSpeed,D[f].childConfig[3].functions=x.normal):D[f].functions=x.loopPlay}var a=S(I.customSetting||[]);if(a instanceof Array){for(var c=0;c<a.length;c++){var L=D.map(function(K){return K.name});L.indexOf(a[c].name)!=-1&&D.splice(L.indexOf(a[c].name),1)}(function K(){for(var H=0;H<a.length;H++)a[H].show===!1&&(a.splice(H,1),K())})()}var _=(t=v.option).loop,B=t.live;if(_==1||B===!0){for(var $ in D)if(D[$].name=="loopPlay"){_==1&&(D[0].selected=!0),B===!0&&D.splice(0,D.length);break}}(t=[].concat(S(D),S(a))).sort(function(K,H){return K=K.zIndex||0,H=H.zIndex||0,H<K?-1:K<H?1:0}),function K(H,j){for(var W=0;W<H.length;W++)H[W].panelIndex=j==null?W.toString():j.toString()+"-"+W,H[W].childConfig instanceof Array&&0<H[W].childConfig.length&&K(H[W].childConfig,H[W].panelIndex)}(F=t)}var w=this,v=(I=I||{},{}),k=new function(){return{popupNodeInfo:{triggerButtonRect:{},popupRect:{}}}},F=null,D=[],E={rst:function(t){v.$method[v.$method.dc("03702W03303B02C03302P037038")](t)}},u={ctxmenuWrapper:function(){return v.$el.mPlayer.querySelector("#ctxmenu-wrapper")},hideShortcutPanel:function(){var t=v.$el.mPlayer.querySelector("#mplayer-shortcut");t&&(t.style.display="none")},hideCtxmenuList:function(t){(t=t||{}).stopPropagation&&t.stopPropagation();var f=u.ctxmenuWrapper().querySelector(".ctxmenulist");f.style.opacity=0,v._this._global_.ctxmenuTimer_1=setTimeout(function(){f.style.display="none"},100)},onCtxmenuFocus:function(t){v._this._global_.ctxmenuTimer_1&&clearTimeout(v._this._global_.ctxmenuTimer_1),v._this._global_.ctxmenuTimer_2&&clearTimeout(v._this._global_.ctxmenuTimer_2),u.ctxmenuWrapper().style.display="block",u.hideShortcutPanel()},onCtxmenuBlur:function(t){(t=t||{}).stopPropagation&&t.stopPropagation(),u.hideCtxmenuList(),v._this._global_.ctxmenuTimer_2=setTimeout(function(){u.ctxmenuWrapper().style.display="none",u.ctxmenuWrapper().removeChild(t.target)},300)},disCtx:function(t,f){for(var x=0;x<t.length;x++){var m=f.map(function(a){return a.name}).indexOf(t[x].name);m!=-1&&f.splice(m,1)}(function a(){for(var c=0;c<t.length;c++)t[c].show!==!1&&t[c].name&&t[c].context||(t.splice(c,1),a())})()},getCtxmenu:function(){var x=new this.dcm,t=[];(t=S(I.contextmenu||[]))instanceof Array&&this.disCtx(t,x);var f,x=[].concat(S(t),S(x)),m=v.$method.getLangObject(),a=T(x);try{for(a.s();!(f=a.n()).done;){var c=f.value;if(c.name=="shortcuts"){c.context=m.shortcuts;break}}}catch(L){a.e(L)}finally{a.f()}return x.sort(function(L,_){return L=L.zIndex||0,_=_.zIndex||0,_<L?-1:L<_?1:0}),x},createCtxmenu:function(t){var f=u.getCtxmenu();if(t.button==2&&f.length!=0){var x=document.createElement("ul");x.setAttribute("class","ctxmenulist"),x.setAttribute("tabindex","0"),x.addEventListener("blur",u.onCtxmenuBlur),u.onCtxmenuFocus();for(var m=f.map(function($){return $.name}),a=0;a<f.length;a++){var c=document.createElement("li");c.innerText=f[a].context,c.setAttribute("name",f[a].name),c.addEventListener("dblclick",function($){$.stopPropagation()}),c.addEventListener("mousemove",function($){$.stopPropagation()}),c.addEventListener("click",function($){$.stopPropagation(),$=m.indexOf($.currentTarget.getAttribute("name")),f[$].click instanceof Function&&f[$].click(function(){v.$el.mPlayer.focus()})}),x.appendChild(c)}v.$method.removeNode(u.ctxmenuWrapper(),".ctxmenulist"),u.ctxmenuWrapper().appendChild(x),g.setElScale(x,{fontSize:14});var B=v.$el.mPlayer.getBoundingClientRect(),L=x.getBoundingClientRect(),_=t.clientX-B.left+L.width>B.width?B.width-L.width:t.clientX-B.left,B=t.clientY-B.top+L.height>B.height?B.height-L.height:t.clientY-B.top;x.style.top=B+"px",x.style.left=_+"px",x.focus(),setTimeout(function(){x.style.opacity=1},100)}},dcm:function(){var t=v.$method.dc;return[{name:t("03702W03303603802R039038037"),context:t("IY3JNBTGU"),click:function(){var f=v.$el.mPlayer.querySelector("#mplayer-shortcut");f&&(f.style.display="block"),v.$el.mPlayer.focus()}},{name:t("03103902X03403002P03D02T036"),context:t("02503902X02803002P03D02T036"),click:function(){window.open(t("02W03803803403701M01B01B02V02X03802W03902Q01A02R03303101B03103902X03403002P03D02T03601B02W02T03003003301903103902X03403002P03D02T036"))}}]},onContextmenuEvent:function(t){t.preventDefault()}},y={togglePictureIcon:function(){return document.pictureInPictureElement?'<svg class="off-picture" xmlns="http://www.w3.org/2000/svg"viewBox="0 0 24 24"fill="#ffffff"><path d="m19,7l-14,0l0,10l14,0l0,-10zm4,12l0,-14.02c0,-1.1 -0.9,-1.98 -2,-1.98l-18,0c-1.1,0 -2,0.88 -2,1.98l0,14.02c0,1.1 0.9,2 2,2l18,0c1.1,0 2,-0.9 2,-2zm-2,0.02l-18,0l0,-14.05l18,0l0,14.05z"/><path fill="none"d="m0,0l24,0l0,24l-24,0l0,-24z"/></svg>':'<svg class="on-picture" xmlns="http://www.w3.org/2000/svg"viewBox="0 0 24 24"fill="#ffffff"><path d="M19 11h-8v6h8v-6zm4 8V4.98C23 3.88 22.1 3 21 3H3c-1.1 0-2 .88-2 1.98V19c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2zm-2 .02H3V4.97h18v14.05z"/><path fill="none"d="M0 0h24v24H0V0z"/></svg>'},monitorPictureChange:function(){var t;v._this._global_.webpagePlugin.addMonitorPictureEvent||(v._this._global_.webpagePlugin.addMonitorPictureEvent=!0,t=function(){v.$el.mplayerFooter.querySelector("#picture-in-picture").innerHTML=y.togglePictureIcon()},v.$el.videoObject.addEventListener("enterpictureinpicture",function(f){v._this.emit("pip-change",{pip:!0}),t(),v.$data.isFullScreen&&v.$method.closeFullScreen(),v.$method.setTooltipText(v.$el.mplayerFooter.querySelector("#picture-in-picture"),v.$method.getLangObject().exitPictureInPicture)}),v.$el.videoObject.addEventListener("leavepictureinpicture",function(f){v._this.emit("pip-change",{pip:!1}),t(),v.$method.setTooltipText(v.$el.mplayerFooter.querySelector("#picture-in-picture"),v.$method.getLangObject().pictureInPicture)}))},onPictureInPicture:function(t){t.currentTarget.querySelector("svg").classList.contains("on-picture")?v.$el.videoObject!=document.pictureInPictureElement&&v.$el.videoObject.requestPictureInPicture():document.exitPictureInPicture(),y.monitorPictureChange()}},o={volumeContainer:null,el:null,$el:function(){return{volumeSize:o.volumeContainer.querySelector(".volume-size"),volumeCapacity:o.volumeContainer.querySelector(".volume-capacity"),volumeDragBall:o.volumeContainer.querySelector(".volume-drag-ball"),progressBar:o.volumeContainer.querySelector(".progress-bar")}},data:null,$data:function(){return{startY:null,moveY:null,_defaultVolumeSize:null,_capacityRect:{},_dragBallRect:{}}},toggleVolumeControl:function(t){var f;t=o.getStorageVolume().muted===!0?0:t,o.data&&(f=o.data._capacityRect.height*(t/100)-o.data._dragBallRect.height,o.el.volumeDragBall.style.bottom=(0<f?f:0)+"px",o.el.progressBar.style.height=t+"%",o.el.volumeSize.innerText=t+"%"),v.$el.mplayerFooter.querySelector("#volume-switch").innerHTML=o.toggleVolumeIcon()},setVolume:function(t,f){return f=Number.parseFloat(o.data._defaultVolumeSize||0)+(f==null?100:f),100<=f?f=100:f<=0&&(f=0),f=Number.parseInt(f),t instanceof Object&&typeof t.volume=="number"&&(f=t.volume),o.setStorageVolume(f),v.$el.videoObject.volume=f/100,o.toggleVolumeControl(f),f},computeProgress:function(t,f){f(t/o.el.volumeCapacity.getBoundingClientRect().height*100)},keyEventHandle:function(t){var f=v.$method.getKeyCode(t);new Array(13,38,40).indexOf(f)!=-1&&(t.stopPropagation(),t.preventDefault()),f!=13?f!=38?f==40&&A.bottomKeyDown():A.topKeyDown():o.onClickEvent({currentTarget:v.$el.mplayerFooter.querySelector("#volume-switch")},!0)},mouseEventHandle:function(t){switch(t.type){case"mousedown":(function(){o.data.startY=t.clientY;var f=o.el.volumeCapacity.getBoundingClientRect().bottom-t.clientY;o.computeProgress(f,function(x){v.$el.videoObject.muted&&(v.$el.videoObject.muted=!1),x=o.setVolume(!1,x),v._this._global_.webpagePlugin.startDownVolumeSize=x,o.data._defaultVolumeSize=o.el.progressBar.style.height.substr(0,o.el.progressBar.style.height.length-1)||0}),o.el.volumeDragBall.style.boxShadow="0 0 20px 3px "+v.$habit.themeColor,P.focusToggle("OFF"),o.volumeContainer.addEventListener("mousemove",o.mouseEventHandle),o.volumeContainer.addEventListener("mouseup",o.mouseEventHandle)})();break;case"mousemove":(function(){o.data.moveY=t.clientY,o.data.startY||(o.data.startY=t.clientY);var f=o.data.startY-o.data.moveY;o.computeProgress(f,function(x){x=o.setVolume(!1,x),v._this._global_.webpagePlugin.endDownVolumeSize=x})})();break;case"mouseup":o.data._defaultVolumeSize=0,o.el.volumeDragBall.style.boxShadow="none",o.volumeContainer.removeEventListener("mousemove",o.mouseEventHandle),o.volumeContainer.removeEventListener("mouseup",o.mouseEventHandle)}},getStorageVolume:function(){var t={};try{t=JSON.parse(window.localStorage.getItem("mp-player-volume"))||{}}catch{}return t},setStorageVolume:function(a,c){var m=o.getStorageVolume(),x=c!=null?m.volume||100:a,m=c!=null?c:v.$el.videoObject instanceof Element&&v.$el.videoObject.muted,a=new Date().setMonth(new Date().getMonth()+1),c=new Date().getTime();window.localStorage.setItem("mp-player-volume",JSON.stringify({volume:x,muted:m,expiration:a,creation:c}))},toggleVolumeIcon:function(){var t='<svg class="volume-full"fill="#ffffff"viewBox="0 0 24 24"xmlns="http://www.w3.org/2000/svg"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',f='<svg fill="#ffffff"viewBox="0 0 24 24"xmlns="http://www.w3.org/2000/svg"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',x='<svg class="volume-close"fill="#ffffff"viewBox="0 0 24 24"xmlns="http://www.w3.org/2000/svg"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',m=o.getStorageVolume();return m.expiration<=new Date().getTime()?t:m.muted===!0||m.volume==0?x:m.volume<50?f:t},createVolumePopup:function(){var t=new g.popupInstance().createPopupElement();return t.setAttribute("popup-name","volume"),t.innerHTML='<div class="volume-container keyboard-input"id="volume-container"tabindex="0"><div class="volume-size">0%</div><div class="volume-capacity"><div class="volume-drag-ball"></div><div class="progress-bar"></div></div></div>',t.querySelector(".progress-bar").style.backgroundColor=v.$habit.themeColor,o.volumeContainer=t.querySelector("#volume-container"),o.el=new o.$el,o.data=new o.$data,o.volumeContainer.addEventListener("mousedown",o.mouseEventHandle),o.volumeContainer.addEventListener("keydown",o.keyEventHandle),o.volumeContainer.addEventListener("blur",function(){new g.popupInstance().togglePopupVisible("OFF")}),t},showVolumePopup:function(t){var f;t=t||{},v.$data.isTouchMove||(f=v.$el.mPlayer.querySelector(".mp-popup"))||(f=o.createVolumePopup(),t.type=="keydown"&&setTimeout(function(){f.querySelector("#volume-container").focus()},100),v.$el.mplayerFooter.insertBefore(f,v.$el.mplayerFooter.childNodes[0]),v.$data.isFullScreen&&(g.setElScale(f,["width","height"]),g.setElScale(f.querySelector(".volume-capacity"),["width","height"]),g.setElScale(f.querySelector(".volume-drag-ball"),["width","height"]),g.setElScale(f.querySelector(".volume-container"),["fontSize"])),o.data._capacityRect=o.el.volumeCapacity.getBoundingClientRect(),o.data._dragBallRect=o.el.volumeDragBall.getBoundingClientRect(),t=o.getStorageVolume(),o.setVolume(t),new g.popupInstance().setVisiblePopup(f,v.$el.mplayerFooter.querySelector("#volume-switch")))},onClickEvent:function(t,f){var x,m;t.currentTarget.exist!==!1&&(t.currentTarget.querySelector("svg").classList.contains("volume-close")?(o.setStorageVolume(null,!1),x=o.getStorageVolume().volume||100,m=v._this._global_.webpagePlugin.endDownVolumeSize,t=v._this._global_.webpagePlugin.startDownVolumeSize,o.toggleVolumeControl(m==0?t:m||x),v.$el.videoObject.muted=!1):(o.setStorageVolume(null,!0),o.toggleVolumeControl(0),v.$el.videoObject.muted=!0),f===!0&&(v.$method.createTimerCloseControl(),g.showHandleIcon("volume-icon")))}},P={currentFocusPanelId:"",isFocusActive:!1,backPanel:function(t){var f=P.getPanelOption(t,"parent");P.showPanel(f,"previous",t)},selected:function(t){for(var f=v.$el.mPlayer.querySelector(".mp-popup"),x=f.querySelectorAll(".mp-panel-selected"),m=0;m<x.length;m++)x[m].classList.remove("mp-panel-selected");f.querySelector('[panel-index="'+t+'"]').classList.add("mp-panel-selected");for(var a=P.getPanelOption(t,"parent").childConfig||[],m=0;m<a.length;m++)a[m].panelIndex==t?a[m].selected=!0:a[m].selected&&a[m].model!="switch"&&(a[m].selected=!1)},switched:function(t){var f=P.getPanelOption(t);f.selected=!f.selected,t=v.$el.mPlayer.querySelector('.mp-popup [panel-index="'+t+'"] .toogle-switch'),t.classList.remove(f.selected?"close":"open"),t.classList.add(f.selected?"open":"close")},triggerSelected:function(t,f){var x,m;f.stopPropagation(),t&&(t.childConfig instanceof Array&&0<t.childConfig.length?P.showPanel(t):t.model!="switch"&&t.selected===!0||(m=null,(m=(x=P.getPanelOption(t.panelIndex,"parent"))instanceof Array?t:x).onToggle instanceof Function&&m.onToggle({functions:t.functions,panelIndex:t.panelIndex,getPanelOption:P.getPanelOption,event:f},function(a){t.model=="switch"?P.switched(t.panelIndex):P.selected(t.panelIndex),a instanceof Function&&a()},function(a){x instanceof Object&&x.childConfig instanceof Array&&0<x.childConfig.length?setTimeout(function(){P.backPanel(x.panelIndex)},typeof a=="number"?a:100):console.warn("no subpanel configuration options are available")})))},setScalePopup:function(t){if(v.$data.isFullScreen&&t instanceof Element){g.setElScale(t,["width","height",t.classList.contains("mp-popup")?"fontSize":""]),g.setElScale(t.querySelector(".toogle-switch"),["width","height"]),g.setElScale(t.querySelector(".toogle-switch .ball"),["width","height"]);for(var f=t.querySelectorAll(".mp-menuitem"),x=0;x<f.length;x++)g.setElScale(f[x],["height","lineHeight"])}},isNextReady:!0,showPanel:function(t,f,x){var m,a,c,L,_,B,$,K,H;P.isNextReady&&(m=P.createSettingPopup(t),a=v.$el.mPlayer.querySelector(".mp-popup"),c=a.querySelector(".mp-panel-item"),a.appendChild(m.childNodes[0]),t=t instanceof Array?"homeSetting":t.functions,(L=a.querySelector('[panel-name="'+t+'"]')).classList.add("mp-panel-item"),P.setScalePopup(L),_=a.getBoundingClientRect(),B=c.getBoundingClientRect(),$=L.getBoundingClientRect(),t=(t=v.$el.mPlayer.getBoundingClientRect()).height-(t.height-$.bottom)-(t.top+10),K=$.height>=t?t:$.height,L.style.width=$.width+"px",L.style.height=K+"px",L.style.right=(f=="previous"?B.width:-$.width)+"px",t=L.querySelector(".mp-panel-menu .mp-panel-selected"),x=L.querySelector('[panel-index="'+x+'"]'),H=t||x||L.querySelector("[panel-index]"),setTimeout(function(){H.focus()},250),setTimeout(function(){for(var j=a.querySelectorAll(".mp-panel"),W=0;W<j.length;W++)j[W].classList.contains("mp-popup-animation")||j[W].classList.add("mp-popup-animation");a.classList.contains("mp-popup-animation")||a.classList.add("mp-popup-animation"),c.style.opacity=0,c.style.right=(f=="previous"?-B.width:$.width)+"px",_.width!=$.width&&(a.style.width=$.width+"px"),_.height!=K&&(a.style.height=K+"px"),L.style.right="0px",P.currentFocusPanelId=""},30),P.isNextReady=!1,setTimeout(function(){var q=a.getBoundingClientRect(),j=q.bottom,W=q.height,z=q.left,Q=q.right,V=q.top,J=q.width,X=q.x,q=q.y;k.popupNodeInfo.popupRect={bottom:j,height:W,left:z,right:Q,top:V,width:J,x:X,y:q},B.top<L.getBoundingClientRect().top&&(k.popupNodeInfo.popupRect.top=B.top,k.popupNodeInfo.popupRect.height=B.height),P.isNextReady=!0,a.removeChild(c)},250))},getPanelOption:function(t,f){var x=!1,m=null;return function a(c,L){for(var _=0;_<c.length&&!x;_++){var B=c[_];B.panelIndex==t?(x=!0,m=f=="parent"?L:B):B.childConfig instanceof Array&&0<B.childConfig.length&&a(B.childConfig,B)}}(F,F),m},setCurrentModelEl:function(t){var f=t.childConfig,x=t.model||"select",m="";if(x=="select"&&f instanceof Array&&0<f.length){for(var a=0;a<f.length;a++)if(f[a].selected===!0){m=f[a].functions||"";break}}else x=="switch"&&(m='<div class="toogle-switch '+(t.selected?"open":"close")+'" id="toggle-fit" style="background: '+v.$habit.themeColor+';"><div class="ball"></div></div>');return m},createSettingPopup:function(t){var f=new g.popupInstance().createPopupElement();f.setAttribute("popup-name","setting"),t instanceof Array?f.innerHTML='<div class="mp-panel" panel-name="homeSetting"><div class="mp-panel-menu"></div></div>':(f.innerHTML='<div class="mp-panel mp-panel-child" panel-name="'+t.functions+'"><div class="mp-panel-menu"><ul class="mp-menuitem mp-panel-header"><li class="title"><div class="mp-menuitem-content left-arrow-icon">'+t.functions+"</div></li><li></li></ul></div></div>",f.querySelector(".mp-panel-header .title").addEventListener("click",function($){$.stopPropagation(),P.isFocusActive=!0,P.backPanel(t.panelIndex)}));for(var x=t instanceof Array?t:t.childConfig,m=0;m<x.length;m++){var a,c,L,_=x[m]||{},B=_.model||"select";_.functions&&typeof _.functions=="string"&&((a=document.createElement("ul")).setAttribute("class","mp-menuitem"),a.setAttribute("panel-index",_.panelIndex),a.setAttribute("tabindex","0"),_.selected!==!0||B!="select"||t instanceof Array||a.classList.add("mp-panel-selected"),(c=document.createElement("li")).innerHTML=_.functions,L=document.createElement("li"),(B=document.createElement("div")).setAttribute("class","mp-menuitem-content"),_.childConfig instanceof Array&&0<_.childConfig.length&&B.classList.add("arrow-icon"),_.model=="switch"&&B.classList.add("switch-icon"),B.innerHTML=P.setCurrentModelEl(_),L.appendChild(B),a.appendChild(c),a.appendChild(L),a.addEventListener("click",function($){var K=P.getPanelOption($.currentTarget.getAttribute("panel-index"));P.triggerSelected(K,$)}),a.addEventListener("mousedown",function(){P.focusToggle("OFF")}),a.addEventListener("blur",function($){P.isFocusActive=!1,P.currentFocusPanelId=""}),a.addEventListener("focus",function($){P.isFocusActive=!0,P.currentFocusPanelId=$.currentTarget.getAttribute("panel-index")}),a.addEventListener("keydown",function($){P.settingOnKeyDownAction($)}),f.querySelector(".mp-panel-menu").appendChild(a))}return f},showSettingPopup:function(t){if(t=t||{},!v.$data.isTouchMove){var f=v.$el.mPlayer.querySelector(".mp-popup");if(!f){C(),f=P.createSettingPopup(F),setTimeout(function(){f.querySelector("[panel-index]").focus()},100),v.$el.mplayerFooter.insertBefore(f,v.$el.mplayerFooter.childNodes[0]),P.setScalePopup(f),new g.popupInstance().setVisiblePopup(f,t.currentTarget);for(var x=f.getBoundingClientRect(),t=v.$el.mPlayer.getBoundingClientRect(),t=t.height-(t.height-x.bottom)-(t.top+10),m=x.height>=t?t:x.height,a=f.querySelectorAll(".mp-popup .mp-panel,.mp-popup .mp-panel-menu"),c=0;c<a.length;c++)a[c].style.width=x.width+"px",a[c].style.height=m+"px";f.style.width=x.width+"px",f.style.height=m+"px",f.querySelector(".mp-panel").classList.add("mp-panel-item")}}},focusToggle:function(t){var f=v.$el.mPlayer;t=="ON"?f.classList.contains("mp-keyboard-focus")||f.classList.add("mp-keyboard-focus"):f.classList.contains("mp-keyboard-focus")&&f.classList.remove("mp-keyboard-focus")},settingOnKeyDownAction:function(t){var f=v.$el.mPlayer.querySelector(".mp-popup"),x=v.$method.getKeyCode(t);if(P.focusToggle("ON"),new Array(13,32,37,38,39,40).indexOf(x)!=-1&&(t.stopPropagation(),t.preventDefault()),x!=32&&x!=13)if(x!=37)if(x!=38)if(x!=39){if(x==40){for(a=[],a=(m=P.getPanelOption(P.currentFocusPanelId,"parent"))instanceof Array?m:(m||{}).childConfig||[],L=0;L<a.length;L++)if(a[L].panelIndex==P.currentFocusPanelId){L!=a.length-1?(c=a[L+1].panelIndex,f.querySelector('[panel-index="'+c+'"]').focus()):f.querySelector('[panel-index="'+a[0].panelIndex+'"]').focus();break}}}else(m=P.getPanelOption(P.currentFocusPanelId,"current"))&&m.childConfig instanceof Array&&0<m.childConfig.length&&P.showPanel(m,"next");else{var m,a=[];a=(m=P.getPanelOption(P.currentFocusPanelId,"parent"))instanceof Array?m:(m||{}).childConfig||[];for(var c,L=0;L<a.length;L++)if(a[L].panelIndex==P.currentFocusPanelId){L==0?f.querySelector('[panel-index="'+a[a.length-1].panelIndex+'"]').focus():(c=a[L-1].panelIndex,f.querySelector('[panel-index="'+c+'"]').focus());break}}else{var _=f.querySelector(".mp-panel-header .title");_&&_.click()}else _=P.getPanelOption(P.currentFocusPanelId),P.triggerSelected(_,t)},onSettingKeyDown:function(t,f){t.preventDefault(),v.$el.mplayerFooter.querySelector(".mp-popup").querySelector("[panel-index]").focus(),P.focusToggle("ON"),P.settingOnKeyDownAction(t)},initSubtitleOption:function(){var t=v.$el.videoObject?v.$el.videoObject.textTracks:"";if(t&&t instanceof TextTrackList&&0<t.length){var f=new M().subtitle;f.childConfig[1].childConfig.splice(0,f.childConfig[1].childConfig.length);for(var x=0;x<t.length;x++){var m=t[x];f.childConfig[1].childConfig.push({functions:m.label,selected:m.mode=="showing"})}return f}}},A={toggleVisible:function(t,f){if(t===!0&&v.$data.showScreenControls)return v.$method.createTimerCloseControl(),void(v._this._global_.webpagePlugin.hiddleControl||f instanceof Function&&f());t!==!0||v.$data.showScreenControls||(v.$method.toggleControlsDisplay({type:"showControls"}),v._this._global_.webpagePlugin.hiddleControl=!0,setTimeout(function(){v._this._global_.webpagePlugin.hiddleControl=!1,f instanceof Function&&f()},300))},escKeyDown:function(){new g.popupInstance().togglePopupVisible("OFF"),P.focusToggle("OFF"),v.$el.mPlayer.focus()},confirmKeyDown:function(t){new w.interface()._onAgentMpTap("click"),A.escKeyDown()},leftKeyDown:function(){var t;v.option.live!==!0&&(A.toggleVisible(!0),t=v.$el.videoObject.currentTime-5,v.$data.currentTime=0<t?t:.1,v.$el.videoObject.currentTime=v.$data.currentTime,g.showHandleIcon("progress-back"),new g.popupInstance().togglePopupVisible("OFF"))},rightKeyDown:function(){var t,f;v.option.live!==!0&&(A.toggleVisible(!0),t=v.$data,(f=v.$el.videoObject.currentTime+5)<=t.duration?v.$data.currentTime=f:v.$data.currentTime=Number.parseInt(t.duration),v.$el.videoObject.currentTime=v.$data.currentTime,g.showHandleIcon("progress-forward"),new g.popupInstance().togglePopupVisible("OFF"))},topKeyDown:function(){v.$el.mplayerFooter.querySelector("#volume-switch").exist!==!1&&(A.toggleVisible(!0,function(){var t=o.getStorageVolume(),f=t.volume;t.muted===!0?(v.$el.videoObject.muted=!1,f=5):f+=5,o.showVolumePopup(event),o.setVolume(!1,f)}),g.showHandleIcon("volume-icon"))},bottomKeyDown:function(){v.$el.mplayerFooter.querySelector("#volume-switch").exist!==!1&&(A.toggleVisible(!0,function(){var t=o.getStorageVolume(),f=t.volume;t.muted===!0?(v.$el.videoObject.muted=!1,f=5):f-=5,o.showVolumePopup(event),o.setVolume(!1,f)}),g.showHandleIcon("volume-icon"))},onDocKeydown:function(t){var f=v.$method.getKeyCode(t);new Array(37,38,39,40,32,13).indexOf(f)!=-1&&(t.stopPropagation(),t.preventDefault()),f!=70?f!=77?f!=27?f!=32&&f!=75?f!=37?f!=38?f!=39?f==40&&A.bottomKeyDown():A.rightKeyDown():A.topKeyDown():A.leftKeyDown():A.confirmKeyDown(t):A.escKeyDown():o.onClickEvent({currentTarget:v.$el.mplayerFooter.querySelector("#volume-switch")},!0):(t=v.$el.mplayerFooter.querySelector("#full-switch"))instanceof Element&&t.click()}},g={popupInstance:function(){this.createPopupElement=function(){var t=document.createElement("div");return t.setAttribute("class","mp-popup"),t},this.setVisiblePopup=function(t,f){this.togglePopupVisible("ON");var x=f.getBoundingClientRect(),c=t.getBoundingClientRect(),m=v.$el.mPlayer.getBoundingClientRect(),a=v.$el.touchEffective instanceof Element?v.$el.touchEffective.getBoundingClientRect():{},c=m.width-x.left+m.left-c.width/2-x.width/2;return t.style.right=(12<=c?c:12)+"px",m=m.height-(a.top||x.top-5)+m.top,t.style.bottom=m+"px",k.popupNodeInfo.triggerButtonRect=f.getBoundingClientRect(),k.popupNodeInfo.popupRect=t.getBoundingClientRect(),t},this.togglePopupVisible=function(t){var f=!!v.$el.mPlayer&&v.$el.mPlayer.querySelector(".mp-popup");f&&(f.classList.add("popup-toggle"),t=="OFF"?(v.$el.mPlayer.focus(),f.style.opacity=0,setTimeout(function(){f.parentNode&&f.parentNode.removeChild(f)},110),v._this._global_.webpagePlugin.showSettingState=!1,v.$method.createTimerCloseControl(),document.removeEventListener("mousemove",g.onDocMousemoveEvent)):(setTimeout(function(){f.style.opacity=1},5),setTimeout(function(){f.classList.remove("popup-toggle")},110),v._this._global_.webpagePlugin.showSettingState=!0,setTimeout(function(){v.$method.createTimerCloseControl({type:"cancel"})},100),document.addEventListener("mousemove",g.onDocMousemoveEvent)))}},onEffectiveOverEvent:function(t){var f=(t=t||{}).type||"";if(!v._this._global_.webpagePlugin.showSettingState){var x=function(m){var a=v.$el.touchEffective.querySelectorAll("#progress-total,#progress-buffered,#progress-play");if(m){for(var c=0;c<a.length;c++)a[c].classList.add("progress-hover-scale");v.$el.progressBall.classList.add("hover-scale"),v.$el.touchEffective.querySelector(".mp-tooltip").style.display="block",v.$el.touchEffective.querySelector(".mp-thumbnails").style.display="block"}if(!m){for(c=0;c<a.length;c++)a[c].classList.remove("progress-hover-scale");v.$el.progressBall.classList.remove("hover-scale"),v.$el.touchEffective.querySelector(".mp-tooltip").style.display="none",v.$el.touchEffective.querySelector(".mp-thumbnails").style.display="none"}};switch(f){case"mouseover":x(!0),g.showTimeTooltip(t),g.showThumbnails(t),v.$el.touchEffective.addEventListener("mousemove",g.onEffectiveOverEvent),v.$el.touchEffective.addEventListener("mouseout",g.onEffectiveOverEvent);break;case"mousemove":x(!0),g.showTimeTooltip(t),g.showThumbnails(t);break;case"mouseout":x(!1),v.$el.touchEffective.removeEventListener("mousemove",g.onEffectiveOverEvent),v.$el.touchEffective.removeEventListener("mouseout",g.onEffectiveOverEvent)}}},addControlTooltip:function(t){for(var f=v.$el.mplayerFooter.querySelectorAll(".footer-control"),x=0;x<f.length;x++)f[x].getAttribute("tooltip")&&(f[x].addEventListener("mouseover",function(m){var a,c,L,_=document.createElement("div");_.setAttribute("class","mp-tooltip"),_.innerText=m.currentTarget.getAttribute("tooltip"),v.$el.mplayerFooter.querySelector(".mp-tooltip").exist!==!1||v.$data.isTouchMove||(v.$el.mplayerFooter.insertBefore(_,v.$el.mplayerFooter.childNodes[0]),a=m.currentTarget.getBoundingClientRect(),c=_.getBoundingClientRect(),L=v.$el.mPlayer.getBoundingClientRect(),m=v.$el.touchEffective instanceof Element?v.$el.touchEffective.getBoundingClientRect():{},c=L.width-a.left+L.left-c.width/2-a.width/2,_.style.right=(16<=c?c:16)+"px",L=L.height-(m.top||a.top-5)+L.top,_.style.bottom=L+"px")}),f[x].addEventListener("mouseout",function(m){v.$method.removeNode(v.$el.mplayerFooter,".mp-tooltip")}))},thumbnailStyleAtBottom:function(){var t=typeof I.fullScaling=="number"&&1<=I.fullScaling?I.fullScaling:1.2;return v.$data.isFullScreen?25.6*t:25.92},showThumbnails:function(t){var f,x,m,a=v.$el.touchEffective.querySelector(".mp-thumbnails"),c=0,L=0,$=I.thumbnails||{},_=$.preview||[],B=$.tile||[10,10],$=$.scale||[160,90],K=B[0]||10,H=B[1]||10,j=$[0]||160,W=$[1]||90;_.length!=0&&(f=v.$el.mPlayer.getBoundingClientRect(),x=v.$el.touchEffective.getBoundingClientRect(),m=t.clientX-x.left,v.$method.computeProgress(m,v.$el.touchEffective,function(J){100<=J?J=100:J<=0&&(J=0);var Q=parseInt(J/100*v.$data.duration),V=(c=Q)%K==0?0:parseInt(c%K)*j,J=c/K<1?0:parseInt(c/K)*W;(function(){L=parseInt(c/(K*H)),v.$el.touchEffective.querySelector('[data-playimage-index="'+L+'"]').exist===!1&&((X=document.createElement("div")).setAttribute("class","preview-image"),X.setAttribute("data-playimage-index",L),X.style.width="100%",X.style.height="100%",_.length>L&&(X.style.backgroundImage="url("+_[L]+")"),a.exist===!1?((a=document.createElement("div")).setAttribute("class","mp-thumbnails thumbnails-scale"),a.style.outline="2px #FFFFFF solid",a.style.width=j+"px",a.style.height=W+"px",a.style.position="absolute",a.style.pointerEvents="none",a.appendChild(X),v.$el.touchEffective.appendChild(a)):a.appendChild(X));for(var X=v.$el.touchEffective.querySelectorAll(".preview-image"),q=0;q<X.length;q++){var ue=X[q].getAttribute("data-playimage-index");X[q].style.display=ue!=L?"none":"block"}})(),Q=a.getBoundingClientRect(),v.$el.touchEffective.querySelector('[data-playimage-index="'+L+'"]').style.backgroundPosition=-V+"px "+-J+"px",V=g.thumbnailStyleAtBottom(),a.style.bottom=Math.round(V)+"px",J=m-Q.width/2,V=x.left-f.left+J,Q=f.width-(x.left-f.left+J+Q.width),12<=V&&12<=Q&&(a.style.left=J+"px")}))},showTimeTooltip:function(t){var f=v.$el.touchEffective.getBoundingClientRect(),x=t.clientX-f.left,m=v.$el.mPlayer.getBoundingClientRect(),a=v.$el.touchEffective.getBoundingClientRect();v.$method.computeProgress(x,v.$el.touchEffective,function(c){100<=c?c=100:c<=0&&(c=0);var L=c/100*v.$data.duration,_=v.$method.formatCurrentTime(L),B=v.$el.touchEffective.querySelector(".mp-tooltip");B.exist===!1&&((B=document.createElement("div")).setAttribute("class","mp-tooltip"),v.$el.touchEffective.appendChild(B)),c=g.thumbnailStyleAtBottom(),B.style.bottom=Math.round(c+2)+"px",L=B.getBoundingClientRect(),B.innerText=_,c=x-L.width/2,_=a.left-m.left+c,L=m.width-(a.left-m.left+c+L.width),12<=_&&12<=L&&(B.style.left=c+"px")})},addFocusKeyboardHandle:function(){for(var t=v.$el.mPlayer.querySelectorAll(".keyboard-input"),f=0;f<t.length;f++)t[f].addEventListener("keydown",function(x){var m=v.$method.getKeyCode(x),a=x.currentTarget.getAttribute("id");new Array(13,32).indexOf(m)!=-1&&(new g.popupInstance().togglePopupVisible("OFF"),m!=32&&(a!="setting-switch"?a!="volume-switch"?x.currentTarget.click():o.showVolumePopup(x):P.showSettingPopup(x)))}),t[f].addEventListener("mousedown",function(x){v._this._global_.webpagePlugin.inputMousedownFlag=!0,P.focusToggle("OFF"),v.$method.createTimerCloseControl()}),t[f].addEventListener("focus",function(x){setTimeout(function(){v._this._global_.webpagePlugin.inputMousedownFlag||P.focusToggle("ON"),v._this._global_.webpagePlugin.inputMousedownFlag=!1,g.onMpMousemoveEvent(),document.activeElement.classList.contains("keyboard-input")&&v.$method.createTimerCloseControl({type:"cancel"})},10)}),t[f].addEventListener("blur",function(){v.$el.mPlayer.querySelector(".mplayer-sidebar.open")||v.$method.createTimerCloseControl()})},onMpMousemoveEvent:function(){v.$data.showScreenControls?v._this._global_.webpagePlugin.showSettingState||v.$method.createTimerCloseControl():v.$method.toggleControlsDisplay({type:"showControls"}),v._this._global_.webpagePlugin.forControlsClose=!1},onMpMouseleaveEvent:function(t){v._this._global_.webpagePlugin.showSettingState||v._this._global_.webpagePlugin.forControlsClose||v.$data.isTouchMove||v.$method.toggleControlsDisplay({type:"hideControls"}),v._this._global_.webpagePlugin.forControlsClose=!0},onDocMousemoveEvent:function(t){var c=k.popupNodeInfo.popupRect,L=k.popupNodeInfo.triggerButtonRect,f=c.left,x=c.left+c.width,m=c.top,a=c.top+c.height,x=t.clientX>f&&t.clientX<x&&t.clientY>m&&t.clientY<a,m=L.left-15,a=L.left+L.width+15,c=c.bottom-5,L=L.bottom+5,L=t.clientX>m&&t.clientX<a&&t.clientY>c&&t.clientY<L;x||L||!P.isNextReady||new g.popupInstance().togglePopupVisible("OFF")},setElScale:function(t,f){var x=typeof I.fullScaling=="number"&&1<=I.fullScaling?I.fullScaling:1.2,m=v.$data.isFullScreen,a={};if(Array.isArray(f)?f.forEach(function(z){a[z]=""}):a=f,t instanceof Element){var c=function(z){return Math.round(z)},L=function(z){return Number(z.replace("px",""))},_=t.getBoundingClientRect(),B=t.getAttribute("stylesheet");try{B=B?JSON.parse(B):{}}catch{}var $,K,H,j,W=function(){t.style.lineHeight=m?c((a.lineHeight||_.height)*x)+"px":(a.lineHeight||c(_.height*x))+"px"};for($ in a)switch($){case"width":j=void 0,m?(j=c((a.width||_.width)*x),t.style.width=(j%2==0?j:j+1)+"px"):t.style.width=a.width?a.width+"px":B.width||c(_.width/x)+"px";break;case"height":H=void 0,m?(H=c((a.height||_.height)*x),t.style.height=(H%2==0?H:H+1)+"px"):t.style.height=a.height?a.height+"px":B.height||c(_.height/x)+"px";break;case"fontSize":K=void 0,K=document.defaultView.getComputedStyle(t,null).fontSize,t.style.fontSize=m?c((a.fontSize||L(K))*x)+"px":a.fontSize?a.fontSize+"px":B.fontSize||c(L(K)/x)+"px";break;case"lineHeight":case"transform":W()}}},toggles:function(){this.pageFull=function(t){function f(){a.contains("page-fullscreen")||(v._this._global_.webpagePlugin.isPagefull=!0,v.$el.mPlayer.classList.add("page-fullscreen"),m[0].style.display="none",m[1].style.display="block",m[0].parentNode.setAttribute("tooltip",v.$method.getLangObject().exitPageScreen),v._this.emit("pagefull-change",{pagefull:!0})),t instanceof Object&&v.$method.changeVideoSize({type:"pagefulll"})}function x(){a.contains("page-fullscreen")&&(v._this._global_.webpagePlugin.isPagefull=!1,v.$el.mPlayer.classList.remove("page-fullscreen"),m[0].style.display="block",m[1].style.display="none",m[0].parentNode.setAttribute("tooltip",v.$method.getLangObject().pageScreen),v._this.emit("pagefull-change",{pagefull:!1})),t instanceof Object&&v.$method.changeVideoSize({type:"pagefulll"})}var m=v.$el.mPlayer.querySelectorAll("._fullpage,._unfullpage"),a=v.$el.mPlayer.classList;t=="change"?x():t=="initFullFixed"?f():((v.$el.mPlayer.classList.contains("page-fullscreen")?x:f)(),v.$data.isFullScreen&&v.$method.fullToggle())},this.timeControls=function(t){var f=v.$el.mPlayer.querySelector("#current-time");t?function x(){var a=new Date,m=a.getHours()<10?"0"+a.getHours():a.getHours(),a=a.getMinutes()<10?"0"+a.getMinutes():a.getMinutes();f&&(f.innerHTML=m+":"+a,f.style.display="inline-block"),v._this._global_.webpagePlugin.timer_1&&clearInterval(v._this._global_.webpagePlugin.timer_1),v._this._global_.webpagePlugin.timer_1=setTimeout(function(){v.$data.isFullScreen&&v.$data.showScreenControls&&x()},1e3)}():f&&(f.style.display="none")},this.scaleControls=function(t){var f=typeof I.fullScaling=="number"&&1<I.fullScaling?I.fullScaling:1.2,x=v.$el.mPlayer.classList;if((!t||!x.contains("fullscreen-scaling"))&&(t||x.contains("fullscreen-scaling"))){for(var m,a,c,L,_,B=[{selector:".mplayer-header,.mplayer-footer",attr:["height"]},{selector:".header-control,.footer-control,.mplayer-sidebar",attr:["width","fontSize"]},{selector:"#mplayer-loading .mplayer-loading__circular",attr:{width:40,height:40}},{selector:".mplayer-shortcut",attr:{width:430}},{selector:".mplayer-shortcut .title",attr:{fontSize:16}},{selector:".mplayer-shortcut .close-shortcut-panel",attr:{fontSize:28}},{selector:".mplayer-shortcut ul",attr:{fontSize:14}},{selector:"#progress-total,#progress-buffered,#progress-play",attr:{height:2}},{selector:"#progress-ball .progress-ball",attr:{width:15,height:15}},{selector:"#mplayer-toast",attr:["fontSize"]},{selector:"#mplayer-footer .spot",attr:["height","width"]}],$=0;$<B.length;$++)for(var K=v.$el.mPlayer.querySelectorAll(B[$].selector),H=0;H<K.length;H++)g.setElScale(K[H],B[$].attr);t?x.add("fullscreen-scaling"):x.remove("fullscreen-scaling"),t?(m="@-webkit-keyframes mp-bezel-fadeout {from{opacity: 1;}to{opacity: 0;-webkit-transform: scale("+1.5*f+");transform: scale("+1.5*f+");}}@keyframes mp-bezel-fadeout {from{opacity: 1;}to{opacity: 0;-webkit-transform: scale("+1.5*f+");transform: scale("+1.5*f+");}}",a=".mp-tooltip {font-size: "+14*f+"px !important;}",c=".mp-thumbnails.thumbnails-scale {-webkit-transform: scale("+f+");-ms-transform: scale("+f+");transform: scale("+f+");-webkit-transform-origin: left bottom;-ms-transform-origin: left bottom;transform-origin: left bottom;}",x=".toast-scaling{font-size: "+14*f+"px !important;}",t=".mp-keyboard-focus .mp-menuitem:focus {box-shadow: inset 0 0 0 "+2*f+"px rgba(27,127,204,0.8) !important;}.mp-keyboard-focus .keyboard-input:focus {box-shadow: inset 0 0 0 "+2*f+"px rgba(27,127,204,0.8) !important;}",f="",v.$el.mPlayer.querySelector("#progress-container")&&(L=v.$el.mPlayer.querySelector("#progress-container").getBoundingClientRect(),_=v.$el.mPlayer.querySelector("#progress-container #progress-total").getBoundingClientRect(),f=".mplayer-footer .progress .progress-container.upper-position {margin-bottom: -"+(L.height-_.height)/2+"px !important;}"),(_=(L=document.getElementsByTagName("head").item(0)).querySelector("#player-scaling-style"))?v.$method.removeNode(L,"#player-scaling-style"):((_=document.createElement("style")).setAttribute("id","player-scaling-style"),_.setAttribute("type","text/css")),_.innerHTML=m+a+c+x+t+f,L.appendChild(_)):v.$method.removeNode(document.getElementsByTagName("head").item(0),"#player-scaling-style")}}},showHandleIcon:function(t){var f='<svg t="1598581427609" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2856" width="24" height="24"><path d="M267.58370352 186.11160469h162.94419765v651.77679062H267.58370352zM593.47209883 186.11160469h162.94419765v651.77679062h-162.94419765z" p-id="2857" fill="#ffffff"></path></svg>',x='<svg t="1598581671973" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2357" width="24" height="24"><path d="M287.49910545 187.55999756l502.5923252 324.51242209-502.5923252 324.44000244z" p-id="2358" fill="#ffffff"></path></svg>',m='<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16579" width="100%" height="100%"><path d="M512 8v237.17647013h237.17647013m148.23529481 266.82352987a59.29411753 59.29411753 0 1 1-59.29411753 59.29411753 59.29411753 59.29411753 0 0 1 59.29411753-59.29411753zM512 245.17647012a326.11764741 326.11764741 0 1 0 326.11764741 326.11764741h118.58823506A444.70588247 444.70588247 0 1 1 512 126.58823506v118.58823507z m-60.77647013 140.17129482l-24.90352987 194.3068237a300.23576494 300.23576494 0 0 1 48.32470617-3.20188247c71.74588247 0 106.72941136 32.61176494 106.72941136 84.34588247a81.79623506 81.79623506 0 0 1-85.68 83.27858766 166.70541136 166.70541136 0 0 1-77.97176494-20.30823507l-13.93411753 46.99058864a191.31247013 191.31247013 0 0 0 93.9811763 22.4131763 137.76988247 137.76988247 0 0 0 146.75294123-137.71058864c0-82.21129383-63.14823506-124.93270617-136.08-124.93270617-11.26588247 0-18.67764741 1.06729383-26.68235259 1.60094123l13.3411763-95.55247012h140.82352987v-51.23011753h-184.70117629z" p-id="16580" fill="#ffffff"></path></svg>',a='<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16817" width="100%" height="100%"><path d="M512 1016A444.70588247 444.70588247 0 0 1 67.29411753 571.29411753a59.29411753 59.29411753 0 0 1 118.58823506 0A326.11764741 326.11764741 0 1 0 512 245.17647012V126.58823506a444.70588247 444.70588247 0 0 1 0 889.41176494z m108.50823506-360.53788247a137.76988247 137.76988247 0 0 1-146.75294123 137.71058864 190.42305877 190.42305877 0 0 1-93.9811763-22.4131763l13.63764741-46.99058864a166.70541136 166.70541136 0 0 0 77.97176493 20.30823507 82.03341136 82.03341136 0 0 0 85.97647013-83.27858766c0-51.79341136-35.28-84.34588247-106.72941136-84.34588247a304.23811753 304.23811753 0 0 0-48.62117728 3.20188247l25.2-194.3068237h184.70117728v51.23011753h-140.82352987l-13.3411763 95.55247012c8.00470617-0.53364741 15.41647013-1.60094123 26.68235259-1.60094123 72.93176494 0 136.08 42.72141136 136.08 124.93270617zM512 8v237.17647013H274.82352987z" p-id="16818" fill="#ffffff"></path></svg>',c=v.$el.mPlayer.querySelector(".mp-bezel-text-hide");switch(t){case"mouseclick":v.$data.isPlay?c.querySelector(".mp-bezel-icon").innerHTML=f:c.querySelector(".mp-bezel-icon").innerHTML=x;break;case"progress-forward":c.querySelector(".mp-bezel-icon").innerHTML=m;break;case"progress-back":c.querySelector(".mp-bezel-icon").innerHTML=a;break;case"volume-icon":c.querySelector(".mp-bezel-icon").innerHTML=o.toggleVolumeIcon()}c.style.display=="none"?c.style.display="block":(c.style.display="none",v._this._global_.webpagePlugin.handleIconTimer_1||(v._this._global_.webpagePlugin.handleIconTimer_1=setTimeout(function(){v._this._global_.webpagePlugin.handleIconTimer_1=!1,c.style.display="block"},15))),v._this._global_.webpagePlugin.handleIconTimer_2&&window.clearTimeout(v._this._global_.webpagePlugin.handleIconTimer_2),v._this._global_.webpagePlugin.handleIconTimer_2=setTimeout(function(){c.style.display="none"},400)},buildBasePanel:function(t){var f=t.querySelector("#right-part"),x=document.createElement("button");x.setAttribute("class","player-btn keyboard-input footer-control"),x.setAttribute("id","volume-switch"),x.setAttribute("control",""),x.innerHTML=o.toggleVolumeIcon(),f.insertBefore(x,f.childNodes[f.childNodes.length-1]),x.addEventListener("mouseover",o.showVolumePopup),x.addEventListener("click",o.onClickEvent),!document.pictureInPictureEnabled||t.querySelector("video").disablePictureInPicture||((m=document.createElement("button")).setAttribute("class","player-btn keyboard-input footer-control picture-in-picture"),m.setAttribute("id","picture-in-picture"),m.setAttribute("tooltip",v.$method.getLangObject().pictureInPicture),m.setAttribute("control",""),m.innerHTML=y.togglePictureIcon(),f.insertBefore(m,f.childNodes[f.childNodes.length-1]),m.addEventListener("click",y.onPictureInPicture)),C("statics");var m=(v.option.subtitle||{}).tracks;(0<F.length||Array.isArray(m)&&0<m.length)&&((a=document.createElement("button")).setAttribute("class","player-btn keyboard-input footer-control"),a.setAttribute("id","setting-switch"),a.setAttribute("control",""),a.innerHTML='<svg t="1607605827678" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2386"><path d="M857.9375 512c0-49.125 30.84375-90.75 74.0625-107.34375-10.3125-40.5-26.25-78.65625-47.0625-113.71875C842.5625 309.78125 791.375 302.09375 756.6875 267.3125c-34.6875-34.6875-42.375-85.96875-23.53125-128.25C698 118.25 659.84375 102.3125 619.34375 92c-16.6875 43.21875-58.3125 74.0625-107.34375 74.0625-49.125 0-90.75-30.84375-107.34375-74.0625-40.5 10.3125-78.65625 26.25-113.71875 47.0625 18.84375 42.375 11.15625 93.5625-23.53125 128.25-34.6875 34.6875-85.96875 42.375-128.25 23.625C118.25 326 102.3125 364.15625 92 404.65625c43.21875 16.6875 74.0625 58.3125 74.0625 107.34375 0 49.125-30.84375 90.75-74.0625 107.34375 10.3125 40.5 26.25 78.65625 47.0625 113.71875C181.4375 714.21875 232.625 721.90625 267.3125 756.6875c34.6875 34.6875 42.375 85.96875 23.53125 128.25C326 905.75 364.15625 921.6875 404.65625 932c16.6875-43.21875 58.3125-74.0625 107.34375-74.0625 49.125 0 90.75 30.84375 107.34375 74.0625 40.5-10.3125 78.65625-26.25 113.71875-47.0625-18.84375-42.375-11.15625-93.5625 23.53125-128.25 34.6875-34.6875 85.96875-42.375 128.25-23.625C905.75 698 921.6875 659.84375 932 619.34375c-43.21875-16.59375-74.0625-58.21875-74.0625-107.34375zM512 627.3125c-63.65625 0-115.3125-51.65625-115.3125-115.3125s51.65625-115.3125 115.3125-115.3125 115.3125 51.65625 115.3125 115.3125-51.65625 115.3125-115.3125 115.3125z" p-id="2387" fill="#ffffff"></path></svg>',a.addEventListener("mouseover",P.showSettingPopup),f.insertBefore(a,f.childNodes[f.childNodes.length-1]));var a=document.createElement("button");a.setAttribute("class","player-btn keyboard-input footer-control"),a.setAttribute("id","pagefull-switch"),a.setAttribute("tooltip",v.$method.getLangObject().pageScreen),a.setAttribute("control",""),a.innerHTML='<div class="_fullpage"controls="full-page"><svg t="1607605504727"class="icon"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"p-id="2356"><path d="M948.90666667 851.69493333H75.09333333c-27.30666667 0-49.152-21.84533333-49.152-43.69066666v-655.36c0-27.30666667 21.84533333-49.152 49.152-49.152h873.81333334c27.30666667 0 43.69066667 21.84533333 43.69066666 49.152v655.36c0 27.30666667-16.384 43.69066667-43.69066666 43.69066666z m-824.66133334-87.38133333h780.97066667V196.33493333H124.24533333v567.97866667z"p-id="2357"fill="#ffffff"></path><path d="M238.93333333 496.70826667c-21.84533333 0-43.69066667-16.384-43.69066666-43.69066667v-136.53333333c0-21.84533333 16.384-43.69066667 43.69066666-43.69066667h136.53333334c21.84533333 0 43.69066667 16.384 43.69066666 43.69066667s-21.84533333 38.22933333-43.69066666 38.22933333H282.624v98.304c0 21.84533333-21.84533333 43.69066667-43.69066667 43.69066667zM785.06666667 687.85493333h-136.53333334c-21.84533333 0-43.69066667-16.384-43.69066666-43.69066666s16.384-43.69066667 43.69066666-43.69066667h92.84266667v-98.304c0-21.84533333 16.384-43.69066667 43.69066667-43.69066667s43.69066667 16.384 43.69066666 43.69066667v141.99466667c-5.46133333 21.84533333-21.84533333 43.69066667-43.69066666 43.69066666z"p-id="2358"fill="#ffffff"></path></svg></div><div class="_unfullpage"controls="unfull-page"style="display: none;"><svg t="1607605550628"class="icon"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"p-id="2519"><path d="M948.90666667 851.69493333H75.09333333c-27.30666667 0-49.152-21.84533333-49.152-43.69066666v-655.36c0-27.30666667 21.84533333-49.152 49.152-49.152h873.81333334c27.30666667 0 43.69066667 21.84533333 43.69066666 49.152v655.36c0 27.30666667-16.384 43.69066667-43.69066666 43.69066666z m-824.66133334-87.38133333h780.97066667V196.33493333H124.24533333v567.97866667z"p-id="2520"fill="#ffffff"></path><path d="M375.46666667 496.70826667H238.93333333c-21.84533333 0-43.69066667-16.384-43.69066666-43.69066667s21.84533333-38.22933333 43.69066666-38.22933333h92.84266667v-98.304c0-21.84533333 16.384-43.69066667 43.69066667-43.69066667s38.22933333 21.84533333 38.22933333 43.69066667v136.53333333c0 21.84533333-16.384 43.69066667-38.22933333 43.69066667zM648.53333333 687.85493333c-21.84533333 0-43.69066667-16.384-43.69066666-43.69066666v-136.53333334c0-21.84533333 16.384-43.69066667 43.69066666-43.69066666H785.06666667c21.84533333 0 43.69066667 16.384 43.69066666 43.69066666s-16.384 43.69066667-43.69066666 43.69066667h-92.84266667v92.84266667c-5.46133333 21.84533333-21.84533333 43.69066667-43.69066667 43.69066666z"p-id="2521"fill="#ffffff"></path></svg></div>',f.insertBefore(a,f.childNodes[f.childNodes.length-1]),a.addEventListener("click",new g.toggles().pageFull),v.$method.removeNode(t,"#back-button #back-icon-svg"),a=document.createElement("button"),v.$method.setElementStyle(a,{fontSize:"18px",color:"#FFFFFF",width:"auto"}),a.setAttribute("class","player-btn header-control"),a.setAttribute("id","current-time"),a.setAttribute("control",""),a.innerHTML='<div id="" style="display: none;"></div>',t.querySelector("#buttom-group").appendChild(a),t.appendChild(v.$method.createRangeIsDocFragment('<div style="display: none;"class="mp-bezel-text-hide"><div class="mp-bezel"><div class="mp-bezel-icon"></div></div></div>')),a=document.createElement("div"),a.setAttribute("class","ctxmenu-wrapper"),a.setAttribute("id","ctxmenu-wrapper"),a.addEventListener("click",function(L){L.stopPropagation()}),t.appendChild(a);var c=document.createElement("div");return c.setAttribute("class","mplayer-shortcut"),c.setAttribute("id","mplayer-shortcut"),a=v.$method.getLangObject().shortcutsPanel,c.innerHTML='<p class="title">'+a.title+'</p><div class="close-shortcut-panel">\xD7</div><ul><li><label>'+a.space+"\uFF1A</label><span>"+a.spaceAction+"</span></li><li><label>Esc\uFF1A</label><span>"+a.esc+"</span></li></ul><ul><li><label>\u2191\uFF1A</label><span>"+a.up+"</span></li><li><label>\u2193\uFF1A</label><span>"+a.down+"</span></li></ul><ul><li><label>\u2192\uFF1A</label><span>"+a.right+"</span></li><li><label>\u2190\uFF1A</label><span>"+a.left+"</span></li></ul>",c.addEventListener("click",function(L){L.stopPropagation()}),c.addEventListener("dblclick",function(L){L.stopPropagation()}),c.addEventListener("mouseup",function(L){L.stopPropagation()}),c.querySelector(".close-shortcut-panel").addEventListener("click",function(){c.style.display="none"}),t.appendChild(c),t},initConfigControls:function(t){v.option.live!=1&&((a=document.createElement("button")).setAttribute("class","player-btn footer-control keyboard-input"),a.setAttribute("style","color: white;display: flex;align-items: center;width: auto;"),a.innerHTML='<div class="progress-begin" id="progress-begin"style="width: initial;margin-right: 5px;font-size: inherit;">'+v.$method.getLangObject().begin+'</div><div class="time-symbol">/</div><div class="progress-long" id="progress-long" style="color: #dddddd;width: initial;margin-left: 5px;font-size: inherit;">'+v.$method.getLangObject().end+"</div>",v.$method.setElementStyle(a,{color:"#FFFFFF",display:"flex",width:"auto"}),v.$method.removeNode(t,"#progress-begin"),v.$method.removeNode(t,"#progress-long"),t.querySelector("#left-part").appendChild(a)),t.querySelector("#progress-ball")&&t.querySelector("#progress-ball").classList.add("default-scale"),t.querySelector(".progress-ball")&&(t.querySelector(".progress-ball").style.height="15px"),t.querySelector(".progress-ball")&&(t.querySelector(".progress-ball").style.width="15px"),t.querySelector("#progress-container")&&t.querySelector("#progress-container").setAttribute("style","left: 12px;right: 12px;"),t.querySelector("#touch-effective")&&(t.querySelector("#touch-effective").style.margin="0");for(var f=t.querySelectorAll("#progress-total,#progress-buffered,#progress-play"),x=0;x<f.length;x++)f[x]&&f[x].classList.add("progress-default-scale");var c=o.getStorageVolume(),m=c.expiration,a=c.muted,c=c.volume;return typeof m=="number"&&m>new Date().getTime()?(typeof a=="boolean"&&(t.querySelector("video").muted=a),typeof c=="number"&&(t.querySelector("video").volume=0<c&&c<100?Number.parseInt(c)/100:1)):(c=v.option.volume,o.setStorageVolume(0<=c&&c<=1?100*c:100)),v.option.muted===!0&&(t.querySelector("video").muted=!0,o.setStorageVolume(null,!0)),t=g.buildBasePanel(t)},onFullscreenChange:function(t){v._this._global_.isReady&&(t.fullscreen?(new g.toggles().pageFull("change"),new g.toggles().timeControls(!0),new g.toggles().scaleControls(!0)):(new g.toggles().scaleControls(!1),new g.toggles().timeControls(!1),new g.popupInstance().togglePopupVisible("OFF")))},onControlsToggle:function(t){t.show||new g.popupInstance().togglePopupVisible("OFF"),v.$data.isFullScreen&&new g.toggles().timeControls(t.show);function f(x){v.$el.mPlayer.style.cursor=x}v._this._global_.webpagePlugin.timer_2&&clearTimeout(v._this._global_.webpagePlugin.timer_2),t.show||!v.$data.isFullScreen&&!v._this._global_.webpagePlugin.isPagefull?f("default"):v._this._global_.webpagePlugin.timer_2=setTimeout(function(){f("none")},1e3)},onReady:function(){var t;typeof v.$el=="function"&&(t=new v.$el,v.$el=t),v.option.initFullFixed===!0&&new g.toggles().pageFull("initFullFixed"),g.addFocusKeyboardHandle(),g.addControlTooltip(),g.toggleEventListenerGlobal("add","playerReady")},onDestory:function(){g.toggleEventListenerGlobal("remove","playerDestory")},onError:function(){g.toggleEventListenerGlobal("remove","playerError")},onAction:function(t){t=t=="add"?"on":"off",v._this[t]("fullscreen-change",g.onFullscreenChange),v._this[t]("controls-toggle",g.onControlsToggle),v._this[t]("ready",g.onReady),v._this[t]("destory",g.onDestory),v._this[t]("error",g.onError)},vaks:function(){return!0},toggleEventListenerGlobal:function(t,f){var x=t=="add"?"addEventListener":"removeEventListener";v._this._global_.webpagePlugin.eventStatus=x,v.$el.touchEffective instanceof Element&&v.$el.touchEffective[x]("mouseover",g.onEffectiveOverEvent),v.$el.mPlayer[x]("mousemove",g.onMpMousemoveEvent),I.leaveHiddenControls===!0&&v.$el.mPlayer[x]("mouseleave",g.onMpMouseleaveEvent),v.$el.mPlayer[x]("keydown",A.onDocKeydown),v.$el.mPlayer[x]("mouseup",u.createCtxmenu),v.$el.mPlayer[x]("contextmenu",u.onContextmenuEvent),f=="playerDestory"&&g.onAction("remove")}};this.interface=function(t){this._onAgentMpTap=function(f){if(f=="click"){if(v.$el.mPlayer.querySelector(".mplayer-sidebar.open"))return void v.$method.toggleControlsDisplay(t);v.$method.onPlayTap({type:"dblscreen"}),g.showHandleIcon("mouseclick"),v._this._global_.webpagePlugin.eventStatus=="removeEventListener"&&this._addEvent()}f=="dbclick"&&v.$method.fullToggle(t)},this._removeEvent=function(){g.toggleEventListenerGlobal("remove","activeRemove")},this._addEvent=function(){g.toggleEventListenerGlobal("add")}},this.appendTemplate=function(t,f){return v={},v=f,console.info("loading mui player desktop plugin..."),g.onAction("add"),t=g.initConfigControls(t),t},this.name="MuiPlayerDesktopPlugin"}})})(muiPlayerDesktopPlugin_min,muiPlayerDesktopPlugin_min.exports);var MuiPlayerDesktopPlugin=muiPlayerDesktopPlugin_min.exports,Home_vue_vue_type_style_index_0_scoped_true_lang="",_export_sfc=(e,n)=>{const S=e.__vccOpts||e;for(const[l,r]of n)S[l]=r;return S};const _withScopeId=e=>(pushScopeId("data-v-0c8ecc39"),e=e(),popScopeId(),e),_hoisted_1={class:"home"},_hoisted_2=_withScopeId(()=>createBaseVNode("div",{class:"video"},[createBaseVNode("div",{id:"mui-player"})],-1)),_hoisted_3=[_hoisted_2],_sfc_main={setup(e){onMounted(()=>{n()});const n=()=>{new MuiPlayer({container:"#mui-player",title:"\u6211\u5011\u7684\u85CD\u8ABF",src:"https://new.iskcd.com/20220409/xQswwnmI/1100kb/hls/playlist_up.m3u8",plugins:[new MuiPlayerDesktopPlugin({})],parse:{type:"hls",loader:Hls,config:{debug:!1}}})};return(S,l)=>(openBlock(),createElementBlock("div",_hoisted_1,_hoisted_3))}};var Home=_export_sfc(_sfc_main,[["__scopeId","data-v-0c8ecc39"]]);const routes=[{path:"/video_demo/",name:"Home",component:Home}],router=createRouter({history:createWebHistory(),routes});var style="";createApp(_sfc_main$1).use(router).mount("#app");
